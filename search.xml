<?xml version="1.0" encoding="utf-8"?>
<search>
  <entry>
    <title>博客搭建</title>
    <url>/2020/03/24/blog/%E5%8D%9A%E5%AE%A2%E6%90%AD%E5%BB%BA/</url>
    <content><![CDATA[<h2 id="软件下载"><a href="#软件下载" class="headerlink" title="软件下载"></a>软件下载</h2><p>1.Node.js</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;nodejs.org&#x2F;en&#x2F;</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<p>2.Git</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;git-scm.com&#x2F;</span><br></pre></td></tr></table></figure>


<p>3.使用淘宝镜像</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -g cnpm --registry&#x3D;https:&#x2F;&#x2F;regitstry.npm.taobao.org</span><br></pre></td></tr></table></figure>
<p>4.Hexo</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cnpm install -g hexo-cli</span><br></pre></td></tr></table></figure>
<p>5.验证</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git version</span><br><span class="line">node -v</span><br><span class="line">npm -v</span><br><span class="line">hexo -v</span><br></pre></td></tr></table></figure>
<h2 id="Hexo搭建博客"><a href="#Hexo搭建博客" class="headerlink" title="Hexo搭建博客"></a>Hexo搭建博客</h2><p>1.查看当前路径</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">pwd</span><br></pre></td></tr></table></figure>
<p>2.创建博客文件夹 blog</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mkdir blog</span><br></pre></td></tr></table></figure>
<p>3.进入到blog</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">cd blog</span><br></pre></td></tr></table></figure>
<p>4.初始化博客</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo init</span><br></pre></td></tr></table></figure>
<p>5.启动博客</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure>
<p>6.访问<code>localhost:4000</code></p>
<h2 id="主题下载"><a href="#主题下载" class="headerlink" title="主题下载"></a>主题下载</h2><p>1.官网主题</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">https:&#x2F;&#x2F;hexo.io&#x2F;themes&#x2F;</span><br></pre></td></tr></table></figure>
<p>2.举例Again主题<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;lyyourc&#x2F;hexo-theme-again.git themes&#x2F;again</span><br></pre></td></tr></table></figure><br>3.文件路径在<code>blog\themes\again\</code></p>
<p>4.修改hexo的配置文件_config.yml<br> <figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">theme: again</span><br></pre></td></tr></table></figure><br>5.清理博客</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo clean</span><br></pre></td></tr></table></figure>
<p>6.编译生成静态资源文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo g</span><br></pre></td></tr></table></figure>
<p>7.启动主题博客</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">hexo s</span><br></pre></td></tr></table></figure>
<p>8.访问<code>localhost:4000</code></p>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>博客</tag>
      </tags>
  </entry>
  <entry>
    <title>Next主题美化</title>
    <url>/2020/03/24/blog/%E4%B8%BB%E9%A2%98%E7%BE%8E%E5%8C%96/</url>
    <content><![CDATA[<h1 id="下载V5-X版本"><a href="#下载V5-X版本" class="headerlink" title="下载V5.X版本"></a>下载V5.X版本</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;iissnan&#x2F;hexo-theme-next.git themes&#x2F;next</span><br></pre></td></tr></table></figure>
<a id="more"></a>
<h1 id="修改主题样式"><a href="#修改主题样式" class="headerlink" title="修改主题样式"></a>修改主题样式</h1><blockquote>
<p>next/_config.yml</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">scheme: Gemini</span><br></pre></td></tr></table></figure>
<h1 id="修改国际化-V5-x"><a href="#修改国际化-V5-x" class="headerlink" title="修改国际化(V5.x)"></a>修改国际化(V5.x)</h1><blockquote>
<p>hexo的_config.yml</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">language: zh-Hans</span><br></pre></td></tr></table></figure>
<h1 id="更改URL"><a href="#更改URL" class="headerlink" title="更改URL"></a>更改URL</h1><blockquote>
<p>hexo的_config.yml</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">url: 博客的网络地址,指的是博客部署到网上的地址,不是github目录</span><br></pre></td></tr></table></figure>

<h1 id="添加API"><a href="#添加API" class="headerlink" title="添加API"></a>添加API</h1><blockquote>
<p>一言API,可以放在描述,简介一类需要介绍的地方</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;https://api.imjad.cn/hitokoto/?cat=&amp;charset=utf-8&amp;length=50&amp;encode=js&amp;fun=sync&amp;source=&quot;</span>&gt;&lt;<span class="regexp">/script&gt;&lt;div id=&quot;hitokoto&quot;&gt;&lt;script&gt;hitokoto()&lt;/</span>script&gt;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>毒鸡汤API,可以放在描述,简介一类需要介绍的地方</p>
</blockquote>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script type=<span class="string">&quot;text/javascript&quot;</span> src=<span class="string">&quot;https://api.qinor.cn/soup/index.php?encode=js&quot;</span>&gt; &lt;/script&gt;</span><br><span class="line">  &lt;script&gt; qinor() &lt;/script&gt;</span><br></pre></td></tr></table></figure>
<h1 id="创建标签页"><a href="#创建标签页" class="headerlink" title="创建标签页"></a>创建标签页</h1><ul>
<li>next配置文件,更改成以下,会缺失图标<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">menu:</span><br><span class="line">  home: &#x2F;</span><br><span class="line">  about: &#x2F;about&#x2F;</span><br><span class="line">  tags: &#x2F;tags&#x2F;</span><br><span class="line">  categories: &#x2F;categories&#x2F;</span><br></pre></td></tr></table></figure></li>
<li>在git命令中创建标签,以tags为例<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">hexo n page tags</span><br></pre></td></tr></table></figure></li>
<li>在博客的source目录中找到tags文件,修改内容<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: 标签</span><br><span class="line">date: 2020-03-27 13:03:38</span><br><span class="line">type: tags</span><br><span class="line">---</span><br></pre></td></tr></table></figure>
<h1 id="创建文章"><a href="#创建文章" class="headerlink" title="创建文章"></a>创建文章</h1></li>
<li>创建一个markdown文章</li>
<li>必须在文章顶部添加以下东西<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">---</span><br><span class="line">title: 新建文件的标题</span><br><span class="line">date: 文章创建时间</span><br><span class="line">tags:</span><br><span class="line"><span class="bullet">	-</span> 标签一</span><br><span class="line"><span class="bullet">	-</span> 标签二</span><br><span class="line">categories: 归档名称</span><br><span class="line">---</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="文章中的图片显示"><a href="#文章中的图片显示" class="headerlink" title="文章中的图片显示"></a>文章中的图片显示</h1><ol>
<li><p>在hexo的source文件夹下面创建images文件夹,把需要显示的图片放在此文件夹下面,eg:1.png</p>
</li>
<li><p>运行命令   <code>hexo n &quot;test&quot;</code></p>
</li>
<li><p>在test.md中引入图片的方式</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">![图片描述](&#x2F;images&#x2F;1.png)</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h1 id="动态背景-粒子漂浮聚合"><a href="#动态背景-粒子漂浮聚合" class="headerlink" title="动态背景-粒子漂浮聚合"></a>动态背景-粒子漂浮聚合</h1><ul>
<li>在根目录执行以下代码<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">git clone https:&#x2F;&#x2F;github.com&#x2F;theme-next&#x2F;theme-next-canvas-nest themes&#x2F;next&#x2F;source&#x2F;lib&#x2F;canvas-nest</span><br></pre></td></tr></table></figure></li>
<li>修改主题配置文件<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">canvas_nest:</span> <span class="literal">true</span> </span><br></pre></td></tr></table></figure>
<h1 id="头像动态设置"><a href="#头像动态设置" class="headerlink" title="头像动态设置"></a>头像动态设置</h1><blockquote>
<p>在<code>hemes\next\source\css_common\components\sidebar\sidebar-author.styl</code>添加</p>
</blockquote>
<figure class="highlight css"><table><tr><td class="code"><pre><span class="line"><span class="selector-class">.site-author-image</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: <span class="number">0</span> auto;</span><br><span class="line">  <span class="attribute">padding</span>: $site-author-image-padding;</span><br><span class="line">  <span class="attribute">max-width</span>: $site-author-image-width;</span><br><span class="line">  <span class="attribute">height</span>: $site-author-image-height;</span><br><span class="line">  <span class="attribute">border</span>: $site-author-image-border-width solid $site-author-image-border-color;</span><br><span class="line"></span><br><span class="line">  <span class="attribute">border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">-webkit-border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">-moz-border-radius</span>: <span class="number">50%</span>;</span><br><span class="line">  <span class="attribute">transition</span>: <span class="number">1.4s</span> all;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.site-author-image</span><span class="selector-pseudo">:hover</span> &#123;</span><br><span class="line">    <span class="attribute">-webkit-transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">    <span class="attribute">-moz-transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">    <span class="attribute">-ms-transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">    <span class="attribute">-transform</span>: <span class="built_in">rotate</span>(<span class="number">360deg</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.site-author-name</span> &#123;</span><br><span class="line">  <span class="attribute">margin</span>: $site-author-name-margin;</span><br><span class="line">  <span class="attribute">text-align</span>: $site-author-name-align;</span><br><span class="line">  <span class="attribute">color</span>: $site-author-name-color;</span><br><span class="line">  <span class="attribute">font-weight</span>: $site-author-name-weight;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="selector-class">.site-description</span> &#123;</span><br><span class="line">  <span class="attribute">margin-top</span>: $site-description-margin-top;</span><br><span class="line">  <span class="attribute">text-align</span>: $site-description-align;</span><br><span class="line">  <span class="attribute">font-size</span>: $site-description-font-size;</span><br><span class="line">  <span class="attribute">color</span>: $site-description-color;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<h1 id="页面添加宠物"><a href="#页面添加宠物" class="headerlink" title="页面添加宠物"></a>页面添加宠物</h1></li>
<li>插件安装<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install -save hexo-helper-live2d</span><br></pre></td></tr></table></figure></li>
<li>看板娘,<a href="https://github.com/xiazeyu/live2d-widget-models">其他宠物源码</a><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install live2d-widget-model-shizuku</span><br></pre></td></tr></table></figure></li>
<li>在next配置文件添加<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment">#添加宠物</span></span><br><span class="line"><span class="comment">#萌宠</span></span><br><span class="line"><span class="comment"># https://github.com/EYHN/hexo-helper-live2d</span></span><br><span class="line"><span class="attr">live2d:</span></span><br><span class="line">  <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">  <span class="attr">pluginRootPath:</span> <span class="string">live2dw/</span></span><br><span class="line">  <span class="attr">pluginJsPath:</span> <span class="string">lib/</span></span><br><span class="line">  <span class="attr">pluginModelPath:</span> <span class="string">assets/</span> <span class="string">Relative)</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 脚本加载源</span></span><br><span class="line">  <span class="attr">scriptFrom:</span> <span class="string">local</span> <span class="comment"># 默认从本地加载脚本</span></span><br><span class="line">  <span class="comment"># scriptFrom: jsdelivr # 从 jsdelivr CDN 加载脚本</span></span><br><span class="line">  <span class="comment"># scriptFrom: unpkg # 从 unpkg CDN 加载脚本</span></span><br><span class="line">  <span class="comment"># scriptFrom: https://cdn.jsdelivr.net/npm/live2d-widget@3.x/lib/L2Dwidget.min.js # 从自定义地址加载脚本</span></span><br><span class="line">  <span class="attr">tagMode:</span> <span class="literal">false</span> <span class="comment"># 只在有 &#123;&#123; live2d() &#125;&#125; 标签的页面上加载 / 在所有页面上加载</span></span><br><span class="line">  <span class="attr">log:</span> <span class="literal">false</span> <span class="comment"># 是否在控制台打印日志</span></span><br><span class="line"></span><br><span class="line">  <span class="comment"># 选择看板娘模型</span></span><br><span class="line">  <span class="attr">model:</span></span><br><span class="line">    <span class="attr">use:</span> <span class="string">live2d-widget-model-shizuku</span>  <span class="comment"># npm package的名字</span></span><br><span class="line">    <span class="comment"># use: wanko # /live2d_models/ 目录下的模型文件夹名称</span></span><br><span class="line">    <span class="comment"># use: ./wives/wanko # 站点根目录下的模型文件夹名称</span></span><br><span class="line">    <span class="comment"># use: https://cdn.jsdelivr.net/npm/live2d-widget-model-wanko@1.0.5/assets/wanko.model.json # 自定义网络数据源</span></span><br><span class="line">  <span class="attr">display:</span></span><br><span class="line">    <span class="attr">position:</span> <span class="string">right</span> <span class="comment"># 显示在左边还是右边</span></span><br><span class="line">    <span class="attr">width:</span> <span class="number">100</span> <span class="comment"># 宽度</span></span><br><span class="line">    <span class="attr">height:</span> <span class="number">180</span> <span class="comment"># 高度</span></span><br><span class="line">  <span class="attr">mobile:</span></span><br><span class="line">    <span class="attr">show:</span> <span class="literal">true</span>  <span class="comment">#是否在手机上显示</span></span><br><span class="line">  <span class="attr">react:</span></span><br><span class="line">    <span class="attr">opacityDefault:</span> <span class="number">0.7</span> <span class="comment"># 默认透明度</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="修改文章底部的那个带-号的标签"><a href="#修改文章底部的那个带-号的标签" class="headerlink" title="修改文章底部的那个带#号的标签"></a>修改文章底部的那个带#号的标签</h1><blockquote>
<p>修改模板 /themes/next/layout/_macro/post.swig</p>
<p>搜索 rel=”tag”&gt;#，将 # 换成</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="tag">&lt;<span class="name">i</span> <span class="attr">class</span>=<span class="string">&quot;fa fa-tag&quot;</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">i</span>&gt;</span></span></span><br></pre></td></tr></table></figure>


<h1 id="搜索引擎"><a href="#搜索引擎" class="headerlink" title="搜索引擎"></a>搜索引擎</h1><ul>
<li>安装插件<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">npm install hexo-generator-searchdb --save</span><br></pre></td></tr></table></figure></li>
<li>打开next主题配置文件 找到Extensions在下面添加<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># 搜索</span></span><br><span class="line">search:</span><br><span class="line">  path: search.xml</span><br><span class="line">  field: post</span><br><span class="line">  format: html</span><br><span class="line">  limit: 10000</span><br></pre></td></tr></table></figure></li>
<li>打开next主题配置文件 找到Local search，将enable设置为true</li>
</ul>
<h1 id="社交链接"><a href="#社交链接" class="headerlink" title="社交链接"></a>社交链接</h1><blockquote>
<p>取消next配置文件中的注释,|| 后面的是图标</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">social:</span><br><span class="line"><span class="code">    GitHub: https://github.com/yourname || github</span></span><br></pre></td></tr></table></figure>

<h1 id="添加头像"><a href="#添加头像" class="headerlink" title="添加头像"></a>添加头像</h1><blockquote>
<p>图片放到themes\next\source\images</p>
<p>修改next_config.yml</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="section"># Sidebar Avatar</span></span><br><span class="line">avatar: /images/header.jpg</span><br></pre></td></tr></table></figure>

<h1 id="阅读全文"><a href="#阅读全文" class="headerlink" title="阅读全文"></a>阅读全文</h1><blockquote>
<p>在文章中添加标志</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line"><span class="xml"><span class="comment">&lt;!--more--&gt;</span></span></span><br></pre></td></tr></table></figure>
<h1 id="动态回到顶部"><a href="#动态回到顶部" class="headerlink" title="动态回到顶部"></a>动态回到顶部</h1><ul>
<li>下载图片scroll.png,放到<code>themes\next\source\images</code></li>
<li>修改主题配置文件 <code>themes\next\source\css\_custom\custom.styl</code></li>
<li>添加代码<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">//自定义回到顶部样式</span><br><span class="line">.back-to-top &#123;</span><br><span class="line">  right: 60px;</span><br><span class="line">  width: 70px;  //图片素材宽度</span><br><span class="line">  height: 900px;  //图片素材高度</span><br><span class="line">  top: -900px;</span><br><span class="line">  bottom: unset;</span><br><span class="line">  transition: all .5s ease-in-out;</span><br><span class="line">  background: url(&quot;/images/scroll.png&quot;);</span><br><span class="line"></span><br><span class="line">  //隐藏箭头图标</span><br><span class="line">  &gt; i &#123;</span><br><span class="line"><span class="code">    display: none;</span></span><br><span class="line"><span class="code">  &#125;</span></span><br><span class="line"><span class="code"></span></span><br><span class="line"><span class="code">  &amp;.back-to-top-on &#123;</span></span><br><span class="line"><span class="code">    bottom: unset;</span></span><br><span class="line"><span class="code">    top: 100vh &lt; (900px + 200px) ? calc( 100vh - 900px - 200px ) : 0px;</span></span><br><span class="line"><span class="code">  &#125;</span></span><br><span class="line"><span class="code">&#125;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
<h1 id="网站LOGO"><a href="#网站LOGO" class="headerlink" title="网站LOGO"></a>网站LOGO</h1><p><a href="http://ico.duduxuexi.com/">在线生成ICO图标</a></p>
<p>图标放到themes\next\source\images,命名logo.ico</p>
<p>修改 next/_config.yml</p>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">favicon:</span><br><span class="line">  medium: /images/logo.ico</span><br></pre></td></tr></table></figure>
<h1 id="隐藏网页底部powered-By-Hexo-强力驱动"><a href="#隐藏网页底部powered-By-Hexo-强力驱动" class="headerlink" title="隐藏网页底部powered By Hexo/强力驱动"></a>隐藏网页底部powered By Hexo/强力驱动</h1><blockquote>
<p>themes/next/layout/_partials/footer.swig</p>
<p>删除或者注释掉以下代码</p>
</blockquote>
<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;% if theme.footer.powered %&#125;</span><br><span class="line">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;powered-by&quot;</span>&gt;</span></span>&#123;#</span><br><span class="line">  #&#125;&#123;&#123; <span class="strong">__(&#x27;footer.powered&#x27;, &#x27;<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;theme-link&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://hexo.io&quot;</span>&gt;</span></span>Hexo<span class="xml"><span class="tag">&lt;/<span class="name">a</span>&gt;</span></span>&#x27;) &#125;&#125;&#123;#</span></span><br><span class="line"><span class="strong">#&#125;<span class="xml"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">&#123;% endif %&#125;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">&#123;% if theme.footer.powered and theme.footer.theme.enable %&#125;</span></span><br><span class="line"><span class="strong">  <span class="xml"><span class="tag">&lt;<span class="name">span</span> <span class="attr">class</span>=<span class="string">&quot;post-meta-divider&quot;</span>&gt;</span></span>|<span class="xml"><span class="tag">&lt;/<span class="name">span</span>&gt;</span></span></span></span><br><span class="line"><span class="strong">&#123;% endif %&#125;</span></span><br><span class="line"><span class="strong"></span></span><br><span class="line"><span class="strong">&#123;% if theme.footer.theme.enable %&#125;</span></span><br><span class="line"><span class="strong">  <span class="xml"><span class="tag">&lt;<span class="name">div</span> <span class="attr">class</span>=<span class="string">&quot;theme-info&quot;</span>&gt;</span></span>&#123;#</span></span><br><span class="line"><span class="strong">  #&#125;&#123;&#123; __</span>(&#x27;footer.theme&#x27;) &#125;&#125; &amp;mdash; &#123;#</span><br><span class="line">  #&#125;<span class="xml"><span class="tag">&lt;<span class="name">a</span> <span class="attr">class</span>=<span class="string">&quot;theme-link&quot;</span> <span class="attr">target</span>=<span class="string">&quot;_blank&quot;</span> <span class="attr">href</span>=<span class="string">&quot;https://github.com/iissnan/hexo-theme-next&quot;</span>&gt;</span></span>&#123;#</span><br><span class="line"><span class="code">    #&#125;NexT.&#123;&#123; theme.scheme &#125;&#125;&#123;#</span></span><br><span class="line"><span class="code">  #&#125;&lt;/a&gt;&#123;% if theme.footer.theme.version %&#125; v&#123;&#123; theme.version &#125;&#125;&#123;% endif %&#125;&#123;#</span></span><br><span class="line"><span class="code">#&#125;&lt;/div&gt;</span></span><br><span class="line"><span class="code">&#123;% endif %&#125;</span></span><br></pre></td></tr></table></figure>

<h1 id="去掉文章目录标题的自动编号"><a href="#去掉文章目录标题的自动编号" class="headerlink" title="去掉文章目录标题的自动编号"></a>去掉文章目录标题的自动编号</h1><blockquote>
<p>打开主题配置文件,将number改为false</p>
</blockquote>
<h1 id="打字特效"><a href="#打字特效" class="headerlink" title="打字特效"></a>打字特效</h1><ul>
<li>创建一个 activate-power-mode.min.js 文件<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">(function webpackUniversalModuleDefinition(root,factory)&#123;if(typeof exports===&#x27;object&#x27;&amp;&amp;typeof module===&#x27;object&#x27;)module.exports=factory();else if(typeof define===&#x27;function&#x27;&amp;&amp;define.amd)define([],factory);else if(typeof exports===&#x27;object&#x27;)exports[&quot;POWERMODE&quot;]=factory();else root[&quot;POWERMODE&quot;]=factory()&#125;)(this,function()&#123;return(function(modules)&#123;var installedModules=&#123;&#125;;function <span class="strong">__webpack<span class="emphasis">_require<span class="strong">__(moduleId)&#123;if(installedModules[moduleId])return installedModules[moduleId].exports;var module=installedModules[moduleId]=&#123;exports:&#123;&#125;,id:moduleId,loaded:false&#125;;modules[moduleId].call(module.exports,module,module.exports,__</span>webpack_</span>require__</span>);module.loaded=true;return module.exports&#125;<span class="strong">__webpack<span class="emphasis">_require<span class="strong">__.m=modules;__</span>webpack_</span>require__</span>.c=installedModules;<span class="strong">__webpack<span class="emphasis">_require<span class="strong">__.p=&quot;&quot;;return __</span>webpack_</span>require__</span>(0)&#125;)([function(module,exports,<span class="strong">__webpack<span class="emphasis">_require<span class="strong">__)&#123;&#x27;use strict&#x27;;var canvas=document.createElement(&#x27;canvas&#x27;);canvas.width=window.innerWidth;canvas.height=window.innerHeight;canvas.style.cssText=&#x27;position:fixed;top:0;left:0;pointer-events:none;z-index:999999&#x27;;window.addEventListener(&#x27;resize&#x27;,function()&#123;canvas.width=window.innerWidth;canvas.height=window.innerHeight&#125;);document.body.appendChild(canvas);var context=canvas.getContext(&#x27;2d&#x27;);var particles=[];var particlePointer=0;POWERMODE.shake=true;function getRandom(min,max)&#123;return Math.random()<span class="emphasis">*(max-min)+min&#125;function getColor(el)&#123;if(POWERMODE.colorful)&#123;var u=getRandom(0,360);return&#x27;hsla(&#x27;+getRandom(u-10,u+10)+&#x27;, 100%, &#x27;+getRandom(50,80)+&#x27;%, &#x27;+1+&#x27;)&#x27;&#125;else&#123;return window.getComputedStyle(el).color&#125;&#125;function getCaret()&#123;var el=document.activeElement;var bcr;if(el.tagName===&#x27;TEXTAREA&#x27;||(el.tagName===&#x27;INPUT&#x27;&amp;&amp;el.getAttribute(&#x27;type&#x27;)===&#x27;text&#x27;))&#123;var offset=<span class="strong">__webpack<span class="emphasis">_require<span class="strong">__(1)(el,el.selectionStart);bcr=el.getBoundingClientRect();return&#123;x:offset.left+bcr.left,y:offset.top+bcr.top,color:getColor(el)&#125;&#125;var selection=window.getSelection();if(selection.rangeCount)&#123;var range=selection.getRangeAt(0);var startNode=range.startContainer;if(startNode.nodeType===document.TEXT<span class="emphasis">_NODE)&#123;startNode=startNode.parentNode&#125;bcr=range.getBoundingClientRect();return&#123;x:bcr.left,y:bcr.top,color:getColor(startNode)&#125;&#125;return&#123;x:0,y:0,color:&#x27;transparent&#x27;&#125;&#125;function createParticle(x,y,color)&#123;return&#123;x:x,y:y,alpha:1,color:color,velocity:&#123;x:-1+Math.random()*2,y:-3.5+Math.random()*2&#125;&#125;&#125;function POWERMODE()&#123;&#123;var caret=getCaret();var numParticles=5+Math.round(Math.random()*10);while(numParticles--)&#123;particles[particlePointer]=createParticle(caret.x,caret.y,caret.color);particlePointer=(particlePointer+1)%500&#125;&#125;&#123;if(POWERMODE.shake)&#123;var intensity=1+2*Math.random();var x=intensity*(Math.random()&gt;0.5?-1:1);var y=intensity*(Math.random()&gt;0.5?-1:1);document.body.style.marginLeft=x+&#x27;px&#x27;;document.body.style.marginTop=y+&#x27;px&#x27;;setTimeout(function()&#123;document.body.style.marginLeft=&#x27;&#x27;;document.body.style.marginTop=&#x27;&#x27;&#125;,75)&#125;&#125;&#125;;POWERMODE.colorful=false;function loop()&#123;requestAnimationFrame(loop);context.clearRect(0,0,canvas.width,canvas.height);for(var i=0;i<span class="xml"><span class="tag">&lt;<span class="name">particles.length;++i)&#123;var</span> <span class="attr">particle</span>=<span class="string">particles[i];if(particle.alpha</span>&lt;=<span class="string">0.1)continue;particle.velocity.y+</span>=<span class="string">0.075;particle.x+</span>=<span class="string">particle.velocity.x;particle.y+</span>=<span class="string">particle.velocity.y;particle.alpha*</span>=<span class="string">0.96;context.globalAlpha</span>=<span class="string">particle.alpha;context.fillStyle</span>=<span class="string">particle.color;context.fillRect(Math.round(particle.x-1.5),Math.round(particle.y-1.5),3,3)&#125;&#125;requestAnimationFrame(loop);module.exports</span>=<span class="string">POWERMODE&#125;,function(module,exports)&#123;(function()&#123;var</span> <span class="attr">properties</span>=<span class="string">[</span>&#x27;<span class="attr">direction</span>&#x27;,&#x27;<span class="attr">boxSizing</span>&#x27;,&#x27;<span class="attr">width</span>&#x27;,&#x27;<span class="attr">height</span>&#x27;,&#x27;<span class="attr">overflowX</span>&#x27;,&#x27;<span class="attr">overflowY</span>&#x27;,&#x27;<span class="attr">borderTopWidth</span>&#x27;,&#x27;<span class="attr">borderRightWidth</span>&#x27;,&#x27;<span class="attr">borderBottomWidth</span>&#x27;,&#x27;<span class="attr">borderLeftWidth</span>&#x27;,&#x27;<span class="attr">borderStyle</span>&#x27;,&#x27;<span class="attr">paddingTop</span>&#x27;,&#x27;<span class="attr">paddingRight</span>&#x27;,&#x27;<span class="attr">paddingBottom</span>&#x27;,&#x27;<span class="attr">paddingLeft</span>&#x27;,&#x27;<span class="attr">fontStyle</span>&#x27;,&#x27;<span class="attr">fontVariant</span>&#x27;,&#x27;<span class="attr">fontWeight</span>&#x27;,&#x27;<span class="attr">fontStretch</span>&#x27;,&#x27;<span class="attr">fontSize</span>&#x27;,&#x27;<span class="attr">fontSizeAdjust</span>&#x27;,&#x27;<span class="attr">lineHeight</span>&#x27;,&#x27;<span class="attr">fontFamily</span>&#x27;,&#x27;<span class="attr">textAlign</span>&#x27;,&#x27;<span class="attr">textTransform</span>&#x27;,&#x27;<span class="attr">textIndent</span>&#x27;,&#x27;<span class="attr">textDecoration</span>&#x27;,&#x27;<span class="attr">letterSpacing</span>&#x27;,&#x27;<span class="attr">wordSpacing</span>&#x27;,&#x27;<span class="attr">tabSize</span>&#x27;,&#x27;<span class="attr">MozTabSize</span>&#x27;];<span class="attr">var</span> <span class="attr">isFirefox</span>=<span class="string">window.mozInnerScreenX!</span>=<span class="string">null;function</span> <span class="attr">getCaretCoordinates</span>(<span class="attr">element</span>,<span class="attr">position</span>,<span class="attr">options</span>)&#123;<span class="attr">var</span> <span class="attr">debug</span>=<span class="string">options&amp;&amp;options.debug||false;if(debug)&#123;var</span> <span class="attr">el</span>=<span class="string">document.querySelector(</span>&#x27;#<span class="attr">input-textarea-caret-position-mirror-div</span>&#x27;);<span class="attr">if</span>(<span class="attr">el</span>)&#123;<span class="attr">el.parentNode.removeChild</span>(<span class="attr">el</span>)&#125;&#125;<span class="attr">var</span> <span class="attr">div</span>=<span class="string">document.createElement(</span>&#x27;<span class="attr">div</span>&#x27;);<span class="attr">div.id</span>=<span class="string">&#x27;input-textarea-caret-position-mirror-div&#x27;</span>;<span class="attr">document.body.appendChild</span>(<span class="attr">div</span>);<span class="attr">var</span> <span class="attr">style</span>=<span class="string">div.style;var</span> <span class="attr">computed</span>=<span class="string">window.getComputedStyle?getComputedStyle(element):element.currentStyle;style.whiteSpace</span>=<span class="string">&#x27;pre-wrap&#x27;</span>;<span class="attr">if</span>(<span class="attr">element.nodeName</span>!==<span class="string">&#x27;INPUT&#x27;</span>)<span class="attr">style.wordWrap</span>=<span class="string">&#x27;break-word&#x27;</span>;<span class="attr">style.position</span>=<span class="string">&#x27;absolute&#x27;</span>;<span class="attr">if</span>(!<span class="attr">debug</span>)<span class="attr">style.visibility</span>=<span class="string">&#x27;hidden&#x27;</span>;<span class="attr">properties.forEach</span>(<span class="attr">function</span>(<span class="attr">prop</span>)&#123;<span class="attr">style</span>[<span class="attr">prop</span>]=<span class="string">computed[prop]&#125;);if(isFirefox)&#123;if(element.scrollHeight</span>&gt;</span></span>parseInt(computed.height))style.overflowY=&#x27;scroll&#x27;&#125;else&#123;style.overflow=&#x27;hidden&#x27;&#125;div.textContent=element.value.substring(0,position);if(element.nodeName===&#x27;INPUT&#x27;)div.textContent=div.textContent.replace(/\s/g,&quot;\u00a0&quot;);var span=document.createElement(&#x27;span&#x27;);span.textContent=element.value.substring(position)||&#x27;.&#x27;;div.appendChild(span);var coordinates=&#123;top:span.offsetTop+parseInt(computed[&#x27;borderTopWidth&#x27;]),left:span.offsetLeft+parseInt(computed[&#x27;borderLeftWidth&#x27;])&#125;;if(debug)&#123;span.style.backgroundColor=&#x27;#aaa&#x27;&#125;else&#123;document.body.removeChild(div)&#125;return coordinates&#125;if(typeof module!=&quot;undefined&quot;&amp;&amp;typeof module.exports!=&quot;undefined&quot;)&#123;module.exports=getCaretCoordinates&#125;else&#123;window.getCaretCoordinates=getCaretCoordinates&#125;&#125;())&#125;])&#125;);</span></span></span></span></span></span></span></span></span><br></pre></td></tr></table></figure></li>
<li>放到 themes\next\source\js\src\ 目录下</li>
<li>在themes\next\layout_custom目录下创建custom.swing<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;# 打字特效 #&#125;</span><br><span class="line">&#123;% if theme.typing<span class="emphasis">_effect %&#125;</span></span><br><span class="line"><span class="emphasis">  <span class="xml"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;/js/activate-power-mode.min.js&quot;</span>&gt;</span></span><span class="xml"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis">  <span class="xml"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span></span></span><br><span class="line"><span class="emphasis">    POWERMODE.colorful = &#123;&#123; theme.typing_</span>effect.colorful &#125;&#125;;</span><br><span class="line"><span class="code">    POWERMODE.shake = &#123;&#123; theme.typing_effect.shake &#125;&#125;;</span></span><br><span class="line"><span class="code">    document.body.addEventListener(&#x27;input&#x27;, POWERMODE);</span></span><br><span class="line"><span class="code">  &lt;/script&gt;</span></span><br><span class="line"><span class="code">&#123;% endif %&#125;</span></span><br></pre></td></tr></table></figure></li>
<li>在themes\next\layout_layout.swig中body标签结尾处引用<figure class="highlight markdown"><table><tr><td class="code"><pre><span class="line">&#123;% include &#x27;<span class="emphasis">_custom/custom.swig&#x27; %&#125;</span></span><br></pre></td></tr></table></figure></li>
<li>在主题配置文件中添加以下代码<figure class="highlight"><table><tr><td class="code"><pre><span class="line"># typing effect</span><br><span class="line">typing_effect:</span><br><span class="line">  colorful: true  # 礼花特效</span><br><span class="line">  shake: false  # 震动特效</span><br></pre></td></tr></table></figure>
<h1 id="代码复制功能"><a href="#代码复制功能" class="headerlink" title="代码复制功能"></a>代码复制功能</h1></li>
<li>在<code>themes/next/layout/_third-party/</code>下面创建<code>copy-code.swig</code>文件,代码如下<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">&#123;% if theme.codeblock.copy_button.enable %&#125;</span><br><span class="line">  <span class="tag">&lt;<span class="name">style</span>&gt;</span></span><br><span class="line"><span class="css">    <span class="selector-class">.copy-btn</span> &#123;</span></span><br><span class="line">      display: inline-block;</span><br><span class="line">      padding: 6px 12px;</span><br><span class="line">      font-size: 13px;</span><br><span class="line">      font-weight: 700;</span><br><span class="line">      line-height: 20px;</span><br><span class="line"><span class="css">      <span class="selector-tag">color</span>: <span class="selector-id">#333</span>;</span></span><br><span class="line">      white-space: nowrap;</span><br><span class="line">      vertical-align: middle;</span><br><span class="line">      cursor: pointer;</span><br><span class="line"><span class="css">      <span class="selector-tag">background-color</span>: <span class="selector-id">#eee</span>;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">background-image</span>: <span class="selector-tag">linear-gradient</span>(<span class="selector-id">#fcfcfc</span>, <span class="selector-id">#eee</span>);</span></span><br><span class="line"><span class="css">      <span class="selector-tag">border</span>: 1<span class="selector-tag">px</span> <span class="selector-tag">solid</span> <span class="selector-id">#d5d5d5</span>;</span></span><br><span class="line">      border-radius: 3px;</span><br><span class="line">      user-select: none;</span><br><span class="line">      outline: 0;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.highlight-wrap</span> <span class="selector-class">.copy-btn</span> &#123;</span></span><br><span class="line"><span class="css">      <span class="selector-tag">transition</span>: <span class="selector-tag">opacity</span> <span class="selector-class">.3s</span> <span class="selector-tag">ease-in-out</span>;</span></span><br><span class="line">      opacity: 0;</span><br><span class="line">      padding: 2px 6px;</span><br><span class="line">      position: absolute;</span><br><span class="line">      right: 4px;</span><br><span class="line">      top: 8px;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.highlight-wrap</span><span class="selector-pseudo">:hover</span> <span class="selector-class">.copy-btn</span>,</span></span><br><span class="line"><span class="css">    <span class="selector-class">.highlight-wrap</span> <span class="selector-class">.copy-btn</span><span class="selector-pseudo">:focus</span> &#123;</span></span><br><span class="line">      opacity: 1</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="css">    <span class="selector-class">.highlight-wrap</span> &#123;</span></span><br><span class="line">      position: relative;</span><br><span class="line">    &#125;</span><br><span class="line">  <span class="tag">&lt;/<span class="name">style</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    $(<span class="string">&#x27;.highlight&#x27;</span>).each(<span class="function"><span class="keyword">function</span> (<span class="params">i, e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">      <span class="keyword">var</span> $wrap = $(<span class="string">&#x27;&lt;div&gt;&#x27;</span>).addClass(<span class="string">&#x27;highlight-wrap&#x27;</span>)</span></span><br><span class="line"><span class="javascript">      $(e).after($wrap)</span></span><br><span class="line"><span class="javascript">      $wrap.append($(<span class="string">&#x27;&lt;button&gt;&#x27;</span>).addClass(<span class="string">&#x27;copy-btn&#x27;</span>).append(<span class="string">&#x27;&#123;&#123;__(&quot;post.copy_button&quot;)&#125;&#125;&#x27;</span>).on(<span class="string">&#x27;click&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> code = $(<span class="built_in">this</span>).parent().find(<span class="string">&#x27;.code&#x27;</span>).find(<span class="string">&#x27;.line&#x27;</span>).map(<span class="function"><span class="keyword">function</span> (<span class="params">i, e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">          <span class="keyword">return</span> $(e).text()</span></span><br><span class="line"><span class="javascript">        &#125;).toArray().join(<span class="string">&#x27;\n&#x27;</span>)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> ta = <span class="built_in">document</span>.createElement(<span class="string">&#x27;textarea&#x27;</span>)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.body.appendChild(ta)</span></span><br><span class="line"><span class="javascript">        ta.style.position = <span class="string">&#x27;absolute&#x27;</span></span></span><br><span class="line"><span class="javascript">        ta.style.top = <span class="string">&#x27;0px&#x27;</span></span></span><br><span class="line"><span class="javascript">        ta.style.left = <span class="string">&#x27;0px&#x27;</span></span></span><br><span class="line">        ta.value = code</span><br><span class="line">        ta.select()</span><br><span class="line">        ta.focus()</span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> result = <span class="built_in">document</span>.execCommand(<span class="string">&#x27;copy&#x27;</span>)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">document</span>.body.removeChild(ta)</span></span><br><span class="line">        &#123;% if theme.codeblock.copy_button.show_result %&#125;</span><br><span class="line"><span class="handlebars"><span class="xml">          if(result)$(this).text(&#x27;</span><span class="template-variable">&#123;&#123;<span class="name">__</span>(<span class="name">&quot;post.copy_success&quot;</span>)&#125;&#125;</span><span class="xml">&#x27;)</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">          else $(this).text(&#x27;</span><span class="template-variable">&#123;&#123;<span class="name">__</span>(<span class="name">&quot;post.copy_failure&quot;</span>)&#125;&#125;</span><span class="xml">&#x27;)</span></span></span><br><span class="line">        &#123;% endif %&#125;</span><br><span class="line"><span class="javascript">        $(<span class="built_in">this</span>).blur()</span></span><br><span class="line"><span class="javascript">      &#125;)).on(<span class="string">&#x27;mouseleave&#x27;</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">var</span> $b = $(<span class="built_in">this</span>).find(<span class="string">&#x27;.copy-btn&#x27;</span>)</span></span><br><span class="line"><span class="javascript">        <span class="built_in">setTimeout</span>(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="handlebars"><span class="xml">          $b.text(&#x27;</span><span class="template-variable">&#123;&#123;<span class="name">__</span>(<span class="name">&quot;post.copy_button&quot;</span>)&#125;&#125;</span><span class="xml">&#x27;)</span></span></span><br><span class="line">        &#125;, 300)</span><br><span class="line">      &#125;).append(e)</span><br><span class="line">    &#125;)</span><br><span class="line">  <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">&#123;% endif %&#125;</span><br></pre></td></tr></table></figure></li>
<li>在上一级目录,找到<code>_layout.swig</code>,在文件末尾添加如下代码<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&#123;% include <span class="string">&#x27;_third-party/copy-code.swig&#x27;</span> %&#125;</span><br></pre></td></tr></table></figure></li>
<li>在next主题的国际化包下面找到中文的yml文件,在post下面添加如下代码:<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">copy_button:</span> <span class="string">复制</span></span><br><span class="line"><span class="attr">copy_success:</span> <span class="string">复制成功</span></span><br><span class="line"><span class="attr">copy_failure:</span> <span class="string">复制失败</span></span><br></pre></td></tr></table></figure></li>
<li>英文(en)的语言包添加如下代码<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">copy_button:</span> <span class="string">Copy</span></span><br><span class="line"><span class="attr">copy_success:</span> <span class="string">Copied</span></span><br><span class="line"><span class="attr">copy_failure:</span> <span class="string">Copy</span> <span class="string">failed</span></span><br></pre></td></tr></table></figure></li>
<li>在next配置文件中添加如下代码<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 代码复制功能开关</span></span><br><span class="line"><span class="attr">codeblock:</span></span><br><span class="line">  <span class="attr">border radius:</span></span><br><span class="line">  <span class="comment"># Add copy button on codeblock</span></span><br><span class="line">  <span class="attr">copy_button:</span></span><br><span class="line">    <span class="attr">enable:</span> <span class="literal">true</span></span><br><span class="line">    <span class="comment"># Show text copy result</span></span><br><span class="line">    <span class="attr">show_result:</span> <span class="literal">true</span></span><br></pre></td></tr></table></figure></li>
</ul>
]]></content>
      <categories>
        <category>博客</category>
      </categories>
      <tags>
        <tag>博客</tag>
      </tags>
  </entry>
  <entry>
    <title>mySql优化案例</title>
    <url>/2020/11/02/mysql/mysql%E4%BC%98%E5%8C%96%E6%A1%88%E4%BE%8B/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p><a href="https://www.bilibili.com/video/BV1KW411u7vy?p=31">尚硅谷MySQL数据库高级，mysql优化，数据库优化</a></p>
<p><a href="https://github.com/RingoTangs/LearningNote/blob/master/MySQL/MySQL.md">文档参考</a></p>
<a id="more"></a>

<h1 id="单表"><a href="#单表" class="headerlink" title="单表"></a>单表</h1><h2 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h2><p><a href="https://www.bilibili.com/video/BV1KW411u7vy?p=31">尚硅谷视频</a></p>
<p>数据库是mysql5.5</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`article`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">NOT</span> <span class="keyword">EXISTS</span> <span class="string">`article`</span>(</span><br><span class="line"><span class="string">`id`</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> PRIMARY <span class="keyword">KEY</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">&#x27;主键&#x27;</span>,</span><br><span class="line"><span class="string">`author_id`</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;作者id&#x27;</span>,</span><br><span class="line"><span class="string">`category_id`</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;分类id&#x27;</span>,</span><br><span class="line"><span class="string">`views`</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;被查看的次数&#x27;</span>,</span><br><span class="line"><span class="string">`comments`</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">UNSIGNED</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;回帖的备注&#x27;</span>,</span><br><span class="line"><span class="string">`title`</span> <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;标题&#x27;</span>,</span><br><span class="line"><span class="string">`content`</span> <span class="built_in">VARCHAR</span>(<span class="number">255</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;正文内容&#x27;</span></span><br><span class="line">) <span class="keyword">COMMENT</span> <span class="string">&#x27;文章&#x27;</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`article`</span>(<span class="string">`author_id`</span>, <span class="string">`category_id`</span>, <span class="string">`views`</span>, <span class="string">`comments`</span>, <span class="string">`title`</span>, <span class="string">`content`</span>) <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="number">1</span>,<span class="string">&#x27;1&#x27;</span>,<span class="string">&#x27;1&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`article`</span>(<span class="string">`author_id`</span>, <span class="string">`category_id`</span>, <span class="string">`views`</span>, <span class="string">`comments`</span>, <span class="string">`title`</span>, <span class="string">`content`</span>) <span class="keyword">VALUES</span>(<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="number">2</span>,<span class="string">&#x27;2&#x27;</span>,<span class="string">&#x27;2&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`article`</span>(<span class="string">`author_id`</span>, <span class="string">`category_id`</span>, <span class="string">`views`</span>, <span class="string">`comments`</span>, <span class="string">`title`</span>, <span class="string">`content`</span>) <span class="keyword">VALUES</span>(<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`article`</span>(<span class="string">`author_id`</span>, <span class="string">`category_id`</span>, <span class="string">`views`</span>, <span class="string">`comments`</span>, <span class="string">`title`</span>, <span class="string">`content`</span>) <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">3</span>,<span class="number">3</span>,<span class="string">&#x27;3&#x27;</span>,<span class="string">&#x27;3&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`article`</span>(<span class="string">`author_id`</span>, <span class="string">`category_id`</span>, <span class="string">`views`</span>, <span class="string">`comments`</span>, <span class="string">`title`</span>, <span class="string">`content`</span>) <span class="keyword">VALUES</span>(<span class="number">1</span>,<span class="number">1</span>,<span class="number">4</span>,<span class="number">4</span>,<span class="string">&#x27;4&#x27;</span>,<span class="string">&#x27;4&#x27;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h2><blockquote>
<p>查询<code>category_id</code>为1且<code>comments</code>大于1的情况下，<code>views</code>最多的<code>article_id</code></p>
</blockquote>
<ol>
<li><p>sql语句:  <code>explain select id,author_id from article where category_id=1 and comments &gt;1 order by views desc limit 1;</code></p>
</li>
<li><p>出现了<code>type=all</code>的全表扫描和<code>Extra: Using where; Using filesort</code>,产生了文件内排序,需要优化</p>
</li>
<li><p>显示表中的索引:<code>show index article</code>,结果只有一个索引,为<code>PRIMARY</code>,名称为<code>id</code></p>
</li>
<li><p>建立三个索引: <code>create index ind_ccv on article (category_id,comments,views);</code></p>
</li>
<li><p>查看索引:<code>show index from article;</code>;</p>
</li>
<li><p>执行explain后发现,type值更新为了<code>rang</code>,而<code>Extra: Using where; Using filesort</code>没变</p>
</li>
<li><p>把sql语句更改为<code>explain select id,author_id from article where category_id=1 and comments =1 order by views desc limit 1;</code>发现<code>Using filesort</code>消失</p>
</li>
<li><p>推断出:当<code>comments &gt; 1</code>的时候<code>order by</code>排序<code>views</code>字段索引就用不上，但是当<code>comments = 1</code>的时候<code>order by</code>排序<code>views</code>字段索引就可以用上！！！<strong>所以，范围之后的索引会失效。</strong></p>
</li>
<li><p>删除原来的索引: <code>drop index ind_ccv on article;</code> 创建新的索引<code>create index idx_cv on article (category_id,views);</code></p>
</li>
<li><p>再次查看时,发现<code>type=rang</code>,<code>Extra: Using where;</code></p>
</li>
</ol>
<h1 id="两张表"><a href="#两张表" class="headerlink" title="两张表"></a>两张表</h1><h2 id="sql-1"><a href="#sql-1" class="headerlink" title="sql"></a>sql</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DROP TABLE IF EXISTS &#96;class&#96;;</span><br><span class="line">DROP TABLE IF EXISTS &#96;book&#96;;</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS &#96;class&#96;(</span><br><span class="line">&#96;id&#96; INT(10) UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT &#39;主键&#39;,</span><br><span class="line">&#96;card&#96; INT(10) UNSIGNED NOT NULL COMMENT &#39;分类&#39; </span><br><span class="line">) COMMENT &#39;商品类别&#39;;</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS &#96;book&#96;(</span><br><span class="line">&#96;bookid&#96; INT(10) UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT &#39;主键&#39;,</span><br><span class="line">&#96;card&#96; INT(10) UNSIGNED NOT NULL COMMENT &#39;分类&#39;</span><br><span class="line">) COMMENT &#39;书籍&#39;;</span><br><span class="line"></span><br><span class="line">insert into class (card) values (FLOOR(1+(RAND()*20)));</span><br><span class="line">insert into class (card) values (FLOOR(1+(RAND()*20)));</span><br><span class="line">insert into class (card) values (FLOOR(1+(RAND()*20)));</span><br><span class="line">insert into class (card) values (FLOOR(1+(RAND()*20)));</span><br><span class="line">insert into class (card) values (FLOOR(1+(RAND()*20)));</span><br><span class="line"></span><br><span class="line">insert into book (card) values (FLOOR(1+(RAND()*20)));</span><br><span class="line">insert into book (card) values (FLOOR(1+(RAND()*20)));</span><br><span class="line">insert into book (card) values (FLOOR(1+(RAND()*20)));</span><br><span class="line">insert into book (card) values (FLOOR(1+(RAND()*20)));</span><br><span class="line">insert into book (card) values (FLOOR(1+(RAND()*20)));</span><br></pre></td></tr></table></figure>

<h2 id="查询-1"><a href="#查询-1" class="headerlink" title="查询"></a>查询</h2><p>左连接</p>
<ol>
<li>使用<code>explain select * from class left join book on class.card =book.card;</code>查询,<code>type=all</code>,默认是全表扫描</li>
<li>尝试在book上添加索引 <code> alter table book add index ind_bk_card (card);</code></li>
<li>使用explain分析后,<code>book</code>表<code>type=ref</code></li>
</ol>
<p><strong>总结:左连接将索引创建在右表上更合适，右连接将索引创建在左表上更合适。</strong></p>
<h1 id="三张表"><a href="#三张表" class="headerlink" title="三张表"></a>三张表</h1><h2 id="sql-2"><a href="#sql-2" class="headerlink" title="sql"></a>sql</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">DROP TABLE IF EXISTS &#96;phone&#96;;</span><br><span class="line"></span><br><span class="line">CREATE TABLE IF NOT EXISTS &#96;phone&#96;(</span><br><span class="line">&#96;phone_id&#96; INT(10) UNSIGNED NOT NULL PRIMARY KEY AUTO_INCREMENT COMMENT &#39;主键&#39;,</span><br><span class="line">&#96;card&#96; INT(10) UNSIGNED NOT NULL COMMENT &#39;分类&#39; </span><br><span class="line">) COMMENT &#39;手机&#39;;</span><br><span class="line"></span><br><span class="line">insert into phone (card) values (FLOOR(1+(RAND()*20)));</span><br><span class="line">insert into phone (card) values (FLOOR(1+(RAND()*20)));</span><br><span class="line">insert into phone (card) values (FLOOR(1+(RAND()*20)));</span><br><span class="line">insert into phone (card) values (FLOOR(1+(RAND()*20)));</span><br><span class="line">insert into phone (card) values (FLOOR(1+(RAND()*20)));</span><br></pre></td></tr></table></figure>

<h2 id="查询-2"><a href="#查询-2" class="headerlink" title="查询"></a>查询</h2><ol>
<li>使用<code>explain select * from class left join book on class.card =book.card left join phone on book.card =phone.card;</code>分析结果为<code>type=all</code></li>
<li>由两张表结论得知,左连接需要在右表上添加索引,在book上添加索引<code>B</code>,在phone上添加索引<code>P</code></li>
<li>分析后,book和phone表的<code>type=ref</code>;</li>
</ol>
<p>结论:</p>
<ul>
<li>尽可能减少<code>JOIN</code>语句中的<code>NestedLoop</code>（嵌套循环）的总次数：<strong>永远都是小的结果集驱动大的结果集</strong>。</li>
<li>优先优化<code>NestedLoop</code>的内层循环。</li>
<li>保证<code>JOIN</code>语句中被驱动表上<code>JOIN</code>条件字段已经被索引。</li>
<li>当无法保证被驱动表的<code>JOIN</code>条件字段被索引且内存资源充足的前提下，不要太吝惜<code>Join Buffer</code> 的设置</li>
</ul>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>Jsp</title>
    <url>/2020/03/24/javaweb/jsp/</url>
    <content><![CDATA[<h1 id="jsp"><a href="#jsp" class="headerlink" title="jsp"></a>jsp</h1><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><blockquote>
<p>表达式         &lt;%=    %&gt;</p>
<p>脚本片段        &lt;%      %&gt;    </p>
</blockquote>
<h2 id="jsp标签"><a href="#jsp标签" class="headerlink" title="jsp标签"></a><strong>jsp标签</strong></h2><p>动态包含,页面数据需要经常更新,使用动态包含</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;jsp:include page=<span class="string">&quot;jsp.jsp&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<p>转发</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;jsp:forward/&gt;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h1 id="隐含对象"><a href="#隐含对象" class="headerlink" title="隐含对象"></a>隐含对象</h1><h2 id="观看地址"><a href="#观看地址" class="headerlink" title="观看地址"></a><a href="https://www.bilibili.com/video/av63564073?p=122">观看地址</a></h2><h2 id="九大隐含对象"><a href="#九大隐含对象" class="headerlink" title="九大隐含对象"></a>九大隐含对象</h2><blockquote>
<p>隐含对象：是我们在页面直接可以使用的对象</p>
</blockquote>
<ol>
<li><code>PageContext pageContext=null；      当前对象</code></li>
<li><code>HttpSession session=null；            会话对象</code></li>
<li><code>Throwable exception=null；            当前捕获的异常对象</code></li>
<li><code>ServletContext application=null；        整个web应用</code></li>
<li><code>ServletConfig config=nul1；            servlet配置信息</code></li>
<li><code>JspWriter out=null；                输出数据的out对象</code></li>
<li><code>object page=this；                    当前jsp</code>                </li>
<li><code>HttpServletRequest request，        本次请求的详细信息</code></li>
<li><code>HttpServletResponse response             本次响应的详细信息</code></li>
</ol>
<h2 id="五大常规对象"><a href="#五大常规对象" class="headerlink" title="五大常规对象"></a><strong>五大常规对象</strong></h2><ol>
<li><code>Throwable exception=null；            当前捕获的异常对象</code></li>
<li><code>ServletConfig config=nul1；            servlet配置信息</code></li>
<li><code>JspWriter out=null；                输出数据的out对象</code></li>
<li><code>object page=this；                    当前jsp</code>                </li>
<li><code>HttpServletResponse response             本次响应的详细信息</code></li>
</ol>
<h2 id="四大域对象"><a href="#四大域对象" class="headerlink" title="四大域对象"></a><strong>四大域对象</strong></h2><p><strong>排列顺序是从小到大</strong></p>
<blockquote>
<p><code>PageContext pageContext=null；      当前对象</code></p>
</blockquote>
<p>1)可以调用其他的八个隐藏对象,通过pageContext.getXXX();</p>
<p>2)只可以在当前页面共享数据,pageContext.setAttribute();</p>
<blockquote>
<p><code>HttpServletRequest request，        本次请求的详细信息</code></p>
</blockquote>
<p>1)同一次请求中共享数据</p>
<blockquote>
<p><code>HttpSession session=null；            会话对象</code></p>
</blockquote>
<p>1)同一次会话共享数据,开启关闭浏览器称为一次会话</p>
<blockquote>
<p><code>ServletContext application=null；        整个web应用</code></p>
</blockquote>
<p>1)只要web应用不卸载,都可以在整个web中共享数据</p>
<h2 id="域对象常用方法"><a href="#域对象常用方法" class="headerlink" title="域对象常用方法"></a><strong>域对象常用方法</strong></h2><ol>
<li><code>setAttribute()</code></li>
<li><code>getAttribute()</code></li>
<li><code>removeAttribute()</code></li>
</ol>
<h1 id="JSTL标签"><a href="#JSTL标签" class="headerlink" title="JSTL标签"></a>JSTL标签</h1><h2 id="el表达式"><a href="#el表达式" class="headerlink" title="el表达式"></a>el表达式</h2><h3 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;taglibs&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;standard&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.1.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;javax.servlet&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jstl&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.1.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.taglibs&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;taglibs-standard-impl&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.5&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.taglibs&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;taglibs-standard-spec&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.5&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h3 id="在-idea-种开启el表达式"><a href="#在-idea-种开启el表达式" class="headerlink" title="在 idea 种开启el表达式"></a>在 idea 种开启el表达式</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;%@ page isELIgnored &#x3D;&quot;false&quot; %&gt;</span><br></pre></td></tr></table></figure>

<h3 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h3><figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%@ taglib prefix=<span class="string">&quot;c&quot;</span> uri=<span class="string">&quot;http://java.sun.com/jsp/jstl/core&quot;</span> %&gt;</span><br></pre></td></tr></table></figure>

<h3 id="四个作用域"><a href="#四个作用域" class="headerlink" title="四个作用域"></a><strong>四个作用域</strong></h3><blockquote>
<p>pageScope </p>
<p>requestScope </p>
<p>sessionScope </p>
<p>applicationScope</p>
</blockquote>
<h3 id="取值"><a href="#取值" class="headerlink" title="取值"></a>取值</h3><figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">$&#123;pagecontextKey.name&#125;</span><br><span class="line"></span><br><span class="line">$&#123;requestKey.[<span class="string">&#x27;name&#x27;</span>]&#125;</span><br><span class="line"></span><br><span class="line">$&#123;name&#125;</span><br></pre></td></tr></table></figure>

<h3 id="el循环"><a href="#el循环" class="headerlink" title="el循环"></a>el循环</h3><p><strong>循环</strong></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">var&#x3D;&quot;&quot; items&#x3D;&quot;&quot; begin&#x3D;&quot;&quot; end&#x3D;&quot;&quot; step&#x3D;&quot;&quot; varStatus&#x3D;&quot;&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>begin：指定遍历的开始位置</p>
<p>end：指定遍历的结束位置</p>
<p>items：要遍历的数据</p>
<p>step：步长，一次跳过多少</p>
<p>var：别名</p>
<p>varStatus：遍历状态，里面封装了当前遍历的所有状态信息</p>
</blockquote>
<h3 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;%</span><br><span class="line">    List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;Integer&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        list.add(i);</span><br><span class="line">    &#125;</span><br><span class="line">%&gt;</span><br><span class="line">&lt;c:forEach items=<span class="string">&quot;&lt;%=list%&gt;&quot;</span> <span class="keyword">var</span>=<span class="string">&quot;num&quot;</span>&gt;</span><br><span class="line">    $&#123;num&#125;</span><br><span class="line">&lt;/c:forEach&gt;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>javaWeb</category>
      </categories>
      <tags>
        <tag>javaWeb</tag>
      </tags>
  </entry>
  <entry>
    <title>java流</title>
    <url>/2021/03/15/java/javaFile/</url>
    <content><![CDATA[<h1 id="流概述"><a href="#流概述" class="headerlink" title="流概述"></a>流概述</h1><p><a href="https://how2j.cn/k/io/io-stream/339.html#nowhere">how2j</a></p>
<p>当不同的介质之间有数据交互的时候，JAVA就使用流来实现。<br>数据源可以是文件，还可以是数据库，网络甚至是其他的程序</p>
<p>比如读取文件的数据到程序中，站在程序的角度来看，就叫做输入流<br>输入流： InputStream<br>输出流：OutputStream</p>
<a id="more"></a>

<h1 id="文件对象File"><a href="#文件对象File" class="headerlink" title="文件对象File"></a>文件对象File</h1><p>常用方法</p>
<ul>
<li>Files.exists()：检测文件路径是否存在。</li>
<li>Files.createFile()：创建文件。</li>
<li>Files.createDirectory()：创建文件夹。</li>
<li>Files.delete()：删除一个文件或目录。</li>
<li>Files.copy()：复制文件。</li>
<li>Files.move()：移动文件。</li>
<li>Files.size()：查看文件个数。</li>
<li>Files.read()：读取文件。</li>
<li>Files.write()：写入文件。</li>
</ul>
<h1 id="字节流"><a href="#字节流" class="headerlink" title="字节流"></a>字节流</h1><h2 id="输入-InputStream"><a href="#输入-InputStream" class="headerlink" title="输入 InputStream"></a>输入 InputStream</h2><p>InputStream是字节输入流，同时也是抽象类，只提供方法声明，不提供方法的具体实现。<br>FileInputStream 是InputStream子类，以FileInputStream 为例进行文件读取</p>
<ol>
<li>用子节读取文件内容,读取到的是<strong>ASCII码</strong>,即读取到的二进制或者十进制数字</li>
<li>读取时需要创建子节数组</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 文件内容是</span></span><br><span class="line"><span class="comment">* 123</span></span><br><span class="line"><span class="comment">* abc</span></span><br><span class="line"><span class="comment">* ABC</span></span><br><span class="line"><span class="comment">* 你好啊</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">File f = <span class="keyword">new</span> File(<span class="string">&quot;h:/1.txt&quot;</span>);</span><br><span class="line">FileInputStream fis = <span class="keyword">new</span> FileInputStream(f);</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建字节数组</span></span><br><span class="line"><span class="keyword">byte</span>[] bytes=<span class="keyword">new</span> <span class="keyword">byte</span>[(<span class="keyword">int</span>) f.length()];</span><br><span class="line"><span class="comment">//读取</span></span><br><span class="line">fis.read(bytes);</span><br><span class="line"><span class="comment">//遍历</span></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">byte</span> aByte : bytes) &#123;</span><br><span class="line">    System.out.println(aByte);</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//最终一定要关闭,可以使用try catch</span></span><br><span class="line">fis.close();</span><br></pre></td></tr></table></figure>

<h2 id="输出-OutputStream"><a href="#输出-OutputStream" class="headerlink" title="输出  OutputStream"></a>输出  OutputStream</h2><p>OutputStream是字节输出流，同时也是抽象类，只提供方法声明，不提供方法的具体实现。<br>FileOutputStream 是OutputStream子类，以FileOutputStream 为例向文件写出数据</p>
<p>注: 如果文件h:/2.txt不存在，写出操作会自动创建该文件。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//文件不存在时,会创建文件</span></span><br><span class="line">File file = <span class="keyword">new</span> File(<span class="string">&quot;h:/2.txt&quot;</span>);</span><br><span class="line">FileOutputStream stream = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line"></span><br><span class="line"><span class="comment">//准备写出的数据</span></span><br><span class="line"><span class="keyword">byte</span>[] data = &#123;<span class="number">88</span>, <span class="number">89</span>&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//写出</span></span><br><span class="line">stream.write(data);</span><br><span class="line"></span><br><span class="line"><span class="comment">//关闭流</span></span><br><span class="line">stream.close();</span><br></pre></td></tr></table></figure>

<h1 id="字符流"><a href="#字符流" class="headerlink" title="字符流"></a>字符流</h1><p>Reader字符输入流<br>Writer字符输出流<br>专门用于字符的形式读取和写入数据</p>
<p>可以读取汉字</p>
<h2 id="输入-FileReader"><a href="#输入-FileReader" class="headerlink" title="输入 FileReader"></a>输入 FileReader</h2><p>FileReader 是Reader子类，以FileReader 为例进行文件读取</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">File file = <span class="keyword">new</span> File(<span class="string">&quot;h:/1.txt&quot;</span>);</span><br><span class="line">FileReader reader = <span class="keyword">new</span> FileReader(file);</span><br><span class="line"><span class="keyword">char</span>[] chars = <span class="keyword">new</span> <span class="keyword">char</span>[(<span class="keyword">int</span>) file.length()];</span><br><span class="line">reader.read(chars);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">char</span> aChar : chars) &#123;</span><br><span class="line">    System.out.println(aChar);</span><br><span class="line">&#125;</span><br><span class="line">reader.close();</span><br></pre></td></tr></table></figure>

<h2 id="输出-FileWriter"><a href="#输出-FileWriter" class="headerlink" title="输出 FileWriter"></a>输出 FileWriter</h2><p>FileWriter 是Writer的子类，以FileWriter 为例把字符串写入到文件</p>
<p>使用String类型的<code>toCharArray()</code>方法,可以将字符串转换为char数组</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">File file = <span class="keyword">new</span> File(<span class="string">&quot;h:/3.txt&quot;</span>);</span><br><span class="line">FileWriter fileWriter = <span class="keyword">new</span> FileWriter(file);</span><br><span class="line">String str=<span class="string">&quot;秦朝始皇帝十年（公元前210年），始皇帝为求长生不老之药，授命大方师徐福率三千童男童女东渡蓬莱仙山。&quot;</span>;</span><br><span class="line"><span class="keyword">char</span>[] chars = str.toCharArray();</span><br><span class="line">fileWriter.write(chars);</span><br><span class="line"></span><br><span class="line">fileWriter.close();</span><br></pre></td></tr></table></figure>

<h1 id="缓存流"><a href="#缓存流" class="headerlink" title="缓存流"></a>缓存流</h1><p><strong>字节流</strong>和<strong>字符流</strong>在每一次读写的时候，都会访问硬盘。 如果读写的频率比较高的时候，其性能表现不佳。</p>
<p>缓存流在读取的时候，<strong>会一次性读较多的数据到缓存中</strong>，以后每一次的读取，都是在缓存中访问，直到缓存中的数据读取完毕，再到硬盘中读取。</p>
<p>缓存流在写入数据的时候，会先把数据写入到缓存区，直到缓存区<strong>达到一定的量</strong>，才把这些数据，<strong>一起写入到硬盘中去</strong>。按照这种操作模式，就不会像字节流，字符流那样<strong>每写一个字节都访问硬盘</strong>，从而减少了IO操作</p>
<p><strong>缓存流必须建立在一个存在的流的基础上</strong></p>
<h2 id="输入-BufferedReader"><a href="#输入-BufferedReader" class="headerlink" title="输入 BufferedReader"></a>输入 BufferedReader</h2><p><code>BufferedReader</code>需要先创建字符流<code>FileReader</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">File f = <span class="keyword">new</span> File(<span class="string">&quot;h:/3.txt&quot;</span>);</span><br><span class="line">FileReader reader = <span class="keyword">new</span> FileReader(f);</span><br><span class="line">BufferedReader bufferedReader = <span class="keyword">new</span> BufferedReader(reader);</span><br><span class="line"></span><br><span class="line"><span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">    String s = bufferedReader.readLine();</span><br><span class="line">    <span class="keyword">if</span> (s == <span class="keyword">null</span>) &#123;</span><br><span class="line">    	<span class="keyword">break</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(s);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bufferedReader.close();</span><br></pre></td></tr></table></figure>

<h2 id="输出-BufferedWriter"><a href="#输出-BufferedWriter" class="headerlink" title="输出  BufferedWriter"></a>输出  BufferedWriter</h2><p>BufferedWriter缓存字符输出流， 可以一次写出一行数据</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">File f = <span class="keyword">new</span> File(<span class="string">&quot;h:/5.txt&quot;</span>);</span><br><span class="line">FileWriter writer = <span class="keyword">new</span> FileWriter(f);</span><br><span class="line">BufferedWriter bufferedWriter = <span class="keyword">new</span> BufferedWriter(writer);</span><br><span class="line">bufferedWriter.write(<span class="string">&quot;这时的李斯在门口已经看了半天，他没有让广仁进去通报，&quot;</span>);</span><br><span class="line"><span class="comment">//换行</span></span><br><span class="line">bufferedWriter.newLine();</span><br><span class="line">bufferedWriter.write(<span class="string">&quot;只是一脸冷笑的看着眼前这一幕。&quot;</span>);</span><br><span class="line"><span class="comment">//关闭流之前会刷新缓冲</span></span><br><span class="line">bufferedWriter.close();</span><br></pre></td></tr></table></figure>

<h2 id="输出-PrintWriter"><a href="#输出-PrintWriter" class="headerlink" title="输出  PrintWriter"></a>输出  PrintWriter</h2><p>推荐使用<code>PrintWriter</code></p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">File f &#x3D; new File(&quot;h:&#x2F;4.txt&quot;);</span><br><span class="line">FileWriter writer &#x3D; new FileWriter(f);</span><br><span class="line">PrintWriter printWriter &#x3D; new PrintWriter(writer);</span><br><span class="line">printWriter.write(&quot;　此时讲道场的晚课已经做完，大方师徐福居中席地而坐，手里拿着一卷竹简，借着昏暗的油灯光亮，低头看着竹简上面写着的内容，他的身后规规矩矩地站着三人，这三个人二男一女却看不出年纪，单看相貌都是在二十到四十岁左右，但是和广仁一样都是一头的白发。徐福身前两侧各有二三十名亲近弟子垂手侍立在两侧，道场中人虽然不少但是却静悄悄的，没有丝毫的声响。&quot;);</span><br><span class="line">printWriter.close();</span><br></pre></td></tr></table></figure>

<h2 id="PrintWriter和BufferedWriter"><a href="#PrintWriter和BufferedWriter" class="headerlink" title="PrintWriter和BufferedWriter"></a>PrintWriter和BufferedWriter</h2><ol>
<li><p>PrintWriter的print、println方法可以接受任意类型的参数，而BufferedWriter的write方法只能接受字符、字符数组和字符串；</p>
</li>
<li><p>PrintWriter的println方法自动添加换行，BufferedWriter需要显示调用newLine方法；</p>
</li>
<li><p>PrintWriter的方法不会抛异常，若关心异常，需要调用checkError方法看是否有异常发生；</p>
</li>
<li><p>PrintWriter构造方法可指定参数，实现自动刷新缓存（autoflush）；</p>
</li>
<li><p>PrintWriter的构造方法更广。</p>
<h1 id="数据流"><a href="#数据流" class="headerlink" title="数据流"></a>数据流</h1></li>
</ol>
<p>要用DataInputStream 读取一个文件，这个文件必须是由DataOutputStream 写出的，否则会出现EOFException，因为DataOutputStream 在写出的时候会做一些特殊标记，只有DataInputStream 才能成功的读取。</p>
<h2 id="输入-DataInputStream"><a href="#输入-DataInputStream" class="headerlink" title="输入 DataInputStream"></a>输入 DataInputStream</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">File file = <span class="keyword">new</span> File(<span class="string">&quot;h:/6.txt&quot;</span>);</span><br><span class="line">FileInputStream inputStream = <span class="keyword">new</span> FileInputStream(file);</span><br><span class="line">DataInputStream stream = <span class="keyword">new</span> DataInputStream(inputStream);</span><br><span class="line">String s = stream.readUTF();</span><br><span class="line">System.out.println(s);</span><br><span class="line">stream.close();</span><br></pre></td></tr></table></figure>

<h2 id="输出-DataOutputStream"><a href="#输出-DataOutputStream" class="headerlink" title="输出   DataOutputStream"></a>输出   DataOutputStream</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">File file = <span class="keyword">new</span> File(<span class="string">&quot;h:/6.txt&quot;</span>);</span><br><span class="line">FileOutputStream outputStream = <span class="keyword">new</span> FileOutputStream(file);</span><br><span class="line">DataOutputStream stream = <span class="keyword">new</span> DataOutputStream(outputStream);</span><br><span class="line"></span><br><span class="line">stream.writeUTF(<span class="string">&quot;这是一段话&quot;</span>);</span><br><span class="line">stream.close();</span><br></pre></td></tr></table></figure>

<h1 id="对象流"><a href="#对象流" class="headerlink" title="对象流"></a>对象流</h1><h2 id="输入-ObjectInputStream"><a href="#输入-ObjectInputStream" class="headerlink" title="输入 ObjectInputStream"></a>输入 ObjectInputStream</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ObjectInputStream stream = <span class="keyword">new</span> ObjectInputStream(<span class="keyword">new</span> FileInputStream(<span class="string">&quot;h:/student.txt&quot;</span>));</span><br><span class="line">List&lt;Student&gt; stu= (List&lt;Student&gt;) stream.readObject();</span><br><span class="line"><span class="keyword">for</span> (Student student : stu) &#123;</span><br><span class="line">    System.out.println(stu);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="输出-ObjectOutputStream"><a href="#输出-ObjectOutputStream" class="headerlink" title="输出 ObjectOutputStream"></a>输出 ObjectOutputStream</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Student s1 = <span class="keyword">new</span> Student(<span class="string">&quot;赵高&quot;</span>, <span class="number">1</span>, <span class="number">20</span>, <span class="string">&quot;中车府令&quot;</span>);</span><br><span class="line">Student s2 = <span class="keyword">new</span> Student(<span class="string">&quot;李斯&quot;</span>, <span class="number">1</span>, <span class="number">30</span>, <span class="string">&quot;丞相&quot;</span>);</span><br><span class="line">List list = <span class="keyword">new</span> ArrayList();</span><br><span class="line">list.add(s1);</span><br><span class="line">list.add(s2);</span><br><span class="line"></span><br><span class="line">FileOutputStream out = <span class="keyword">new</span> FileOutputStream(<span class="keyword">new</span> File(<span class="string">&quot;h:/student.txt&quot;</span>));</span><br><span class="line">ObjectOutputStream stream = <span class="keyword">new</span> ObjectOutputStream(out);</span><br><span class="line">stream.writeObject(list);</span><br><span class="line">stream.close();</span><br></pre></td></tr></table></figure>

<h1 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h1><ol>
<li>strem结尾的是字节流,读取到的是二进制文件</li>
<li>read结尾的是字符流,可以读取中文</li>
</ol>
<p>按功能来分：输入流（input）、输出流（output）。</p>
<p>按类型来分：字节流和字符流。</p>
<p>字节流和字符流的区别是：字节流按 8 位传输以字节为单位输入输出数据，字符流按 16 位传输以字符为单位输入输出数据。</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java基础</tag>
        <tag>流</tag>
      </tags>
  </entry>
  <entry>
    <title>jdk1.8 日期类型</title>
    <url>/2020/07/28/java/jdk1.8%20%E6%97%A5%E6%9C%9F%E7%B1%BB%E5%9E%8B/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p><a href="https://blog.csdn.net/HuaZi_Myth/article/details/104198192">参考博客</a></p>
<blockquote>
<p>Java8引入的新的一系列API，对时间日期的处理提供了更好的支持，清楚的定义了时间日期的一些概念，比如说，</p>
<p>瞬时时间（Instant）,</p>
<p>持续时间（duration）,</p>
<p>日期（date）,</p>
<p>时间（time）,</p>
<p>时区（time-zone）,</p>
<p>时间段（Period）。</p>
</blockquote>
<a id="more"></a>

<ol>
<li><p><code>LocalDate</code>：不包含时间的日期，比如2019-10-14。可以用来存储生日，周年纪念日，入职日期等。</p>
</li>
<li><p><code>LocalTime</code>：与<code>LocalDate</code>想对照，它是不包含日期的时间。</p>
</li>
<li><p><code>LocalDateTime</code>：包含了日期及时间，没有偏移信息（时区）。</p>
</li>
<li><p><code>ZonedDateTime</code>：包含时区的完整的日期时间，偏移量是以UTC/格林威治时间为基准的。</p>
</li>
<li><p><code>Instant</code>：时间戳，与<code>System.currentTimeMillis()</code>类似以毫秒表示，<code>Instant</code>可以精确到纳秒。</p>
</li>
<li><p><code>Duration</code>：表示一个时间段,表示秒或纳秒时间间隔，适合处理较短的时间，需要更高的精确性。</p>
</li>
<li><p><code>Period</code>：计算的是年月日的差值。</p>
</li>
<li><p><code>DateTimeFormatter</code>：新的日期解析格式化类。</p>
</li>
</ol>
<h1 id="LocalDate"><a href="#LocalDate" class="headerlink" title="LocalDate"></a>LocalDate</h1><p>LocalDate类内只包含日期，不包含具体时间。只需要表示日期而不包含时间，就可以使用它。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalDate today = LocalDate.now();</span><br><span class="line">System.out.println(<span class="string">&quot;现状时间是:&quot;</span> + today);<span class="comment">////2021-01-10</span></span><br><span class="line">System.out.println(<span class="string">&quot;现在是哪一年==&gt;&quot;</span> + today.getYear());<span class="comment">//2021</span></span><br><span class="line">System.out.println(<span class="string">&quot;现在是哪一年==&gt;&quot;</span> + today.get(ChronoField.YEAR));<span class="comment">//2021</span></span><br><span class="line">System.out.println(<span class="string">&quot;输出英文的月份==&gt;&quot;</span> + today.getMonth());<span class="comment">//JANUARY</span></span><br><span class="line">System.out.println(<span class="string">&quot;今年的第几个月==&gt;&quot;</span> + today.getMonthValue()); <span class="comment">//1</span></span><br><span class="line">System.out.println(<span class="string">&quot;这个月的第几天==&gt;&quot;</span> + today.getDayOfMonth()); <span class="comment">//10</span></span><br><span class="line">System.out.println(<span class="string">&quot;这个月有多少天==&gt;&quot;</span> + today.lengthOfMonth());<span class="comment">//31</span></span><br><span class="line">System.out.println(<span class="string">&quot;今年有多少天==&gt;&quot;</span> + today.lengthOfYear());<span class="comment">//365</span></span><br><span class="line">System.out.println(<span class="string">&quot;今天是周几,输出英文==&gt;&quot;</span> + today.getDayOfWeek());<span class="comment">//SUNDAY</span></span><br><span class="line">System.out.println(<span class="string">&quot;是否是闰年==&gt;&quot;</span> + today.isLeapYear());<span class="comment">//false</span></span><br><span class="line"><span class="comment">//构造指定日期</span></span><br><span class="line">LocalDate of = LocalDate.of(<span class="number">2020</span>, <span class="number">7</span>, <span class="number">29</span>);</span><br><span class="line">System.out.println(of);<span class="comment">//2020-07-29</span></span><br></pre></td></tr></table></figure>

<h1 id="LocalTime"><a href="#LocalTime" class="headerlink" title="LocalTime"></a>LocalTime</h1><p>LocalTime只会获取时间，不获取日期。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalTime now = LocalTime.now();</span><br><span class="line">System.out.println(<span class="string">&quot;现在的时间==&gt;&quot;</span> + now);<span class="comment">//12:42:17.669</span></span><br><span class="line">System.out.println(<span class="string">&quot;当前小时==&gt;&quot;</span> + now.getHour());<span class="comment">//12</span></span><br><span class="line">System.out.println(<span class="string">&quot;当前分钟==&gt;&quot;</span> + now.getMinute());<span class="comment">//42</span></span><br><span class="line">System.out.println(<span class="string">&quot;当前秒==&gt;&quot;</span> + now.getSecond());<span class="comment">//17</span></span><br><span class="line"><span class="comment">//构造一个时间</span></span><br><span class="line">LocalTime of = LocalTime.of(<span class="number">10</span>, <span class="number">52</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;构造的函数==&gt;&quot;</span> + of);<span class="comment">//10:52</span></span><br></pre></td></tr></table></figure>

<h1 id="LocalDateTime"><a href="#LocalDateTime" class="headerlink" title="LocalDateTime"></a>LocalDateTime</h1><p><code>LocalDateTime</code>表示日期和时间组合。可以通过of()方法直接创建，也可以调用<code>LocalDate</code>的<code>atTime()</code>方法或<code>LocalTime</code>的<code>atDate()</code>方法将<code>LocalDate</code>或<code>LocalTime</code>合并成一个<code>LocalDateTime</code>。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalDateTime now = LocalDateTime.now();</span><br><span class="line">System.out.println(<span class="string">&quot;现在是==&gt;&quot;</span> + now);<span class="comment">//2021-01-10T12:43:50.486</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//获取本地化时间</span></span><br><span class="line">System.out.println(<span class="string">&quot;本地日期==&gt;&quot;</span> + now.toLocalDate());<span class="comment">//2021-01-10</span></span><br><span class="line">System.out.println(<span class="string">&quot;本地时间==&gt;&quot;</span> + now.toLocalTime());<span class="comment">//12:43:50.486</span></span><br><span class="line"><span class="comment">//构造一个日期</span></span><br><span class="line">LocalDateTime dateTime = LocalDateTime.of(<span class="number">2020</span>, <span class="number">7</span>, <span class="number">28</span>, <span class="number">10</span>, <span class="number">55</span>, <span class="number">34</span>, <span class="number">34</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;创建的日期==&gt;&quot;</span> + dateTime);<span class="comment">//2020-07-28T10:55:34.000000034</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//拼接日期</span></span><br><span class="line">LocalDateTime thisTime1 = LocalTime.now().atDate(LocalDate.of(<span class="number">2020</span>, <span class="number">7</span>, <span class="number">28</span>));</span><br><span class="line">LocalDateTime thisTime2 = LocalDate.now().atTime(LocalTime.now());</span><br><span class="line">LocalDateTime thisTime3 = LocalDate.now().atTime(LocalTime.of(<span class="number">12</span>, <span class="number">24</span>, <span class="number">12</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;拼接的日期==&gt;&quot;</span> + thisTime1);<span class="comment">//2020-07-28T12:43:50.486</span></span><br><span class="line">System.out.println(<span class="string">&quot;拼接的日期==&gt;&quot;</span> + thisTime2);<span class="comment">//2021-01-10T12:43:50.486</span></span><br><span class="line">System.out.println(<span class="string">&quot;拼接的日期==&gt;&quot;</span> + thisTime3);<span class="comment">//2021-01-10T12:24:12</span></span><br></pre></td></tr></table></figure>

<h1 id="ZonedDateTime"><a href="#ZonedDateTime" class="headerlink" title="ZonedDateTime"></a>ZonedDateTime</h1><p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1303904694304801">参考博客</a></p>
<blockquote>
<ol>
<li>可以简单地把<code>ZonedDateTime</code>理解成<code>LocalDateTime</code>加<code>ZoneId</code>。<code>ZoneId</code>是<code>java.time</code>引入的新的时区类，注意和旧的<code>java.util.TimeZone</code>区别。</li>
<li>要创建一个<code>ZonedDateTime</code>对象，一种是通过<code>now()</code>方法返回当前时间。</li>
<li>另一种方式是通过给一个<code>LocalDateTime</code>附加一个<code>ZoneId</code>，就可以变成<code>ZonedDateTime</code>。</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第一种创建方式</span></span><br><span class="line"><span class="comment">//默认时区</span></span><br><span class="line">ZonedDateTime now = ZonedDateTime.now();</span><br><span class="line">System.out.println(<span class="string">&quot;默认的包含时区的完整信息==&gt;&quot;</span> + now);<span class="comment">//2021-01-10T12:46:23.130+08:00[Asia/Shanghai]</span></span><br><span class="line"><span class="comment">//指定一个时区,获取时区的信息</span></span><br><span class="line">ZonedDateTime dateTime = ZonedDateTime.now(ZoneId.of(<span class="string">&quot;America/New_York&quot;</span>));</span><br><span class="line">System.out.println(<span class="string">&quot;指定时区的时间==&gt;&quot;</span> + dateTime);<span class="comment">//2021-01-09T23:46:23.130-05:00[America/New_York]</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//第二种创建方式</span></span><br><span class="line">LocalDateTime localdateTime = LocalDateTime.of(<span class="number">2020</span>, <span class="number">7</span>, <span class="number">28</span>, <span class="number">15</span>, <span class="number">16</span>, <span class="number">17</span>);</span><br><span class="line"><span class="comment">//本地时区 Asia/Shanghai</span></span><br><span class="line">ZonedDateTime zonedDateTime = localdateTime.atZone(ZoneId.systemDefault());</span><br><span class="line">ZonedDateTime zibedD = localdateTime.atZone(ZoneId.of(<span class="string">&quot;America/New_York&quot;</span>));</span><br><span class="line">System.out.println(zonedDateTime);<span class="comment">//2020-07-28T15:16:17+08:00[Asia/Shanghai]</span></span><br><span class="line">System.out.println(zibedD);<span class="comment">//2020-07-28T15:16:17-04:00[America/New_York]</span></span><br></pre></td></tr></table></figure>

<h1 id="Instant"><a href="#Instant" class="headerlink" title="Instant"></a>Instant</h1><p><code>Instant</code>用于一个获取时间戳，与<code>System.currentTimeMillis()</code>类似，但<code>Instant</code>可以精确到纳秒。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建时间戳</span></span><br><span class="line">Instant now = Instant.now();</span><br><span class="line">System.out.println(<span class="string">&quot;秒==&gt;&quot;</span> + now.getEpochSecond());<span class="comment">//1610254106</span></span><br><span class="line">System.out.println(<span class="string">&quot;毫秒==&gt;&quot;</span> + now.toEpochMilli());<span class="comment">//1610254106536</span></span><br><span class="line"></span><br><span class="line"><span class="comment">//根据指定的时间戳,创建出时区信息</span></span><br><span class="line">Instant ins = Instant.ofEpochSecond(<span class="number">1595909419</span>);</span><br><span class="line">ZonedDateTime zdt = ins.atZone(ZoneId.systemDefault());</span><br><span class="line">System.out.println(zdt);<span class="comment">//2020-07-28T12:10:19+08:00[Asia/Shanghai]</span></span><br></pre></td></tr></table></figure>

<h1 id="Duration"><a href="#Duration" class="headerlink" title="Duration"></a>Duration</h1><p><a href="https://www.codercto.com/a/19223.html">文章地址</a></p>
<p>表示一个时间段,表示秒或纳秒时间间隔，适合处理较短的时间，需要更高的精确性。</p>
<p><code>Duration</code> 字符串类似数字有正负之分,默认正,负以’-‘开头,紧接着’P’,下面所有字母都不区分大小写:<br>‘D’ – 天<br>‘H’ – 小时<br>‘M’ – 分钟<br>‘S’ – 秒<br>字符’T’是紧跟在时分秒之前的，每个单位都必须由数字开始,且时分秒顺序不能乱,比如:P2DT3M5S,P3D,PT3S<br>PT3M2S 等于   -PT-3M-2S</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalTime start = LocalTime.of(<span class="number">12</span>, <span class="number">34</span>, <span class="number">00</span>);</span><br><span class="line">LocalTime end = LocalTime.of(<span class="number">12</span>, <span class="number">40</span>, <span class="number">01</span>);</span><br><span class="line"></span><br><span class="line">Duration between = Duration.between(start, end);</span><br><span class="line">System.out.println(between);<span class="comment">//PT6M1S  6分1秒</span></span><br></pre></td></tr></table></figure>

<h1 id="Period"><a href="#Period" class="headerlink" title="Period"></a>Period</h1><p>计算年月日的差值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> LocalDate startDate = LocalDate.now();</span><br><span class="line">LocalDate endDate = startDate.plusDays(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">Period period = Period.between(startDate, endDate);</span><br><span class="line">System.out.println(<span class="string">&quot;间隔的天数&quot;</span> + period.getDays());<span class="comment">//1</span></span><br><span class="line">System.out.println(<span class="string">&quot;间隔的月数:&quot;</span> + period.getMonths());<span class="comment">//0</span></span><br><span class="line">System.out.println(<span class="string">&quot;间隔的年数:&quot;</span> + period.getYears());<span class="comment">//0</span></span><br></pre></td></tr></table></figure>

<h1 id="DateTimeFormatter"><a href="#DateTimeFormatter" class="headerlink" title="DateTimeFormatter"></a>DateTimeFormatter</h1><p>新的日期解析格式化类。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LocalDate today = LocalDate.now();</span><br><span class="line"><span class="comment">// 两种默认格式化时间方式</span></span><br><span class="line">String todayStr1 = today.format(DateTimeFormatter.BASIC_ISO_DATE);</span><br><span class="line">String todayStr2 = today.format(DateTimeFormatter.ISO_LOCAL_DATE);</span><br><span class="line">System.out.println(<span class="string">&quot;格式化时间：&quot;</span> + todayStr1);<span class="comment">//20210110</span></span><br><span class="line">System.out.println(<span class="string">&quot;格式化时间：&quot;</span> + todayStr2);<span class="comment">//2021-01-10</span></span><br><span class="line"><span class="comment">//自定义格式化</span></span><br><span class="line">DateTimeFormatter dateTimeFormatter = DateTimeFormatter.ofPattern(<span class="string">&quot;dd/MM/yyyy&quot;</span>);</span><br><span class="line">String todayStr3 = today.format(dateTimeFormatter);</span><br><span class="line">System.out.println(<span class="string">&quot;自定义格式化时间：&quot;</span> + todayStr3);<span class="comment">//10/01/2021</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">LocalDate date1 = LocalDate.parse(<span class="string">&quot;20080808&quot;</span>, DateTimeFormatter.BASIC_ISO_DATE);</span><br><span class="line">LocalDate date2 = LocalDate.parse(<span class="string">&quot;2008-08-08&quot;</span>, DateTimeFormatter.ISO_LOCAL_DATE);</span><br><span class="line">System.out.println(date1);<span class="comment">//2008-08-08</span></span><br><span class="line">System.out.println(date2);<span class="comment">//2008-08-08</span></span><br></pre></td></tr></table></figure>





















]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java基础</tag>
      </tags>
  </entry>
  <entry>
    <title>Servlet</title>
    <url>/2020/03/24/javaweb/servlet/</url>
    <content><![CDATA[<h1 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><blockquote>
<p>客户端  —&gt;  服务器     请求    HttpServletRequest</p>
</blockquote>
<blockquote>
<p>客户端  —&gt;  客户端     响应    HttpServletResponse</p>
</blockquote>
<h2 id="生命周期"><a href="#生命周期" class="headerlink" title="生命周期"></a>生命周期</h2><p><strong>访问Servlet方法的时候</strong></p>
<ol>
<li><strong>创建一个Servlet实例对象</strong></li>
<li><strong>调用nit方法 初始化</strong></li>
<li><strong>调用service方法 处理请求</strong></li>
<li><strong>以后的请求,只调用service方法,getServletConfig—getServletInfo手动调用</strong></li>
<li><strong>服务器停止或者项目卸载,调用destory方法</strong></li>
</ol>
<a id="more"></a>

<h2 id="方法实例"><a href="#方法实例" class="headerlink" title="方法实例"></a>方法实例</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebServlet(urlPatterns = &#123;&quot;/s1&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ServletDemo</span> <span class="keyword">implements</span> <span class="title">Servlet</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 处理在init方法调用的时候的servlet配置信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> ServletConfig config=<span class="keyword">null</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * servlet初始化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(ServletConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line">        <span class="comment">//一个servlet对应一个config,</span></span><br><span class="line">        <span class="keyword">this</span>.config=config;</span><br><span class="line">        System.out.println(<span class="string">&quot;初始化...........&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取servlet初始化的时候的配置信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> ServletConfig <span class="title">getServletConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> config;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 方法处理</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">service</span><span class="params">(ServletRequest req, ServletResponse res)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;service......&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 返回servlet描述信息,一般返回类名就可以</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getServletInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;ServletDemo&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * servlet销毁</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;destroy.............&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><blockquote>
<p>获取servlet的别名</p>
</blockquote>
<p><code>public String getServletName();</code></p>
<blockquote>
<p>获取servlet的上下文      eg: <a href="mailto:org.apache.catalina.core.ApplicationContextFacade@62d71f09">org.apache.catalina.core.ApplicationContextFacade@62d71f09</a></p>
</blockquote>
<p><code>public ServletContext getServletContext();</code></p>
<blockquote>
<p>获取servlet的初始化参数</p>
</blockquote>
<p><code>public String getInitParameter(String name);</code></p>
<h2 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;servlet&gt;</span><br><span class="line">    &lt;servlet-name&gt;ServletDemo&lt;&#x2F;servlet-name&gt;</span><br><span class="line">    &lt;servlet-class&gt;com.wty.servlet.servlet.ServletDemo&lt;&#x2F;servlet-class&gt;</span><br><span class="line">    &#x2F;&#x2F;初始化参数</span><br><span class="line">    &lt;init-param&gt;</span><br><span class="line">        &lt;param-name&gt;username&lt;&#x2F;param-name&gt;</span><br><span class="line">        &lt;param-value&gt;xiaoaaa&lt;&#x2F;param-value&gt;</span><br><span class="line">    &lt;&#x2F;init-param&gt;</span><br><span class="line">&lt;&#x2F;servlet&gt;</span><br></pre></td></tr></table></figure>

<h1 id="HttpServlet"><a href="#HttpServlet" class="headerlink" title="HttpServlet"></a>HttpServlet</h1><h2 id="实现原理图示"><a href="#实现原理图示" class="headerlink" title="实现原理图示"></a>实现原理图示</h2><p><img data-src="/images/servlet/servlet-1.png"></p>
<h2 id="原理说明"><a href="#原理说明" class="headerlink" title="原理说明"></a>原理说明</h2><blockquote>
<ol>
<li><p>发送 <a href="http://localhost:8080/XXX%E8%AF%B7%E6%B1%82">http://localhost:8080/XXX请求</a></p>
</li>
<li><p>Servlet是父接口,优先实现,调用<code>service  (ServletRequest req, ServletResponse res)</code> 实现,但是Servlet是接口,没有实现方法,被GenericServlet类实现</p>
</li>
<li><p>GenericServlet类继承Servlet接口,调用本身的 <code>abstract void service(ServletRequest req, ServletResponse res)</code> 抽象方法,本身并没有实现具体方法</p>
</li>
<li><p>HttpServlet实现抽象类GenericServlet,并实现GenericServlet的service抽象方法,写出了具体方法<code>service(ServletRequest req, ServletResponse res)</code></p>
</li>
</ol>
</blockquote>
<p><img data-src="/images%5Cservlet%5Cservlet-2.png" alt="图片servlet-2.png"></p>
<p>service方法,强转ServletRequest 为  <code>HttpServletRequest</code> ,强转ServletResponse 为  <code>HttpServletResponse,</code></p>
<p>最后调用了自身的  <code>service(HttpServletRequest req, HttpServletResponse resp)</code></p>
<ol start="5">
<li><p>HttpServlet中的service(HttpServletRequest req, HttpServletResponse resp)方法首先获取请求方式,判断是那种请求,就会调用哪种方法,例如:是Get请求,就返回doGet(HttpServletRequest req, HttpServletResponse resp).</p>
<blockquote>
<p>HttpServlet中的service(HttpServletRequest req, HttpServletResponse resp)方法</p>
</blockquote>
</li>
</ol>
<p><img data-src="/images%5Cservlet%5Cservlet-3.png" alt="图片servlet-3.png"></p>
<ol start="6">
<li>HttpServlet中的 <code>doGet</code>方法有自己的实现方式,我们编写的Servlet<code>继承HttpServlet</code>,对<code>doGet方法进行重写</code></li>
</ol>
<p><img data-src="/images%5Cservlet%5Cservlet-4.png" alt="图片servlet-4.png"></p>
<h2 id="自定义Servlet"><a href="#自定义Servlet" class="headerlink" title="自定义Servlet"></a>自定义Servlet</h2><ol>
<li><p><strong>继承HttpServlet</strong></p>
</li>
<li><p><strong>重写doGet方法</strong></p>
<p><img data-src="/images%5Cservlet%5Cservlet-5.png"></p>
</li>
</ol>
<h1 id="Request"><a href="#Request" class="headerlink" title="Request"></a>Request</h1><h2 id="1-说明"><a href="#1-说明" class="headerlink" title="1.说明"></a><strong>1.说明</strong></h2><p><strong>HttpServletRequest</strong>                      封装了浏览器客户端请求服务器的信息</p>
<h2 id="2-乱码"><a href="#2-乱码" class="headerlink" title="2.乱码"></a><strong>2.乱码</strong></h2><p>request.setCharacterEncoding(“utf-8”);</p>
<h2 id="3-获取表单数据"><a href="#3-获取表单数据" class="headerlink" title="3.获取表单数据"></a><strong>3.获取表单数据</strong></h2><p>name指的是 form表单中的name属性</p>
<p>request.getParameter(name)</p>
<h2 id="4-获取表单中的多个数据"><a href="#4-获取表单中的多个数据" class="headerlink" title="4.获取表单中的多个数据"></a><strong>4.获取表单中的多个数据</strong></h2><p>返回String数组</p>
<p>String[] parameterValues = request.getParameterValues(name);</p>
<h2 id="5-获取请求头信息"><a href="#5-获取请求头信息" class="headerlink" title="5.获取请求头信息"></a><strong>5.获取请求头信息</strong></h2><p>request.getHeader(“ “)</p>
<h2 id="6-请求转发"><a href="#6-请求转发" class="headerlink" title="6.请求转发"></a><strong>6.请求转发</strong></h2><p>request.getRequestDispatcher(“/ServletDemo2”).forward(request, response);</p>
<h2 id="7-域对象"><a href="#7-域对象" class="headerlink" title="7.域对象"></a><strong>7.域对象</strong></h2><p>//共享域对象</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">request.setAttribute(&quot;msg&quot;, &quot;hello&quot;);</span><br><span class="line"></span><br><span class="line">request.getAttribute(&quot;msg&quot;);</span><br></pre></td></tr></table></figure>

<h2 id="8-请求转发和重定向的区别"><a href="#8-请求转发和重定向的区别" class="headerlink" title="8.请求转发和重定向的区别"></a>8.请求转发和重定向的区别</h2><p><img data-src="/images/servlet/servlet-6.png" alt="/images/servlet/servlet-6.png"></p>
<h2 id="9-获得客户机【浏览器】信息"><a href="#9-获得客户机【浏览器】信息" class="headerlink" title="9.获得客户机【浏览器】信息"></a><strong>9.获得客户机【浏览器】信息</strong></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">getRequestURL方法——返回客户端发出请求时的完整URL。 eg: http:&#x2F;&#x2F;192.168.0.111:8080&#x2F;ss2</span><br><span class="line"></span><br><span class="line">getRequestURI方法——返回请求行中的资源名部分。 eg:  &#x2F;ss2</span><br><span class="line"></span><br><span class="line">getQueryString 方法——返回请求行中的参数部分。</span><br><span class="line"></span><br><span class="line">getPathInfo方法——返回请求URL中的额外路径信息。额外路径信息是请求URL中的位于 Servlet的路径之后和查询参数之前的内容，它以“&#x2F;”开头。</span><br><span class="line"></span><br><span class="line">getRemoteAddr方法——返回发出请求的客户机的IP地址</span><br><span class="line"></span><br><span class="line">getRemoteHost方法——返回发出请求的客户机的完整主机名</span><br><span class="line"></span><br><span class="line">getRemotePort方法——返回客户机所使用的网络端口号</span><br><span class="line"></span><br><span class="line">getLocalAddr方法——返回WEB服务器的IP地址。</span><br><span class="line"></span><br><span class="line">getLocalName方法——返回WEB服务器的主机名</span><br></pre></td></tr></table></figure>

<h2 id="10-获得客户机请求头"><a href="#10-获得客户机请求头" class="headerlink" title="10.获得客户机请求头"></a><strong>10.获得客户机请求头</strong></h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">getHeader方法</span><br><span class="line"></span><br><span class="line">getHeaders方法</span><br><span class="line"></span><br><span class="line">getHeaderNames方法</span><br></pre></td></tr></table></figure>

<h2 id="11-获得客户机请求参数-客户端提交的数据"><a href="#11-获得客户机请求参数-客户端提交的数据" class="headerlink" title="11.获得客户机请求参数(客户端提交的数据)"></a><strong>11.获得客户机请求参数(客户端提交的数据)</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">getParameter</span><br><span class="line"></span><br><span class="line">getParameterValues（String name）</span><br><span class="line"></span><br><span class="line">getParameterNames</span><br><span class="line"></span><br><span class="line">getParameterMap</span><br></pre></td></tr></table></figure>

<h1 id="Response"><a href="#Response" class="headerlink" title="Response"></a>Response</h1><h2 id="1-说明-1"><a href="#1-说明-1" class="headerlink" title="1.说明"></a><strong>1.说明</strong></h2><blockquote>
<p>HttpServletResponse            封装了服务器响应给浏览器的响应信息</p>
</blockquote>
<h2 id="2-乱码-1"><a href="#2-乱码-1" class="headerlink" title="2.乱码**"></a>2.乱码**</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-给浏览器发送字符串"><a href="#3-给浏览器发送字符串" class="headerlink" title="3.给浏览器发送字符串"></a><strong>3.给浏览器发送字符串</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.getWriter().write(<span class="string">&quot;hello A&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="4-Response重定向"><a href="#4-Response重定向" class="headerlink" title="4.Response重定向"></a><strong>4.Response重定向</strong></h2><p>重定向会发送两次请求</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.sendRedirect(<span class="string">&quot;&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="5-设置不使用缓存"><a href="#5-设置不使用缓存" class="headerlink" title="5.设置不使用缓存"></a><strong>5.设置不使用缓存</strong></h2><p>使用缓存可以加快页面的加载，降低服务端的负担。但是也可能看到过时的信息，可以通过如下手段通知浏览器不要使用缓存</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.setDateHeader(<span class="string">&quot;Expires&quot;</span>,<span class="number">0</span> ); </span><br><span class="line">response.setHeader(<span class="string">&quot;Cache-Control&quot;</span>,<span class="string">&quot;no-cache&quot;</span>);</span><br><span class="line">response.setHeader(<span class="string">&quot;pragma&quot;</span>,<span class="string">&quot;no-cache&quot;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="Session"><a href="#Session" class="headerlink" title="Session"></a>Session</h1><h2 id="1-说明-2"><a href="#1-说明-2" class="headerlink" title="1.说明"></a>1.说明</h2><p>session是浏览器开关一次的会话机制,开启浏览器的访问jsp页面的时候,session就创建了,</p>
<p>服务器会为每次会话(浏览器开关闭,切换浏览器)生成一个新的session,以后每次使用的都是旧的session</p>
<p>观看地址:<a href="https://www.bilibili.com/video/av63564073?p=174">https://www.bilibili.com/video/av63564073?p=174</a></p>
<h2 id="2-创建-获取"><a href="#2-创建-获取" class="headerlink" title="2.创建 获取"></a><strong>2.创建 获取</strong></h2><p><img data-src="/images/servlet/servlet-7.png" alt="img"></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">HttpSession session = request.getSession();</span><br></pre></td></tr></table></figure>

<h2 id="3-赋值"><a href="#3-赋值" class="headerlink" title="3.赋值"></a><strong>3.赋值</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">session.setAttribute(<span class="string">&quot;user&quot;</span>, <span class="string">&quot;wang&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="4-判断是否是新的session"><a href="#4-判断是否是新的session" class="headerlink" title="4.判断是否是新的session"></a><strong>4.判断是否是新的session</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">session.isNew();</span><br></pre></td></tr></table></figure>

<h2 id="5-生命周期"><a href="#5-生命周期" class="headerlink" title="5.生命周期"></a><strong>5.生命周期</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//默认30分钟消失</span></span><br><span class="line"><span class="comment">//负数表示永不过期,太占用资源 </span></span><br><span class="line"><span class="comment">//整数指的是在不使用session后的多少秒消失</span></span><br><span class="line">session.setMaxInactiveInterval();</span><br></pre></td></tr></table></figure>

<h2 id="6-强制删除-使之立即失效"><a href="#6-强制删除-使之立即失效" class="headerlink" title="6.强制删除,使之立即失效"></a><strong>6.强制删除,使之立即失效</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">session.invalidate();</span><br></pre></td></tr></table></figure>

<h2 id="7-URL重写-适用于Cookie被禁用"><a href="#7-URL重写-适用于Cookie被禁用" class="headerlink" title="7.URL重写,适用于Cookie被禁用"></a><strong>7.URL重写,适用于Cookie被禁用</strong></h2><p>传值是页面或者servlet访问路径</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.encodeRedirectURL();</span><br></pre></td></tr></table></figure>

<p>c标签在页面使用</p>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;c:url value=<span class="string">&quot;&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<h1 id="Cookie"><a href="#Cookie" class="headerlink" title="Cookie"></a>Cookie</h1><h2 id="1-说明-3"><a href="#1-说明-3" class="headerlink" title="1.说明"></a>1.说明</h2><blockquote>
<p>服务器发送给浏览器的数据,浏览器保存,就是Cookie,浏览器关闭,cookie消失</p>
<p>在本项目中,不论服务器是否关闭,都可以获取持久化的cookie</p>
<p><a href="https://www.bilibili.com/video/av63564073?p=169">观看地址 </a></p>
</blockquote>
<h2 id="2-创建"><a href="#2-创建" class="headerlink" title="2.创建"></a><strong>2.创建</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Cookie cookie = <span class="keyword">new</span> Cookie(<span class="string">&quot;username&quot;</span>,<span class="string">&quot;wty&quot;</span>);</span><br></pre></td></tr></table></figure>

<h2 id="3-发送"><a href="#3-发送" class="headerlink" title="3.发送"></a><strong>3.发送</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.addCookie(cookie);</span><br></pre></td></tr></table></figure>

<h2 id="4-获取"><a href="#4-获取" class="headerlink" title="4.获取"></a><strong>4.获取</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Cookie[] cookies = request.getCookies(); </span><br><span class="line"><span class="keyword">if</span> (cookies != <span class="keyword">null</span>) &#123;    </span><br><span class="line">    <span class="keyword">for</span> (Cookie cookie : cookies) &#123; </span><br><span class="line">        String name = cookie.getName();</span><br><span class="line">        String value = cookie.getValue();</span><br><span class="line">        System.out.println(name + <span class="string">&quot;--&quot;</span> + value); </span><br><span class="line">    &#125; </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="5-删除"><a href="#5-删除" class="headerlink" title="5.删除"></a><strong>5.删除</strong></h2><p><strong>删除就是设置setMaxAge(0);</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">response.setContentType(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line"><span class="comment">//获取所有cookie</span></span><br><span class="line">Cookie[] cookies = request.getCookies();</span><br><span class="line"><span class="comment">//遍历cookie</span></span><br><span class="line"><span class="keyword">for</span> (Cookie cookie : cookies) &#123;</span><br><span class="line">    <span class="comment">//判断获取的cooKie是否是要删除的</span></span><br><span class="line">    <span class="keyword">if</span> (cookie.getName().equals(<span class="string">&quot;username&quot;</span>)) &#123;</span><br><span class="line">        <span class="comment">//执行删除操作</span></span><br><span class="line">        cookie.setMaxAge(<span class="number">0</span>);</span><br><span class="line">        response.addCookie(cookie);</span><br><span class="line">        response.getWriter().write(<span class="string">&quot;cookie删除完毕&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="6-持久化"><a href="#6-持久化" class="headerlink" title="6.持久化"></a><strong>6.持久化</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>);</span><br></pre></td></tr></table></figure>

<h2 id="7-生命周期"><a href="#7-生命周期" class="headerlink" title="7.生命周期"></a><strong>7.生命周期</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//设置cookie的存活时间,里面的参数是以秒为单位</span></span><br><span class="line">cookie.setMaxAge(<span class="number">60</span>*<span class="number">60</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果maxAge设置成-1代表是当前cookie的销毁时间是浏览器关闭，和默认是一样的</span></span><br><span class="line">cookie.setMaxAge(-<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//如果maxAge设置成0代表删除已经存在的和当前同名的cookie</span></span><br><span class="line">cookie.setMaxAge(<span class="number">0</span>);</span><br></pre></td></tr></table></figure>

<h2 id="8-路径"><a href="#8-路径" class="headerlink" title="8.路径"></a>8.<strong>路径</strong></h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//是以服务器作为根路径的</span></span><br><span class="line">cookie1.setPath(<span class="string">&quot;/&quot;</span>);</span><br></pre></td></tr></table></figure>

<h1 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h1><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p><a href="https://www.bilibili.com/video/BV1Cb411i71i?from=search&seid=3965524059942509965">观看地址</a></p>
<blockquote>
<p>web中的过滤器：当访问服务器的资源时，过滤器可以捋请求拦截下来，完成一些特殊的功能;</p>
<p>filter配置的是拦截路径,不是过滤路径;</p>
<p>过滤器在一次请求中,执行两遍,请求发送时是一次,请求返回时是一次;</p>
<p>一般用于完成通用的操作。如：登录验证、统一编码处理、敏感字符过滤.</p>
</blockquote>
<p><img data-src="/images/servlet/filter-1.png" alt="filter-1.png"></p>
<h2 id="实现自定义Filter"><a href="#实现自定义Filter" class="headerlink" title="实现自定义Filter"></a>实现自定义Filter</h2><h3 id="xml配置"><a href="#xml配置" class="headerlink" title="xml配置"></a>xml配置</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>MyFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>com.wty.servlet.filter.MyFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>MyFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--拦截路径--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//urlPatterns = &quot;/*&quot;,拦截所有请求,请求可以是路径,也可以是页面,eg:index.jsp</span></span><br><span class="line"><span class="meta">@WebFilter(urlPatterns = &quot;/*&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFilter</span> <span class="keyword">implements</span> <span class="title">Filter</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">destroy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> 		  ServletException, IOException </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器执行了&quot;</span>);</span><br><span class="line">        <span class="comment">//放行拦截,不然所有页面都访问不了</span></span><br><span class="line">        chain.doFilter(req, resp);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">init</span><span class="params">(FilterConfig config)</span> <span class="keyword">throws</span> ServletException </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="生命周期-1"><a href="#生命周期-1" class="headerlink" title="生命周期"></a>生命周期</h2><ol>
<li>服务器启动后,创建了<code>Filter</code>,执行了<code>init(FilterConfig config)</code>方法,只会执行一次一般用于加载资源;</li>
<li>每一次请求数据,都会执行<code>doFilter(ServletRequest req, ServletResponse resp, FilterChain chain)</code>方法,执行多次;</li>
<li>服务器只有在<code>正常关闭</code>的情况下,会执行<code>destroy()</code>方法,只执行一次,一般用于释放资源.</li>
</ol>
<h2 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h2><ol>
<li><p>发送了一个页面的请求数据,开始执行过滤器拦截,过滤器允许请求通过;</p>
</li>
<li><p>访问到了页面数据;</p>
</li>
<li><p>携带页面数据,返回到过滤器;</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doFilter</span><span class="params">(ServletRequest req, ServletResponse resp, FilterChain chain)</span> <span class="keyword">throws</span> ServletException, IOException </span>&#123;</span><br><span class="line">        <span class="comment">//对ServletRequest的请求信息增强</span></span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器执行了&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//放行拦截,不然所有页面都访问不了</span></span><br><span class="line">        chain.doFilter(req, resp);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//对ServletResponse的响应信息增强</span></span><br><span class="line">        System.out.println(<span class="string">&quot;过滤器返回了&quot;</span>);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="过滤器拦截配置"><a href="#过滤器拦截配置" class="headerlink" title="过滤器拦截配置"></a>过滤器拦截配置</h2><h3 id="拦截路径"><a href="#拦截路径" class="headerlink" title="拦截路径"></a>拦截路径</h3><ol>
<li><strong>具体资源路径：<code>/index.jsp</code>      只有访问index.jsp资源时，过滤器才会被执行</strong></li>
<li><strong>拦截目录：<code>/user/*</code>                 访问/user下的所有资源时，过滤器都会被执行</strong></li>
<li><strong>后缀名拦截：<code>*.jsp</code>               访问所有后缀名为jsp资源时，过滤器都会被执行</strong></li>
<li><strong>拦截所有资源：<code>/*</code>               访问所有资源时，过滤器都会被执行</strong></li>
</ol>
<h3 id="拦截方式"><a href="#拦截方式" class="headerlink" title="拦截方式"></a>拦截方式</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//@WebFilter(dispatcherTypes=DispatcherType.REQUEST)</span></span><br><span class="line"></span><br><span class="line">REQUEST, <span class="comment">//默认方式,浏览器直接请求资源</span></span><br><span class="line">FORWARD, <span class="comment">//转发访问,只有在服务器内部转发的时候,才触发拦截器</span></span><br><span class="line">INCLUDE,<span class="comment">//包含访问</span></span><br><span class="line">ASYNC, <span class="comment">//异步访问,如ajax</span></span><br><span class="line">ERROR;<span class="comment">//错误访问</span></span><br></pre></td></tr></table></figure>

<h2 id="过滤器链"><a href="#过滤器链" class="headerlink" title="过滤器链"></a>过滤器链</h2><h3 id="注解-1"><a href="#注解-1" class="headerlink" title="注解"></a>注解</h3><p>过滤器链就是有多个过滤器执行,说的是执行顺序,例如有filter1,filter2,资源,三者的执行顺序是</p>
<ol>
<li>filter1请求</li>
<li>filter2请求</li>
<li>资源</li>
<li>filter2响应</li>
<li>filter1响应</li>
</ol>
<h3 id="web-xml-1"><a href="#web-xml-1" class="headerlink" title="web.xml"></a>web.xml</h3><blockquote>
<p>哪一个过滤器的<code>&lt;filter-mapping&gt;</code>放在第一个,就先执行哪一个</p>
</blockquote>
<h1 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h1><h2 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h2><blockquote>
<p>概念：web的三大组件之一。<br>事件监听机制<br>事件：一件事情<br>事件源：事件发生的地方<br>监听器：一个对象<br>注册监听：将事件、事件源、监听器绑定在一起。当事件源上发生某个事件后，执行监听器代码</p>
</blockquote>
<h2 id="自定义"><a href="#自定义" class="headerlink" title="自定义"></a>自定义</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@WebListener()</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyListener</span> <span class="keyword">implements</span> <span class="title">ServletContextListener</span></span>&#123;</span><br><span class="line"> <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextInitialized</span><span class="params">(ServletContextEvent servletContextEvent)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//获取ServletContextListener对象</span></span><br><span class="line">        ServletContext servletContext = servletContextEvent.getServletContext();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="web-xml-2"><a href="#web-xml-2" class="headerlink" title="web.xml"></a>web.xml</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">//配置监听器</span><br><span class="line">	<span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>com.wty.servlet.listener.MyListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    //配置监听器的初始数据,比如文件位置</span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>localtion<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br></pre></td></tr></table></figure>







































]]></content>
      <categories>
        <category>javaWeb</category>
      </categories>
      <tags>
        <tag>javaWeb</tag>
      </tags>
  </entry>
  <entry>
    <title>反射</title>
    <url>/2020/01/05/java/%E5%8F%8D%E5%B0%84/</url>
    <content><![CDATA[<h1 id="创建反射"><a href="#创建反射" class="headerlink" title="创建反射"></a>创建反射</h1><p><a href="https://www.bilibili.com/video/BV1p4411P7V3?p=1">视频观看地址</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//类名</span></span><br><span class="line">Class&lt;User&gt; u1 = User.class;</span><br><span class="line">System.out.println(u1.hashCode());</span><br><span class="line"></span><br><span class="line"><span class="comment">//forName</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Class&lt;?&gt; u2 = Class.forName(<span class="string">&quot;com.wty.bean.User&quot;</span>);</span><br><span class="line">    System.out.println(u2.hashCode());</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">	e.printStackTrace();</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//实例化对象</span></span><br><span class="line">Class u3 = <span class="keyword">new</span> User().getClass();</span><br><span class="line">System.out.println(u3.hashCode());</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取父类</span></span><br><span class="line">Class  superclass = u1.getSuperclass();</span><br></pre></td></tr></table></figure>

<h1 id="所有类型的Class"><a href="#所有类型的Class" class="headerlink" title="所有类型的Class"></a>所有类型的Class</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Class c1 = Override.class;</span><br><span class="line">Class c2 = <span class="keyword">int</span>[][].class;</span><br><span class="line">Class c3 = String[].class;</span><br><span class="line">Class c4 = Integer.class;</span><br><span class="line">Class c5 = <span class="keyword">void</span>.class;</span><br><span class="line">Class c6 = Object.class;</span><br><span class="line">Class c7 = Class.class;</span><br><span class="line"></span><br><span class="line">System.out.println(c1);</span><br><span class="line">System.out.println(c2);</span><br><span class="line">System.out.println(c3);</span><br><span class="line">System.out.println(c4);</span><br><span class="line">System.out.println(c5);</span><br><span class="line">System.out.println(c6);</span><br><span class="line">System.out.println(c7);</span><br><span class="line"></span><br><span class="line"><span class="comment">//元素类型与维度一样,就是一个Class</span></span><br><span class="line"><span class="keyword">int</span>[] a=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line"><span class="keyword">int</span>[] b=<span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">10</span>];</span><br><span class="line">System.out.println(a.getClass().hashCode());</span><br><span class="line">System.out.println(b.getClass().hashCode());</span><br></pre></td></tr></table></figure>

<h1 id="类加载过程"><a href="#类加载过程" class="headerlink" title="类加载过程"></a>类加载过程</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test01</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        A a = <span class="keyword">new</span> A();</span><br><span class="line">        System.out.println(A.m);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span> </span>&#123;</span><br><span class="line">    <span class="keyword">static</span> <span class="keyword">int</span> m = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;静态代码块&quot;</span>);</span><br><span class="line">        m = <span class="number">200</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">A</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;构造器&quot;</span>);</span><br><span class="line">        m=<span class="number">300</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果:</p>
<blockquote>
<p>静态代码块<br>构造器<br>300</p>
</blockquote>
<p><strong>说明类加载的时候,先加载静态代码块,后加载构造器</strong></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java基础</tag>
      </tags>
  </entry>
  <entry>
    <title>Lamda的简化流程</title>
    <url>/2021/03/03/java/lamda/</url>
    <content><![CDATA[<h1 id="Lamda"><a href="#Lamda" class="headerlink" title="Lamda"></a>Lamda</h1><p><a href="https://www.bilibili.com/video/BV1V4411p7EF?p=10">狂神说</a></p>
<p><a href="https://blog.csdn.net/qq_41915921/article/details/107530736">CSDN博客</a></p>
<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>1、λ 希腊字母表中排序第十一位的字母，英语名称为 Lamda<br>2、避免匿名内部类定义过多<br>3、可以让你的代码看起来很简洁<br>4、去掉了一堆没有意义的代码，留下核心的逻辑<br>3、其实质属于函数式编程的概念</p>
<a id="more"></a>

<h2 id="函数式接口"><a href="#函数式接口" class="headerlink" title="函数式接口"></a>函数式接口</h2><blockquote>
<p>什么是(Functional interface)函数式接口</p>
</blockquote>
<ul>
<li>任何接口，如果只包含唯一一个抽象方法，那么它就是一个函数式接口。</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">Runnable</span></span>&#123;</span><br><span class="line">	<span class="function"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>对于函数式接口，我们可以通过lamda表达式来创建该接口的对象</li>
</ul>
<h1 id="推导"><a href="#推导" class="headerlink" title="推导"></a>推导</h1><h2 id="流程"><a href="#流程" class="headerlink" title="流程"></a>流程</h2><p>原始接口类  —&gt;  静态内部类 —&gt;  局部内部类(方法内部) —&gt; 匿名内部类  —&gt;lamda</p>
<h1 id="无参lamda"><a href="#无参lamda" class="headerlink" title="无参lamda"></a>无参lamda</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Wty</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/3/3 21:39</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: //TODO 推导lamda</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LamdaDemo1</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 3.静态内部类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Like2</span> <span class="keyword">implements</span> <span class="title">ILike</span> </span>&#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lamda</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;i like lamda3,静态内部类&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//2的运行</span></span><br><span class="line">        ILike like = <span class="keyword">new</span> Like();</span><br><span class="line">        like.lamda();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//3的运行</span></span><br><span class="line">        like = <span class="keyword">new</span> Like2();</span><br><span class="line">        like.lamda();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 4.局部内部类,直接放在方法里面</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Like3</span> <span class="keyword">implements</span> <span class="title">ILike</span> </span>&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lamda</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;i like lamda4,局部内部类&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//4的运行</span></span><br><span class="line">        like = <span class="keyword">new</span> Like3();</span><br><span class="line">        like.lamda();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 5.匿名内部类,没有类的名称,需要借助接口或者父类</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        like = <span class="keyword">new</span> ILike() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lamda</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;i like lamda5,匿名内部类&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        like.lamda();</span><br><span class="line"></span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 6. jdk1.8出现的lamda表达式</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        like = () -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;i like lamda6,lamda表达式&quot;</span>);</span><br><span class="line">        &#125;;</span><br><span class="line">        like.lamda();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 1. 定义一个函数式接口</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ILike</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">lamda</span><span class="params">()</span></span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 2.接口实现类</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Like</span> <span class="keyword">implements</span> <span class="title">ILike</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">lamda</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;i like lamda2,接口实现类&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="有参lamda"><a href="#有参lamda" class="headerlink" title="有参lamda"></a>有参lamda</h1><p>总结</p>
<ol>
<li>接口的方法参数只能有一个</li>
<li>参数有多个时,要去掉就都去掉,代码块要加括号</li>
<li>只有一行代码时,可以去掉花括号,超过了一行,就不能去掉花括号</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Wty</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/3/3 22:02</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: //TODO 有参lamda</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestLamda2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ILove love = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//局部内部类</span></span><br><span class="line">        <span class="class"><span class="keyword">class</span> <span class="title">Love</span> <span class="keyword">implements</span> <span class="title">ILove</span> </span>&#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;局部内部类:&quot;</span> + a);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        love = <span class="keyword">new</span> Love();</span><br><span class="line">        love.say(<span class="number">20</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//匿名内部类</span></span><br><span class="line">        love = <span class="keyword">new</span> ILove() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">(<span class="keyword">int</span> a)</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;匿名内部类:&quot;</span> + a);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        love.say(<span class="number">30</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//lamda</span></span><br><span class="line">        love = (<span class="keyword">int</span> a) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;lamda:&quot;</span> + a);</span><br><span class="line">        &#125;;</span><br><span class="line">        love.say(<span class="number">40</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//简化一,去掉属性类型</span></span><br><span class="line">        love = (a) -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;lamda:&quot;</span> + a);</span><br><span class="line">        &#125;;</span><br><span class="line">        love.say(<span class="number">50</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//简化二,去掉括号</span></span><br><span class="line">        love = a -&gt; &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;lamda:&quot;</span> + a);</span><br><span class="line">        &#125;;</span><br><span class="line">        love.say(<span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//简化三,去掉花括号</span></span><br><span class="line">        love = a -&gt; System.out.println(<span class="string">&quot;lamda:&quot;</span> + a);</span><br><span class="line">        love.say(<span class="number">60</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">interface</span> <span class="title">ILove</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">say</span><span class="params">(<span class="keyword">int</span> a)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>























]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java基础</tag>
      </tags>
  </entry>
  <entry>
    <title>java 变量</title>
    <url>/2020/03/24/java/%E5%8F%98%E9%87%8F/</url>
    <content><![CDATA[<h1 id="一-变量"><a href="#一-变量" class="headerlink" title="一.变量"></a>一.变量</h1><h2 id="1-基本数据类型"><a href="#1-基本数据类型" class="headerlink" title="1. 基本数据类型"></a>1. 基本数据类型</h2><h3 id="整型-4种"><a href="#整型-4种" class="headerlink" title="整型(4种)"></a>整型(4种)</h3><blockquote>
<p>整型变量用于存放整数<br>byte<br>short<br>int<br>long</p>
</blockquote>
<a id="more"></a>

<p><img data-src="/images/javase/1.png"></p>
<h3 id="字符型-1种"><a href="#字符型-1种" class="headerlink" title="字符型(1种)"></a>字符型(1种)</h3><blockquote>
<p>char类型用于存放一个字符，值用单引号’表示 (双引号表示字符串)<br>其长度和short一样，也是16位的<br><strong>只能存放一个字符</strong>，超过一个字符就会产生编译错误</p>
</blockquote>
<h3 id="浮点型-2种"><a href="#浮点型-2种" class="headerlink" title="浮点型(2种)"></a>浮点型(2种)</h3><blockquote>
<p>浮点数类型有两种<br>float 长度为32位<br>double 长度为64位<br><strong>注意： 默认的小数值是double类型的</strong><br>所以 float f = 54.321会出现编译错误，因为54.321的默认类型是 double，其类型 长度为64，超过了float的长度32<br>在数字后面<strong>加一个字母f</strong>，直接把该数字声明成float类型<br>float f2 = 54.321<strong>f</strong>,<br>这样就不会出错了</p>
</blockquote>
<p><img data-src="/images%5Cjavase%5C2.png"></p>
<h3 id="布尔型-1种"><a href="#布尔型-1种" class="headerlink" title="布尔型(1种)"></a>布尔型(1种)</h3><blockquote>
<p>true </p>
<p>false</p>
</blockquote>
<h3 id="String"><a href="#String" class="headerlink" title="String"></a>String</h3><blockquote>
<p>String类型是Immutable的，一旦创建就不能够被改变</p>
<p>immutable 是指不可改变的,<br><strong>不可改变</strong>的具体含义是指：<br>不能增加长度<br>不能减少长度<br>不能插入字符<br>不能删除字符<br>不能修改字符<br>一旦创建好这个字符串，里面的内容 <strong>永远</strong> 不能改变</p>
<p>String 的表现就像是一个<strong>常量</strong></p>
</blockquote>
<h3 id="字符串格式化"><a href="#字符串格式化" class="headerlink" title="字符串格式化"></a>字符串格式化</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">  </span><br><span class="line">    String name =<span class="string">&quot;盖伦&quot;</span>;</span><br><span class="line">    <span class="keyword">int</span> kill = <span class="number">8</span>;</span><br><span class="line">    String title=<span class="string">&quot;超神&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//直接使用+进行字符串连接，编码感觉会比较繁琐，并且维护性差,易读性差</span></span><br><span class="line">    String sentence = name+ <span class="string">&quot; 在进行了连续 &quot;</span> + kill + <span class="string">&quot; 次击杀后，获得了 &quot;</span> + title +<span class="string">&quot; 的称号&quot;</span>;</span><br><span class="line"></span><br><span class="line">    System.out.println(sentence);</span><br><span class="line"></span><br><span class="line">    <span class="comment">//格式化字符串</span></span><br><span class="line">    <span class="comment">//%s表示字符串，%d表示数字,%n表示换行</span></span><br><span class="line">    String sentenceFormat =<span class="string">&quot;%s 在进行了连续 %d 次击杀后，获得了 %s 的称号%n&quot;</span>;</span><br><span class="line"></span><br><span class="line">    String sentence2 = String.format(sentenceFormat, name,kill,title);</span><br><span class="line"></span><br><span class="line">    System.out.println(sentence2);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>



<h2 id="2-类型转换"><a href="#2-类型转换" class="headerlink" title="2. 类型转换"></a>2. 类型转换</h2><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><blockquote>
<p>需要注意的一点是<br>虽然short和char都是16位的，长度是一样的<br>但是彼此之间，依然需要进行强制转换</p>
</blockquote>
<p><img data-src="/images%5Cjavase%5C3.png"></p>
<h3 id="数据转换"><a href="#数据转换" class="headerlink" title="数据转换"></a>数据转换</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">1）将字符串转化为整型；</span><br><span class="line"></span><br><span class="line">int i &#x3D; Integer.parseInt(String str);</span><br><span class="line"></span><br><span class="line">int i &#x3D; Integer.valueOf(String str).intValue();</span><br><span class="line"></span><br><span class="line">注：Integer.parseInt和 Integer.valueOf 不同，前者生成的是整型，而后者是一个对象，所以要通过intValue()来获得对象的值；</span><br><span class="line"></span><br><span class="line">字串转成 Double, Float, Long 的方法大同小异.</span><br><span class="line"></span><br><span class="line">2) 整型转化为字符串：</span><br><span class="line"></span><br><span class="line">String str &#x3D; String.valueOf(int i);</span><br><span class="line"></span><br><span class="line">String str &#x3D; Integer.toString(int i);</span><br><span class="line"></span><br><span class="line">String str &#x3D; “” + i ;</span><br><span class="line"></span><br><span class="line">注： Double, Float, Long 的方法大同小异.</span><br></pre></td></tr></table></figure>





















]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java基础</tag>
      </tags>
  </entry>
  <entry>
    <title>集合基础</title>
    <url>/2020/03/24/java/%E9%9B%86%E5%90%88/</url>
    <content><![CDATA[<h1 id="集合简介"><a href="#集合简介" class="headerlink" title="集合简介"></a>集合简介</h1><p><a href="https://www.cnblogs.com/chenglc/p/8073049.html">原文博客地址</a></p>
<p><a href="https://how2j.cn/k/collection/collection-arraylist/363.html#nowhere">how2j</a></p>
<p><img data-src="/images/javase/list.png"></p>
<a id="more"></a>

<h1 id="几种集合之间的关系"><a href="#几种集合之间的关系" class="headerlink" title="几种集合之间的关系"></a>几种集合之间的关系</h1><ol>
<li>Queue队列: 先进先出队列</li>
</ol>
<p>Deque: 双向链表</p>
<p>Stack栈: 先进后出</p>
<p>注：Collection和Map之间没有关系，Collection是放一个一个对象的，Map 是放键值对的</p>
<p>注：Deque 继承 Queue,间接的继承了 Collection</p>
<ol start="2">
<li>LinkedList和ArrayList关系</li>
</ol>
<p>LinkedList， 插入，删除数据快</p>
<p>ArrayList是顺序结构，所以定位很快</p>
<ol start="3">
<li>ArrayList和HashSet </li>
</ol>
<p>ArrayList: 有顺序               HashSet: 无顺序</p>
<p>List中的数据可以重复        Set中的数据不能够重复</p>
<p>HashSet： 无序</p>
<p>LinkedHashSet： 按照插入顺序</p>
<p>TreeSet： 从小到大排序</p>
<ol start="4">
<li>HashMap和Hashtable都实现了Map接口，都是键值对保存数据的方式</li>
</ol>
<p>区别1：</p>
<p>HashMap可以存放 null</p>
<p>Hashtable不能存放null</p>
<p>区别2：</p>
<p>HashMap不是线程安全的类</p>
<p>Hashtable是线程安全的类</p>
<h1 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h1><h2 id="List方法"><a href="#List方法" class="headerlink" title="List方法"></a>List方法</h2><table>
<thead>
<tr>
<th>add</th>
<th>1.增加对象 2.指定位置增加对象</th>
</tr>
</thead>
<tbody><tr>
<td>contains</td>
<td>判断是否存在,判断的是对象</td>
</tr>
<tr>
<td>get</td>
<td>获取指定下角标位置的对象</td>
</tr>
<tr>
<td>indexOf</td>
<td>获取对象所处的位置</td>
</tr>
<tr>
<td>remove</td>
<td>1.删除对象 2.删除指定位置对象</td>
</tr>
<tr>
<td>set</td>
<td>替换指定位置的元素</td>
</tr>
<tr>
<td>size</td>
<td>获取大小</td>
</tr>
<tr>
<td>toArray</td>
<td>转换为数组</td>
</tr>
<tr>
<td>addAll</td>
<td>把另一个容器所有对象都加进来</td>
</tr>
<tr>
<td>clear</td>
<td>清空</td>
</tr>
</tbody></table>
<h3 id="ArrayList"><a href="#ArrayList" class="headerlink" title="ArrayList"></a>ArrayList</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt; </span></span><br><span class="line"><span class="class">    		<span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">RandomAccess</span>, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span>&#123;</span><br><span class="line">        </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为ArrayList实现了List接口,所有List接口有的方法,ArrayList也有</p>
<h3 id="LinkedList"><a href="#LinkedList" class="headerlink" title="LinkedList"></a>LinkedList</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractSequentialList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">   			<span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">Deque</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span>&#123;</span><br><span class="line">   						 </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>LinkedList 实现了<strong>List</strong>接口,还实现了双向链表结构<strong>Deque</strong>接口,还实现了队列<strong>Queue</strong>接口</p>
<ol>
<li><p>首先,需要明确,序列分先进先出FIFO,先进后出FILO<br>FIFO在Java中又叫Queue 队列<br>FILO在Java中又叫Stack 栈</p>
</li>
<li><p><strong>Deque</strong>是双向链表结构,可以很方便地在头尾添加删除数据</p>
<p>addFirst ()在最前面插入</p>
<p>getFirst() 查看最后一位</p>
<p>addLast () 在最后插入</p>
<p>removeFirst() 移除最前面的</p>
<p>removeLast()    移除最后面</p>
</li>
<li><p><strong>Queue</strong>是先进先出队列 FIFO，常用方法：<br><strong>offer</strong> 在最后添加元素<br><strong>poll</strong> 取出第一个元素<br><strong>peek</strong> 查看第一个元素</p>
</li>
</ol>
<h1 id="遍历"><a href="#遍历" class="headerlink" title="遍历"></a>遍历</h1><p>以此数据为例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;Integer&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">    list.add(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="for"><a href="#for" class="headerlink" title="for"></a>for</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; list.size(); i++) &#123;</span><br><span class="line">     System.out.println(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="foreach"><a href="#foreach" class="headerlink" title="foreach"></a>foreach</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">for</span> (Integer i : list) &#123;</span><br><span class="line">    System.out.println(i);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="迭代"><a href="#迭代" class="headerlink" title="迭代"></a>迭代</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Iterator&lt;Integer&gt; i = list.iterator();</span><br><span class="line"><span class="keyword">while</span> (i.hasNext())&#123;</span><br><span class="line">    Integer next = i.next();</span><br><span class="line">    System.out.println(next);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Map的遍历方式"><a href="#Map的遍历方式" class="headerlink" title="Map的遍历方式"></a>Map的遍历方式</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">Map&lt;Integer, String&gt; map &#x3D; new HashMap&lt;&gt;();</span><br><span class="line">map.put(1, &quot;西游记&quot;);</span><br><span class="line">map.put(2, &quot;红楼梦&quot;);</span><br><span class="line">map.put(3, &quot;水浒传&quot;);</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;第一种,使用普遍,二次取值</span><br><span class="line">for (Integer key : map.keySet()) &#123;</span><br><span class="line">	System.out.println(key+&quot;&#x3D;&#x3D;&quot;+map.get(key));</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">&#x2F;&#x2F;第二种,适用于数值较大的</span><br><span class="line">&#x2F;&#x2F;遍历时,用到了Map接口提供的方法</span><br><span class="line">for (Map.Entry&lt;Integer, String&gt; entry : map.entrySet()) &#123;</span><br><span class="line">Integer key &#x3D; entry.getKey();</span><br><span class="line">String value &#x3D; entry.getValue();</span><br><span class="line">System.out.println(key + &quot;&#x3D;&quot; + value);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Collections"><a href="#Collections" class="headerlink" title="Collections"></a>Collections</h1><blockquote>
<p>Collections是一个类，容器的工具类,就如同Arrays是数组的工具类</p>
</blockquote>
<p>常用的方法如下 </p>
<p>everse  反转<br> shuffle   混淆List中数据的顺序<br> sort   排序<br> swap 交换两个数据的位置<br> rotate  把List中的数据，向右滚动指定单位的长度<br> synchronizedList  把非线程安全的List转换为线程安全的List</p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java基础</tag>
      </tags>
  </entry>
  <entry>
    <title>javaInterview</title>
    <url>/2021/03/15/other/javaInterview/</url>
    <content><![CDATA[<h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><blockquote>
<p>Math.floor和Math.round</p>
</blockquote>
<p>代码:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//-11.0</span></span><br><span class="line">System.out.println(Math.floor(-<span class="number">10.5</span>));</span><br><span class="line"><span class="comment">//10.0</span></span><br><span class="line">System.out.println(Math.floor(<span class="number">10.5</span>));</span><br><span class="line"><span class="comment">//-10</span></span><br><span class="line">System.out.println(Math.round(-<span class="number">10.5</span>));</span><br><span class="line"><span class="comment">//11</span></span><br><span class="line">System.out.println(Math.round(<span class="number">10.5</span>));</span><br></pre></td></tr></table></figure>

<ol>
<li>round:在数轴上取值时，中间值（0.5）向右取整，所以正 0.5 是往上取整，负 0.5 是直接舍弃。</li>
<li>floor相反</li>
</ol>
<a id="more"></a>

<blockquote>
<p>String、StringBuffer、StringBuilder</p>
</blockquote>
<p><a href="https://how2j.cn/k/number-string/number-string-wrap/22.html">how2j</a> </p>
<p>String 声明的是不可变的对象，每次操作都会生成新的 String 对象，然后将指针指向新的 String 对象</p>
<p>StringBuffer、StringBuilder 可以在原有对象的基础上进行操作，所以在经常改变字符串内容的情况下最好不要使用 String。</p>
<p>StringBuffer 和 StringBuilder 最大的区别在于，StringBuffer 是线程安全的，而 StringBuilder 是非线程安全的，但 StringBuilder 的性能却高于 StringBuffer，所以在单线程环境下推荐使用 StringBuilder，多线程环境下推荐使用 StringBuffer。</p>
<blockquote>
<p> String 类的常用方法都有那些？</p>
</blockquote>
<ul>
<li>indexOf()：返回指定字符的索引。</li>
<li>charAt()：返回指定索引处的字符。</li>
<li>replace()：字符串替换。</li>
<li>trim()：去除字符串两端空白。</li>
<li>split()：分割字符串，返回一个分割后的字符串数组。</li>
<li>getBytes()：返回字符串的 byte 类型数组。</li>
<li>length()：返回字符串长度。</li>
<li>toLowerCase()：将字符串转成小写字母。</li>
<li>toUpperCase()：将字符串转成大写字符。</li>
<li>substring()：截取字符串。</li>
<li>equals()：字符串比较。</li>
</ul>
<blockquote>
<p>普通类和抽象类有哪些区别？</p>
</blockquote>
<ul>
<li>普通类不能包含抽象方法，抽象类可以包含抽象方法。</li>
<li>抽象类不能直接实例化，普通类可以直接实例化。</li>
</ul>
<blockquote>
<p>接口和抽象类有什么区别？</p>
</blockquote>
<ul>
<li>实现：抽象类的子类使用 extends 来继承；接口必须使用 implements 来实现接口。</li>
<li>构造函数：抽象类可以有构造函数；接口不能有。</li>
<li>main 方法：抽象类可以有 main 方法，并且我们能运行它；接口不能有 main 方法。</li>
<li>实现数量：类可以实现很多个接口；但是只能继承一个抽象类。</li>
<li>访问修饰符：接口中的方法默认使用 public 修饰；抽象类中的方法可以是任意访问修饰符。</li>
</ul>
<blockquote>
<p>接口和抽象类有什么区别？</p>
</blockquote>
<p><a href="https://how2j.cn/k/interface-inheritance/interface-inheritance-interface/289.html">how2j</a></p>
<ul>
<li>实现：抽象类的子类使用 extends 来继承；接口必须使用 implements 来实现接口。</li>
<li>构造函数：抽象类可以有构造函数；接口不能有。</li>
<li>main 方法：抽象类可以有 main 方法，并且我们能运行它；接口不能有 main 方法。</li>
<li>实现数量：类可以实现很多个接口；但是只能继承一个抽象类。</li>
<li>访问修饰符：接口中的方法默认使用 public 修饰；抽象类中的方法可以是任意访问修饰符。</li>
</ul>
<blockquote>
<p>Files的常用方法都有哪些？</p>
</blockquote>
<p><a href="https://how2j.cn/k/io/io-file/345.html">how2j</a></p>
<ul>
<li>Files.exists()：检测文件路径是否存在。</li>
<li>Files.createFile()：创建文件。</li>
<li>Files.createDirectory()：创建文件夹。</li>
<li>Files.delete()：删除一个文件或目录。</li>
<li>Files.copy()：复制文件。</li>
<li>Files.move()：移动文件。</li>
<li>Files.size()：查看文件个数。</li>
<li>Files.read()：读取文件。</li>
<li>Files.write()：写入文件。</li>
</ul>
<blockquote>
<p> java 中 IO 流分为几种？</p>
</blockquote>
<p>按功能来分：输入流（input）、输出流（output）。</p>
<p>按类型来分：字节流和字符流。</p>
<p>字节流和字符流的区别是：字节流按 8 位传输以字节为单位输入输出数据，字符流按 16 位传输以字符为单位输入输出数据。</p>
]]></content>
      <categories>
        <category>面试</category>
      </categories>
      <tags>
        <tag>面试</tag>
      </tags>
  </entry>
  <entry>
    <title>docker入门</title>
    <url>/2020/06/23/linux/docker/</url>
    <content><![CDATA[<h1 id="Docker"><a href="#Docker" class="headerlink" title="Docker"></a>Docker</h1><p><a href="https://www.bilibili.com/video/BV1og4y1q7M4?p=1">视频地址</a></p>
<h2 id="环境查看"><a href="#环境查看" class="headerlink" title="环境查看"></a>环境查看</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">uname -r</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="环境安装"><a href="#环境安装" class="headerlink" title="环境安装"></a>环境安装</h2><p>使用<code>yum -y update</code>可以更新yum安装包，更新时间大概是三十分钟左右，请谨慎</p>
<ol>
<li>卸载</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum remove docker \</span><br><span class="line">                  docker-client \</span><br><span class="line">                  docker-client-latest \</span><br><span class="line">                  docker-common \</span><br><span class="line">                  docker-latest \</span><br><span class="line">                  docker-latest-logrotate \</span><br><span class="line">                  docker-logrotate \</span><br><span class="line">                  docker-engine</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>需要的安装包</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y yum-utils \</span><br><span class="line">  device-mapper-persistent-data \</span><br><span class="line">  lvm2</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>添加阿里云仓库</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum-config-manager \</span><br><span class="line">    --add-repo \</span><br><span class="line">    http://mirrors.aliyun.com/docker-ce/linux/centos/docker-ce.repo</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>更新yum软件包索引</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">老式</span></span><br><span class="line">yum makecache fast</span><br><span class="line"><span class="meta">#</span><span class="bash">新式</span></span><br><span class="line">yum makecache timer  </span><br></pre></td></tr></table></figure>

<h2 id="docker安装"><a href="#docker安装" class="headerlink" title="docker安装"></a>docker安装</h2><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><p>centos8安装docker,需要先升级一下containerd.io软件包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">升级</span></span><br><span class="line">yum -y install containerd.io-1.2.6-3.3.el7.x86_64.rpm</span><br><span class="line"><span class="meta">#</span><span class="bash">安装</span></span><br><span class="line">wget https://download.docker.com/linux/centos/7/x86_64/edge/Packages/containerd.io-1.2.6-3.3.el7.x86_64.rpm</span><br></pre></td></tr></table></figure>

<h3 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install docker-ce docker-ce-cli</span><br></pre></td></tr></table></figure>

<h3 id="查看安装是否成功"><a href="#查看安装是否成功" class="headerlink" title="查看安装是否成功"></a>查看安装是否成功</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看详细信息</span></span><br><span class="line">docker version</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 只显示版本信息</span></span><br><span class="line">docker -v</span><br></pre></td></tr></table></figure>

<h3 id="启动"><a href="#启动" class="headerlink" title="启动"></a>启动</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl start docker</span><br></pre></td></tr></table></figure>

<h3 id="开机自启动"><a href="#开机自启动" class="headerlink" title="开机自启动"></a>开机自启动</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl enable docker</span><br></pre></td></tr></table></figure>

<h3 id="停止"><a href="#停止" class="headerlink" title="停止"></a>停止</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">systemctl stop docker</span><br></pre></td></tr></table></figure>

<h3 id="重启"><a href="#重启" class="headerlink" title="重启"></a>重启</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">service docker restart</span><br></pre></td></tr></table></figure>

<h3 id="卸载"><a href="#卸载" class="headerlink" title="卸载"></a>卸载</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 卸载依赖</span></span><br><span class="line">yum remove install docker-ce docker-ce-cli containerd.io</span><br><span class="line"><span class="meta">#</span><span class="bash"> 删除目录</span></span><br><span class="line">rm -rf /var/lib/docker</span><br></pre></td></tr></table></figure>

<h1 id="阿里云镜像加速器"><a href="#阿里云镜像加速器" class="headerlink" title="阿里云镜像加速器"></a>阿里云镜像加速器</h1><p>阿里云镜像地址:<a href="https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors">https://cr.console.aliyun.com/cn-hangzhou/instances/mirrors</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">sudo mkdir -p /etc/docker</span><br><span class="line"></span><br><span class="line">sudo tee /etc/docker/daemon.json &lt;&lt;-&#x27;EOF&#x27;</span><br><span class="line">&#123;</span><br><span class="line">  &quot;registry-mirrors&quot;: [&quot;https://7ehfv5c5.mirror.aliyuncs.com&quot;]</span><br><span class="line">&#125;</span><br><span class="line">EOF</span><br><span class="line"></span><br><span class="line">sudo systemctl daemon-reload</span><br><span class="line"></span><br><span class="line">sudo systemctl restart docker</span><br><span class="line"></span><br><span class="line">重启docker服务</span><br><span class="line">service docker restart</span><br></pre></td></tr></table></figure>

<h1 id="防火墙"><a href="#防火墙" class="headerlink" title="防火墙"></a>防火墙</h1><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1:查看防火状态</span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line">2:暂时关闭防火墙</span><br><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line">3.开启防火墙</span><br><span class="line">systemctl start firewalld</span><br><span class="line"></span><br><span class="line">4:开机不启动</span><br><span class="line">systemctl disable firewalld</span><br><span class="line"></span><br><span class="line">5:开机启动</span><br><span class="line">systemctl enable firewalld</span><br><span class="line"></span><br><span class="line">重启linux</span><br><span class="line">shutdown -r now</span><br></pre></td></tr></table></figure>

<h1 id="镜像命令"><a href="#镜像命令" class="headerlink" title="镜像命令"></a>镜像命令</h1><h2 id="查看-docker-images"><a href="#查看-docker-images" class="headerlink" title="查看 docker images"></a>查看 docker images</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看本机存在了多少镜像</span></span><br><span class="line">docker images  参数</span><br><span class="line">参数</span><br><span class="line">-a  # 查看镜像信息</span><br><span class="line">-q  # 只查看镜像ID</span><br></pre></td></tr></table></figure>

<h2 id="搜索-docker-search"><a href="#搜索-docker-search" class="headerlink" title="搜索 docker search"></a>搜索 docker search</h2><p>搜索时以官网为准<a href="https://hub.docker.com/">docker hub</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">搜索mysql,过滤出STARS大于3000的</span></span><br><span class="line">docker search mysql --filter=STARS=3000  </span><br></pre></td></tr></table></figure>

<h2 id="下载-docker-pull"><a href="#下载-docker-pull" class="headerlink" title="下载  docker pull"></a>下载  docker pull</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 下载指定版本的mysql</span></span><br><span class="line">docker pull mysql:版本号  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认下载最新版</span></span><br><span class="line">docker pull mysql   </span><br></pre></td></tr></table></figure>

<h2 id="删除-docker-rmi"><a href="#删除-docker-rmi" class="headerlink" title="删除  docker rmi"></a>删除  docker rmi</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker rmi -f ID   #单一删除</span><br><span class="line">docker rmi -f ID1 ID2 ID3 #批量删除,以空格作为界限</span><br><span class="line">docker rmi -f $(docker images -aq)   # 通过docker images -aq查出所有id,然后全部删除</span><br></pre></td></tr></table></figure>

<h1 id="容器命令"><a href="#容器命令" class="headerlink" title="容器命令"></a>容器命令</h1><h2 id="停止-1"><a href="#停止-1" class="headerlink" title="停止"></a>停止</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker restart 容器id</span><br><span class="line">docker stop 容器id   </span><br><span class="line">docker kill 容器id   #强制停止</span><br></pre></td></tr></table></figure>

<h2 id="启动-1"><a href="#启动-1" class="headerlink" title="启动"></a>启动</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">进入容器</span></span><br><span class="line">docker run -it 启动的容器的id /bin/bash   </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> --name后面跟自定义名称,-d表示后台运行,版本号必须要写,-p端口映射</span></span><br><span class="line">docker run --name myTomcat -d -p 主机端口:镜像端口 镜像名字:版本号</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查询端口号</span></span><br><span class="line">netstat -ntpl |grep 6379</span><br></pre></td></tr></table></figure>

<h2 id="列出所有运行的容器"><a href="#列出所有运行的容器" class="headerlink" title="列出所有运行的容器"></a>列出所有运行的容器</h2><blockquote>
<p>docker  ps  [参数] 查看运行的容器</p>
<p>参数</p>
<p>-a   正在运行的容器 + 历史运行过的容器</p>
<p>-n=?    显示最近创建的容器,<code>?</code>是一个数字</p>
<p>-q    只显示容器的ID</p>
</blockquote>
<h2 id="退出容器"><a href="#退出容器" class="headerlink" title="退出容器"></a>退出容器</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 容器停止且退出</span><br><span class="line">exit  </span><br><span class="line"></span><br><span class="line">#容器不停止退出,可以使用docker ps查看是否在运行</span><br><span class="line">Ctrl + P + Q </span><br></pre></td></tr></table></figure>

<h2 id="删除容器"><a href="#删除容器" class="headerlink" title="删除容器"></a>删除容器</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">删除一个容器,不能删除正在运行的容器,需要加 -f参数</span></span><br><span class="line">docker rm id     </span><br><span class="line"><span class="meta">#</span><span class="bash">删除所有容器</span></span><br><span class="line">docker rm -f $(docker ps -aq)    </span><br><span class="line"><span class="meta">#</span><span class="bash">删除所有容器</span></span><br><span class="line">docker ps -a -q|xargs docker rm  </span><br></pre></td></tr></table></figure>

<h1 id="常用其他命令"><a href="#常用其他命令" class="headerlink" title="常用其他命令"></a>常用其他命令</h1><ol>
<li>后台启动  <code>docker run -d 镜像名字</code></li>
<li>查看日志  <code>docker logs 参数</code></li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">查看指定id容器的日志,显示10条</span></span><br><span class="line">docker logs -tf --tail 数字  id    </span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">Options:</span><br><span class="line">      --details        Show extra details provided to logs</span><br><span class="line">  -f, --follow         Follow log output</span><br><span class="line">      --since string   Show logs since timestamp (e.g. 2013-01-02T13:23:37) or relative (e.g. 42m for 42 minutes)</span><br><span class="line">      --tail string    Number of lines to show from the end of the logs (default &quot;all&quot;)</span><br><span class="line">  -t, --timestamps     Show timestamps</span><br><span class="line">      --until string   Show logs before a timestamp (e.g. 2013-01-02T13:23:37) or relative (e.g. 42m for 42 minutes)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>查看docker内部容器的进程 <code>docker top ID</code></p>
</li>
<li><p>查看镜像的元数据 <code>docker inspect 镜像ID</code></p>
</li>
<li><p>进入正在运行中的容器</p>
<ul>
<li><p>exec   (常用)    <code>docker exec -it ID /bin/bash</code>  </p>
</li>
<li><p>attach    <code>docker attach  ID</code></p>
</li>
</ul>
</li>
</ol>
<h1 id="基本流程"><a href="#基本流程" class="headerlink" title="基本流程"></a>基本流程</h1><p>下载镜像–&gt; 启动镜像–&gt;获得容器—&gt;启动容器</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">docker pull 镜像名字  #下载镜像</span><br><span class="line">docker images #查看所有镜像</span><br><span class="line">docker run --name 别名 -d 镜像名字:版本号 #根据镜像,在后台启动一个容器</span><br><span class="line">docker ps # 查看运行中的容器</span><br><span class="line">docker stop 容器ID  # 停止容器</span><br><span class="line">docker rm -f 容器ID  # 删除容器</span><br><span class="line">docker logs 容器ID  #查看容器的日志</span><br></pre></td></tr></table></figure>

<h1 id="端口映射错误解决"><a href="#端口映射错误解决" class="headerlink" title="端口映射错误解决"></a>端口映射错误解决</h1><p>端口映射出现问题,报错:<code>No chain/target/match by that name</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">pkill docker</span><br><span class="line"></span><br><span class="line">iptables -t nat -F</span><br><span class="line"></span><br><span class="line">ifconfig docker0 down</span><br><span class="line"></span><br><span class="line">brctl delbr docker0</span><br><span class="line"></span><br><span class="line">service docker restart</span><br></pre></td></tr></table></figure>

<h1 id="安装tomcat"><a href="#安装tomcat" class="headerlink" title="安装tomcat"></a>安装tomcat</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看防火墙是否开启</span></span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭防火墙</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载tomcat</span></span><br><span class="line">docker pull tomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动tomcat</span></span><br><span class="line">docker run -d -p 8080:8080 --restart=always --name mytomcat tomcat</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> tomcat访问404决解思路: 因为webapps目录为空,只需要把webapps删除,把webapps.dist改名为webapps即可</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看正在运行的tomcat的ID号</span></span><br><span class="line">docker ps -a</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入到已经启动的tomcat内部</span></span><br><span class="line">docker exec -it 2d1a91228304 /bin/bash</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">删除webapps文件夹</span></span><br><span class="line">rm -rf webapps</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 更改webapps.dist名字</span></span><br><span class="line">mv webapps.dist webapps</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出tomcat文件</span></span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<h1 id="安装mysql"><a href="#安装mysql" class="headerlink" title="安装mysql"></a>安装mysql</h1><h2 id="设置挂载"><a href="#设置挂载" class="headerlink" title="设置挂载"></a>设置挂载</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 老贺给的参考  配置文件启动mysql</span></span><br><span class="line">docker run -p 3308:3306 --name mysql \</span><br><span class="line">-v /mydata/mysql/log:/var/log/mysql \</span><br><span class="line">-v /mydata/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /mydata/mysql/conf:/etc/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">-d mysql</span><br></pre></td></tr></table></figure>
<p>参考<a href="http://blog.haoservice.cn/archives/1528">码农code的博客</a></p>
<p>参考<a href="https://blog.csdn.net/heanfeiliu/article/details/107929562">河岸飞流的博客</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 参数说明：</span></span><br><span class="line">-e MYSQL_USER=”woniu”  ：添加woniu用户</span><br><span class="line">-e MYSQL_PASSWORD=”123456″：设置添加的用户密码</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=”123456″：设置root用户密码</span><br><span class="line">–character-set-server=utf8：设置字符集为utf8</span><br><span class="line">–collation-server=utf8_general_cli：设置字符比较规则为utf8_general_cli</span><br><span class="line">--privileged=true：容器内的root拥有真正root权限，否则容器内root只是外部普通用户权限</span><br><span class="line">-v /docker/mysql/conf/my.cnf:/etc/my.cnf：映射配置文件</span><br><span class="line">-v /docker/mysql/data:/var/lib/mysql：映射数据目录</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> my.cnf添加如下内容：</span></span><br><span class="line">[mysqld]</span><br><span class="line">user=mysql</span><br><span class="line">character-set-server=utf8</span><br><span class="line">default_authentication_plugin=mysql_native_password</span><br><span class="line">[client]</span><br><span class="line">default-character-set=utf8</span><br><span class="line">[mysql]</span><br><span class="line">default-character-set=utf8</span><br></pre></td></tr></table></figure>

<h2 id="基本设置"><a href="#基本设置" class="headerlink" title="基本设置"></a>基本设置</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看防火墙是否开启</span></span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭防火墙</span></span><br><span class="line">systemctl stop firewalld</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 下载mysql</span></span><br><span class="line">docker pull mysql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">常规启动mysql,发现报错 `You need to specify one of MYSQL_ROOT_PASSWORD, MYSQL_ALLOW_EMPTY_PASSWORD and MYSQL_RANDOM_ROOT_PASSWORD`,这是因为没有在启动的时候,没有创建一个管理员的账号密码</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">官网给出的正确启动方式是</span></span><br><span class="line">docker run --name some-mysql -e MYSQL_ROOT_PASSWORD=my-secret-pw -d mysql:tag</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 进入到已经启动的mysql内部 </span></span><br><span class="line">docker exec -it 674cdb5df0ce /bin/bash</span><br></pre></td></tr></table></figure>

<p>最终启动方式举例</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">docker run --restart=always \</span><br><span class="line">--privileged=true \</span><br><span class="line">-it \</span><br><span class="line">-d \</span><br><span class="line">-p 3306:3306 \</span><br><span class="line">-v /mdata/docker/mysql/conf:/etc/mysql/conf.d \</span><br><span class="line">-v /mdata/docker/mysql/data:/var/lib/mysql \</span><br><span class="line">-v /mdata/docker/mysql/log:/var/log/mysql \</span><br><span class="line">-e MYSQL_ROOT_PASSWORD=root \</span><br><span class="line">--name mysql01 \</span><br><span class="line">mysql</span><br></pre></td></tr></table></figure>

<h2 id="后续操作"><a href="#后续操作" class="headerlink" title="后续操作"></a>后续操作</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看端口占用</span></span><br><span class="line">netstat -tunlp | grep 3306</span><br><span class="line">tcp6       0      0 :::3306                 :::*                    LISTEN      6891/mysqld</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭端口</span></span><br><span class="line">kill -9  6891</span><br></pre></td></tr></table></figure>

<p><a href="https://www.cnblogs.com/cgl-dong/p/14041833.html">好像是一个小姐姐的博客</a></p>
<p>启动后</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>jdk安装</title>
    <url>/2021/02/10/linux/jdk%E5%AE%89%E8%A3%85/</url>
    <content><![CDATA[<h1 id="jdk安装"><a href="#jdk安装" class="headerlink" title="jdk安装"></a>jdk安装</h1><p>yum安装jdk,<a href="https://blog.csdn.net/github_38336924/article/details/82221258">参考博客</a></p>
<p><a href="https://mirrors.huaweicloud.com/java/jdk/">华为云jdk镜像</a></p>
<p>卸载java环境</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum -y remove java-1.6.0-openjdk*  //表示卸载所有openjdk相关文件输入</span><br><span class="line">yum -y remove tzdata-java.noarch   //卸载tzdata-java</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>安装jdk1.8.0的所有文件</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">yum install -y java-1.8.0-openjdk*</span><br></pre></td></tr></table></figure>

<p>查看安装是否成功</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>

<p>配置环境变量</p>
<p>JDK默认安装路径<code>/usr/lib/jvm</code></p>
<p>在<code>/etc</code>下的<code>profile</code>中配置环境变量</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> <span class="built_in">set</span> java environment  </span></span><br><span class="line">JAVA_HOME=/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.181-3.b13.el7_5.x86_64</span><br><span class="line">PATH=$PATH:$JAVA_HOME/bin  </span><br><span class="line">CLASSPATH=.:$JAVA_HOME/lib/dt.jar:$JAVA_HOME/lib/tools.jar  </span><br><span class="line">export JAVA_HOME  CLASSPATH  PATH </span><br></pre></td></tr></table></figure>

<p>保存关闭<code>profile</code>文件，执行如下命令生效</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">source  /etc/profile</span><br></pre></td></tr></table></figure>

<p>使用如下命令，查看<code>JDK</code>变量</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">echo $JAVA_HOME</span><br><span class="line">echo $PATH</span><br><span class="line">echo $CLASSPATH</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>兄弟连linux基础</title>
    <url>/2020/09/30/linux/%E5%85%84%E5%BC%9F%E8%BF%9Elinux%E5%9F%BA%E7%A1%80/</url>
    <content><![CDATA[<h1 id="Linux常用命令"><a href="#Linux常用命令" class="headerlink" title="Linux常用命令"></a>Linux常用命令</h1><p>笔记摘录自微信读书兄弟连的课程《<a href="https://weread.qq.com/web/reader/f51321b0716ce822f5111a6ka87322c014a87ff679a21ea">细说Linux基础</a>》</p>
<p><a href="https://www.bilibili.com/video/BV1mW411i7Qf">兄弟连Linux视频</a></p>
<h2 id="命令的基本格式"><a href="#命令的基本格式" class="headerlink" title="命令的基本格式"></a>命令的基本格式</h2><p>登录系统后，第一眼看到的内容是：</p>
<blockquote>
<p>[root@localhost ~]#</p>
</blockquote>
<p>●[]：这是提示符的分隔符号，没有特殊含义。</p>
<a id="more"></a>

<p>●root：显示的是当前的登录用户</p>
<p>●@：分隔符号，没有特殊含义。</p>
<p>●localhost：当前系统的简写主机名（完整主机名是localhost.localdomain）。</p>
<p>●~：代表用户当前所在的目录，此例中用户当前所在的目录是家home目录。</p>
<p>●#：命令提示符，Linux用这个符号标识登录的用户权限等级。如果是超级用户，提示符就是#；如果是普通用户，提示符就是$。</p>
<blockquote>
<p>[root@localhost ~]#  命令 [选项] [参数]</p>
</blockquote>
<p>命令格式中的[]代表可选项，也就是有些命令可以不写选项或参数，也能执行</p>
<p>命令的选项用于调整命令功能，而命令的参数是这个命令的操作对象。</p>
<h2 id="目录操作"><a href="#目录操作" class="headerlink" title="目录操作"></a>目录操作</h2><h3 id="ls-显示目录下的内容"><a href="#ls-显示目录下的内容" class="headerlink" title="ls  显示目录下的内容"></a>ls  显示目录下的内容</h3><blockquote>
<p>[rootelocalhost]#ls  [选项]  [文件名或目录名]<br>选项：<br>-a：显示所有文件<br>–color=when：支持颜色输出，when的值默认是a1ways（总显示颜色），也可以是never（从不显示颜色）和auto（自动）<br>-d：显示目录信息，而不是目录下的文件<br>-h：人性化显示，按照我们习惯的单位显示文件大小<br>-i：显示文件的i节点号<br>-1：长格式显示</p>
</blockquote>
<h4 id="a"><a href="#a" class="headerlink" title="-a"></a>-a</h4><p>显示隐藏文件,隐藏文件以”.”开头,隐藏文件不是为了把文件藏起来不让其他用户找到，而是为了告诉用户这些文件都是重要的系统文件，如非必要，不要乱动！</p>
<h4 id="l"><a href="#l" class="headerlink" title="-l"></a>-l</h4><p>显示详细信息</p>
<p>●第一列：权限。具体权限的含义将在4.5节中讲解。</p>
<p>●第二列：引用计数。文件的引用计数代表该文件的硬链接个数，而目录的引用计数代表该目录有多少个一级子目录。</p>
<p>●第三列：所有者，也就是这个文件属于哪个用户。默认所有者是文件的建立用户</p>
<p>●第四列：所属组。默认所属组是文件建立用户的有效组，一般情况下就是建立用户的所在组。</p>
<p>●第五列：大小。默认单位是字节。</p>
<p>●第六列：文件修改时间。文件状态修改时间或文件数据修改时间都会更改这个时间，注意这个时间不是文件的创建时间。</p>
<p>●第七列：文件名。</p>
<h4 id="d"><a href="#d" class="headerlink" title="-d"></a>-d</h4><p>显示目录本身的详细信息</p>
<h4 id="h"><a href="#h" class="headerlink" title="-h"></a>-h</h4><p>显示详细信息的时候,以常见的KB方式显示文件大小</p>
<h4 id="i"><a href="#i" class="headerlink" title="-i"></a>-i</h4><p>每个文件都有一个被称作inode（i节点）的隐藏属性，可以看成系统搜索这个文件的ID，而“-i”选项就是用来查看文件的inode号的,从理论上来说，每个文件的inode号都是不一样的，当然也有例外（如硬链接），</p>
<h3 id="cd-切换目录"><a href="#cd-切换目录" class="headerlink" title="cd 切换目录"></a>cd 切换目录</h3><h4 id="P-（大写）"><a href="#P-（大写）" class="headerlink" title="-P （大写）"></a>-P （大写）</h4><p>是指如果切换的目录是软链接目录，则进入其原始的物理目录，而不是进入软链接目录</p>
<h4 id="L（大写）"><a href="#L（大写）" class="headerlink" title="-L（大写）"></a>-L（大写）</h4><p>是指如果切换的目录是软链接目录，则直接进入软链接目录。</p>
<h4 id="快捷符号"><a href="#快捷符号" class="headerlink" title="快捷符号"></a>快捷符号</h4><table>
<thead>
<tr>
<th align="center">符号</th>
<th align="center">解释</th>
</tr>
</thead>
<tbody><tr>
<td align="center">~</td>
<td align="center">home目录</td>
</tr>
<tr>
<td align="center">-</td>
<td align="center">上次所在目录</td>
</tr>
<tr>
<td align="center">.</td>
<td align="center">当前目录</td>
</tr>
<tr>
<td align="center">..</td>
<td align="center">上级目录</td>
</tr>
</tbody></table>
<h3 id="mkdir-创建空目录"><a href="#mkdir-创建空目录" class="headerlink" title="mkdir  创建空目录"></a>mkdir  创建空目录</h3><p>主要作用就是新建一个空目录。</p>
<h4 id="p"><a href="#p" class="headerlink" title="-p"></a>-p</h4><p>递归创建所有目录</p>
<h3 id="rmdir-删除目录"><a href="#rmdir-删除目录" class="headerlink" title="rmdir 删除目录"></a>rmdir 删除目录</h3><p>删除一个空目录</p>
<h4 id="p-1"><a href="#p-1" class="headerlink" title="-p"></a>-p</h4><p>递归删除目录</p>
<h3 id="tree-树形显示文件"><a href="#tree-树形显示文件" class="headerlink" title="tree  树形显示文件"></a>tree  树形显示文件</h3><p>tree命令以树形结构显示目录下的文件</p>
<h2 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h2><p><a href="https://weread.qq.com/web/reader/f51321b0716ce822f5111a6k02e32f0021b02e74f10ece8">书籍地址</a></p>
<h3 id="touch-创建空文件"><a href="#touch-创建空文件" class="headerlink" title="touch 创建空文件"></a>touch 创建空文件</h3><p>touch的意思是触摸，如果文件不存在，则会建立空文件；如果文件已经存在，则会修改文件的时间戳（访问时间、数据修改时间、状态修改时间都会改变）</p>
<h4 id="命令格式"><a href="#命令格式" class="headerlink" title="命令格式"></a>命令格式</h4><blockquote>
<p>touch [选项] 文件名字或目录名</p>
</blockquote>
<h4 id="文件的时间"><a href="#文件的时间" class="headerlink" title="文件的时间"></a>文件的时间</h4><blockquote>
<p>Linux中的每个文件都有三个时间，分别是访问时间（Access Time）、数据修改时间（ModifyTime）和状态修改时间（Change Time),。</p>
<p>这三个时间可以通过stat命令来进行查看。不过touch命令只能手工指定是只修改访问时间，还是只修改数据修改时间，而不能指定只修改状态修改时间。</p>
<p>因为不论是修改访问时间，还是修改文件的数据时间，对文件来讲，状态都会发生改变，所以状态修改时间会随之改变。</p>
</blockquote>
<blockquote>
<p>注意：在Linux中，文件没有创建时间。</p>
</blockquote>
<h4 id="常见用法"><a href="#常见用法" class="headerlink" title="常见用法"></a>常见用法</h4><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">touch blos</span><br><span class="line"># 建立一个blos文件,如果不存在,创建文件,如果存在,不会报错,只会修改文件的访问时间</span><br></pre></td></tr></table></figure>

<h3 id="stat-查看文件信息"><a href="#stat-查看文件信息" class="headerlink" title="stat 查看文件信息"></a>stat 查看文件信息</h3><p>stat可以查看文件的访问时间,数据修改时间,状态修改时间</p>
<h3 id="cat-查看文件内容"><a href="#cat-查看文件内容" class="headerlink" title="cat  查看文件内容"></a>cat  查看文件内容</h3><p>这个命令是concatenate（连接、连续）的简写</p>
<h4 id="选项"><a href="#选项" class="headerlink" title="选项"></a>选项</h4><blockquote>
<p>-A：相当于-vET选项的整合，用于列出所有隐藏符号<br>-E：列出每行结尾的回车符$<br>-n：显示行号<br>-T：把Tab键用I显示出来<br>-v：列出特殊字符</p>
</blockquote>
<h3 id="more-分屏显示"><a href="#more-分屏显示" class="headerlink" title="more  分屏显示"></a>more  分屏显示</h3><p>●空格键：向下翻页。</p>
<p>●b：向上翻页。</p>
<p>●回车键：向下滚动一行。</p>
<p>●/字符串：搜索指定的字符串。</p>
<p>●q：退出。</p>
<h3 id="less-分行显示"><a href="#less-分行显示" class="headerlink" title="less  分行显示"></a>less  分行显示</h3><p>less命令可以使用上、下箭头，用于分行查看文件内容。</p>
<h3 id="head-显示文件开头"><a href="#head-显示文件开头" class="headerlink" title="head 显示文件开头"></a>head 显示文件开头</h3><p>-n 行数：从文件头开始，显示指定行数<br>-v：显示文件名</p>
<h3 id="tail-显示文件结尾"><a href="#tail-显示文件结尾" class="headerlink" title="tail 显示文件结尾"></a>tail 显示文件结尾</h3><p>-n行数：从文件结尾开始，显示指定行数<br>-f：监听文件的新增内容</p>
<p> -f参数使用时,可以另开一个终端</p>
<h3 id="ln-在文件之间建立链接"><a href="#ln-在文件之间建立链接" class="headerlink" title="ln 在文件之间建立链接"></a>ln 在文件之间建立链接</h3><h4 id="选项-1"><a href="#选项-1" class="headerlink" title="选项"></a>选项</h4><p>-s 创建软链接, 没有-s选项,创建硬链接</p>
<p>-f 强制 ,如果目标文件已经存在，则删除目标文件后再建立链接文件</p>
<h4 id="软链接和硬链接的区别"><a href="#软链接和硬链接的区别" class="headerlink" title="软链接和硬链接的区别"></a>软链接和硬链接的区别</h4><p><strong>硬链接的特点如下：</strong></p>
<p>●不论是修改源文件（test文件），还是修改硬链接文件（test-hard文件），另一个文件中的数据都会发生改变。</p>
<p>●不论是删除源文件，还是删除硬链接文件，只要还有一个文件存在，这个文件（inode号是262147的文件）都可以被访问。</p>
<p>●硬链接不会建立新的inode信息，也不会更改inode的总数。</p>
<p>●硬链接不能跨文件系统（分区）建立，因为在不同的文件系统中，inode号是重新计算的。</p>
<p>●硬链接不能链接目录，因为如果给目录建立硬链接，那么不仅目录本身需要重新建立，目录下所有的子文件，包括子目录中的所有子文件都需要建立硬链接，这对当前的Linux来讲过于复杂。</p>
<p><strong>软链接</strong></p>
<p>软链接文件的源文件必须写成绝对路径，而不能写成相对路径（硬链接没有这样的要求）；否则软链接文件会报错。</p>
<p>软链接的标志非常明显，首先，权限位中“l”表示这是一个软链接文件；</p>
<p>其次，在文件的后面通过“-&gt;”显示出源文件的完整名字。</p>
<p>所以软链接比硬链接的标志要明显得多，而且软链接也不像硬链接的限制那样多，比如软链接可以链接目录，也可以跨分区来建立软链接</p>
<h2 id="目录和文件都能操作的命令"><a href="#目录和文件都能操作的命令" class="headerlink" title="目录和文件都能操作的命令"></a>目录和文件都能操作的命令</h2><h2 id="权限管理"><a href="#权限管理" class="headerlink" title="权限管理"></a>权限管理</h2><h2 id="帮助命令"><a href="#帮助命令" class="headerlink" title="帮助命令"></a>帮助命令</h2><h2 id="搜索命令"><a href="#搜索命令" class="headerlink" title="搜索命令"></a>搜索命令</h2><h2 id="压缩和解压缩"><a href="#压缩和解压缩" class="headerlink" title="压缩和解压缩"></a>压缩和解压缩</h2><h2 id="关机和重启"><a href="#关机和重启" class="headerlink" title="关机和重启"></a>关机和重启</h2><h2 id="网络命令"><a href="#网络命令" class="headerlink" title="网络命令"></a>网络命令</h2>]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>idea快捷键</title>
    <url>/2020/05/29/tools/idea/</url>
    <content><![CDATA[<h1 id="常规操作"><a href="#常规操作" class="headerlink" title="常规操作"></a>常规操作</h1><p>ctrl+alt+T                    快速生成if/ if else /try catch</p>
<p>ctrl+alt+Insert                快速创建文件    </p>
<p>F5                        快速复制当前文件到本目录下</p>
<p>F6                           快速移动当前文件到另一个目录</p>
<p>ctrl+shift+V                idea自带粘贴板</p>
<p>ctrl+shift+B                从接口到实现类</p>
<p><strong><a id="more"></a></strong></p>
<h1 id="搜索"><a href="#搜索" class="headerlink" title="搜索"></a><strong>搜索</strong></h1><p>ctrl+shift+alt+n              寻找函数</p>
<p>ctrl+N                         寻找类</p>
<p>edit-find                      可以搜索文件</p>
<h1 id="列操作"><a href="#列操作" class="headerlink" title="列操作"></a><strong>列操作</strong></h1><p>ctrl+shift+U                   大小写</p>
<p>ctrl+&gt;                      选中一个完整的单词</p>
<p>ctrl+shift+alt+J              选中一行代码 其他行也进行此操作</p>
<p>alt+J                       选中相同的单词</p>
<p>alt+鼠标左键                竖选操作</p>
<h1 id="Postfix"><a href="#Postfix" class="headerlink" title="Postfix"></a><strong>Postfix</strong></h1><p>100.fori                    for循环</p>
<p>b.if                                            if (b) { }</p>
<p>foo().lambda                     () -&gt; foo()</p>
<p>o.nn                        if (o != null){ }</p>
<p>o.null                     if (o == null){ }</p>
<p>o.synchronized                synchronized (o) {  }</p>
<p>arg.field                    适用于class类属性</p>
<h1 id="抽取变量"><a href="#抽取变量" class="headerlink" title="抽取变量"></a><strong>抽取变量</strong></h1><p>ctrl+alt+V                   快速new 对象 / 抽取变量</p>
<p>ctrl+alt+C                    抽取静态常量</p>
<p>ctrl+alt+F                    抽取成员变量</p>
<p>ctrl+alt+M                  抽取代码成为新的方法</p>
<h1 id="查看源码"><a href="#查看源码" class="headerlink" title="查看源码"></a><strong>查看源码</strong></h1><p>ctrl+F12                    查看当前类的属性,变量,方法</p>
<p>alt+7                          查看类方法</p>
<p>ctrl+alt+shift+U                查看类大纲</p>
<p>ctrl+alt+H                    查看类依赖和方法依赖</p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>nginx</title>
    <url>/2021/02/08/linux/nginx/</url>
    <content><![CDATA[<h1 id="Nginx简介"><a href="#Nginx简介" class="headerlink" title="Nginx简介"></a>Nginx简介</h1><p>Nginx 是高性能的 HTTP 和反向代理的服务器，处理高并发能力是十分强大的，能经受高负载的考验,有报告表明能支持高达 50,000 个并发连接数</p>
<blockquote>
<p>正向代理</p>
<p>​    需要在客户端配置代理服务器进行指定网站访问</p>
<p>反向代理</p>
<p>​    暴露的是代理服务器地址，隐藏了真实服务器 IP 地址</p>
<p>负载均衡</p>
<p>​    增加服务器的数量，然后将请求分发到各个服务器上，将原先请求集中到单个服务器上的情况改为将请求分发到多个服务器上，将负载分发到不同的服务器，也就是我们所说的负载均衡</p>
</blockquote>
<a id="more"></a>

<h1 id="Linux安装"><a href="#Linux安装" class="headerlink" title="Linux安装"></a>Linux安装</h1><p><a href="http://nginx.org/en/download.html">nginx安装网址</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">下载完成nginx-1.18.0.tar.gz以后上传到linux的/opt下面</span></span><br><span class="line"><span class="meta">#</span><span class="bash">解压  tar -zxvf nginx-1.18.0.tar.gz</span></span><br><span class="line"><span class="meta">#</span><span class="bash">进入目录  <span class="built_in">cd</span> nginx-1.18.0/</span></span><br><span class="line"><span class="meta">#</span><span class="bash">安装 </span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 安装环境 yum -y install pcre-devel openssl openssl-devel</span></span><br><span class="line"><span class="meta">	#</span><span class="bash"> 运行自动配置 ./configure</span></span><br><span class="line">	make &amp;&amp; make install</span><br><span class="line"><span class="meta">#</span><span class="bash">查看nginx安装路径  whereis nginx	</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 默认安装在了 /usr/<span class="built_in">local</span>/nginx</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动nginx  </span></span><br><span class="line">       cd sbin  </span><br><span class="line">       ./nginx</span><br><span class="line"><span class="meta">#</span><span class="bash">默认端口是80 可以在/usr/<span class="built_in">local</span>/nginx/conf/nginx.conf 中看到</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动后访问linux的服务器地址 看到Welcome to nginx!就成功了				</span></span><br></pre></td></tr></table></figure>

<h1 id="常用命令"><a href="#常用命令" class="headerlink" title="常用命令"></a>常用命令</h1><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/nginx/sbin</span><br><span class="line"><span class="meta">#</span><span class="bash">查看nginx版本 ./nginx -v</span></span><br><span class="line"><span class="meta">#</span><span class="bash">启动 ./nginx   </span></span><br><span class="line"><span class="meta">#</span><span class="bash">停止 ./nginx -s stop</span></span><br><span class="line"><span class="meta">#</span><span class="bash">安全退出 ./nginx -s quit</span></span><br><span class="line"><span class="meta">#</span><span class="bash">查看nginx进程 ps -ef|grep nginx</span></span><br><span class="line"><span class="meta">#</span><span class="bash">重新加载配置文件 ./nginx -s reload</span></span><br></pre></td></tr></table></figure>

<h1 id="配置简介"><a href="#配置简介" class="headerlink" title="配置简介"></a>配置简介</h1><p>nginx的配置在<code>/usr/local/nginx/conf/nginx.conf</code>中</p>
<p>nginx的配置分为三部分:全局、events 、http</p>
<h2 id="全局配置"><a href="#全局配置" class="headerlink" title="全局配置"></a><strong>全局配置</strong></h2><blockquote>
<p>从配置文件开始到 events 块之间的内容，主要会设置一些影响 nginx 服务器整体运行的配置指令，主要包括配<br>置运行 Nginx 服务器的用户（组）、允许生成的 worker process 数，进程 PID 存放路径、日志存放路径和类型以<br>及配置文件的引入等</p>
<p>例如:worker_processes  1;    worker_processes 值越大，可以支持的并发处理量也越多</p>
</blockquote>
<h2 id="events块"><a href="#events块" class="headerlink" title="events块"></a><strong>events块</strong></h2><blockquote>
<p>events 块涉及的指令主要影响 Nginx 服务器与用户的网络连接，常用的设置包括是否开启对多 work process下的网络连接进行序列化，是否允许同时接收多个网络连接，选取哪种事件驱动模型来处理连接请求，每个 wordprocess 可以同时支持的最大连接数等。</p>
<p>这部分的配置对 Nginx 的性能影响较大，在实际中应该灵活配置。</p>
<p>例如: worker_connections  1024;</p>
</blockquote>
<h2 id="http块"><a href="#http块" class="headerlink" title="http块"></a><strong>http块</strong></h2><blockquote>
<p>这算是 Nginx 服务器配置中最频繁的部分，代理、缓存和日志定义等绝大多数功能和第三方模块的配置都在这里。<br>需要注意的是：http 块也可以包括 http 全局块、server 块。</p>
</blockquote>
<h3 id="http-全局块"><a href="#http-全局块" class="headerlink" title="http 全局块"></a>http 全局块</h3><blockquote>
<p>http 全局块配置的指令包括文件引入、MIME-TYPE 定义、日志自定义、连接超时时间、单链接请求数上限等。</p>
</blockquote>
<h3 id="server块"><a href="#server块" class="headerlink" title="server块"></a>server块</h3><blockquote>
<p>这块和虚拟主机有密切关系，虚拟主机从用户角度看，和一台独立的硬件主机是完全一样的，该技术的产生是为了节省互联网服务器硬件成本。<br>每个 http 块可以包括多个 server 块，而每个 server 块就相当于一个虚拟主机。<br>而每个 server 块也分为全局 server 块，以及可以同时包含多个 locaton 块。</p>
</blockquote>
<h4 id="全局-server块"><a href="#全局-server块" class="headerlink" title="全局 server块"></a>全局 server块</h4><blockquote>
<p>最常见的配置是本虚拟机主机的监听配置和本虚拟主机的名称或 IP 配置。</p>
</blockquote>
<h4 id="location块"><a href="#location块" class="headerlink" title="location块"></a>location块</h4><blockquote>
<p>一个 server 块可以配置多个 location 块。<br>这块的主要作用是基于 Nginx 服务器接收到的请求字符串（例如 server_name/uri-string），对虚拟主机名称（也可以是 IP 别名）之外的字符串（例如 前面的 /uri-string）进行匹配，对特定的请求进行处理。地址定向、数据缓存和应答控制等功能，还有许多第三方模块的配置也在这里进行。</p>
</blockquote>
<h1 id="反向代理"><a href="#反向代理" class="headerlink" title="反向代理"></a>反向代理</h1><h2 id="反向代理一"><a href="#反向代理一" class="headerlink" title="反向代理一"></a>反向代理一</h2><p><a href="https://www.bilibili.com/video/BV1zJ411w7SV?p=8&spm_id_from=pageDriver">尚硅谷视频</a></p>
<p>例子: 在浏览器中输入<code>www.123.com</code>后,跳转到tomcat的主页</p>
<p>实现逻辑</p>
<blockquote>
<p>浏览器展示<a href="http://www.123.com/">www.123.com</a> 点击进入后,nginx调用IP:80端口,跳转到linux内部的127.0.0.1:8080</p>
</blockquote>
<p>准备工作,在linux中解压tomcat的tar包,并在<code>bin</code>下面启动使用命令<code>./startup.sh</code>使tomcat启动</p>
<p>添加需要开放访问的端口,可以关闭防火墙,或者添加开放端口,tomcat默认是8080</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 开放端口</span></span><br><span class="line">firewall-cmd --zone=public --add-port=8080/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">重启防火墙</span></span><br><span class="line">systemctl restart firewalld</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看已经开放的端口号</span></span><br><span class="line">firewall-cmd --list-all</span><br></pre></td></tr></table></figure>

<p>在浏览器地址栏中输入<code>IP:8080</code>就可以访问到tomcat首页</p>
<p>nginx配置</p>
<p>首先需要解析网上的域名,一般是网络服务商自动解析,此次实验,本地解析即可</p>
<p>使用管理员身份运行txt文本软件,在<code>C:\Windows\System32\drivers\etc</code>的host文件中添加以下字段,IP表示虚拟机地址,网址表示需要在前端访问的域名</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line"># nginx</span><br><span class="line">192.168.31.166  www.123.com</span><br></pre></td></tr></table></figure>

<p>win10系统使用<code>ipconfig/flushdns </code>来清除本地的DNS缓存</p>
<p>在<code>/usr/local/nginx/conf</code>下的nginx.conf文件中配置反向代理</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>  <span class="number">80</span>;</span><br><span class="line">    <span class="comment"># 配置外网地址</span></span><br><span class="line">    <span class="attribute">server_name</span>  <span class="number">192.168.31.166</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> / &#123;</span><br><span class="line">        <span class="attribute">root</span>   html;</span><br><span class="line">        <span class="comment"># 添加代理 配置linux中访问的地址</span></span><br><span class="line">        <span class="attribute">proxy_pass</span> http://127.0.0.1:8080;</span><br><span class="line">        <span class="attribute">index</span>  index.html index.htm;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>在<code>/usr/local/nginx/sbin</code>中重新加载nginx的配置文件<code>./nginx -s reload</code></p>
<p>在<code>/usr/local/nginx/sbin</code>中启动nginx<code>./nginx</code></p>
<p>在浏览器中输入<code>www.123.com</code>即可访问linux服务器中的tomcat首页</p>
<h2 id="反向代理二"><a href="#反向代理二" class="headerlink" title="反向代理二"></a>反向代理二</h2><p><a href="https://www.bilibili.com/video/BV1zJ411w7SV?p=10">尚硅谷视频</a></p>
<ol>
<li>实现效果</li>
</ol>
<p>使用 nginx 反向代理，根据访问的路径跳转到不同端口的服务中,nginx监听端口为 9001 ，</p>
<p>访问 <a href="http://192.168.17.129:6001/edu/">http://192.168.17.129:6001/edu/</a> 直接跳转到 127.0.0.1:8080<br>访问 http:// 192.168.17.129:6001/vod/ 直接跳转到 127.0.0.1:8081</p>
<ol start="2">
<li>准备工作</li>
</ol>
<p>（1 ）准备两个 tomcat 服务器，一个 8080 端口，一个 8081 端口,并启动两个服务器<br>（2 ）在webapps文件夹下面创建edu或者vod文件夹,并在下面放入html文件</p>
<p>在8081的tomcat中的<code>conf/server.xml</code>中修改shutdown端口为8015,修改启动端口为8081</p>
<ol start="3">
<li>nginx配置</li>
</ol>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">server</span> &#123;</span><br><span class="line">    <span class="attribute">listen</span>       <span class="number">9001</span>;</span><br><span class="line">    <span class="attribute">server_name</span>  <span class="number">192.168.17.129</span>;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ /edu/</span> &#123;</span><br><span class="line">    	<span class="attribute">proxy_pass</span> http://127.0.0.1:8080;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="attribute">location</span> <span class="regexp">~ /vod/</span> &#123;</span><br><span class="line">    	<span class="attribute">proxy_pass</span> http://127.0.0.1:8081;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>location 指令说明</p>
<p>该指令用于匹配 URL。</p>
<p>1、= ：用于不含正则表达式的 uri 前，要求请求字符串与 uri 严格匹配，如果匹配成功，就停止继续向下搜索并立即处理该请求。<br>2、~ ：用于表示 uri 包含正则表达式，并且区分大小写。<br>3、~ * ：用于表示 uri 包含正则表达式，并且不区分大小写。<br>4、~~ ：用于不含正则表达式的 uri 前，要求 Nginx 服务器找到标识 uri 和请求字符串匹配度最高的 location 后，立即使用此 location 处理请求，而不再使用 location块中的正则 uri 和请求字符串做匹配。<br>注意：如果 uri 包含正则表达式，则必须要有 ~ 或者 ~* 标识。</p>
<ol start="4">
<li>开放对外的端口</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 开放端口</span></span><br><span class="line">firewall-cmd --zone=public --add-port=8080/tcp --permanent</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">重启防火墙</span></span><br><span class="line">systemctl restart firewalld</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看已经开放的端口号</span></span><br><span class="line">firewall-cmd --list-all</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>重启nginx</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd /usr/local/nginx/sbin</span><br><span class="line"><span class="meta">#</span><span class="bash">查看nginx版本 ./nginx -v</span></span><br><span class="line"><span class="meta">#</span><span class="bash">启动 ./nginx   </span></span><br><span class="line"><span class="meta">#</span><span class="bash">停止 ./nginx -s stop</span></span><br><span class="line"><span class="meta">#</span><span class="bash">安全退出 ./nginx -s quit</span></span><br><span class="line"><span class="meta">#</span><span class="bash">查看nginx进程 ps -ef|grep nginx</span></span><br><span class="line"><span class="meta">#</span><span class="bash">重新加载配置文件 ./nginx -s reload</span></span><br></pre></td></tr></table></figure>

<h1 id="负载均衡"><a href="#负载均衡" class="headerlink" title="负载均衡"></a>负载均衡</h1><p>1 、实现效果<br>（1 ）浏览器地址栏输入地址 <a href="http://192.168.17.129/edu/a.html">http://192.168.17.129/edu/a.html</a> 后实现负载均衡效果，url平均在 8080和 和 8081 端口中</p>
<p>2 、准备工作<br>（1 ）准备两台 tomcat 服务器，一台 8080 ，一台 8081<br>（2 ）在两台 tomcat 里面 webapps 目录中，创建名称为edu的文件夹，在 edu 文件夹中创建页面a.html ，用于测试<br>3 、在 nginx 的配置文件中进行负载均衡的配置</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="section">http</span> &#123;</span><br><span class="line">    <span class="comment">#在http模块中使用upstream关键字添加自定义名字myserver</span></span><br><span class="line">    <span class="attribute">upstream</span>  myserver&#123;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.17.129:8080</span>;</span><br><span class="line">        <span class="attribute">server</span> <span class="number">192.168.17.129:8081</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="section">server</span> &#123;</span><br><span class="line">        <span class="comment">#nginx默认监听端口8080</span></span><br><span class="line">        <span class="attribute">listen</span>  <span class="number">80</span>;</span><br><span class="line">        <span class="attribute">server_name</span>  <span class="number">192.168.17.129</span>;</span><br><span class="line"></span><br><span class="line">        <span class="attribute">location</span> / &#123;</span><br><span class="line">            <span class="attribute">proxy_pass</span> http://myserver;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>随着互联网信息的爆炸性增长，负载均衡（load balance）已经不再是一个很陌生的话题，顾名思义，负载均衡即是将负载分摊到不同的服务单元，既保证服务的可用性，又保证响应足够快，给用户很好的体验。快速增长的访问量和数据流量催生了各式各样的负载均衡产品，<br>很多专业的负载均衡硬件提供了很好的功能，但却价格不菲，这使得负载均衡软件大受欢迎，nginx 就是其中的一个，在 linux 下有 ginx、LVS、Haproxy 等等服务可以提供负载均衡服务，而且 Nginx 提供了几种分配方式(策略)：</p>
<blockquote>
<p>轮询（默认）</p>
</blockquote>
<p>每个请求按时间顺序逐一分配到不同的后端服务器，如果后端服务器 down 掉，能自动剔除</p>
<blockquote>
<p>weight</p>
</blockquote>
<p>weight 代表权,重默认为 1,权重越高被分配的客户端越多<br>指定轮询几率，weight 和访问比率成正比，用于后端服务器性能不均的情况。 例如：</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">upstream</span>  myserver&#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.17.129:8080</span> weight=<span class="number">5</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.17.129:8081</span> weight=<span class="number">10</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>ip_hash</p>
</blockquote>
<p>每个请求按访问 ip 的 hash 结果分配，这样每个访客固定访问一个后端服务器，可以解决 session 的问题。 例如：</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">upstream</span>  myserver&#123;</span><br><span class="line">    <span class="comment">#添加固定名称</span></span><br><span class="line">    ip_hash;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.17.129:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.17.129:8081</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>fair （第三方）</p>
</blockquote>
<p>按后端服务器的响应时间来分配请求，响应时间短的优先分配。</p>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">upstream</span>  myserver&#123;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.17.129:8080</span>;</span><br><span class="line">    <span class="attribute">server</span> <span class="number">192.168.17.129:8081</span>;</span><br><span class="line">    fair;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="动静分离"><a href="#动静分离" class="headerlink" title="动静分离"></a>动静分离</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>通过 location 指定不同的后缀名实现不同的请求转发。通过 expires 参数设置，可以使浏览器缓存过期时间，减少与服务器之前的请求和流量。具体 Expires 定义：是给一个资源设定一个过期时间，也就是说无需去 服务端验证，直接通过浏览器自身确认是否过期即可，所以不会产生额外的流量。此种方法非常适合不经常变动的资源。（如果经常更新的文件，不建议使用 Expires 来缓存），我这里设置 3d ，表示在这 3 天之内访问这个 URL ，发送一个请求，比对服务器该文件最后更新时间没有变化，则不会从服务器抓取，返回状态码 304 ，如果有修改，则直接从服务器重新下载，返回状态码 200 。</p>
<h2 id="实验"><a href="#实验" class="headerlink" title="实验"></a>实验</h2><ol>
<li>在/tmp文件夹下面创建data文件夹,在data下面创建www和image文件夹,www中存放test.html页面,image中存放1.jpg</li>
<li>在nginx中配置页面访问</li>
</ol>
<figure class="highlight nginx"><table><tr><td class="code"><pre><span class="line"><span class="attribute">location</span> /www/ &#123;</span><br><span class="line">    <span class="attribute">root</span>  /tmp/data/;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="attribute">location</span> /image/&#123;</span><br><span class="line">    <span class="attribute">root</span> /tmp/data/;</span><br><span class="line">    <span class="comment"># 此配置可以显示所有的静态文件</span></span><br><span class="line">    <span class="attribute">autoindex</span> <span class="literal">on</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>重启nginx</li>
<li>访问<code>http://IP/www/test.html</code>页面和<code>http://IP/image</code>即可访问</li>
</ol>
<h1 id="集群"><a href="#集群" class="headerlink" title="集群"></a>集群</h1><h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><p>图一</p>
<p><img data-src="/images/linux/nginx/1.jpg"></p>
<p>图二</p>
<p><img data-src="/images/linux/nginx/2.jpg"></p>
<h2 id="准备工作"><a href="#准备工作" class="headerlink" title="准备工作"></a>准备工作</h2><p>安装keepalived</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 安装</span></span><br><span class="line">yum install keepalived -y</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看是否安装成功</span></span><br><span class="line">rpm -q -a keepalived</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">安装位置</span></span><br><span class="line">/etc/keepalived/keepalived.conf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">启动</span></span><br><span class="line">systemctl start keepalived.service</span><br></pre></td></tr></table></figure>

<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><blockquote>
<p>规定: </p>
<p>192.168.31.166 是主服务器 </p>
<p>192.168.31.223 是备份服务器  </p>
<p>192.168.31.30  是虚拟IP</p>
</blockquote>
<p>在keepalived的配置文件中修改配置</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">#全局定义</span><br><span class="line">global_defs &#123;</span><br><span class="line">	notification_email &#123;</span><br><span class="line">	acassen@firewall.loc</span><br><span class="line">	failover@firewall.loc</span><br><span class="line">	sysadmin@firewall.loc</span><br><span class="line">	&#125;</span><br><span class="line">	notification_email_from Alexandre.Cassen@firewall.loc</span><br><span class="line">	smtp_server 192.168.17.129</span><br><span class="line">	smtp_connect_timeout 30</span><br><span class="line">	#通过该名字可以访问到服务器,在etc/host文件中添加即可,不添加也可以访问</span><br><span class="line">	#添加格式是 127.0.0.1  LVS_DEVEL</span><br><span class="line">	router_id LVS_DEVEL</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#脚本</span><br><span class="line">vrrp_script chk_http_port &#123;</span><br><span class="line">    # 脚本的路径及名称</span><br><span class="line">    script &quot;/usr/local/src/nginx_check.sh&quot;</span><br><span class="line"></span><br><span class="line">    interval 2 #（检测脚本执行的间隔）</span><br><span class="line"></span><br><span class="line">    weight 2  #权重</span><br><span class="line">&#125; </span><br><span class="line"></span><br><span class="line">#虚拟IP的配置</span><br><span class="line">vrrp_instance VI_1 &#123;</span><br><span class="line">    state BACKUP # 备份服务器上将 MASTER 改为 BACKUP</span><br><span class="line">    interface enp0s3 #网卡,可以使用ifconfig查看网卡信息</span><br><span class="line">    virtual_router_id 51 # 主、备机的 virtual_router_id 必须相同</span><br><span class="line">    priority 90 # 主、备机取不同的优先级，主机值较大，备份机值较小</span><br><span class="line">    advert_int 1 # 每隔1秒监测一下主机或者服务器是否还活着</span><br><span class="line">    authentication &#123;</span><br><span class="line">    auth_type PASS  #权限校验方式</span><br><span class="line">    auth_pass 1111  #密码是1111</span><br><span class="line">	&#125;</span><br><span class="line">	virtual_ipaddress &#123;</span><br><span class="line">		192.168.31.30  # VRRP H 虚拟地址,可以绑定多个</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>脚本文件</p>
<figure class="highlight"><table><tr><td class="code"><pre><span class="line">#!/bin/bash</span><br><span class="line">A=`ps -C nginx –no-header |wc -l`</span><br><span class="line">if [ $A -eq 0 ];then</span><br><span class="line">	# nginx的启动地址</span><br><span class="line">   /usr/local/nginx/sbin/nginx</span><br><span class="line">	sleep 2</span><br><span class="line">	if [ `ps -C nginx --no-header |wc -l` -eq 0 ];then</span><br><span class="line">		killall keepalived</span><br><span class="line">	fi</span><br><span class="line">fi</span><br></pre></td></tr></table></figure>

<p>启动nginx和keepalived</p>
<p>访问虚拟ip 192.168.31.30</p>
<p>查看服务器是否绑定成功,绑定成功后,会在网卡上显示虚拟IP</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">[root@MiWiFi-R4A-srv sbin]# ip a</span><br><span class="line"></span><br><span class="line">enp0s3: &lt;BROADCAST,MULTICAST,UP,LOWER_UP&gt; mtu 1500 qdisc fq_codel state UP group default qlen 1000</span><br><span class="line">    link&#x2F;ether 08:00:27:09:1b:e5 brd ff:ff:ff:ff:ff:ff</span><br><span class="line">    # 主服务器地址</span><br><span class="line">    inet 192.168.31.166&#x2F;24 brd 192.168.31.255 scope global dynamic noprefixroute enp0s3</span><br><span class="line">    valid_lft 38930sec preferred_lft 38930sec</span><br><span class="line">    # 绑定的虚拟IP</span><br><span class="line">    inet 192.168.31.30&#x2F;32 scope global enp0s3</span><br><span class="line">    valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::2b66:e8aa:ff51:1922&#x2F;64 scope link dadfailed tentative noprefixroute</span><br><span class="line">    valid_lft forever preferred_lft forever</span><br><span class="line">    inet6 fe80::b48d:f45f:e6a2:4006&#x2F;64 scope link noprefixroute</span><br><span class="line">    valid_lft forever preferred_lft forever</span><br></pre></td></tr></table></figure>

<p>关闭主服务器,再次访问虚拟IP,如果还有页面,就说明已经完成了集群</p>
<p>查看备份服务器网卡是否绑定虚拟IP</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>nginx</tag>
      </tags>
  </entry>
  <entry>
    <title>git</title>
    <url>/2020/03/24/tools/git/</url>
    <content><![CDATA[<h1 id="基础"><a href="#基础" class="headerlink" title="基础"></a>基础</h1><p><code>pwd </code>   查看当前目录</p>
<p><code>git init </code>    把这个目录变成Git可以管理的仓库</p>
<a id="more"></a>

<p><code>ls -a     </code>                查看当前目录下面文件   -a包含隐藏文件</p>
<p><code>git add &lt;file&gt;</code>                 告诉Git，把文件添加到暂存区：git add file2.txt file3.txt        </p>
<p><code>git commit -m &quot; &quot; </code>              告诉Git，把文件提交到仓库,并添加注释</p>
<h1 id="本地操作"><a href="#本地操作" class="headerlink" title="本地操作"></a>本地操作</h1><p><code>git status </code>                 实时掌握当前仓库的状态</p>
<p><code>git diff</code>                    查看具体的修改内容</p>
<p><code>git log</code>                显示从最近到最远的提交日志</p>
<p><code>git log --pretty=oneline  </code>       以简洁的内容展示日志文件</p>
<p><code>cat  &lt;file&gt;</code>                查看文件内容</p>
<p><code>git reset --hard  HEAD^ </code>        查看上一个版本,HEAD^上一个,  HEAD^^上两个, HEAD~100上100个</p>
<p><code>git reset --hard  版本号</code>        根据版本号来确定回退到某一个版本</p>
<p><code>git reflog    </code>                用来记录你的每一次命令：</p>
<p><code>git diff HEAD -- (空格)&lt;file&gt;</code>    查看工作区和版本库里面最新版本的区别</p>
<p><code>git checkout -- (空格)&lt;file&gt; </code>        把某文件在工作区的修改全部撤销</p>
<p><code>rm &lt;file&gt;</code>                    删除本地的文件</p>
<p><code>git rem  &lt;file&gt; </code>            删除版本库中的文件</p>
<h1 id="分支"><a href="#分支" class="headerlink" title="分支"></a>分支</h1><p><code>git switch -c 分支名字</code>                        创建分支</p>
<p><code>git switch 分支名字</code>                            切换分支</p>
<p><code>git branch -d 分支名字</code>                        删除分支</p>
<p><code>git branch</code>                                 查看当前分支</p>
<p><code>git merge  A</code>                                       合并A分支到当前分支</p>
<p><code>git merge --no-ff -m &quot;描述信息&quot; A</code>                  普通模式的合并,可以在log历史中查看到</p>
<p><code>git log --graph</code>                                查看分支合并图</p>
<h1 id="远程"><a href="#远程" class="headerlink" title="远程"></a>远程</h1><p><code>git remote add origin 地址</code>    连接远程</p>
<p><code>git push -u -f origin master</code>        首次推送本地文件到远程添加 -u,强制上传使用-f,以后直接 git push origin master</p>
<p><code>git clone url地址</code>            克隆到本地</p>
<h1 id="忽略"><a href="#忽略" class="headerlink" title="忽略"></a>忽略</h1><p><code>git rm -r --cached .</code>删除忽略文件的缓存,然后就可以进行正常的添加和提交</p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>easyExcel使用</title>
    <url>/2020/03/24/tools/easyExcel%E4%BD%BF%E7%94%A8/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><ul>
<li><p>Java领域解析、生成Excel比较有名的框架有Apache poi、jxl等。但他们都存在一个严重的问题就是非常的耗内存。如果你的系统并发量不大的话可能还行，但是一旦并发上来后一定会OOM或者JVM频繁的full gc。</p>
</li>
<li><p>EasyExcel是阿里巴巴开源的一个excel处理框架，以使用简单、节省内存著称。EasyExcel能大大减少占用内存的主要原因是在解析Excel时没有将文件数据一次性全部加载到内存中，而是从磁盘上一行行读取数据，逐个解析。</p>
</li>
<li><p>EasyExcel采用一行一行的解析模式，并将一行的解析结果以观察者的模式通知处理(AnalysisEventListener）。</p>
</li>
</ul>
<p><a href="https://www.yuque.com/easyexcel/doc/easyexcel">官网地址</a></p>
<h1 id="写Excel"><a href="#写Excel" class="headerlink" title="写Excel"></a>写Excel</h1><p><a href="https://www.yuque.com/easyexcel/doc/write">官网</a>的excel写操作,列出了很多分类,例如 指定写入的列,列宽,列高,自定义样式,合并单元格,插入批注,web请求的创建等</p>
<h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><p>需要引入一个easyexcel和poi依赖,而且easyexcel版本和poi版本对应</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- https://mvnrepository.com/artifact/com.alibaba/easyexcel --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easyexcel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--xls--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--xlsx--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.poi<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>poi-ooxml<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="创建实体对象"><a href="#创建实体对象" class="headerlink" title="创建实体对象"></a>创建实体对象</h2><p>创建一个实体对象,用于描述要写入表格的信息</p>
<p><code>@ExcelIgnore</code>注解会忽略此字段,在生成表格时,不生成这个字段</p>
<p><code>@ExcelProperty</code>注解支持单个单元格和合并多个单元格</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoData</span> </span>&#123;</span><br><span class="line">    <span class="comment">//主标题的意思是 会生成一个合并的单元格 名字叫主标题</span></span><br><span class="line">    <span class="meta">@ExcelProperty(&#123;&quot;主标题&quot;, &quot;字符串标题&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> String string;</span><br><span class="line">    <span class="meta">@ExcelProperty(&#123;&quot;主标题&quot;, &quot;日期标题&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line">    <span class="meta">@ExcelProperty(&quot;数字标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Double doubleData;</span><br><span class="line">    <span class="comment">//忽略此字段</span></span><br><span class="line">    <span class="meta">@ExcelIgnore</span></span><br><span class="line">    <span class="keyword">private</span> String ignore;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="自动关闭流写操作"><a href="#自动关闭流写操作" class="headerlink" title="自动关闭流写操作"></a>自动关闭流写操作</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建一个excel文件,并指定路径和文件名</span></span><br><span class="line">    String fileName = <span class="string">&quot;H:\\write.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">//创建数据</span></span><br><span class="line">    List&lt;DemoData&gt; list = <span class="keyword">new</span> ArrayList&lt;DemoData&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        DemoData data = <span class="keyword">new</span> DemoData();</span><br><span class="line">        data.setString(<span class="string">&quot;字符串&quot;</span> + i);</span><br><span class="line">        data.setDate(<span class="keyword">new</span> Date());</span><br><span class="line">        data.setDoubleData(<span class="number">0.56</span>);</span><br><span class="line">        list.add(data);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//写出操作,会自动关闭流</span></span><br><span class="line">    EasyExcel.write(fileName, DemoData.class).sheet(<span class="string">&quot;模板&quot;</span>).doWrite(list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="手动关闭流的写操作"><a href="#手动关闭流的写操作" class="headerlink" title="手动关闭流的写操作"></a>手动关闭流的写操作</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 创建一个excel文件,并指定路径和文件名</span></span><br><span class="line">    String fileName = <span class="string">&quot;H:\\write.xlsx&quot;</span>;</span><br><span class="line">    <span class="comment">//创建数据</span></span><br><span class="line">    List&lt;DemoData&gt; list = <span class="keyword">new</span> ArrayList&lt;DemoData&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">        DemoData data = <span class="keyword">new</span> DemoData();</span><br><span class="line">        data.setString(<span class="string">&quot;字符串&quot;</span> + i);</span><br><span class="line">        data.setDate(<span class="keyword">new</span> Date());</span><br><span class="line">        data.setDoubleData(<span class="number">0.56</span>);</span><br><span class="line">        list.add(data);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    ExcelWriter excelWriter = <span class="keyword">null</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        excelWriter = EasyExcel.write(fileName, DemoData.class).build();</span><br><span class="line">        WriteSheet sheet = EasyExcel.writerSheet(<span class="string">&quot;模板&quot;</span>).build();</span><br><span class="line">        excelWriter.write(list, sheet);</span><br><span class="line"></span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (excelWriter != <span class="keyword">null</span>) &#123;</span><br><span class="line">            excelWriter.finish();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="读Excel"><a href="#读Excel" class="headerlink" title="读Excel"></a>读Excel</h1><p><a href="https://www.yuque.com/easyexcel/doc/read">官网</a></p>
<h2 id="创建实体类"><a href="#创建实体类" class="headerlink" title="创建实体类"></a>创建实体类</h2><p>实体类中地value属性要写值,index值可写可不写,<strong>不建议<code>value</code>和<code>index</code>属性同时写</strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoData</span> </span>&#123;</span><br><span class="line">   <span class="meta">@ExcelProperty(index = 0)</span></span><br><span class="line">    <span class="keyword">private</span> String string;</span><br><span class="line">    <span class="meta">@ExcelProperty(value = &#123;&quot;主标题&quot;, &quot;日期标题&quot;&#125;)</span></span><br><span class="line">    <span class="keyword">private</span> Date date;</span><br><span class="line">    <span class="meta">@ExcelProperty(value = &quot;数字标题&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Double doubleData;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="创建监听器"><a href="#创建监听器" class="headerlink" title="创建监听器"></a>创建监听器</h2><p>监听器的创建,需要实现一个<code>AnalysisEventListener</code>泛型类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ExcelListener</span> <span class="keyword">extends</span> <span class="title">AnalysisEventListener</span>&lt;<span class="title">DemoData</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 一行一行地读取内容</span></span><br><span class="line"><span class="comment">     读取的excel表内容存在DemoData对象里</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> data</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invoke</span><span class="params">(DemoData data, AnalysisContext context)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;***&quot;</span> + data);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取表头,默认继承了AnalysisEventListener后不会自动生成该方法</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> headMap</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">invokeHeadMap</span><span class="params">(Map&lt;Integer, String&gt; headMap, AnalysisContext context)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;表头&quot;</span> + headMap);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 读取完成后需要做的操作</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> context</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">doAfterAllAnalysed</span><span class="params">(AnalysisContext context)</span> </span>&#123;&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="读操作"><a href="#读操作" class="headerlink" title="读操作"></a>读操作</h2><p>读取的内容在监听器里</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="meta">@Test</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">read</span><span class="params">()</span> </span>&#123;</span><br><span class="line"> <span class="comment">//获取文件地路径和名称</span></span><br><span class="line"> String fileName = <span class="string">&quot;H:\\write.xlsx&quot;</span>;</span><br><span class="line"> <span class="comment">//读取</span></span><br><span class="line"> EasyExcel.read(fileName, DemoData.class, <span class="keyword">new</span> ExcelListener()).sheet().doRead();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="下载excle"><a href="#下载excle" class="headerlink" title="下载excle"></a>下载excle</h1><p>以get方式请求,设置文件编码,就可以直接访问的时候调用浏览器的下载功能</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;UserCompany&gt; userList = userService.getCompanyList();</span><br><span class="line"><span class="comment">//设置浏览器格式以及编码</span></span><br><span class="line">response.setContentType(<span class="string">&quot;application/vnd.ms-excel&quot;</span>);</span><br><span class="line">response.setCharacterEncoding(<span class="string">&quot;utf-8&quot;</span>);</span><br><span class="line">response.setContentType(<span class="string">&quot;application/octet-stream&quot;</span>);</span><br><span class="line"><span class="comment">//当前日期</span></span><br><span class="line">LocalDate now = LocalDate.now();</span><br><span class="line"><span class="comment">// 这里URLEncoder.encode可以防止中文乱码</span></span><br><span class="line">String fileName = URLEncoder.encode(<span class="string">&quot;职遇企业用户数据&quot;</span>, <span class="string">&quot;UTF-8&quot;</span>);</span><br><span class="line">response.setHeader(<span class="string">&quot;Content-disposition&quot;</span>, <span class="string">&quot;attachment;filename=&quot;</span> + fileName + <span class="string">&quot;.xlsx&quot;</span>);</span><br><span class="line">EasyExcel.write(response.getOutputStream(), UserCompany.class).sheet(<span class="string">&quot;企业用户数据一览_&quot;</span> + now).doWrite(userList);</span><br></pre></td></tr></table></figure>







































]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>springBoot部署</title>
    <url>/2021/04/05/linux/linuxJar/</url>
    <content><![CDATA[<p>为了解决springBoot打包后,项目文件过大的问题,采用jar和项目分离的模式</p>
<p><a href="https://blog.csdn.net/weixin_42375707/article/details/109037258?ops_request_misc=&request_id=&biz_id=102&utm_term=springbooy%E6%89%93%E5%8C%85&utm_medium=distribute.pc_search_result.none-task-blog-2~all~sobaiduweb~default-6-109037258.pc_search_result_before_js--">参考CSDN</a></p>
<a id="more"></a>

<p>思路是:</p>
<ol>
<li>先用原始的springBoot打包方式进行一次打包,然后把打包文件的<code>BOOT-INF</code>中的<code>lib</code>单独复制出来</li>
<li>更改打包插件,打包出一份只有java代码的文件</li>
<li>把<code>lib</code>和新打包出来的jar放在同一个目录,然后运行即可</li>
</ol>
<blockquote>
<p>原始的打包方式</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">excludes</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">exclude</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">exclude</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">excludes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>原始打包方式会生成一个<code>spring.jar</code>文件,把它解压,找到<code>BOOT-INF\lib</code>文件</p>
<blockquote>
<p>简洁版打包</p>
</blockquote>
<p>需要单独配置一下启动类的路径</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">build</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">finalName</span>&gt;</span>spring<span class="tag">&lt;/<span class="name">finalName</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--项目的启动类--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">mainClass</span>&gt;</span>com.wty.springbootdemo.SpringbootdemoApplication<span class="tag">&lt;/<span class="name">mainClass</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--解决windows命令行窗口中文乱码--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">jvmArguments</span>&gt;</span>-Dfile.encoding=UTF-8<span class="tag">&lt;/<span class="name">jvmArguments</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">layout</span>&gt;</span>ZIP<span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">                    <span class="comment">&lt;!--配置需要打包进项目的jar--&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">includes</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">include</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>non-exists<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>non-exists<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">include</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">includes</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>repackage<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--此插件用于将依赖包抽出--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">plugin</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.maven.plugins<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>maven-dependency-plugin<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">executions</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;<span class="name">execution</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">id</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">phase</span>&gt;</span>package<span class="tag">&lt;/<span class="name">phase</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">goals</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">goal</span>&gt;</span>copy-dependencies<span class="tag">&lt;/<span class="name">goal</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">goals</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">outputDirectory</span>&gt;</span>$&#123;project.build.directory&#125;/lib<span class="tag">&lt;/<span class="name">outputDirectory</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">excludeTransitive</span>&gt;</span>false<span class="tag">&lt;/<span class="name">excludeTransitive</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">stripVersion</span>&gt;</span>false<span class="tag">&lt;/<span class="name">stripVersion</span>&gt;</span></span><br><span class="line">                            <span class="tag">&lt;<span class="name">includeScope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">includeScope</span>&gt;</span></span><br><span class="line">                        <span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br><span class="line">                    <span class="tag">&lt;/<span class="name">execution</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;/<span class="name">executions</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">build</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>会生成一个<code>spring.jar</code>文件,把这个文件和<code>lib</code>文件放在同一个目录</p>
<blockquote>
<p>启动</p>
</blockquote>
<p>把文件放到linux服务器上,使用<code>nohup</code>命令启动</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">nohup java -jar -Dloader.path=lib spring.jar --server.port=8081 &gt; ./<span class="built_in">log</span>/spring.log 2&gt;&amp;1 &amp;</span><br></pre></td></tr></table></figure>

<p>解释:</p>
<p><code>nohup</code></p>
<p><code>-Dloader.path=lib spring.jar</code>指定lib和项目一起启动</p>
<p><code> &gt; ./log/spring.log</code> 指定生成的日志路径和名字,不指定的话,会生成一个默认的日志文件<code>nohup.out</code></p>
<blockquote>
<p>其他命令</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment">#查看项目的端口占用的pid</span></span><br><span class="line">lsof -i:端口  </span><br><span class="line"></span><br><span class="line"><span class="comment">#停止项目的运行</span></span><br><span class="line"><span class="built_in">kill</span> -9 pid</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>swagger</title>
    <url>/2020/05/29/tools/swagger/</url>
    <content><![CDATA[<h1 id="整合springboot"><a href="#整合springboot" class="headerlink" title="整合springboot"></a>整合springboot</h1><h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="编写配置类"><a href="#编写配置类" class="headerlink" title="编写配置类"></a>编写配置类</h2><p>第一个版本</p>
<p>访问地址:<a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConf</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;swagger.enable&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> enable;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//添加head参数start</span></span><br><span class="line">        ParameterBuilder tokenPar;</span><br><span class="line">        tokenPar = <span class="keyword">new</span> ParameterBuilder();</span><br><span class="line">        List&lt;Parameter&gt; pars = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        tokenPar.name(<span class="string">&quot;userId&quot;</span>).description(<span class="string">&quot;用户名&quot;</span>).modelRef(<span class="keyword">new</span> ModelRef(<span class="string">&quot;string&quot;</span>)).parameterType(<span class="string">&quot;header&quot;</span>).required(<span class="keyword">false</span>).build();</span><br><span class="line">        pars.add(tokenPar.build());</span><br><span class="line">        <span class="comment">//添加head参数end</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .enable(enable)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.u.zhiyu.controller&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.regex(<span class="string">&quot;/.*&quot;</span>))</span><br><span class="line">                .build()</span><br><span class="line">                .globalOperationParameters(pars)</span><br><span class="line">                .apiInfo(apiInfo());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">&quot;后台接口文档与测试&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;Spring Boot 测试使用 Swagger2 构建RESTful API&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0.0&quot;</span>)</span><br><span class="line">                .termsOfServiceUrl(<span class="string">&quot;http://terms-of-services.url&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="api"><a href="#api" class="headerlink" title="api"></a>api</h3><p>api一共可以扫描五种路径</p>
<p> RequestHandlerSelectors:配置要扫描接口的方式</p>
<ul>
<li><p>none    什么都不扫描</p>
</li>
<li><p>any   扫描全部</p>
</li>
<li><p>withMethodAnnotation()</p>
</li>
<li><p>withClassAnnotation</p>
</li>
<li><p>basePackage    包扫描</p>
</li>
<li><pre><code class="java">.apis(RequestHandlerSelectors.basePackage(&quot;com.wty.swagger.controller&quot;))
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line">&#96;&#96;&#96;java</span><br><span class="line">&#x2F;**</span><br><span class="line">* 过滤路径</span><br><span class="line">* ant():配置哪些路径不扫描,路径不存在,提示: No operations defined in spec!</span><br><span class="line">* regex():正则</span><br><span class="line">*&#x2F;</span><br><span class="line">.paths(PathSelectors.any())</span><br></pre></td></tr></table></figure>
</code></pre>
</li>
</ul>
<h3 id="paths"><a href="#paths" class="headerlink" title="paths"></a>paths</h3><p>过滤路径,有四种方法</p>
<ul>
<li>ant  配置需要过滤的路径</li>
<li>any  所有的路径都过滤</li>
<li>none  都不过滤</li>
<li>regex   表达式</li>
</ul>
<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><p><a href="https://www.bilibili.com/video/BV1BA411v7BT?p=4">参考视频</a></p>
<ul>
<li>@ApiModel() 实体类的说明</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiModel(value=&quot;EduTeacher对象&quot;, description=&quot;讲师&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduTeacher</span> <span class="keyword">implements</span> <span class="title">Serializable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>@ApiModelProperty() 实体类属性的说明</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiModelProperty(value = &quot;讲师姓名&quot;)</span></span><br><span class="line"><span class="keyword">private</span> String name;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>@ApiOperation  方法的说明</p>
<p>此注解添加再方法上,用来描述一个方法</p>
<p>value用来简述</p>
<p>notes 用来详细描述,还可以使用html标签</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(value = &quot;方法简述&quot;,notes = &quot;这是一个XXX方法的实现&quot;)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>@ApiImplicitParams  用来对方法参数进行说明,用在方法上<ul>
<li>name  传参的名称</li>
<li>dataType  参数的类型</li>
<li>paramType   默认值是body,如果使用rest风格,通过路径传参,更改为path</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiImplicitParams(&#123;</span></span><br><span class="line"><span class="meta">    @ApiImplicitParam(name = &quot;id&quot;, value = &quot;用户的id&quot;, dataType = &quot;Integer&quot;,paramType = &quot;path&quot;,required = true, defaultValue = &quot;1&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br></pre></td></tr></table></figure>

<ul>
<li>@ApiParam 参数的说明<ul>
<li>name 需要的传参</li>
<li>value  参数的描述</li>
<li>required 是否必须</li>
</ul>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@ApiOperation(value &#x3D; &quot;根据id逻辑删除讲师&quot;)</span><br><span class="line">@DeleteMapping(&quot;&#x2F;delete&#x2F;&#123;id&#125;&quot;)</span><br><span class="line">public boolean deleteById(@ApiParam(name &#x3D; &quot;id&quot;, value &#x3D; &quot;讲师ID&quot;, required &#x3D; true) @PathVariable String id) &#123;</span><br><span class="line">    boolean flag &#x3D; teacherService.removeById(id);</span><br><span class="line">    return flag;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>@Api  可以放置在controller类上,描述这个类的作用</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Api(description = &quot;讲师管理&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">EduTeacherController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ul>
<li>@ApiResponses   对状态码进行定制</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiResponses(&#123;</span></span><br><span class="line"><span class="meta">    @ApiResponse(code = 404, message = &quot;请求路径错误&quot;),</span></span><br><span class="line"><span class="meta">    @ApiResponse(code = 200, message = &quot;请求成功&quot;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br></pre></td></tr></table></figure>

<h2 id="启动类注解"><a href="#启动类注解" class="headerlink" title="启动类注解"></a>启动类注解</h2><p>如果swagger配置类和启动类不在同一个模块里,需要在启动类上配置swagger的包路径</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(basePackages = &#123;&quot;com.wty&quot;&#125;)</span></span><br></pre></td></tr></table></figure>

<h1 id="整合springmvc"><a href="#整合springmvc" class="headerlink" title="整合springmvc"></a>整合springmvc</h1><h2 id="maven-1"><a href="#maven-1" class="headerlink" title="maven"></a>maven</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!--swagger--&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springfox-swagger-ui&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;springfox-swagger2&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.8.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.mangofactory&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;swagger-springmvc&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.0.2&lt;&#x2F;version&gt;</span><br><span class="line">        &lt;exclusions&gt;</span><br><span class="line">            &lt;exclusion&gt;</span><br><span class="line">                &lt;artifactId&gt;guava&lt;&#x2F;artifactId&gt;</span><br><span class="line">                &lt;groupId&gt;com.google.guava&lt;&#x2F;groupId&gt;</span><br><span class="line">            &lt;&#x2F;exclusion&gt;</span><br><span class="line">    &lt;&#x2F;exclusions&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="springmvc-xml配置"><a href="#springmvc-xml配置" class="headerlink" title="springmvc.xml配置"></a>springmvc.xml配置</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;bean class&#x3D;&quot;springfox.documentation.swagger2.configuration.Swagger2DocumentationConfiguration&quot; id&#x3D;&quot;swagger2Config&quot;&#x2F;&gt;</span><br><span class="line">&lt;bean class&#x3D;&quot;com.wty.ssm.util.SwaggerConfig&quot;&#x2F;&gt;</span><br><span class="line">&lt;mvc:resources location&#x3D;&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;&quot; mapping&#x3D;&quot;swagger-ui.html&quot;&#x2F;&gt;</span><br><span class="line">&lt;mvc:resources location&#x3D;&quot;classpath:&#x2F;META-INF&#x2F;resources&#x2F;webjars&#x2F;&quot; mapping&#x3D;&quot;&#x2F;webjars&#x2F;**&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>lombok</title>
    <url>/2020/03/24/tools/lombok/</url>
    <content><![CDATA[<h1 id="maven坐标"><a href="#maven坐标" class="headerlink" title="maven坐标"></a>maven坐标</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.18.8&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>
<a id="more"></a>

<h1 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h1><p>Intellij idea开发的话需要安装Lombok plugin，同时设置<br> Setting -&gt; Compiler -&gt; Annotation Processors -&gt; Enable annotation processing勾选。</p>
<h1 id="解释"><a href="#解释" class="headerlink" title="解释"></a>解释</h1><p><code>@Data(类)</code><br> 包含了 @ToString、@EqualsAndHashCode、@Getter / @Setter和@RequiredArgsConstructor的功能</p>
<p><code>@Setter (类或属性)</code><br>注解在类或字段，注解在类时为所有字段生成setter方法，注解在字段上时只为该字段生成setter方法</p>
<p><code>@Getter(类或属性)</code><br>默认生成的方法是public的，如果要修改方法修饰符可以设置AccessLevel的值，例如：@Getter(access = AccessLevel.PROTECTED)</p>
<p><code>@ToString(类)</code><br>设置不包含哪些字段  @ToString(exclude = “id”)    @ToString(exclude = {“id”,”name”})<br>如果继承的有父类的话，可以设置callSuper 让其调用父类的toString()方法 ,例如;@ToString(callSuper = true)</p>
<p><code>@EqualsAndHashCode(类)</code><br>生成hashCode和equals方法。</p>
<p><code>@RequiredArgsConstructor</code><br>会生成构造方法（可能带参数也可能不带参数），如果带参数，这参数只能是以final修饰的未经初始化的字段，或者是以@NonNull注解的未经初始化的字段为类中需要特殊处理的字段生成构造方法，比如final和被@NonNull注解的字段</p>
<p><code>@NoArgsConstructor(类)     无参</code></p>
<p><code>@AllArgsConstructor(类)      有参</code></p>
<p><code>@Slf4j</code><br>生成log变量，严格意义来说是常量。<br>private static final Logger log = LoggerFactory.getLogger(UserController.class);</p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>常用代码工具</title>
    <url>/2020/10/12/tools/%E5%B8%B8%E7%94%A8%E4%BB%A3%E7%A0%81%E5%B7%A5%E5%85%B7/</url>
    <content><![CDATA[<h1 id="java数据库连接测试"><a href="#java数据库连接测试" class="headerlink" title="java数据库连接测试"></a>java数据库连接测试</h1><p>后缀</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">jdbc:mysql://localhost:3306/wty?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;allowPublicKeyRetrieval=true&amp;useSSL=false&amp;characterEncoding=utf8</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<p>maven</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--mysql数据库--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    Class.forName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">    String url=<span class="string">&quot;jdbc:mysql://localhost:3306/wty?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;allowPublicKeyRetrieval=true&amp;useSSL=false&amp;characterEncoding=utf8&quot;</span>;</span><br><span class="line">    String username=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">    String password=<span class="string">&quot;root&quot;</span>;</span><br><span class="line">    Connection conn= DriverManager.getConnection(url,username,password);</span><br><span class="line">    System.out.println(<span class="string">&quot;连接成功！&quot;</span>);</span><br><span class="line">    System.out.println(conn);</span><br><span class="line">&#125; <span class="keyword">catch</span> (ClassNotFoundException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">catch</span> (SQLException e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="swagger配置"><a href="#swagger配置" class="headerlink" title="swagger配置"></a>swagger配置</h1><ul>
<li>配置maven</li>
<li>编写配置文件代码,需要添加<code>@Configuration</code>注解</li>
<li>在启动类上添加<code>@EnableSwagger2</code>开启swagger,添加<code>@ComponentScan</code>配置swagger文件的位置,eg:<code>@ComponentScan(basePackages = &quot;com.atguigu&quot;)</code></li>
<li>API访问地址    <a href="localhost:8080/swagger-ui.html"> localhost:8080/swagger-ui.html</a></li>
<li>DOC访问地址  <a href="localhost:8080/doc.html">localhost:8080/doc.html</a></li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--swageer-ui--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--swagger-doc--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-bootstrap-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.jackson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core-asl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConf</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Value(&quot;$&#123;swagger.enable&#125;&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> enable;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">createRestApi</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//添加head参数start</span></span><br><span class="line">        ParameterBuilder tokenPar;</span><br><span class="line">        tokenPar = <span class="keyword">new</span> ParameterBuilder();</span><br><span class="line">        List&lt;Parameter&gt; pars = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        tokenPar.name(<span class="string">&quot;userId&quot;</span>).description(<span class="string">&quot;用户名&quot;</span>).modelRef(<span class="keyword">new</span> ModelRef(<span class="string">&quot;string&quot;</span>)).parameterType(<span class="string">&quot;header&quot;</span>).required(<span class="keyword">false</span>).build();</span><br><span class="line">        pars.add(tokenPar.build());</span><br><span class="line">        <span class="comment">//添加head参数end</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .enable(enable)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.u.zhiyu.controller&quot;</span>))</span><br><span class="line">                .paths(PathSelectors.regex(<span class="string">&quot;/.*&quot;</span>))</span><br><span class="line">                .build()</span><br><span class="line">                .globalOperationParameters(pars)</span><br><span class="line">                .apiInfo(apiInfo());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">apiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">&quot;后台接口文档与测试&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;Spring Boot 测试使用 Swagger2 构建RESTful API&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0.0&quot;</span>)</span><br><span class="line">                .termsOfServiceUrl(<span class="string">&quot;http://terms-of-services.url&quot;</span>)</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="日志配置"><a href="#日志配置" class="headerlink" title="日志配置"></a>日志配置</h2><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#swagger的日志</span></span><br><span class="line"><span class="meta">logging.level.io.swagger.models.parameters.AbstractSerializableParameter</span>=<span class="string">error</span></span><br></pre></td></tr></table></figure>



<h1 id="统一结果返回"><a href="#统一结果返回" class="headerlink" title="统一结果返回"></a>统一结果返回</h1><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--&lt;optional&gt;true&lt;/optional&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Msg"><a href="#Msg" class="headerlink" title="Msg"></a>Msg</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Msg</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 状态码   100-成功    200-失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> code;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 提示信息</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 用户要返回给浏览器的数据</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; extend = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Msg <span class="title">success</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Msg result = <span class="keyword">new</span> Msg();</span><br><span class="line">        result.setCode(<span class="number">100</span>);</span><br><span class="line">        result.setMsg(<span class="string">&quot;处理成功！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> Msg <span class="title">fail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        Msg result = <span class="keyword">new</span> Msg();</span><br><span class="line">        result.setCode(<span class="number">200</span>);</span><br><span class="line">        result.setMsg(<span class="string">&quot;处理失败！&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Msg <span class="title">add</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.getExtend().put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="R"><a href="#R" class="headerlink" title="R"></a>R</h2><p>自定义数据</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">R</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;是否成功&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回消息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回数据&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; data = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造函数私有化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">R</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 成功</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">ok</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(<span class="keyword">true</span>);</span><br><span class="line">        r.setCode(<span class="number">20000</span>);</span><br><span class="line">        r.setMessage(<span class="string">&quot;成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 失败</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">error</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(<span class="keyword">false</span>);</span><br><span class="line">        r.setCode(<span class="number">20001</span>);</span><br><span class="line">        r.setMessage(<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">success</span><span class="params">(Boolean success)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setSuccess(success);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">message</span><span class="params">(String message)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setMessage(message);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">code</span><span class="params">(Integer code)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setCode(code);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">data</span><span class="params">(String key, Object value)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">data</span><span class="params">(Map&lt;String, Object&gt; map)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setData(map);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="全局异常"><a href="#全局异常" class="headerlink" title="全局异常"></a>全局异常</h1><p>全局异常需要用到lombok</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">     <span class="comment">&lt;!--&lt;optional&gt;true&lt;/optional&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.18.8<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>以下是代码</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@RestControllerAdvice</span><br><span class="line">@Slf4j</span><br><span class="line">public class GlobalExceptionHandler &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 全局异常处理</span><br><span class="line">     * @param e</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @ExceptionHandler(Exception.class)</span><br><span class="line">    public R error(Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        log.error(e.getMessage());</span><br><span class="line">        return R.error().message(&quot;全局异常&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 特定异常</span><br><span class="line">     * java.lang.ArithmeticException: &#x2F; by zero</span><br><span class="line">     *</span><br><span class="line">     * @param e</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @ExceptionHandler(ArithmeticException.class)</span><br><span class="line">    public R error(ArithmeticException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        log.error(e.getMessage());</span><br><span class="line">        return R.error().message(&quot;ArithmeticException异常&quot;);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 自定义异常 GuLiException</span><br><span class="line">     *</span><br><span class="line">     * @param e</span><br><span class="line">     * @return</span><br><span class="line">     *&#x2F;</span><br><span class="line">    @ExceptionHandler(GuLiException.class)</span><br><span class="line">    public R error(GuLiException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">        log.error(e.getMessage());</span><br><span class="line">        return R.error().code(e.getCode()).message(e.getMsg());</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="自定义异常"><a href="#自定义异常" class="headerlink" title="自定义异常"></a>自定义异常</h1><p>自定义异常的定义</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">GuLiException</span> <span class="keyword">extends</span> <span class="title">RuntimeException</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;状态码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;异常信息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String msg;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>自定义异常的使用</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ApiOperation(&quot;查询所有的讲师&quot;)</span></span><br><span class="line"><span class="meta">@GetMapping(&quot;/findAll&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">findAllTeacher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    List&lt;EduTeacher&gt; list = teacherService.list(<span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">    	<span class="keyword">int</span> i = <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="comment">//自定义异常</span></span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> GuLiException(<span class="number">20001</span>, <span class="string">&quot;EduTeacherController-findAllTeacher出现了异常&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> R.ok().data(<span class="string">&quot;items&quot;</span>, list);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>







]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>微信Dat文件解析</title>
    <url>/2020/05/09/tools/wechat/</url>
    <content><![CDATA[<p>此代码解决了PC端微信加密图片转换为普通图片的问题,可以直接运行此代码</p>
<a id="more"></a>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.io.*;</span><br><span class="line"><span class="keyword">import</span> java.util.Arrays;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicInteger;</span><br><span class="line"><span class="keyword">import</span> java.util.concurrent.atomic.AtomicReference;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WxChatImgRevert2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//微信的Image地址</span></span><br><span class="line">        String path = <span class="string">&quot;F:\\my\\Image&quot;</span>;</span><br><span class="line">        <span class="comment">//转换后的图片地址,该地址需要提前创建</span></span><br><span class="line">        String targetPath = <span class="string">&quot;H:\\weChat\\temp&quot;</span>;</span><br><span class="line">        convert(path, targetPath);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> path       图片目录地址</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> targetPath 转换后目录</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">convert</span><span class="params">(String path, String targetPath)</span> </span>&#123;</span><br><span class="line">        File[] file = <span class="keyword">new</span> File(path).listFiles();</span><br><span class="line">        <span class="keyword">if</span> (file == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">int</span> size = file.length;</span><br><span class="line">        System.out.println(<span class="string">&quot;总共&quot;</span> + size + <span class="string">&quot;个文件&quot;</span>);</span><br><span class="line">        AtomicReference&lt;Integer&gt; integer = <span class="keyword">new</span> AtomicReference&lt;&gt;(<span class="number">0</span>);</span><br><span class="line">        AtomicInteger x = <span class="keyword">new</span> AtomicInteger();</span><br><span class="line">        <span class="keyword">for</span> (File file1 : file) &#123;</span><br><span class="line">            <span class="keyword">if</span> (file1.isFile()) &#123;</span><br><span class="line">                Object[] xori = getXor(file1);</span><br><span class="line">                <span class="keyword">if</span> (xori != <span class="keyword">null</span> &amp;&amp; xori[<span class="number">1</span>] != <span class="keyword">null</span>) &#123;</span><br><span class="line">                    x.set((<span class="keyword">int</span>) xori[<span class="number">1</span>]);</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        Arrays.stream(file).parallel().forEach(file1 -&gt; &#123;</span><br><span class="line">            <span class="keyword">if</span> (file1.isDirectory()) &#123;</span><br><span class="line">                String[] newTargetPath = file1.getPath().split(<span class="string">&quot;/|\\\\&quot;</span>);</span><br><span class="line">                File targetFile = <span class="keyword">new</span> File(targetPath + File.separator + newTargetPath[newTargetPath.length - <span class="number">1</span>]);</span><br><span class="line">                <span class="keyword">if</span> (!targetFile.exists()) &#123;</span><br><span class="line">                    targetFile.mkdirs();</span><br><span class="line">                &#125;</span><br><span class="line">                convert(file1.getPath(), targetPath + File.separator + newTargetPath[newTargetPath.length - <span class="number">1</span>]);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            Object[] xor = getXor(file1);</span><br><span class="line">            <span class="keyword">if</span> (x.get() == <span class="number">0</span> &amp;&amp; xor[<span class="number">1</span>] != <span class="keyword">null</span> &amp;&amp; (<span class="keyword">int</span>) xor[<span class="number">1</span>] != <span class="number">0</span>) &#123;</span><br><span class="line">                x.set((<span class="keyword">int</span>) xor[<span class="number">1</span>]);</span><br><span class="line">            &#125;</span><br><span class="line">            xor[<span class="number">1</span>] = xor[<span class="number">1</span>] == <span class="keyword">null</span> ? x.get() : xor[<span class="number">1</span>];</span><br><span class="line">            <span class="keyword">try</span> (InputStream reader = <span class="keyword">new</span> FileInputStream(file1);</span><br><span class="line">                 OutputStream writer =</span><br><span class="line">                         <span class="keyword">new</span> FileOutputStream(targetPath + File.separator + file1.getName().split(<span class="string">&quot;\\.&quot;</span>)[<span class="number">0</span>] + (xor[<span class="number">0</span>] != <span class="keyword">null</span> ?</span><br><span class="line">                                 <span class="string">&quot;.&quot;</span> + xor[<span class="number">0</span>] : <span class="string">&quot;&quot;</span>))) &#123;</span><br><span class="line">                <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">1024</span> * <span class="number">10</span>];</span><br><span class="line">                <span class="keyword">int</span> b;</span><br><span class="line">                <span class="keyword">while</span> ((b = reader.read(bytes)) != -<span class="number">1</span>) &#123;<span class="comment">//这里的in.read(bytes);就是把输入流中的东西，写入到内存中（bytes）。</span></span><br><span class="line">                    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; bytes.length; i++) &#123;</span><br><span class="line">                        bytes[i] = (<span class="keyword">byte</span>) (<span class="keyword">int</span>) (bytes[i] ^ (<span class="keyword">int</span>) xor[<span class="number">1</span>]);</span><br><span class="line">                        <span class="keyword">if</span> (i == (b - <span class="number">1</span>)) &#123;</span><br><span class="line">                            <span class="keyword">break</span>;</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;</span><br><span class="line">                    writer.write(bytes, <span class="number">0</span>, b);</span><br><span class="line">                    writer.flush();</span><br><span class="line">                &#125;</span><br><span class="line">                integer.set(integer.get() + <span class="number">1</span>);</span><br><span class="line">                System.out.println(file1.getName() + <span class="string">&quot;(大小:&quot;</span> + ((<span class="keyword">double</span>) file1.length() / <span class="number">1000</span>) + <span class="string">&quot;kb,异或值:&quot;</span> + xor[<span class="number">1</span>] + <span class="string">&quot;),&quot;</span> +</span><br><span class="line">                        <span class="string">&quot;进度：&quot;</span> + integer.get() +</span><br><span class="line">                        <span class="string">&quot;/&quot;</span> + size);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        System.out.println(<span class="string">&quot;解析完毕！&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断图片异或值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> file</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object[] getXor(File file) &#123;</span><br><span class="line">        Object[] xor = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">if</span> (file != <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">byte</span>[] bytes = <span class="keyword">new</span> <span class="keyword">byte</span>[<span class="number">4</span>];</span><br><span class="line">            <span class="keyword">try</span> (InputStream reader = <span class="keyword">new</span> FileInputStream(file)) &#123;</span><br><span class="line">                reader.read(bytes, <span class="number">0</span>, bytes.length);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">            xor = getXor(bytes);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> xor;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> bytes</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> Object[] getXor(<span class="keyword">byte</span>[] bytes) &#123;</span><br><span class="line">        Object[] xorType = <span class="keyword">new</span> Object[<span class="number">2</span>];</span><br><span class="line">        <span class="keyword">int</span>[] xors = <span class="keyword">new</span> <span class="keyword">int</span>[<span class="number">3</span>];</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;String, String&gt; type : FILE_TYPE_MAP.entrySet()) &#123;</span><br><span class="line">            String[] hex = &#123;</span><br><span class="line">                    String.valueOf(type.getKey().charAt(<span class="number">0</span>)) + type.getKey().charAt(<span class="number">1</span>),</span><br><span class="line">                    String.valueOf(type.getKey().charAt(<span class="number">2</span>)) + type.getKey().charAt(<span class="number">3</span>),</span><br><span class="line">                    String.valueOf(type.getKey().charAt(<span class="number">4</span>)) + type.getKey().charAt(<span class="number">5</span>)</span><br><span class="line">            &#125;;</span><br><span class="line">            xors[<span class="number">0</span>] = bytes[<span class="number">0</span>] &amp; <span class="number">0xFF</span> ^ Integer.parseInt(hex[<span class="number">0</span>], <span class="number">16</span>);</span><br><span class="line">            xors[<span class="number">1</span>] = bytes[<span class="number">1</span>] &amp; <span class="number">0xFF</span> ^ Integer.parseInt(hex[<span class="number">1</span>], <span class="number">16</span>);</span><br><span class="line">            xors[<span class="number">2</span>] = bytes[<span class="number">2</span>] &amp; <span class="number">0xFF</span> ^ Integer.parseInt(hex[<span class="number">2</span>], <span class="number">16</span>);</span><br><span class="line">            <span class="keyword">if</span> (xors[<span class="number">0</span>] == xors[<span class="number">1</span>] &amp;&amp; xors[<span class="number">1</span>] == xors[<span class="number">2</span>]) &#123;</span><br><span class="line">                xorType[<span class="number">0</span>] = type.getValue();</span><br><span class="line">                xorType[<span class="number">1</span>] = xors[<span class="number">0</span>];</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> xorType;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> <span class="keyword">static</span> Map&lt;String, String&gt; FILE_TYPE_MAP = <span class="keyword">new</span> HashMap&lt;String, String&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">static</span> &#123;</span><br><span class="line">        getAllFileType();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">getAllFileType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;89504e470d0a1a0a0000&quot;</span>, <span class="string">&quot;png&quot;</span>); <span class="comment">//PNG (png)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;47494638396126026f01&quot;</span>, <span class="string">&quot;gif&quot;</span>); <span class="comment">//GIF (gif)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;49492a00227105008037&quot;</span>, <span class="string">&quot;tif&quot;</span>); <span class="comment">//TIFF (tif)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;424d228c010000000000&quot;</span>, <span class="string">&quot;bmp&quot;</span>); <span class="comment">//16色位图(bmp)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;424d8240090000000000&quot;</span>, <span class="string">&quot;bmp&quot;</span>); <span class="comment">//24位位图(bmp)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;424d8e1b030000000000&quot;</span>, <span class="string">&quot;bmp&quot;</span>); <span class="comment">//256色位图(bmp)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;41433130313500000000&quot;</span>, <span class="string">&quot;dwg&quot;</span>); <span class="comment">//CAD (dwg)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;3c21444f435459504520&quot;</span>, <span class="string">&quot;html&quot;</span>); <span class="comment">//HTML (html)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;3c21646f637479706520&quot;</span>, <span class="string">&quot;htm&quot;</span>); <span class="comment">//HTM (htm)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;48544d4c207b0d0a0942&quot;</span>, <span class="string">&quot;css&quot;</span>); <span class="comment">//css</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;696b2e71623d696b2e71&quot;</span>, <span class="string">&quot;js&quot;</span>); <span class="comment">//js</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;7b5c727466315c616e73&quot;</span>, <span class="string">&quot;rtf&quot;</span>); <span class="comment">//Rich Text Format (rtf)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;38425053000100000000&quot;</span>, <span class="string">&quot;psd&quot;</span>); <span class="comment">//Photoshop (psd)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;46726f6d3a203d3f6762&quot;</span>, <span class="string">&quot;eml&quot;</span>); <span class="comment">//Email [Outlook Express 6] (eml)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;d0cf11e0a1b11ae10000&quot;</span>, <span class="string">&quot;doc&quot;</span>); <span class="comment">//MS Excel 注意：word、msi 和 excel的文件头一样</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;d0cf11e0a1b11ae10000&quot;</span>, <span class="string">&quot;vsd&quot;</span>); <span class="comment">//Visio 绘图</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;5374616E64617264204A&quot;</span>, <span class="string">&quot;mdb&quot;</span>); <span class="comment">//MS Access (mdb)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;252150532D41646F6265&quot;</span>, <span class="string">&quot;ps&quot;</span>);</span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;255044462d312e360d25&quot;</span>, <span class="string">&quot;pdf&quot;</span>); <span class="comment">//Adobe Acrobat (pdf)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;ffd8ffe000104a464946&quot;</span>, <span class="string">&quot;jpg&quot;</span>); <span class="comment">//JPEG (jpg)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;2e524d46000000120001&quot;</span>, <span class="string">&quot;rmvb&quot;</span>); <span class="comment">//rmvb/rm相同</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;464c5601050000000900&quot;</span>, <span class="string">&quot;flv&quot;</span>); <span class="comment">//flv与f4v相同</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;00000020667479706973&quot;</span>, <span class="string">&quot;mp4&quot;</span>);</span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;49443303000000000f76&quot;</span>, <span class="string">&quot;mp3&quot;</span>);</span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;000001ba210001000180&quot;</span>, <span class="string">&quot;mpg&quot;</span>); <span class="comment">//</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;3026b2758e66cf11a6d9&quot;</span>, <span class="string">&quot;wmv&quot;</span>); <span class="comment">//wmv与asf相同</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;524946464694c9015741&quot;</span>, <span class="string">&quot;wav&quot;</span>); <span class="comment">//Wave (wav)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;52494646d07d60074156&quot;</span>, <span class="string">&quot;avi&quot;</span>);</span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;4d546864000000060001&quot;</span>, <span class="string">&quot;mid&quot;</span>); <span class="comment">//MIDI (mid)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;504b0304140000000800&quot;</span>, <span class="string">&quot;zip&quot;</span>);</span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;526172211a0700cf9073&quot;</span>, <span class="string">&quot;rar&quot;</span>);</span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;235468697320636f6e66&quot;</span>, <span class="string">&quot;ini&quot;</span>);</span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;504b03040a0000000000&quot;</span>, <span class="string">&quot;jar&quot;</span>);</span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;4d5a9000030000000400&quot;</span>, <span class="string">&quot;exe&quot;</span>);<span class="comment">//可执行文件</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;3c25402070616765206c&quot;</span>, <span class="string">&quot;jsp&quot;</span>);<span class="comment">//jsp文件</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;4d616e69666573742d56&quot;</span>, <span class="string">&quot;mf&quot;</span>);<span class="comment">//MF文件</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;3c3f786d6c2076657273&quot;</span>, <span class="string">&quot;xml&quot;</span>);<span class="comment">//xml文件</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;efbbbf2f2a0d0a53514c&quot;</span>, <span class="string">&quot;sql&quot;</span>);<span class="comment">//xml文件</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;7061636b616765207765&quot;</span>, <span class="string">&quot;java&quot;</span>);<span class="comment">//java文件</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;406563686f206f66660d&quot;</span>, <span class="string">&quot;bat&quot;</span>);<span class="comment">//bat文件</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;1f8b0800000000000000&quot;</span>, <span class="string">&quot;gz&quot;</span>);<span class="comment">//gz文件</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;6c6f67346a2e726f6f74&quot;</span>, <span class="string">&quot;properties&quot;</span>);<span class="comment">//bat文件</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;cafebabe0000002e0041&quot;</span>, <span class="string">&quot;class&quot;</span>);<span class="comment">//bat文件</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;49545346030000006000&quot;</span>, <span class="string">&quot;chm&quot;</span>);<span class="comment">//bat文件</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;04000000010000001300&quot;</span>, <span class="string">&quot;mxp&quot;</span>);<span class="comment">//bat文件</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;504b0304140006000800&quot;</span>, <span class="string">&quot;docx&quot;</span>);<span class="comment">//docx文件</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;d0cf11e0a1b11ae10000&quot;</span>, <span class="string">&quot;wps&quot;</span>);<span class="comment">//WPS文字wps、表格et、演示dps都是一样的</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;6431303a637265617465&quot;</span>, <span class="string">&quot;torrent&quot;</span>);</span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;494d4b48010100000200&quot;</span>, <span class="string">&quot;264&quot;</span>);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;6D6F6F76&quot;</span>, <span class="string">&quot;mov&quot;</span>); <span class="comment">//Quicktime (mov)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;FF575043&quot;</span>, <span class="string">&quot;wpd&quot;</span>); <span class="comment">//WordPerfect (wpd)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;CFAD12FEC5FD746F&quot;</span>, <span class="string">&quot;dbx&quot;</span>); <span class="comment">//Outlook Express (dbx)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;2142444E&quot;</span>, <span class="string">&quot;pst&quot;</span>); <span class="comment">//Outlook (pst)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;AC9EBD8F&quot;</span>, <span class="string">&quot;qdf&quot;</span>); <span class="comment">//Quicken (qdf)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;E3828596&quot;</span>, <span class="string">&quot;pwl&quot;</span>); <span class="comment">//Windows Password (pwl)</span></span><br><span class="line">        FILE_TYPE_MAP.put(<span class="string">&quot;2E7261FD&quot;</span>, <span class="string">&quot;ram&quot;</span>); <span class="comment">//Real Audio (ram)</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>常用软件环境配置</title>
    <url>/2020/05/31/tools/%E5%B8%B8%E7%94%A8%E8%BD%AF%E4%BB%B6%E7%8E%AF%E5%A2%83%E9%85%8D%E7%BD%AE/</url>
    <content><![CDATA[<hr>
<h1 id="Jdk"><a href="#Jdk" class="headerlink" title="Jdk"></a>Jdk</h1><h2 id="下载"><a href="#下载" class="headerlink" title="下载"></a><a href="https://www.oracle.com/technetwork/java/javase/downloads/index.html">下载</a></h2><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">JAVA_HOME</span><br><span class="line"><span class="function">D:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">Java</span>\<span class="title">jdk1</span>.8</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">Path</span></span></span><br><span class="line"><span class="function">;%<span class="title">JAVA_HOME</span>%\<span class="title">bin</span>;%<span class="title">JAVA_HOME</span>%\<span class="title">jre</span>\<span class="title">bin</span>; </span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">CLASSPATH</span></span></span><br><span class="line"><span class="function">.;%<span class="title">JAVA_HOME</span>%\<span class="title">lib</span>\<span class="title">dt.jar</span>;%<span class="title">JAVA_HOME</span>%\<span class="title">lib</span>\<span class="title">tools.jar</span></span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="验证"><a href="#验证" class="headerlink" title="验证"></a>验证</h2><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">java -version</span><br></pre></td></tr></table></figure>

<h1 id="Maven"><a href="#Maven" class="headerlink" title="Maven"></a>Maven</h1><h2 id="下载-1"><a href="#下载-1" class="headerlink" title="下载"></a><a href="http://maven.apache.org/download.cgi">下载</a></h2><p><img data-src="/images/javase/maven.png"><img data-src="data:image/gif;base64,R0lGODlhAQABAPABAP///wAAACH5BAEKAAAALAAAAAABAAEAAAICRAEAOw==" alt="点击并拖拽以移动"></p>
<h2 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h2><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">MAVEN_HOME</span><br><span class="line"><span class="function">G:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">Apache</span>\<span class="title">maven</span>-3.6.3</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">path</span></span></span><br><span class="line"><span class="function">%<span class="title">MAVEN_HOME</span>%\<span class="title">bin</span></span></span><br></pre></td></tr></table></figure>

<h2 id="验证-1"><a href="#验证-1" class="headerlink" title="验证"></a>验证</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mvn -version</span><br></pre></td></tr></table></figure>

<h2 id="常用配置"><a href="#常用配置" class="headerlink" title="常用配置"></a>常用配置</h2><h3 id="配置本地仓库路径"><a href="#配置本地仓库路径" class="headerlink" title="配置本地仓库路径"></a>配置本地仓库路径</h3><p>conf\settings.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">localRepository</span>&gt;</span>D:\maven-3.5.2\repository<span class="tag">&lt;/<span class="name">localRepository</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置阿里云镜像"><a href="#配置阿里云镜像" class="headerlink" title="配置阿里云镜像"></a>配置阿里云镜像</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mirror</span>&gt;</span>      </span><br><span class="line">  <span class="tag">&lt;<span class="name">id</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">id</span>&gt;</span>    </span><br><span class="line">  <span class="tag">&lt;<span class="name">name</span>&gt;</span>nexus-aliyun<span class="tag">&lt;/<span class="name">name</span>&gt;</span>  </span><br><span class="line">  <span class="tag">&lt;<span class="name">url</span>&gt;</span>http://maven.aliyun.com/nexus/content/groups/public<span class="tag">&lt;/<span class="name">url</span>&gt;</span>    </span><br><span class="line">  <span class="tag">&lt;<span class="name">mirrorOf</span>&gt;</span>central<span class="tag">&lt;/<span class="name">mirrorOf</span>&gt;</span>      </span><br><span class="line"><span class="tag">&lt;/<span class="name">mirror</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置默认jdk"><a href="#配置默认jdk" class="headerlink" title="配置默认jdk"></a>配置默认jdk</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profile</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">id</span>&gt;</span>jdk-1.8<span class="tag">&lt;/<span class="name">id</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">activation</span>&gt;</span>    </span><br><span class="line">		<span class="tag">&lt;<span class="name">activeByDefault</span>&gt;</span>true<span class="tag">&lt;/<span class="name">activeByDefault</span>&gt;</span>    </span><br><span class="line">		<span class="tag">&lt;<span class="name">jdk</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">jdk</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;/<span class="name">activation</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;<span class="name">properties</span>&gt;</span>    </span><br><span class="line">		<span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span>    </span><br><span class="line">		<span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span>    </span><br><span class="line">		<span class="tag">&lt;<span class="name">maven.compiler.compilerVersion</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.compilerVersion</span>&gt;</span>    </span><br><span class="line">	<span class="tag">&lt;/<span class="name">properties</span>&gt;</span>    </span><br><span class="line"><span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="百度快速搜索jar"><a href="#百度快速搜索jar" class="headerlink" title="百度快速搜索jar"></a>百度快速搜索jar</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mvn spring</span><br></pre></td></tr></table></figure>

<h3 id="初始化仓库jar包"><a href="#初始化仓库jar包" class="headerlink" title="初始化仓库jar包"></a>初始化仓库jar包</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mvn help:system</span><br></pre></td></tr></table></figure>

<h1 id="Tomcat"><a href="#Tomcat" class="headerlink" title="Tomcat"></a>Tomcat</h1><h2 id="下载-2"><a href="#下载-2" class="headerlink" title="下载"></a><a href="http://tomcat.apache.org/">下载</a></h2><p><img data-src="/images/javase/tomcat.png"></p>
<h2 id="配置-2"><a href="#配置-2" class="headerlink" title="配置"></a>配置</h2><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">CATALINA_HOME</span><br><span class="line"><span class="function">G:\<span class="title">Program</span> <span class="title">Files</span>\<span class="title">Apache</span>\<span class="title">tomcat</span>\<span class="title">tomcat</span>-8.5</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function"><span class="title">path</span></span></span><br><span class="line"><span class="function">%<span class="title">CATALINA_HOME</span>%\<span class="title">lib</span>;%<span class="title">CATALINA_HOME</span>%\<span class="title">bin</span></span></span><br></pre></td></tr></table></figure>

<h2 id="常用配置-1"><a href="#常用配置-1" class="headerlink" title="常用配置"></a>常用配置</h2><h3 id="启动日志乱码"><a href="#启动日志乱码" class="headerlink" title="启动日志乱码"></a>启动日志乱码</h3><p>conf\logging.properties</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">java.util.logging.ConsoleHandler.encoding</span> = <span class="string">GBK</span></span><br></pre></td></tr></table></figure>

<h3 id="IDEA启动Tomcat乱码"><a href="#IDEA启动Tomcat乱码" class="headerlink" title="IDEA启动Tomcat乱码"></a>IDEA启动Tomcat乱码</h3><blockquote>
<p>修改conf\logging.properties中的编码,UTF-8全部改为GBK</p>
</blockquote>
<h3 id="字符编码"><a href="#字符编码" class="headerlink" title="字符编码"></a>字符编码</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">Connector</span> <span class="attr">URIEncoding</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">port</span>=<span class="string">&quot;8080&quot;</span> <span class="attr">protocol</span>=<span class="string">&quot;HTTP/1.1&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">connectionTimeout</span>=<span class="string">&quot;20000&quot;</span></span></span><br><span class="line"><span class="tag">               <span class="attr">redirectPort</span>=<span class="string">&quot;8443&quot;</span> /&gt;</span></span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>视频截桢</title>
    <url>/2021/01/31/tools/%E8%A7%86%E9%A2%91%E6%88%AA%E6%A1%A2/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p><a href="https://blog.csdn.net/chokshen/article/details/89848282">参考代码</a></p>
<p>需要在页面展示视频时,截取视频中的内容作为图片进行展示</p>
<a id="more"></a>

<h1 id="第一版本"><a href="#第一版本" class="headerlink" title="第一版本"></a>第一版本</h1><h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javacv-platform<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.3.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javacv<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco.javacpp-presets<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>ffmpeg-platform<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.2-1.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.bytedeco<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>javacpp<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.5.4<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="java代码"><a href="#java代码" class="headerlink" title="java代码"></a>java代码</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.bytedeco.javacpp.opencv_core;</span><br><span class="line"><span class="keyword">import</span> org.bytedeco.javacpp.opencv_core.IplImage;</span><br><span class="line"><span class="keyword">import</span> org.bytedeco.javacv.FFmpegFrameGrabber;</span><br><span class="line"><span class="keyword">import</span> org.bytedeco.javacv.Frame;</span><br><span class="line"><span class="keyword">import</span> org.bytedeco.javacv.FrameGrabber.Exception;</span><br><span class="line"><span class="keyword">import</span> org.bytedeco.javacv.Java2DFrameConverter;</span><br><span class="line"><span class="keyword">import</span> org.bytedeco.javacv.OpenCVFrameConverter;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> javax.imageio.ImageIO;</span><br><span class="line"><span class="keyword">import</span> java.awt.image.BufferedImage;</span><br><span class="line"><span class="keyword">import</span> java.io.File;</span><br><span class="line"><span class="keyword">import</span> java.io.IOException;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Wty</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/1/31 20:28</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: //TODO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoFrameKit</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取指定视频的帧并保存为图片至指定目录</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videofile 源视频文件路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> framefile 截取帧的图片存放路径</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> Exception</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> IOException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">fetchFrame</span><span class="params">(String videofile, String framefile)</span></span></span><br><span class="line"><span class="function">            <span class="keyword">throws</span> Exception, IOException </span>&#123;</span><br><span class="line">        FFmpegFrameGrabber ff = <span class="keyword">new</span> FFmpegFrameGrabber(videofile);</span><br><span class="line">        ff.start();</span><br><span class="line">        <span class="comment">//视频的旋转角度</span></span><br><span class="line">        String rotate = ff.getVideoMetadata(<span class="string">&quot;rotate&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> lenght = ff.getLengthInFrames();</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        Frame f = <span class="keyword">null</span>;</span><br><span class="line">        <span class="keyword">while</span> (i &lt; lenght) &#123;</span><br><span class="line">            <span class="comment">// 过滤前5帧，避免出现全黑的图片，依自己情况而定</span></span><br><span class="line">            <span class="comment">//应该使用grabImage而不是grabFrame，这样可以避免mov格式的视频截图失败</span></span><br><span class="line">            f = ff.grabImage();</span><br><span class="line">            <span class="keyword">if</span> ((i &gt; <span class="number">5</span>) &amp;&amp; (f.image != <span class="keyword">null</span>)) &#123;</span><br><span class="line">                <span class="keyword">break</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            IplImage src = <span class="keyword">null</span>;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">null</span> != rotate &amp;&amp; rotate.length() &gt; <span class="number">1</span>) &#123;</span><br><span class="line">                OpenCVFrameConverter.ToIplImage converter = <span class="keyword">new</span> OpenCVFrameConverter.ToIplImage();</span><br><span class="line">                src = converter.convert(f);</span><br><span class="line">                f = converter.convert(rotate(src, Integer.valueOf(rotate)));</span><br><span class="line">            &#125;</span><br><span class="line">            doExecuteFrame(f, framefile);</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> IplImage <span class="title">rotate</span><span class="params">(IplImage src, <span class="keyword">int</span> angle)</span> </span>&#123;</span><br><span class="line">        IplImage img = IplImage.create(src.height(), src.width(), src.depth(), src.nChannels());</span><br><span class="line">        opencv_core.cvTranspose(src, img);</span><br><span class="line">        opencv_core.cvFlip(img, img, angle);</span><br><span class="line">        <span class="keyword">return</span> img;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">doExecuteFrame</span><span class="params">(Frame f, String targetFileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">null</span> == f || <span class="keyword">null</span> == f.image) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        Java2DFrameConverter converter = <span class="keyword">new</span> Java2DFrameConverter();</span><br><span class="line">        BufferedImage bi = converter.getBufferedImage(f);</span><br><span class="line">        File output = <span class="keyword">new</span> File(targetFileName);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ImageIO.write(bi, <span class="string">&quot;jpeg&quot;</span>, output);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String videofile = <span class="string">&quot;H:/1.mp4&quot;</span>;</span><br><span class="line">        <span class="comment">//framefile目标地址需要指定文件名</span></span><br><span class="line">        String framefile = <span class="string">&quot;H:/1.png&quot;</span>;</span><br><span class="line">        VideoFrameKit.fetchFrame(videofile, framefile);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="第二版本"><a href="#第二版本" class="headerlink" title="第二版本"></a>第二版本</h1><h2 id="maven-1"><a href="#maven-1" class="headerlink" title="maven"></a>maven</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.apache.logging.log4j&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.12.1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.bytedeco.javacpp-presets&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;ffmpeg-platform&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;4.0.2-1.4.3&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.bytedeco&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;javacv&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.4.3&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="java"><a href="#java" class="headerlink" title="java"></a>java</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Wty</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span> //TODO 处理视频,将视频提取成帧图片）</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>  2021/2/27</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Param</span> </span></span><br><span class="line"><span class="comment"> * <span class="doctag">@return</span> </span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">VideoClipUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 视频帧图片存储路径</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="keyword">public</span> <span class="keyword">static</span> String videoFramesPath = <span class="string">&quot;/zhiYuImage/img&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * TODO 将视频文件帧处理并以“jpg”格式进行存储。</span></span><br><span class="line"><span class="comment">     * 依赖FrameToBufferedImage方法：将frame转换为bufferedImage对象</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> videoFileName index:想取得帧下标</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> String <span class="title">grabberVideoFramer</span><span class="params">(String videoFileName, <span class="keyword">int</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//Frame对象</span></span><br><span class="line">        Frame frame = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">//截桢后存放的具体位置</span></span><br><span class="line">        String fileName = <span class="keyword">null</span>;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 获取视频文件</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        FFmpegFrameGrabber fFmpegFrameGrabber = <span class="keyword">new</span> FFmpegFrameGrabber(videoFileName);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            fFmpegFrameGrabber.start();</span><br><span class="line">            <span class="comment">/**</span></span><br><span class="line"><span class="comment">             *</span></span><br><span class="line"><span class="comment">             .getFrameRate()方法：获取视频文件信息,总帧数</span></span><br><span class="line"><span class="comment">             */</span></span><br><span class="line">            <span class="keyword">int</span> ftp = fFmpegFrameGrabber.getLengthInFrames();</span><br><span class="line">            System.out.println(<span class="string">&quot;总帧数：&quot;</span> + ftp);</span><br><span class="line">            System.out.println(<span class="string">&quot;时长 &quot;</span> + ftp / fFmpegFrameGrabber.getFrameRate() / <span class="number">60</span>);</span><br><span class="line"></span><br><span class="line">            System.out.println(<span class="string">&quot;开始运行视频提取帧，耗时较长&quot;</span>);</span><br><span class="line">            File file = <span class="keyword">new</span> File(videoFramesPath);</span><br><span class="line">            <span class="keyword">if</span> (!file.exists()) &#123;</span><br><span class="line">                file.mkdirs();</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">if</span> (index &gt; ftp) &#123;</span><br><span class="line">                index = <span class="number">0</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; ftp; i++) &#123;</span><br><span class="line">                <span class="comment">//获取帧</span></span><br><span class="line">                frame = fFmpegFrameGrabber.grabImage();</span><br><span class="line">                <span class="keyword">if</span> (i == index) &#123;</span><br><span class="line">                    <span class="comment">//文件绝对路径+名字</span></span><br><span class="line">                    fileName = videoFramesPath + <span class="string">&quot;/img_&quot;</span> + i + <span class="string">&quot;.jpg&quot;</span>;</span><br><span class="line">                    <span class="comment">//文件储存对象</span></span><br><span class="line">                    File outPut = <span class="keyword">new</span> File(fileName);</span><br><span class="line">                    <span class="keyword">if</span> (frame != <span class="keyword">null</span>) &#123;</span><br><span class="line">                        ImageIO.write(FrameToBufferedImage(frame), <span class="string">&quot;jpg&quot;</span>, outPut);</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;============运行结束============&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;本地的视频截桢存放路径:&quot;</span> + fileName);</span><br><span class="line">            fFmpegFrameGrabber.stop();</span><br><span class="line">            <span class="keyword">return</span> fileName;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException E) &#123;</span><br><span class="line">            E.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> BufferedImage <span class="title">FrameToBufferedImage</span><span class="params">(Frame frame)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//创建BufferedImage对象</span></span><br><span class="line">        Java2DFrameConverter converter = <span class="keyword">new</span> Java2DFrameConverter();</span><br><span class="line">        BufferedImage bufferedImage = converter.getBufferedImage(frame);</span><br><span class="line">        <span class="keyword">return</span> bufferedImage;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 测试</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> args</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//视频截桢</span></span><br><span class="line">        String videoFileName = <span class="string">&quot;D:/computer/user/桌面/测试视频/7.70MB.mp4&quot;</span>;</span><br><span class="line">        String framer = grabberVideoFramer(videoFileName, <span class="number">1</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//删除本地的视频截桢</span></span><br><span class="line">        File file = <span class="keyword">new</span> File(framer);</span><br><span class="line">        <span class="keyword">boolean</span> delete = file.delete();</span><br><span class="line">        System.out.println(<span class="string">&quot;删除了本地的视频截桢:&quot;</span> + delete);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
        <tag>java</tag>
      </tags>
  </entry>
  <entry>
    <title>MybatisPlus逆向</title>
    <url>/2020/08/22/mybatis/mybatis-plus%E9%80%86%E5%90%91/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p><a href="https://baomidou.com/guide/generator.html">官方网址</a></p>
<p><a href="https://www.bilibili.com/video/av97733494?p=16">狂神说地址</a></p>
<p><a href="https://www.bilibili.com/video/av27212529?p=57">尚硅谷视频</a></p>
<a id="more"></a>

<h1 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h1><p>头部文件</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">java.version</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">java.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-plus.version</span>&gt;</span>3.4.1<span class="tag">&lt;/<span class="name">mybatis-plus.version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mp_gen.version</span>&gt;</span>3.3.2<span class="tag">&lt;/<span class="name">mp_gen.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>maven包</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--spring以及springboot系列--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mybatis_plus--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mybatis-plus.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mybatisPlus逆向--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.baomidou<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-plus-generator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;mp_gen.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--模板引擎--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.velocity<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>velocity-engine-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--lombok--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--swageer-ui--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>io.springfox<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>springfox-swagger2<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--swagger-doc--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.github.xiaoymin<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>swagger-bootstrap-ui<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.8.7<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codehaus.jackson<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core-asl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!-- 数据库连接池 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.10<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.DbType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.annotation.IdType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.AutoGenerator;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.InjectionConfig;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.*;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.po.TableInfo;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.DateType;</span><br><span class="line"><span class="keyword">import</span> com.baomidou.mybatisplus.generator.config.rules.NamingStrategy;</span><br><span class="line"></span><br><span class="line"><span class="keyword">import</span> java.util.ArrayList;</span><br><span class="line"><span class="keyword">import</span> java.util.HashMap;</span><br><span class="line"><span class="keyword">import</span> java.util.List;</span><br><span class="line"><span class="keyword">import</span> java.util.Map;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Wty</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2020/11/16 14:00</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: //TODO</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CodeGenerator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 1、创建代码生成器</span></span><br><span class="line">        AutoGenerator mpg = <span class="keyword">new</span> AutoGenerator();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 2、全局配置</span></span><br><span class="line">        GlobalConfig gc = <span class="keyword">new</span> GlobalConfig();</span><br><span class="line">        <span class="comment">//当前项目路径</span></span><br><span class="line">        String projectPath = System.getProperty(<span class="string">&quot;user.dir&quot;</span>);</span><br><span class="line">        <span class="comment">//代码生成的输出目录</span></span><br><span class="line">        gc.setOutputDir(projectPath + <span class="string">&quot;/src/main/java&quot;</span>);</span><br><span class="line">        <span class="comment">//生成作者</span></span><br><span class="line">        gc.setAuthor(<span class="string">&quot;wty&quot;</span>);</span><br><span class="line">        <span class="comment">//生成后是否打开资源管理器</span></span><br><span class="line">        gc.setOpen(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//重新生成时文件是否覆盖</span></span><br><span class="line">        gc.setFileOverride(<span class="keyword">false</span>);</span><br><span class="line">        <span class="comment">//是否支持AR模式,会让实体类继承Model类</span></span><br><span class="line">        <span class="comment">//gc.setActiveRecord(true);</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">////去掉Service接口的首字母I</span></span><br><span class="line">        gc.setServiceName(<span class="string">&quot;%sService&quot;</span>);</span><br><span class="line">        <span class="comment">//设置id的默认雪花算法</span></span><br><span class="line">        gc.setIdType(IdType.ASSIGN_ID);</span><br><span class="line">        <span class="comment">//定义生成的实体类中日期类型</span></span><br><span class="line">        gc.setDateType(DateType.ONLY_DATE);</span><br><span class="line">        <span class="comment">//开启Swagger2模式</span></span><br><span class="line">        gc.setSwagger2(<span class="keyword">true</span>);</span><br><span class="line">        gc.setBaseResultMap(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">// 生成基本的sql片段</span></span><br><span class="line">        gc.setBaseColumnList(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//装配全局配置</span></span><br><span class="line">        mpg.setGlobalConfig(gc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 3、数据源配置</span></span><br><span class="line">        DataSourceConfig dsc = <span class="keyword">new</span> DataSourceConfig();</span><br><span class="line">        dsc.setUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/wty?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;allowPublicKeyRetrieval=true&amp;useSSL=false&amp;characterEncoding=utf8&quot;</span>);</span><br><span class="line">        dsc.setDriverName(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        dsc.setUsername(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dsc.setDbType(DbType.MYSQL);</span><br><span class="line">        mpg.setDataSource(dsc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 4、包配置</span></span><br><span class="line">        PackageConfig pc = <span class="keyword">new</span> PackageConfig();</span><br><span class="line">        <span class="comment">//模块名</span></span><br><span class="line">        <span class="comment">//pc.setModuleName(&quot;user&quot;);</span></span><br><span class="line">        <span class="comment">//包名的父类</span></span><br><span class="line">        pc.setParent(<span class="string">&quot;com.wty&quot;</span>);</span><br><span class="line">        <span class="comment">//其他包</span></span><br><span class="line">        pc.setController(<span class="string">&quot;controller&quot;</span>);</span><br><span class="line">        pc.setEntity(<span class="string">&quot;entity&quot;</span>);</span><br><span class="line">        pc.setService(<span class="string">&quot;service&quot;</span>);</span><br><span class="line">        pc.setMapper(<span class="string">&quot;mapper&quot;</span>);</span><br><span class="line">        mpg.setPackageInfo(pc);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//自定义xml生成目录</span></span><br><span class="line">        InjectionConfig cfg = <span class="keyword">new</span> InjectionConfig() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">initMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line">                map.put(<span class="string">&quot;abc&quot;</span>, <span class="keyword">this</span>.getConfig().getGlobalConfig().getAuthor() + <span class="string">&quot;-rb&quot;</span>);</span><br><span class="line">                <span class="keyword">this</span>.setMap(map);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">//xml生成路径</span></span><br><span class="line">        List&lt;FileOutConfig&gt; focList = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">        focList.add(<span class="keyword">new</span> FileOutConfig(<span class="string">&quot;/templates/mapper.xml.vm&quot;</span>) &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> String <span class="title">outputFile</span><span class="params">(TableInfo tableInfo)</span> </span>&#123;</span><br><span class="line">                <span class="keyword">return</span> projectPath + <span class="string">&quot;/src/main/resources/mapper/&quot;</span> + tableInfo.getEntityName() + <span class="string">&quot;Mapper.xml&quot;</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;);</span><br><span class="line">        cfg.setFileOutConfigList(focList);</span><br><span class="line">        mpg.setCfg(cfg);</span><br><span class="line">        <span class="comment">// 关闭默认 xml 生成，调整生成 至 根目录</span></span><br><span class="line">        TemplateConfig tc = <span class="keyword">new</span> TemplateConfig();</span><br><span class="line">        tc.setXml(<span class="keyword">null</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 5、策略配置</span></span><br><span class="line">        StrategyConfig strategy = <span class="keyword">new</span> StrategyConfig();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 此处可以修改为您的表前缀,同下</span></span><br><span class="line">        <span class="comment">//strategy.setTablePrefix(new String[]&#123;&quot;sys_uc&quot;&#125;);</span></span><br><span class="line">        <span class="comment">//生成实体时去掉表前缀,同上</span></span><br><span class="line">        <span class="comment">// strategy.setTablePrefix(pc.getModuleName() + &quot;_&quot;);</span></span><br><span class="line">        <span class="comment">//设置需要生成的表名,如果不写,就是全部生成</span></span><br><span class="line">        <span class="comment">// String[] dataTable = new String[]&#123;&quot;sys_uc_user&quot;&#125;;</span></span><br><span class="line">        strategy.setInclude(<span class="string">&quot;users&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//全局大写命名</span></span><br><span class="line">        strategy.setCapitalMode(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//数据库表映射到实体的命名策略,包命名规则,默认下划线转驼峰命名</span></span><br><span class="line">        strategy.setNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">//数据库表字段映射到实体的命名策略,列命名规则,默认下划线转驼峰命名</span></span><br><span class="line">        strategy.setColumnNaming(NamingStrategy.underline_to_camel);</span><br><span class="line">        <span class="comment">// lombok编程的 @Accessors(chain = true) setter链式操作</span></span><br><span class="line">        strategy.setEntityLombokModel(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//开启controller的驼峰命名</span></span><br><span class="line">        strategy.setRestControllerStyle(<span class="keyword">true</span>);</span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//restful api风格控制器</span></span><br><span class="line">        strategy.setRestControllerStyle(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//url中驼峰转连字符</span></span><br><span class="line">        strategy.setControllerMappingHyphenStyle(<span class="keyword">true</span>);</span><br><span class="line">        <span class="comment">//设置逻辑删除字段的名称</span></span><br><span class="line">        <span class="comment">//strategy.setLogicDeleteFieldName(&quot;deleted&quot;);</span></span><br><span class="line">        <span class="comment">//自动填充</span></span><br><span class="line">        <span class="comment">//TableFill createTime = new TableFill(&quot;create_time&quot;, FieldFill.INSERT);</span></span><br><span class="line">        <span class="comment">//TableFill updateTime = new TableFill(&quot;update_time&quot;, FieldFill.INSERT_UPDATE);</span></span><br><span class="line">        <span class="comment">//在策略中装配自动填充</span></span><br><span class="line">        <span class="comment">//List&lt;TableFill&gt; list = new ArrayList&lt;&gt;();</span></span><br><span class="line">        <span class="comment">//list.add(createTime);</span></span><br><span class="line">        <span class="comment">//list.add(updateTime);</span></span><br><span class="line">        <span class="comment">//strategy.setTableFillList(list);</span></span><br><span class="line">        <span class="comment">//乐观锁配置</span></span><br><span class="line">        <span class="comment">//strategy.setVersionFieldName(&quot;version&quot;);</span></span><br><span class="line">        <span class="comment">//装配策略</span></span><br><span class="line">        mpg.setStrategy(strategy);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// 6、执行</span></span><br><span class="line">        mpg.execute();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h1><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#服务端口</span></span><br><span class="line"><span class="meta">server.port</span>=<span class="string">6001</span></span><br><span class="line"><span class="comment"># 数据库连接</span></span><br><span class="line"><span class="meta">spring.datasource.driver-class-name</span>=<span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line"><span class="meta">spring.datasource.url</span>=<span class="string">jdbc:mysql://127.0.0.1:3306/wty?serverTimezone=Asia/Shanghai&amp;useUnicode=true&amp;allowPublicKeyRetrieval=true&amp;useSSL=false&amp;characterEncoding=utf8</span></span><br><span class="line"><span class="meta">spring.datasource.username</span>=<span class="string">root</span></span><br><span class="line"><span class="meta">spring.datasource.password</span>=<span class="string">root</span></span><br><span class="line"><span class="comment">#执行sql时打印日志</span></span><br><span class="line"><span class="meta">logging.level.com.wty.shiro.mapper</span>=<span class="string">debug</span></span><br><span class="line"><span class="comment">#sql语句打印</span></span><br><span class="line"><span class="meta">mybatis-plus.configuration.log-impl</span>=<span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line"><span class="comment">#mapper对应的xml文件</span></span><br><span class="line"><span class="meta">mybatis-plus.mapper-locations</span>=<span class="string">classpath:mapper/*.xml</span></span><br><span class="line"><span class="comment">#开启关闭swagger</span></span><br><span class="line"><span class="meta">swagger.enable</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<h1 id="后续"><a href="#后续" class="headerlink" title="后续"></a>后续</h1><ol>
<li>需要在启动类上配置<code>@MapperScan(basePackages = &quot; &quot;)</code></li>
<li>在springboot配置文件中,配置xml位置,当自定义sql语句的时候,会用到 <code>mybatis-plus.mapper-locations=</code></li>
<li>删除src\java\mapper下面的xml文件,因为已经在resource路径下生成了一个xml文件</li>
</ol>
]]></content>
      <categories>
        <category>mybatis框架</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>阿里云OSS上传文件</title>
    <url>/2020/03/24/tools/%E9%98%BF%E9%87%8C%E4%BA%91OSS%E4%B8%8A%E4%BC%A0%E6%96%87%E4%BB%B6/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p><a href="https://help.aliyun.com/document_detail/84781.html?spm=a2c4g.11186623.2.7.705f2ebbbW4XsU#concept-84781-zh">阿里云OSS文档地址</a></p>
<h1 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;properties&gt;</span><br><span class="line">      &lt;java.version&gt;1.8&lt;&#x2F;java.version&gt;</span><br><span class="line">      &lt;swagger.version&gt;2.7.0&lt;&#x2F;swagger.version&gt;</span><br><span class="line">      &lt;aliyun-sdk-oss.version&gt;3.10.2&lt;&#x2F;aliyun-sdk-oss.version&gt;</span><br><span class="line">  &lt;&#x2F;properties&gt;</span><br><span class="line"></span><br><span class="line">  &lt;dependencies&gt;</span><br><span class="line">      &lt;!--spring web--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;!--swagger--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;springfox-swagger2&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;$&#123;swagger.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;!--swagger ui--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;springfox-swagger-ui&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;$&#123;swagger.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;com.aliyun.oss&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;aliyun-sdk-oss&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;$&#123;aliyun-sdk-oss.version&#125;&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">  &lt;&#x2F;dependencies&gt;</span><br></pre></td></tr></table></figure>

<h1 id="工具类"><a href="#工具类" class="headerlink" title="工具类"></a>工具类</h1><h2 id="swagger"><a href="#swagger" class="headerlink" title="swagger"></a>swagger</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableSwagger2</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">SwaggerConfig</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Docket <span class="title">webApiConfig</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .groupName(<span class="string">&quot;wty&quot;</span>)</span><br><span class="line">                .apiInfo(webApiInfo())</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(<span class="string">&quot;com.wty.springbootoss.controller&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">private</span> ApiInfo <span class="title">webApiInfo</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> ApiInfoBuilder()</span><br><span class="line">                .title(<span class="string">&quot;阿里云OSS文件上传&quot;</span>)</span><br><span class="line">                .description(<span class="string">&quot;使用springboot+OSS实现文件上传&quot;</span>)</span><br><span class="line">                .version(<span class="string">&quot;1.0&quot;</span>)</span><br><span class="line">                .contact(<span class="keyword">new</span> Contact(<span class="string">&quot;java&quot;</span>, <span class="string">&quot;http://www.baidu.com&quot;</span>, <span class="string">&quot;oyyo@k.com&quot;</span>))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="统一结果返回类"><a href="#统一结果返回类" class="headerlink" title="统一结果返回类"></a>统一结果返回类</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">R</span> </span>&#123;</span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;是否成功&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Boolean success;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回码&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Integer code;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回消息&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> String message;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@ApiModelProperty(value = &quot;返回数据&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Map&lt;String, Object&gt; data = <span class="keyword">new</span> HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 构造函数私有化</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="title">R</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 成功</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">ok</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(<span class="keyword">true</span>);</span><br><span class="line">        r.setCode(<span class="number">100</span>);</span><br><span class="line">        r.setMessage(<span class="string">&quot;成功&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 失败</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> R <span class="title">error</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        R r = <span class="keyword">new</span> R();</span><br><span class="line">        r.setSuccess(<span class="keyword">false</span>);</span><br><span class="line">        r.setCode(<span class="number">200</span>);</span><br><span class="line">        r.setMessage(<span class="string">&quot;失败&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> r;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">success</span><span class="params">(Boolean success)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setSuccess(success);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">message</span><span class="params">(String message)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setMessage(message);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">code</span><span class="params">(Integer code)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setCode(code);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">data</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.data.put(key, value);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">data</span><span class="params">(Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.setData(map);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="controller"><a href="#controller" class="headerlink" title="controller"></a>controller</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RestController</span></span><br><span class="line"><span class="meta">@Api(tags = &quot;OSS文件上传&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OSSController</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    OSSService ossService;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/uploadFile&quot;)</span></span><br><span class="line">    <span class="meta">@ApiOperation(&quot;头像上传实现&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> R <span class="title">updateFile</span><span class="params">(<span class="meta">@ApiParam(name = &quot;file&quot;, value = &quot;头像图片&quot;)</span>MultipartFile file)</span> </span>&#123;</span><br><span class="line">        String url = ossService.updateFile(file);</span><br><span class="line">        <span class="keyword">return</span> R.ok().data(<span class="string">&quot;url&quot;</span>, url);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="service"><a href="#service" class="headerlink" title="service"></a>service</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">OSSService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//上传文件到阿里云OSS</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">updateFile</span><span class="params">(MultipartFile file)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">// Endpoint以北京为例，其它Region请按实际情况填写。</span></span><br><span class="line">            String endpoint = <span class="string">&quot;oss-cn-beijing.aliyuncs.com&quot;</span>;</span><br><span class="line">            <span class="comment">// 云账号AccessKey有所有API访问权限，建议遵循阿里云安全最佳实践，</span></span><br><span class="line">            String accessKeyId = <span class="string">&quot;LTAI4G6LE7zfNSQ2vm4fT345&quot;</span>;</span><br><span class="line">            String accessKeySecret = <span class="string">&quot;fc6H4YexH5mGCQOk5WbSqa6LjYWxeN&quot;</span>;</span><br><span class="line">            String bucketName = <span class="string">&quot;edu-guli-wty&quot;</span>;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 创建OSSClient实例</span></span><br><span class="line">            OSS ossClient = <span class="keyword">new</span> OSSClientBuilder().build(endpoint, accessKeyId, accessKeySecret);</span><br><span class="line"></span><br><span class="line">            <span class="comment">//获取文件的名字</span></span><br><span class="line">            String fileName = file.getOriginalFilename();</span><br><span class="line">            <span class="comment">//文件上传后,同名文件会覆盖,通过添加一个uuid来避免</span></span><br><span class="line">            String uuid = UUID.randomUUID().toString().replaceAll(<span class="string">&quot;-&quot;</span>, <span class="string">&quot;&quot;</span>);</span><br><span class="line">            fileName = uuid + fileName;</span><br><span class="line">            <span class="comment">//对上传的文件进行分类,eg: 2020/2/2/01.png</span></span><br><span class="line">            <span class="comment">//用了jdk8的日期类</span></span><br><span class="line">            DateTimeFormatter formatter = DateTimeFormatter.ofPattern(<span class="string">&quot;yyyy/MM/dd&quot;</span>);</span><br><span class="line">            String datePath = LocalDate.now().format(formatter);</span><br><span class="line">            <span class="comment">//拼接</span></span><br><span class="line">            fileName = datePath + <span class="string">&quot;/&quot;</span> + fileName;</span><br><span class="line"></span><br><span class="line">            <span class="comment">// 上传文件流。</span></span><br><span class="line">            InputStream inputStream = file.getInputStream();</span><br><span class="line">            ossClient.putObject(bucketName, fileName, inputStream);</span><br><span class="line"></span><br><span class="line">            ossClient.shutdown();</span><br><span class="line"></span><br><span class="line">            <span class="comment">//https://edu-guli-wty.oss-cn-beijing.aliyuncs.com/abcdefg1.jpeg</span></span><br><span class="line">            <span class="comment">//拼接url地址</span></span><br><span class="line">            String url = <span class="string">&quot;https://&quot;</span> + bucketName + <span class="string">&quot;.&quot;</span> + endpoint + <span class="string">&quot;/&quot;</span> + fileName;</span><br><span class="line">            <span class="keyword">return</span> url;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="swagger测试"><a href="#swagger测试" class="headerlink" title="swagger测试"></a>swagger测试</h1><p>地址:<a href="http://localhost:8080/swagger-ui.html">http://localhost:8080/swagger-ui.html</a></p>
]]></content>
      <categories>
        <category>工具</category>
      </categories>
      <tags>
        <tag>工具</tag>
      </tags>
  </entry>
  <entry>
    <title>mybatis逆向生成</title>
    <url>/2020/06/04/mybatis/mybatis%E9%80%86%E5%90%91/</url>
    <content><![CDATA[<h1 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h1><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.5.3&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;8.0.18&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis.generator&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-generator-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.4.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h1 id="xml"><a href="#xml" class="headerlink" title="xml"></a>xml</h1><p>xml文件命名为MBG.xml,放置在项目根目录下</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;UTF-8&#x27;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;mybatisGenerator&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 是否去除自动生成的注释 true：是 ： false:否 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--数据库连接的信息：驱动类、连接地址、用户名、密码 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/wty?rewriteBatchedStatements=true<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=utf8<span class="symbol">&amp;amp;</span>serverTimezone=UTC&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 默认false，把JDBC DECIMAL 和 NUMERIC 类型解析为 Integer，为 true时把JDBC DECIMAL 和</span></span><br><span class="line"><span class="comment">            NUMERIC 类型解析为java.math.BigDecimal --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- targetProject:生成javabean类的位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.wty.mybatis.bean&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\java&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- enableSubPackages:是否让schema作为包的后缀 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 从数据库返回的值被清理前后的空格 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- targetProject:mapper映射文件生成的位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;mybatis\mapper&quot;</span></span></span><br><span class="line"><span class="tag">                         <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\resources&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- enableSubPackages:是否让schema作为包的后缀 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- targetPackage：mapper接口生成的位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span></span></span><br><span class="line"><span class="tag">                             <span class="attr">targetPackage</span>=<span class="string">&quot;com.wty.mybatis.dao&quot;</span></span></span><br><span class="line"><span class="tag">                             <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\java&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- enableSubPackages:是否让schema作为包的后缀 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 指定数据库表 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;books&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Books&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="javaTest"><a href="#javaTest" class="headerlink" title="javaTest"></a>javaTest</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        List&lt;String&gt; warnings = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">        <span class="keyword">boolean</span> overwrite = <span class="keyword">true</span>;</span><br><span class="line">        File configFile = <span class="keyword">new</span> File(<span class="string">&quot;MBG.xml&quot;</span>);</span><br><span class="line">        ConfigurationParser cp = <span class="keyword">new</span> ConfigurationParser(warnings);</span><br><span class="line">        Configuration config = cp.parseConfiguration(configFile);</span><br><span class="line">        DefaultShellCallback callback = <span class="keyword">new</span> DefaultShellCallback(overwrite);</span><br><span class="line">        MyBatisGenerator myBatisGenerator = <span class="keyword">new</span> MyBatisGenerator(config, callback, warnings);</span><br><span class="line">        myBatisGenerator.generate(<span class="keyword">null</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="生成文件说明"><a href="#生成文件说明" class="headerlink" title="生成文件说明"></a>生成文件说明</h1><p><a href="https://blog.csdn.net/weixin_39789689/article/details/81566080">csdn博客</a></p>
<h1 id="实例"><a href="#实例" class="headerlink" title="实例"></a>实例</h1><h2 id="maper"><a href="#maper" class="headerlink" title="maper"></a>maper</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">BooksMapper</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">long</span> <span class="title">countByExample</span><span class="params">(BooksExample example)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteByExample</span><span class="params">(BooksExample example)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">deleteByPrimaryKey</span><span class="params">(Integer bookid)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insert</span><span class="params">(Books record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">insertSelective</span><span class="params">(Books record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">List&lt;Books&gt; <span class="title">selectByExample</span><span class="params">(BooksExample example)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function">Books <span class="title">selectByPrimaryKey</span><span class="params">(Integer bookid)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByExampleSelective</span><span class="params">(<span class="meta">@Param(&quot;record&quot;)</span> Books record, <span class="meta">@Param(&quot;example&quot;)</span> BooksExample example)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByExample</span><span class="params">(<span class="meta">@Param(&quot;record&quot;)</span> Books record, <span class="meta">@Param(&quot;example&quot;)</span> BooksExample example)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKeySelective</span><span class="params">(Books record)</span></span>;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">int</span> <span class="title">updateByPrimaryKey</span><span class="params">(Books record)</span></span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">public class BooksMapperTest &#123;</span><br><span class="line">    public SqlSessionFactory getSqlSessionFactory() throws IOException &#123;</span><br><span class="line">        String resource &#x3D; &quot;mybatis-config.xml&quot;;</span><br><span class="line">        InputStream inputStream &#x3D; Resources.getResourceAsStream(resource);</span><br><span class="line">        return new SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void test() &#123;</span><br><span class="line">        SqlSession sqlSession &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactory factory &#x3D; getSqlSessionFactory();</span><br><span class="line">            sqlSession &#x3D; factory.openSession(true);</span><br><span class="line">            BooksMapper mapper &#x3D; sqlSession.getMapper(BooksMapper.class);</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void countByExample() &#123;</span><br><span class="line">        SqlSession sqlSession &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactory factory &#x3D; getSqlSessionFactory();</span><br><span class="line">            sqlSession &#x3D; factory.openSession(true);</span><br><span class="line">            BooksMapper mapper &#x3D; sqlSession.getMapper(BooksMapper.class);</span><br><span class="line">            BooksExample booksExample &#x3D; new BooksExample();</span><br><span class="line">            BooksExample.Criteria criteria &#x3D; booksExample.createCriteria();</span><br><span class="line">            criteria.andBooknameEqualTo(&quot;水浒传&quot;);</span><br><span class="line">            long l &#x3D; mapper.countByExample(booksExample);</span><br><span class="line">            System.out.println(l);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void deleteByExample() &#123;</span><br><span class="line">        SqlSession sqlSession &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactory factory &#x3D; getSqlSessionFactory();</span><br><span class="line">            sqlSession &#x3D; factory.openSession(true);</span><br><span class="line">            BooksMapper mapper &#x3D; sqlSession.getMapper(BooksMapper.class);</span><br><span class="line">            BooksExample booksExample &#x3D; new BooksExample();</span><br><span class="line">            BooksExample.Criteria criteria &#x3D; booksExample.createCriteria();</span><br><span class="line">            criteria.andBooknameEqualTo(&quot;红楼梦&quot;);</span><br><span class="line">            int i &#x3D; mapper.deleteByExample(booksExample);</span><br><span class="line">            if (i &gt; 0) &#123;</span><br><span class="line">                System.out.println(&quot;删除成功&quot;);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; catch (</span><br><span class="line">                IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void deleteByPrimaryKey() &#123;</span><br><span class="line">        SqlSession sqlSession &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactory factory &#x3D; getSqlSessionFactory();</span><br><span class="line">            sqlSession &#x3D; factory.openSession(true);</span><br><span class="line">            BooksMapper mapper &#x3D; sqlSession.getMapper(BooksMapper.class);</span><br><span class="line">            mapper.deleteByPrimaryKey(1);</span><br><span class="line"></span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void insert() &#123;</span><br><span class="line">        SqlSession sqlSession &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactory factory &#x3D; getSqlSessionFactory();</span><br><span class="line">            sqlSession &#x3D; factory.openSession(true);</span><br><span class="line">            BooksMapper mapper &#x3D; sqlSession.getMapper(BooksMapper.class);</span><br><span class="line">            Books books &#x3D; new Books(null, &quot;道君&quot;, 20, &quot;江湖仙侠&quot;);</span><br><span class="line">            mapper.insert(books);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void insertSelective() &#123;</span><br><span class="line">        SqlSession sqlSession &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactory factory &#x3D; getSqlSessionFactory();</span><br><span class="line">            sqlSession &#x3D; factory.openSession(true);</span><br><span class="line">            BooksMapper mapper &#x3D; sqlSession.getMapper(BooksMapper.class);</span><br><span class="line">            Books books &#x3D; new Books();</span><br><span class="line">            books.setBookname(&quot;我的超级异能&quot;);</span><br><span class="line">            books.setBookid(null);</span><br><span class="line">            mapper.insertSelective(books);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void selectByExample() &#123;</span><br><span class="line">        SqlSession sqlSession &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactory factory &#x3D; getSqlSessionFactory();</span><br><span class="line">            sqlSession &#x3D; factory.openSession(true);</span><br><span class="line">            BooksMapper mapper &#x3D; sqlSession.getMapper(BooksMapper.class);</span><br><span class="line">            List&lt;Books&gt; books &#x3D; mapper.selectByExample(null);</span><br><span class="line">            for (Books book : books) &#123;</span><br><span class="line">                System.out.println(book);</span><br><span class="line">            &#125;</span><br><span class="line"></span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void selectByPrimaryKey() &#123;</span><br><span class="line">        SqlSession sqlSession &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactory factory &#x3D; getSqlSessionFactory();</span><br><span class="line">            sqlSession &#x3D; factory.openSession(true);</span><br><span class="line">            BooksMapper mapper &#x3D; sqlSession.getMapper(BooksMapper.class);</span><br><span class="line"></span><br><span class="line">            Books books &#x3D; mapper.selectByPrimaryKey(2);</span><br><span class="line">            System.out.println(books);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void updateByExampleSelective() &#123;</span><br><span class="line">        SqlSession sqlSession &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactory factory &#x3D; getSqlSessionFactory();</span><br><span class="line">            sqlSession &#x3D; factory.openSession(true);</span><br><span class="line">            BooksMapper mapper &#x3D; sqlSession.getMapper(BooksMapper.class);</span><br><span class="line">            Books books &#x3D; new Books();</span><br><span class="line">            books.setBookname(&quot;梵高的晚餐&quot;);</span><br><span class="line">            BooksExample booksExample &#x3D; new BooksExample();</span><br><span class="line">            BooksExample.Criteria criteria &#x3D; booksExample.createCriteria();</span><br><span class="line">            criteria.andBookidEqualTo(3);</span><br><span class="line">            mapper.updateByExampleSelective(books, booksExample);</span><br><span class="line"></span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void updateByExample() &#123;</span><br><span class="line">        SqlSession sqlSession &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactory factory &#x3D; getSqlSessionFactory();</span><br><span class="line">            sqlSession &#x3D; factory.openSession(true);</span><br><span class="line">            BooksMapper mapper &#x3D; sqlSession.getMapper(BooksMapper.class);</span><br><span class="line">            Books books &#x3D; new Books();</span><br><span class="line">            &#x2F;&#x2F;以下是默认属性,id不能为空</span><br><span class="line">            books.setBookid(5);</span><br><span class="line">            books.setBookname(&quot;水浒传&quot;);</span><br><span class="line">            books.setBookcounts(20);</span><br><span class="line">            &#x2F;&#x2F;修改描述</span><br><span class="line">            books.setDetail(&quot;农民起义&quot;);</span><br><span class="line">            BooksExample booksExample &#x3D; new BooksExample();</span><br><span class="line">            BooksExample.Criteria criteria &#x3D; booksExample.createCriteria();</span><br><span class="line">            criteria.andBookidEqualTo(5);</span><br><span class="line">            mapper.updateByExample(books, booksExample);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void updateByPrimaryKeySelective() &#123;</span><br><span class="line">        SqlSession sqlSession &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactory factory &#x3D; getSqlSessionFactory();</span><br><span class="line">            sqlSession &#x3D; factory.openSession(true);</span><br><span class="line">            BooksMapper mapper &#x3D; sqlSession.getMapper(BooksMapper.class);</span><br><span class="line">            Books books &#x3D; new Books(3, &quot;西游记&quot;, 30, &quot;神魔&quot;);</span><br><span class="line">            mapper.updateByPrimaryKeySelective(books);</span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    @Test</span><br><span class="line">    public void updateByPrimaryKey() &#123;</span><br><span class="line">        SqlSession sqlSession &#x3D; null;</span><br><span class="line">        try &#123;</span><br><span class="line">            SqlSessionFactory factory &#x3D; getSqlSessionFactory();</span><br><span class="line">            sqlSession &#x3D; factory.openSession(true);</span><br><span class="line">            BooksMapper mapper &#x3D; sqlSession.getMapper(BooksMapper.class);</span><br><span class="line">            Books books &#x3D; new Books(2, &quot;红楼梦&quot;, 30, &quot;晚清小说&quot;);</span><br><span class="line">            mapper.updateByPrimaryKeySelective(books);</span><br><span class="line"></span><br><span class="line">        &#125; catch (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; finally &#123;</span><br><span class="line">            sqlSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>mybatis框架</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>mybatis</title>
    <url>/2020/06/03/mybatis/mybatis/</url>
    <content><![CDATA[<h1 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h1><h2 id="创建数据库表"><a href="#创建数据库表" class="headerlink" title="创建数据库表"></a>创建数据库表</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`employee`</span>;</span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`employee`</span>  (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">int</span>(<span class="number">0</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">  <span class="string">`lastName`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`email`</span> <span class="built_in">varchar</span>(<span class="number">255</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`gender`</span> <span class="built_in">int</span>(<span class="number">0</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  <span class="string">`d_id`</span> <span class="built_in">int</span>(<span class="number">0</span>) <span class="literal">NULL</span> <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">  PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>) <span class="keyword">USING</span> BTREE</span><br><span class="line">) <span class="keyword">ENGINE</span> = <span class="keyword">InnoDB</span> AUTO_INCREMENT = <span class="number">7</span> <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> = utf8 <span class="keyword">COLLATE</span> = utf8_general_ci ROW_FORMAT = Dynamic;</span><br><span class="line"><span class="keyword">SET</span> FOREIGN_KEY_CHECKS = <span class="number">1</span>;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.mybatis&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.5.3&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;8.0.19&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;log4j&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;log4j&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.2.12&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.18.8&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;build&gt;</span><br><span class="line">    &lt;resources&gt;</span><br><span class="line">        &lt;resource&gt;</span><br><span class="line">            &lt;directory&gt;src&#x2F;main&#x2F;java&lt;&#x2F;directory&gt;</span><br><span class="line">            &lt;includes&gt;</span><br><span class="line">                &lt;include&gt;**&#x2F;*.xml&lt;&#x2F;include&gt;</span><br><span class="line">                &lt;include&gt;**&#x2F;*.properties&lt;&#x2F;include&gt;</span><br><span class="line">            &lt;&#x2F;includes&gt;</span><br><span class="line">        &lt;&#x2F;resource&gt;</span><br><span class="line">        &lt;resource&gt;</span><br><span class="line">            &lt;directory&gt;src&#x2F;main&#x2F;resources&lt;&#x2F;directory&gt;</span><br><span class="line">            &lt;includes&gt;</span><br><span class="line">                &lt;include&gt;**&#x2F;*.xml&lt;&#x2F;include&gt;</span><br><span class="line">                &lt;include&gt;**&#x2F;*.properties&lt;&#x2F;include&gt;</span><br><span class="line">            &lt;&#x2F;includes&gt;</span><br><span class="line">        &lt;&#x2F;resource&gt;</span><br><span class="line">    &lt;&#x2F;resources&gt;</span><br><span class="line">&lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<h2 id="javaBean"><a href="#javaBean" class="headerlink" title="javaBean"></a>javaBean</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String lastName;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="keyword">private</span> Integer gender;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="mybatisConfig-xml"><a href="#mybatisConfig-xml" class="headerlink" title="mybatisConfig.xml"></a>mybatisConfig.xml</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">environments</span> <span class="attr">default</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">environment</span> <span class="attr">id</span>=<span class="string">&quot;development&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">transactionManager</span> <span class="attr">type</span>=<span class="string">&quot;JDBC&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dataSource</span> <span class="attr">type</span>=<span class="string">&quot;POOLED&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driver&quot;</span> <span class="attr">value</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/wty?serverTimezone=UTC&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;root&quot;</span>/&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dataSource</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">environment</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">environments</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mappers</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;EmployeeMapper.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mappers</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="EmployeeMapper-xml"><a href="#EmployeeMapper-xml" class="headerlink" title="EmployeeMapper.xml"></a>EmployeeMapper.xml</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span> &gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com.wty.mybatis.mapper.EmployeeMapper&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wty.mybatis.bean.Employee&quot;</span>&gt;</span></span><br><span class="line">        select * from employee</span><br><span class="line">  <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestMyBatis</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">        String resource = <span class="string">&quot;mybatisConfig.xml&quot;</span>;</span><br><span class="line">        InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">        SqlSessionFactory sqlSessionFactory = <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//设置为true,在增删改的时候会自动提交</span></span><br><span class="line">        SqlSession openSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            EmployeeMapper mapper = openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">            List&lt;Employee&gt; all = mapper.getAll();</span><br><span class="line">            <span class="keyword">for</span> (Employee employee : all) &#123;</span><br><span class="line">                System.out.println(employee);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            openSession.close();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="mybatis全局配置"><a href="#mybatis全局配置" class="headerlink" title="mybatis全局配置"></a>mybatis全局配置</h1><h2 id="文档地址"><a href="#文档地址" class="headerlink" title="文档地址"></a>文档地址</h2><p><a href="https://mybatis.org/mybatis-3/zh/configuration.html">中文文档</a></p>
<h2 id="配置全览"><a href="#配置全览" class="headerlink" title="配置全览"></a>配置全览</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">configuration（配置）</span><br><span class="line">properties（属性）</span><br><span class="line">settings（设置）</span><br><span class="line">typeAliases（类型别名）</span><br><span class="line">typeHandlers（类型处理器）</span><br><span class="line">objectFactory（对象工厂）</span><br><span class="line">plugins（插件）</span><br><span class="line">environments（环境配置）</span><br><span class="line">environment（环境变量）</span><br><span class="line">transactionManager（事务管理器）</span><br><span class="line">dataSource（数据源）</span><br><span class="line">databaseIdProvider（数据库厂商标识）</span><br><span class="line">mappers（映射器）</span><br></pre></td></tr></table></figure>

<h2 id="常用设置"><a href="#常用设置" class="headerlink" title="常用设置"></a><strong>常用设置</strong></h2><h3 id="设置-settings"><a href="#设置-settings" class="headerlink" title="设置 (settings)"></a><strong>设置 (settings)</strong></h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;!--驼峰命名--&gt;</span><br><span class="line">&lt;setting name&#x3D;&quot;mapUnderscoreToCamelCase&quot; value&#x3D;&quot;true&quot;&#x2F;&gt;</span><br><span class="line">&lt;!--当插入sql时,数据为空,为了防止数据库比如oracle无法处理null值</span><br><span class="line">值可以是 NULL, VARCHAR 或 OTHER,默认是OTHER--&gt;</span><br><span class="line">&lt;setting name&#x3D;&quot;jdbcTypeForNull&quot; value&#x3D;&quot;NULL&quot;&#x2F;&gt;</span><br><span class="line">&lt;!--延迟加载全局开关--&gt;</span><br><span class="line">&lt;setting name&#x3D;&quot;lazyLoadingEnabled&quot; value&#x3D;&quot;true&quot;&#x2F;&gt;</span><br><span class="line">&lt;!--当开启时，任何方法的调用都会加载该对象的所有属性。 否则，每个属性会按需加载--&gt;</span><br><span class="line">&lt;setting name&#x3D;&quot;aggressiveLazyLoading&quot; value&#x3D;&quot;false&quot;&#x2F;&gt;</span><br><span class="line">&lt;!--缓存 默认true--&gt;</span><br><span class="line">&lt;setting name&#x3D;&quot;cacheEnabled&quot; value&#x3D;&quot;true&quot;&#x2F;&gt;</span><br></pre></td></tr></table></figure>

<h3 id="别名处理器（typeAliases）"><a href="#别名处理器（typeAliases）" class="headerlink" title="别名处理器（typeAliases）"></a><strong>别名处理器（typeAliases）</strong></h3><h4 id="说明"><a href="#说明" class="headerlink" title="说明"></a><strong>说明</strong></h4><blockquote>
<p>在mapper.xml文件中,resultType的返回类型名称可以只用别名,需要用到别名处理器, 别名不区分大小写</p>
</blockquote>
<h4 id="单独配置javaBean"><a href="#单独配置javaBean" class="headerlink" title="单独配置javaBean"></a>单独配置javaBean</h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">typeAlias</span> <span class="attr">alias</span>=<span class="string">&quot;Emp&quot;</span> <span class="attr">type</span>=<span class="string">&quot;com.wty.mybatis.bean.Employee&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="配置包扫描的别名"><a href="#配置包扫描的别名" class="headerlink" title="配置包扫描的别名"></a><strong>配置包扫描的别名</strong></h4><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeAliases</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">package</span> <span class="attr">name</span>=<span class="string">&quot;com.wty.mybatis.bean&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeAliases</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="注解别名"><a href="#注解别名" class="headerlink" title="注解别名"></a><strong>注解别名</strong></h4><blockquote>
<p>必须要在配置包扫描的情况下使用</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Alias(&quot;author&quot;) </span><br><span class="line">public class Author &#123;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="mappers（映射器）"><a href="#mappers（映射器）" class="headerlink" title="mappers（映射器）"></a><strong>mappers（映射器）</strong></h3><h4 id="mapper"><a href="#mapper" class="headerlink" title="mapper"></a><strong>mapper</strong></h4><h5 id="resource"><a href="#resource" class="headerlink" title="resource"></a><strong>resource</strong></h5><blockquote>
<p>类路径,用/表示路径</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">resource</span>=<span class="string">&quot;mapper/BooksMapper.xml&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h5 id="url"><a href="#url" class="headerlink" title="url"></a><strong>url</strong></h5><blockquote>
<p>磁盘路径或者网络路径</p>
</blockquote>
<h5 id="class"><a href="#class" class="headerlink" title="class"></a><strong>class</strong></h5><blockquote>
<p> class:接口扫描配置,以下二选一</p>
<p>​        1.接口和sql映射Mapper文件在同一个目录下,并且名称一样</p>
<p>​        2.用class注册接口,不用写mapper文件,直接在接口方法是添加注解</p>
<p>​             @Select()  @Insert()等</p>
</blockquote>
<h4 id="package"><a href="#package" class="headerlink" title="package"></a><strong>package</strong></h4><blockquote>
<p>package:包扫描配置,以下二选一</p>
<p>​        1.接口和sql映射Mapper文件在同一个目录下,并且名称一样</p>
<p>​        2.直接在接口方法是添加注解 @Select() @Insert()等</p>
</blockquote>
<h1 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h1><h2 id="返回类型"><a href="#返回类型" class="headerlink" title="返回类型"></a>返回类型</h2><h3 id="图示"><a href="#图示" class="headerlink" title="图示"></a>图示</h3><p><img data-src="/images/framework/mybatis-1.png"></p>
<blockquote>
<p>mybatis允许返回值类型为 void \Long\ Boolean \Integer等</p>
</blockquote>
<h3 id="list类型"><a href="#list类型" class="headerlink" title="list类型"></a>list类型</h3><blockquote>
<p>对于List,返回类型为集合中元素的类型，list元素是Employee,所以返回类型是Employee</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> List&lt;Employee&gt; <span class="title">getEmp</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="code"><pre><span class="line"> &lt;select id=<span class="string">&quot;getEmp&quot;</span> resultType=<span class="string">&quot;Employee&quot;</span>&gt;</span><br><span class="line">      select * from employee where id =#&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h3 id="map类型"><a href="#map类型" class="headerlink" title="map类型"></a>map类型</h3><blockquote>
<p>mybatis已经对Map进行了处理，返回类型写map就可以</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Map&lt;String,Object&gt; <span class="title">getEmp</span><span class="params">(Integer id)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight"><table><tr><td class="code"><pre><span class="line">&lt;select id=<span class="string">&quot;getEmp&quot;</span> resultType=<span class="string">&quot;map&quot;</span>&gt;</span><br><span class="line">      select * from employee where id =#&#123;id&#125;</span><br><span class="line">&lt;/select&gt;</span><br></pre></td></tr></table></figure>

<h2 id="获取自增主键"><a href="#获取自增主键" class="headerlink" title="获取自增主键"></a>获取自增主键</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">insert</span> <span class="attr">id</span>=<span class="string">&quot;addEmp&quot;</span> <span class="attr">useGeneratedKeys</span>=<span class="string">&quot;true&quot;</span> <span class="attr">keyProperty</span>=<span class="string">&quot;id&quot;</span>&gt;</span></span><br><span class="line">     insert into employee values (null,#&#123;lastName&#125;,#&#123;gender&#125;,#&#123;email&#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">insert</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>设置useGeneratedKeys=”true” 获取到自增主键</p>
<p>keyProperty=”id” , 把获取到的主键给了jvaBean的某个属性</p>
</blockquote>
<h2 id="参数处理"><a href="#参数处理" class="headerlink" title="参数处理"></a>参数处理</h2><h3 id="单个参数"><a href="#单个参数" class="headerlink" title="单个参数"></a>单个参数</h3><blockquote>
<p>不做处理,#{}内容随便写,但是不建议</p>
</blockquote>
<h3 id="多个参数"><a href="#多个参数" class="headerlink" title="多个参数"></a>多个参数</h3><ol>
<li>封装POJO对象</li>
</ol>
<blockquote>
<p>如果在接口中传入的值太多，而且每个值都是POJO的属性，就可以直接存放一个pojo对象，</p>
<p>在获取的的时候实例化pojo对象并赋值</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpByIdAndLastName</span><span class="params">(Employee employee)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> <span class="keyword">id</span> =<span class="comment">#&#123;id&#125; and last_name=#&#123;lastName&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">EmployeeMapper mapper = openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">Employee emp = <span class="keyword">new</span> Employee();</span><br><span class="line">emp.setId(<span class="number">1006</span>);</span><br><span class="line">emp.setLastName(<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">Employee employee = mapper.getEmpByIdAndLastName(emp);</span><br><span class="line">System.out.println(employee);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>指定取值名称</li>
</ol>
<ul>
<li><p>@Param明确指定取值的名称</p>
</li>
<li><p>取多个值的时候,根据@Param规定的名称取值</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpByIdAndLastName</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span> Integer id,<span class="meta">@Param(&quot;lastName&quot;)</span> String lastName)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> <span class="keyword">id</span> =<span class="comment">#&#123;id&#125; and last_name=#&#123;lastName&#125;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>Map存取值</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpByIdAndLastName</span><span class="params">(Map&lt;String,Object&gt;map)</span></span>;</span><br></pre></td></tr></table></figure>

<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> <span class="keyword">id</span> =<span class="comment">#&#123;id&#125; and last_name=#&#123;lastName&#125;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">EmployeeMapper mapper = openSession.getMapper(EmployeeMapper.class);</span><br><span class="line">Map map=<span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">map.put(<span class="string">&quot;id&quot;</span>,<span class="number">1006</span>);</span><br><span class="line">map.put(<span class="string">&quot;lastName&quot;</span>,<span class="string">&quot;Tom&quot;</span>);</span><br><span class="line">Employee empByIdAndLastName = mapper.getEmpByIdAndLastName(map);</span><br><span class="line">System.out.println(empByIdAndLastName);</span><br></pre></td></tr></table></figure>

<h3 id="思考"><a href="#思考" class="headerlink" title="思考"></a>思考</h3><figure class="highlight"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmp</span><span class="params">(<span class="meta">@Param(&quot;id&quot;)</span>Integer id,String lastName)</span></span>;</span><br><span class="line">	取值：id==&gt;#&#123;id/param1&#125;   lastName==&gt;#&#123;param2&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmp</span><span class="params">(Integer id,<span class="meta">@Param(&quot;e&quot;)</span>Employee emp)</span></span>;</span><br><span class="line">	取值：id==&gt;#&#123;param1&#125;    lastName===&gt;#&#123;param2.lastName/e.lastName&#125;</span><br><span class="line"></span><br><span class="line">##特别注意：如果是Collection（List、Set）类型或者是数组，</span><br><span class="line">		 也会特殊处理。也是把传入的list或者数组封装在map中。</span><br><span class="line">			key：Collection（collection）,如果是List还可以使用这个key(list)</span><br><span class="line">				数组(array)</span><br><span class="line"><span class="function"><span class="keyword">public</span> Employee <span class="title">getEmpById</span><span class="params">(List&lt;Integer&gt; ids)</span></span>;</span><br><span class="line">	取值：取出第一个id的值：   #&#123;list[0]&#125;</span><br></pre></td></tr></table></figure>

<h2 id="和-区别"><a href="#和-区别" class="headerlink" title="#{}和${}区别"></a>#{}和${}区别</h2><blockquote>
<p>#{}:常规取值，会在sql语句中形成占位符’?’,不会涉及安全问题</p>
<p>${}:动态获取，但是会在sql语句中明文出现获取的值</p>
</blockquote>
<p>举例：动态获取表名</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> $&#123;tbleName&#125; <span class="keyword">where</span> <span class="keyword">id</span> =<span class="comment">#&#123;id&#125; and last_name=#&#123;lastName&#125;</span></span><br></pre></td></tr></table></figure>

<h2 id="赋值空值处理"><a href="#赋值空值处理" class="headerlink" title="#{}赋值空值处理"></a>#{}赋值空值处理</h2><p>举例:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span> <span class="keyword">id</span> =<span class="comment">#&#123;id&#125; and last_name=#&#123;lastName&#125;</span></span><br></pre></td></tr></table></figure>

<p>如果在java代码中，没有给id赋值</p>
<ol>
<li><p>mysql，空值会直接插入,不会报错.</p>
</li>
<li><p>oracle,不识别null，会报错，处理方法如下，二选一</p>
</li>
</ol>
<p>A. 添加jdbcType=NULL</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> employee <span class="keyword">where</span></span><br><span class="line"> <span class="keyword">id</span> =<span class="comment">#&#123;id,jdbcType=NULL&#125; </span></span><br><span class="line"> <span class="keyword">and</span> last_name=<span class="comment">#&#123;lastName&#125;</span></span><br></pre></td></tr></table></figure>

<p>B. 全局配置文件设置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--当插入sql时,数据为空,为了防止数据库比如oracle无法处理null值,值可以是 NULL, VARCHAR 或 OTHER,默认是OTHER--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;jdbcTypeForNull&quot;</span> <span class="attr">value</span>=<span class="string">&quot;NULL&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="resultMap-amp-延迟加载"><a href="#resultMap-amp-延迟加载" class="headerlink" title="resultMap &amp; 延迟加载"></a>resultMap &amp; 延迟加载</h1><h2 id="resultMap特别说明"><a href="#resultMap特别说明" class="headerlink" title="resultMap特别说明"></a>resultMap特别说明</h2><blockquote>
<p>使用resultMap之前,关闭全局配置文件中的驼峰命名,取消注解@Alias()</p>
</blockquote>
<h2 id="单个查询"><a href="#单个查询" class="headerlink" title="单个查询"></a>单个查询</h2><p>使用association,定义对象,分为两步:<strong>分步查询 和 延迟加载</strong></p>
<ol>
<li>分步查询</li>
</ol>
<p>举例:根据id查出员工信息,然后根据查出的员工信息找到部门id,再根据部门id查出部门信息</p>
<p>在mapper文件中:</p>
<blockquote>
<p>员工查询:SELECT * from employee WHERE id=1009;//查到的部门id是2</p>
<p>部门查询: SELECT * from department WHERE id=2;</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">resultMap</span> <span class="attr">id</span>=<span class="string">&quot;Bystep&quot;</span> <span class="attr">type</span>=<span class="string">&quot;Employee&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;id&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">column</span>=<span class="string">&quot;g&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">association</span> <span class="attr">property</span>=<span class="string">&quot;department&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">select</span>=<span class="string">&quot;com.wty.mybatis.mapper.DepartmentMapper.getDept&quot;</span></span></span><br><span class="line"><span class="tag">                 <span class="attr">column</span>=<span class="string">&quot;dept_id&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">resultMap</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;getEmpWithDeptBystep&quot;</span> <span class="attr">resultMap</span>=<span class="string">&quot;Bystep&quot;</span>&gt;</span></span><br><span class="line">    SELECT * from employee WHERE id=#&#123;id&#125;;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>延迟加载</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--延迟加载全局开关--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;lazyLoadingEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="comment">&lt;!--当开启时，任何方法的调用都会加载该对象的所有属性。 否则，每个属性会按需加载--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;aggressiveLazyLoading&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="多个查询"><a href="#多个查询" class="headerlink" title="多个查询"></a>多个查询</h2><p>使用<code>&lt;collection&gt;</code>标签定义</p>
<p>Department</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Department</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> Integer id;</span><br><span class="line">    <span class="keyword">private</span> String departmentName;</span><br><span class="line">    <span class="keyword">private</span> List&lt;Employee&gt; employeeList;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>DepartmentMapper</p>
<blockquote>
<p>property指定javaBean的集合,oftype指定javaBean类型</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">collection</span> <span class="attr">property</span>=<span class="string">&quot;employeeList&quot;</span> <span class="attr">ofType</span>=<span class="string">&quot;Employee&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">id</span> <span class="attr">property</span>=<span class="string">&quot;id&quot;</span> <span class="attr">column</span>=<span class="string">&quot;eid&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;lastName&quot;</span> <span class="attr">column</span>=<span class="string">&quot;last_name&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;gender&quot;</span> <span class="attr">column</span>=<span class="string">&quot;gender&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">result</span> <span class="attr">property</span>=<span class="string">&quot;email&quot;</span> <span class="attr">column</span>=<span class="string">&quot;email&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">collection</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h1><ol>
<li>开启缓存</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">settings</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--缓存 默认true--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">setting</span> <span class="attr">name</span>=<span class="string">&quot;cacheEnabled&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">settings</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>javaBean实体类需要实现<code>Serializable</code>接口</li>
<li>Mapper.xml中namespace配置中开启缓存配置</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;mapper namespace&#x3D;&quot;com.wty.mybatis.mapper.EmployeeMapperPlus&quot; &gt;</span><br><span class="line">        &lt;!--开启缓存--&gt;</span><br><span class="line">        &lt;cache&#x2F;&gt;</span><br><span class="line">&lt;&#x2F;mapper&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">eviction:缓存的回收策略：</span><br><span class="line">    • LRU – 最近最少使用的：移除最长时间不被使用的对象。</span><br><span class="line">    • FIFO – 先进先出：按对象进入缓存的顺序来移除它们。</span><br><span class="line">    • SOFT – 软引用：移除基于垃圾回收器状态和软引用规则的对象。</span><br><span class="line">    • WEAK – 弱引用：更积极地移除基于垃圾收集器状态和弱引用规则的对象。</span><br><span class="line">    • 默认的是 LRU。</span><br><span class="line">    </span><br><span class="line">flushInterval：缓存刷新间隔</span><br><span class="line">	缓存多长时间清空一次，默认不清空，设置一个毫秒值</span><br><span class="line">	</span><br><span class="line">readOnly:是否只读：</span><br><span class="line">	true：只读；mybatis认为所有从缓存中获取数据的操作都是只读操作，不会修改数据。</span><br><span class="line">		mybatis为了加快获取速度，直接就会将数据在缓存中的引用交给用户。不安全，速度快</span><br><span class="line">	false：非只读：mybatis觉得获取的数据可能会被修改。</span><br><span class="line">		mybatis会利用序列化&amp;反序列的技术克隆一份新的数据给你。安全，速度慢</span><br><span class="line">		</span><br><span class="line">size：缓存存放多少元素；</span><br><span class="line"></span><br><span class="line">type=&quot;&quot;：指定自定义缓存的全类名；</span><br><span class="line">	实现Cache接口即可；</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>mybatis框架</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>PageHelper分页</title>
    <url>/2020/06/05/mybatis/pagehelper/</url>
    <content><![CDATA[<h1 id="mybatis分页"><a href="#mybatis分页" class="headerlink" title="mybatis分页"></a>mybatis分页</h1><h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.pagehelper&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;pagehelper&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;5.0.0&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"> &lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.github.jsqlparser&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jsqlparser&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;1.1&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="xml配置"><a href="#xml配置" class="headerlink" title="xml配置"></a>xml配置</h2><p>在mybatis-config中配置</p>
<blockquote>
<p>xml文件顺序<br>   xml文件顺序<br>   configuration（配置）<br>   properties（属性）<br>   settings（设置）<br>   typeAliases（类型别名）<br>   typeHandlers（类型处理器）<br>   objectFactory（对象工厂）<br>   plugins（插件）</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--分页参数合理化  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;reasonable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="文档说明"><a href="#文档说明" class="headerlink" title="文档说明"></a>文档说明</h2><p><a href="https://github.com/pagehelper/Mybatis-PageHelper/blob/master/wikis/zh/HowToUse.md">官网文档说明</a></p>
<h2 id="简洁说明"><a href="#简洁说明" class="headerlink" title="简洁说明"></a>简洁说明</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;&#x2F;获取第1页，10条内容，默认查询总数count</span><br><span class="line">PageHelper.startPage(1, 10);</span><br><span class="line">List&lt;Employee&gt; employeeList &#x3D; employeeService.getAll();</span><br><span class="line">&#x2F;&#x2F;用PageInfo对结果进行包装</span><br><span class="line">PageInfo page &#x3D; new PageInfo(employeeList,5);</span><br><span class="line">&#x2F;&#x2F;测试PageInfo全部属性</span><br><span class="line">&#x2F;&#x2F;PageInfo包含了非常全面的分页属性</span><br><span class="line">assertEquals(1, page.getPageNum());</span><br><span class="line">assertEquals(10, page.getPageSize());</span><br><span class="line">assertEquals(1, page.getStartRow());</span><br><span class="line">assertEquals(10, page.getEndRow());</span><br><span class="line">assertEquals(183, page.getTotal());</span><br><span class="line">assertEquals(19, page.getPages());</span><br><span class="line">assertEquals(1, page.getFirstPage());</span><br><span class="line">assertEquals(8, page.getLastPage());</span><br><span class="line">assertEquals(true, page.isFirstPage());</span><br><span class="line">assertEquals(false, page.isLastPage());</span><br><span class="line">assertEquals(false, page.isHasPreviousPage());</span><br><span class="line">assertEquals(true, page.isHasNextPage());</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">page.getPageNum();</span><br><span class="line">page.getPageSize();</span><br><span class="line">page.getStartRow();</span><br><span class="line">page.getEndRow();</span><br><span class="line">page.getTotal();</span><br><span class="line">page.getPages();</span><br><span class="line">page.getFirstPage();</span><br><span class="line">page.getLastPage();</span><br><span class="line">page.isHasPreviousPage();</span><br><span class="line">page.isHasNextPage();</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> SqlSessionFactory <span class="title">getSqlSessionFactory</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    String resource = <span class="string">&quot;mybatis-config.xml&quot;</span>;</span><br><span class="line">    InputStream inputStream = Resources.getResourceAsStream(resource);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SqlSessionFactoryBuilder().build(inputStream);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testEmployee</span><span class="params">()</span> <span class="keyword">throws</span> IOException </span>&#123;</span><br><span class="line">    SqlSessionFactory sqlSessionFactory = getSqlSessionFactory();</span><br><span class="line">    SqlSession sqlSession = sqlSessionFactory.openSession(<span class="keyword">true</span>);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        EmployeeMapper mapper = sqlSession.getMapper(EmployeeMapper.class);</span><br><span class="line">        <span class="comment">//获取第1页，10条内容，默认查询总数count</span></span><br><span class="line">        PageHelper.startPage(<span class="number">1</span>, <span class="number">10</span>);</span><br><span class="line">        List&lt;Employee&gt; employees = mapper.selectByExample(<span class="keyword">null</span>);</span><br><span class="line">        <span class="comment">//用PageInfo对结果进行包装</span></span><br><span class="line">        PageInfo page = <span class="keyword">new</span> PageInfo(employees, <span class="number">5</span>);</span><br><span class="line">        <span class="comment">//分页导航 1 2 3 4 5 页</span></span><br><span class="line">        <span class="keyword">int</span>[] nums = page.getNavigatepageNums();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> num : nums) &#123;</span><br><span class="line">            System.out.println(num);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        sqlSession.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>























]]></content>
      <categories>
        <category>mybatis框架</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>MyBatisPlus条件查询例子</title>
    <url>/2020/10/13/mybatis/mybatisplus%E6%9D%A1%E4%BB%B6%E6%9F%A5%E8%AF%A2%E4%BE%8B%E5%AD%90/</url>
    <content><![CDATA[<h1 id="文档地址"><a href="#文档地址" class="headerlink" title="文档地址"></a>文档地址</h1><p><a href="https://www.imooc.com/video/19499">慕课网视频</a></p>
<p><a href="https://baomidou.com/guide/wrapper.html#abstractwrapper">官网</a></p>
<a id="more"></a>

<h1 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WrapperTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line">    <span class="comment">//创建查询条件</span></span><br><span class="line">    QueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 1.名字中包含雨并且年龄小于40</span></span><br><span class="line"><span class="comment">     * name like &#x27;%雨%&#x27; and age&lt;40</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">tet1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//拼装条件</span></span><br><span class="line">        wrapper.lt(<span class="string">&quot;age&quot;</span>, <span class="number">40</span>).like(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;雨&quot;</span>);</span><br><span class="line">        List&lt;User&gt; userList = userMapper.selectList(wrapper);</span><br><span class="line">        userList.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 2.名字中包含雨年并且龄大于等于20且小于等于40并且email不为空</span></span><br><span class="line"><span class="comment">     * name like &#x27;%雨%&#x27; and age between 20 and 40 and email is not null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        wrapper.like(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;雨&quot;</span>).between(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>, <span class="number">40</span>).isNotNull(<span class="string">&quot;email&quot;</span>);</span><br><span class="line">        userMapper.selectList(wrapper).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 3.名字为王姓或者年龄大于等于25，按照年龄降序排列，年龄相同按照id升序排列</span></span><br><span class="line"><span class="comment">     * name like &#x27;王%&#x27; or age&gt;=25 order by age desc,id asc</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        wrapper.likeRight(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;王&quot;</span>).or().ge(<span class="string">&quot;age&quot;</span>, <span class="number">25</span>)</span><br><span class="line">            .orderByDesc(<span class="string">&quot;age&quot;</span>).orderByAsc(<span class="string">&quot;id&quot;</span>);</span><br><span class="line">        userMapper.selectList(wrapper).forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 4、创建日期为2019年2月14日并且直属上级名字为王姓</span></span><br><span class="line"><span class="comment">     * date_format(create_time,&#x27;%Y-%m-%d&#x27;)=&#x27;2019-02-14&#x27; and</span></span><br><span class="line"><span class="comment">     * manager_id in (select id from user where name like &#x27;王%&#x27;)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test4</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        wrapper.apply(<span class="string">&quot;date_format(create_time,&#x27;%Y-%m-%d&#x27;)= &#123;0&#125;&quot;</span>, <span class="string">&quot;2019-02-14&quot;</span>)</span><br><span class="line">                .inSql(<span class="string">&quot;manager_id&quot;</span>, <span class="string">&quot;select id from user where name like &#x27;王%&#x27;&quot;</span>);</span><br><span class="line">        userMapper.selectList(wrapper).forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 5、名字为王姓并且（年龄小于40或邮箱不为空）</span></span><br><span class="line"><span class="comment">     * name like &#x27;王%&#x27; and (age&lt;40 or email is not null)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test5</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        wrapper.likeRight(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;王&quot;</span>).and(wq -&gt; wq.lt(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;40&quot;</span>)</span><br><span class="line">                                           .isNotNull(<span class="string">&quot;email&quot;</span>));</span><br><span class="line">        userMapper.selectList(wrapper).forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 6、名字为王姓或者（年龄小于40并且年龄大于20并且邮箱不为空）</span></span><br><span class="line"><span class="comment">     * name like &#x27;王%&#x27; or (age&lt;40 and age&gt;20 and email is not null)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test6</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        wrapper.likeRight(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;王&quot;</span>)</span><br><span class="line">                .or(qw -&gt; qw.lt(<span class="string">&quot;age&quot;</span>, <span class="number">40</span>).gt(<span class="string">&quot;age&quot;</span>, <span class="number">20</span>).isNotNull(<span class="string">&quot;email&quot;</span>));</span><br><span class="line">        userMapper.selectList(wrapper).forEach(System.out::println);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 7、（年龄小于40或邮箱不为空）并且名字为王姓</span></span><br><span class="line"><span class="comment">     * (age&lt;40 or email is not null) and name like &#x27;王%&#x27;</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test7</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        wrapper.nested(i -&gt; i.lt(<span class="string">&quot;age&quot;</span>, <span class="number">40</span>).or().isNotNull(<span class="string">&quot;email&quot;</span>))</span><br><span class="line">            .likeRight(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;王&quot;</span>);</span><br><span class="line">        userMapper.selectList(wrapper).forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 8、年龄为30、31、34、35</span></span><br><span class="line"><span class="comment">     * age in (30、31、34、35)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test8</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        wrapper.in(<span class="string">&quot;age&quot;</span>, Arrays.asList(<span class="number">30</span>, <span class="number">31</span>, <span class="number">34</span>, <span class="number">35</span>));</span><br><span class="line">        userMapper.selectList(wrapper).forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 9、只返回满足条件的其中一条语句即可</span></span><br><span class="line"><span class="comment">     * limit 1</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test9</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        wrapper.in(<span class="string">&quot;age&quot;</span>, Arrays.asList(<span class="number">30</span>, <span class="number">32</span>, <span class="number">31</span>, <span class="number">34</span>, <span class="number">35</span>)).last(<span class="string">&quot;limit 1&quot;</span>);</span><br><span class="line">        userMapper.selectList(wrapper).forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>mybatis框架</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>通用Mapper</title>
    <url>/2020/11/12/mybatis/%E9%80%9A%E7%94%A8Mapper/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><p><a href="https://mapperhelper.github.io/docs/">通用Mapper官网</a></p>
<p><a href="https://www.bilibili.com/video/BV1yW411M7m1?p=1">尚硅谷</a></p>
<a id="more"></a>

<h1 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h1><h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>tk.mybatis<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mapper<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.5<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="测试sql"><a href="#测试sql" class="headerlink" title="测试sql"></a>测试sql</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">CREATE TABLE &#96;tabple_emp&#96; (</span><br><span class="line">  &#96;emp_id&#96; int NOT NULL AUTO_INCREMENT,</span><br><span class="line">  &#96;emp_name&#96; varchar(500) DEFAULT NULL,</span><br><span class="line">  &#96;emp_salary&#96; double(15,5) DEFAULT NULL,</span><br><span class="line">  &#96;emp_age&#96; int DEFAULT NULL,</span><br><span class="line">  PRIMARY KEY (&#96;emp_id&#96;)</span><br><span class="line">) ENGINE&#x3D;InnoDB AUTO_INCREMENT&#x3D;6 DEFAULT CHARSET&#x3D;utf8mb4 COLLATE&#x3D;utf8mb4_0900_ai_ci;</span><br><span class="line"></span><br><span class="line">INSERT INTO &#96;tabple_emp&#96; (&#96;emp_name&#96;, &#96;emp_salary&#96;, &#96;emp_age&#96;) VALUES (&#39;tom&#39;, &#39;1254.37&#39;, &#39;27&#39;);</span><br><span class="line">INSERT INTO &#96;tabple_emp&#96; (&#96;emp_name&#96;, &#96;emp_salary&#96;, &#96;emp_age&#96;) VALUES (&#39;jerry&#39;, &#39;6635.42&#39;, &#39;38&#39;);</span><br><span class="line">INSERT INTO &#96;tabple_emp&#96; (&#96;emp_name&#96;, &#96;emp_salary&#96;, &#96;emp_age&#96;) VALUES (&#39;bob&#39;, &#39;5560.11&#39;, &#39;40&#39;);</span><br><span class="line">INSERT INTO &#96;tabple_emp&#96; (&#96;emp_name&#96;, &#96;emp_salary&#96;, &#96;emp_age&#96;) VALUES (&#39;kate&#39;, &#39;2209.11&#39;, &#39;22&#39;);</span><br><span class="line">INSERT INTO &#96;tabple_emp&#96; (&#96;emp_name&#96;, &#96;emp_salary&#96;, &#96;emp_age&#96;) VALUES (&#39;justin&#39;, &#39;4203.15&#39;, &#39;30&#39;);</span><br></pre></td></tr></table></figure>

<h2 id="sql语句打印"><a href="#sql语句打印" class="headerlink" title="sql语句打印"></a>sql语句打印</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># sql语句</span></span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="string">com.wty.mapper2.mapper.*:</span> <span class="string">debug</span> </span><br></pre></td></tr></table></figure>

<h2 id="通用Mapper"><a href="#通用Mapper" class="headerlink" title="通用Mapper"></a>通用Mapper</h2><p>mapper类继承<code>Mapper&lt;T&gt;</code>类即可,例如下面的接口</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">EmployeeMapper</span> <span class="keyword">extends</span> <span class="title">Mapper</span>&lt;<span class="title">Employee</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="启动类注解"><a href="#启动类注解" class="headerlink" title="启动类注解"></a>启动类注解</h2><p>在启动类上添加mapper的包扫描,需要添加的是<code>tk.mybatis.spring.annotation.MapperScan</code>,</p>
<p>而不是<code>org.mybatis.spring.annotation.MapperScan</code>,</p>
<p>不然报错<code>tk.mybatis.mapper.MapperException:无法获取实体类com.wty.tk_mapper.bean.Employee对应的表名!</code></p>
<h1 id="方法"><a href="#方法" class="headerlink" title="方法"></a>方法</h1><h2 id="XXXXPrimaryKey"><a href="#XXXXPrimaryKey" class="headerlink" title="XXXXPrimaryKey"></a>XXXXPrimaryKey</h2><p>此方法传入一个id时,查询的结果为<code>NULL</code>,</p>
<p>sql语句是<code>SELECT emp_id,emp_name,emp_salary,emp_age FROM tabple_emp WHERE emp_id = ? AND emp_name = ? AND emp_salary = ? AND emp_age = ?</code></p>
<p>原因分两种情况 </p>
<ol>
<li>没有使用@Id 注解明确指定主键字段,sql语句把所有字段都当成了主键,所以每个都执行</li>
<li>使用@Id 主键明确标记和数据库表中主键字段对应的实体类字段。</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Id</span></span><br><span class="line"><span class="keyword">private</span> Integer empId;</span><br></pre></td></tr></table></figure>

<h2 id="existsWithPrimaryKey"><a href="#existsWithPrimaryKey" class="headerlink" title="existsWithPrimaryKey"></a>existsWithPrimaryKey</h2><p>如果需要判断一个用户名是否存在,可以在name属性上添加<code>@Id</code>注解,把name当成主键来测试</p>
<p>但是有违主键策略,慎用</p>
<h2 id="insert-获取自增主键"><a href="#insert-获取自增主键" class="headerlink" title="insert 获取自增主键"></a>insert 获取自增主键</h2><ol>
<li>在主键上添加注解<code>@GeneratedValue(strategy= GenerationType.IDENTITY)</code>并配置相应的策略</li>
<li>在添加数据时,通过get方法即可获取,eg:<code>e.getEmpId()</code></li>
</ol>
<h2 id="insertSelective"><a href="#insertSelective" class="headerlink" title="insertSelective"></a>insertSelective</h2><p>非主键的字段为null时,不插入sql语句中</p>
<h2 id="updateByPrimaryKeySelective"><a href="#updateByPrimaryKeySelective" class="headerlink" title="updateByPrimaryKeySelective"></a>updateByPrimaryKeySelective</h2><p>传入的参数为null时,不修改原有数据</p>
<h1 id="QBC条件查询"><a href="#QBC条件查询" class="headerlink" title="QBC条件查询"></a>QBC条件查询</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p>Query By Criteria<br>Criteria 是 Criterion 的复数形式。意思是：规则、标准、准则。在 SQL 语句中相当于查询条件。<br>QBC 查询是将查询条件通过 Java 对象进行模块化封装。</p>
<h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//实例化example</span></span><br><span class="line">Example example = <span class="keyword">new</span> Example(Employee.class);</span><br><span class="line"><span class="comment">//创建条件</span></span><br><span class="line">Example.Criteria c1 = example.createCriteria();</span><br><span class="line"></span><br><span class="line"><span class="comment">//拼装and条件,可以连缀</span></span><br><span class="line">c1.andGreaterThan(<span class="string">&quot;empSalaryApply&quot;</span>,<span class="number">3000</span>);</span><br><span class="line">     </span><br><span class="line"><span class="comment">//拼装or条件,只能使用example对象</span></span><br><span class="line">example.or();</span><br></pre></td></tr></table></figure>

<h2 id="其他设置"><a href="#其他设置" class="headerlink" title="其他设置"></a>其他设置</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//i.设置排序信息</span></span><br><span class="line">example.orderBy(<span class="string">&quot;empSalary&quot;</span>).asc().orderBy(<span class="string">&quot;empAge&quot;</span>).desc();</span><br><span class="line"><span class="comment">//ii.设置“去重”</span></span><br><span class="line">example.setDistinct(<span class="keyword">true</span>);</span><br><span class="line"><span class="comment">//iii.设置 select 字段</span></span><br><span class="line">example.selectProperties(<span class="string">&quot;empName&quot;</span>,<span class="string">&quot;empSalary&quot;</span>);</span><br></pre></td></tr></table></figure>









<h1 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h1><p>注解都在<code>javax.persistence</code>包下</p>
<h2 id="Table"><a href="#Table" class="headerlink" title="@Table"></a>@Table</h2><p>当数据库表与实体类名称不一致时,用此注解绑定两个的数据</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Table(name = &quot;tabple_emp&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Employee</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Column"><a href="#Column" class="headerlink" title="@Column"></a>@Column</h2><p>在数据表名称和实体类名称不一致时,用于绑定两个数据</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Column(name = &quot;emp_salary&quot;)</span></span><br><span class="line"><span class="keyword">private</span> Double empSalaryApply; <span class="comment">//emp_salary</span></span><br></pre></td></tr></table></figure>

<h2 id="Id"><a href="#Id" class="headerlink" title="@Id"></a>@Id</h2><p>使用@Id 主键明确标记和数据库表中主键字段对应的实体类字段。直接在实体类属性上添加注解</p>
<h2 id="GeneratedValue"><a href="#GeneratedValue" class="headerlink" title="@GeneratedValue"></a>@GeneratedValue</h2><p>让通用 Mapper 在执行 insert 操作之后将数据库自动生成的主键值回写到实体类对象中。</p>
<p>应用场景：购物车结账</p>
<ul>
<li>增加商品销量…</li>
<li>减少商品库存…</li>
<li>生成订单数据→封装到 Order 对象中→保存 Order 对象→数据库自动生成主键值→回写到实体类对象 Order 中</li>
<li>生成一系列订单详情数据→List<OrderItem>→在每一个 OrderItem 中设置Order 对象的主键值作为外键→批量保存 List<OrderItem></li>
</ul>
<h2 id="Transient-主键"><a href="#Transient-主键" class="headerlink" title="@Transient 主键"></a>@Transient 主键</h2><p>用于标记不与数据库表字段对应的实体类字段</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 非数据库字段</span></span><br><span class="line"><span class="meta">@Transient</span></span><br><span class="line"><span class="keyword">private</span> String empAddress;</span><br></pre></td></tr></table></figure>

<h1 id="二级缓存"><a href="#二级缓存" class="headerlink" title="二级缓存"></a>二级缓存</h1><p>实现步骤</p>
<ol>
<li>开启缓存   <code>mybatis.configuration.cache-enabled=true</code></li>
<li>在mapper上添加注解 <code>@CacheNamespace</code></li>
<li>实体类实现<code>Serializable</code>接口</li>
<li>测试,对同一个查询语句进行两次查询,出现0.5即表示缓存成功,eg: <code>Cache Hit Ratio [com.wty.mapper2.mapper.EmployeeMapper]: 0.5</code></li>
</ol>
<h1 id="复杂类型"><a href="#复杂类型" class="headerlink" title="复杂类型"></a>复杂类型</h1><h2 id="情况概述"><a href="#情况概述" class="headerlink" title="情况概述"></a>情况概述</h2><p>简单类型和复杂类型</p>
<table>
<thead>
<tr>
<th>基本数据类型</th>
<th>byte short int long double float char boolean</th>
</tr>
</thead>
<tbody><tr>
<td>引用数据类型</td>
<td>类、接口、数组、枚举……</td>
</tr>
<tr>
<td>简单类型</td>
<td>只有一个值的类型</td>
</tr>
<tr>
<td>复杂类型</td>
<td>有多个值的类型</td>
</tr>
</tbody></table>
<p>这就是一个简单类型加复杂类型</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Id</span></span><br><span class="line">    <span class="keyword">private</span> Integer userId;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> String userName;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> Address address;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> SeasonEnum season;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>当通过id查询一个用户时,查询结果是 <code>User(userId=1, userName=小米, address=null, season=null)</code></p>
<p>说明<code>通用 Mapper 默认情况下会忽略复杂类型，对复杂类型不进行“从类到表”的映射</code>。</p>
<h2 id="Address实体类"><a href="#Address实体类" class="headerlink" title="Address实体类"></a>Address实体类</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p>使用类型转换机制,进行数据的绑定</p>
<p>转换分为两种</p>
<ol>
<li><code>Address实体类-&gt;TypeHandler-&gt;字符串</code></li>
<li><code>字符串-&gt;TypeHandler-&gt;Address实体类</code></li>
</ol>
<p><code>TypeHandler</code>是一个顶级接口,它有一个实现类<code>BaseTypeHandler</code>,自定义转换器实现<code>BaseTypeHandler</code>即可</p>
<p><code>BaseTypeHandler</code>有三个方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//在这个方法中将 parameter 转换为字符串</span></span><br><span class="line"><span class="comment">//对应的是 Address实体类-&gt;TypeHandler-&gt;字符串</span></span><br><span class="line"><span class="function"><span class="keyword">void</span> <span class="title">setParameter</span><span class="params">(PreparedStatement ps, <span class="keyword">int</span> i, T parameter, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">//根据列名从 ResultSet 中获取数据，通常是字符串形式</span></span><br><span class="line"><span class="comment">//将字符串还原为 Java 对象，以 T 类型返回</span></span><br><span class="line"><span class="comment">//对应的是  字符串-&gt;TypeHandler-&gt;Address实体类</span></span><br><span class="line"><span class="function">T <span class="title">getResult</span><span class="params">(ResultSet rs, String columnName)</span> <span class="keyword">throws</span> SQLException</span>; <span class="comment">//通过字段名来读库并转换为T类型</span></span><br><span class="line"><span class="function">T <span class="title">getResult</span><span class="params">(ResultSet rs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException</span>; <span class="comment">//通过字段索引来读库并转换为T类型</span></span><br><span class="line"><span class="function">T <span class="title">getResult</span><span class="params">(CallableStatement cs, <span class="keyword">int</span> columnIndex)</span> <span class="keyword">throws</span> SQLException</span>; <span class="comment">//调用存储过程来获取结果并转换为T类型。</span></span><br></pre></td></tr></table></figure>

<h3 id="解决办法"><a href="#解决办法" class="headerlink" title="解决办法"></a>解决办法</h3><ol>
<li>实现<code>BaseTypeHandler</code>抽象类,并实现四个方法</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AddressTypeHandler</span> <span class="keyword">extends</span> <span class="title">BaseTypeHandler</span>&lt;<span class="title">Address</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setNonNullParameter</span><span class="params">(PreparedStatement preparedStatement, <span class="keyword">int</span> i, Address address, JdbcType jdbcType)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//如果传过来的address对象为空,setNonNullParameter方法不用执行,直接跳过</span></span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (address == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//从实体对象中获取数据</span></span><br><span class="line">        String provice = address.getProvice();</span><br><span class="line">        String city = address.getCity();</span><br><span class="line">        String street = address.getStreet();</span><br><span class="line">        <span class="comment">// 拼装成一个字符串</span></span><br><span class="line">        <span class="comment">// 拼装规则 使用 &quot;,&quot;分割</span></span><br><span class="line">        StringBuilder builder = <span class="keyword">new</span> StringBuilder();</span><br><span class="line">        builder.append(provice).append(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">                .append(city).append(<span class="string">&quot;,&quot;</span>)</span><br><span class="line">                .append(street);</span><br><span class="line">        String perametar = builder.toString();</span><br><span class="line">        <span class="comment">//设置参数</span></span><br><span class="line">        preparedStatement.setString(i, perametar);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Address <span class="title">getNullableResult</span><span class="params">(ResultSet resultSet, String s)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//根据字段名从resultSet对象中获取字段值</span></span><br><span class="line">        String columnValue = resultSet.getString(s);</span><br><span class="line">        <span class="comment">//判断字段值是否有效,主要是判断是否符合制定的规则,即是否带&quot;,&quot;,注意取反 &quot;!columnValue.contains(&quot;,&quot;)&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (columnValue == <span class="keyword">null</span> || columnValue.length() == <span class="number">0</span> || !columnValue.contains(<span class="string">&quot;,&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据&quot;,&quot;对columnValue进行拆分</span></span><br><span class="line">        String[] split = columnValue.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="comment">//获取具体值</span></span><br><span class="line">        String provice = split[<span class="number">0</span>];</span><br><span class="line">        String city = split[<span class="number">1</span>];</span><br><span class="line">        String street = split[<span class="number">2</span>];</span><br><span class="line">        <span class="comment">// 拼装成对象</span></span><br><span class="line">        Address address = <span class="keyword">new</span> Address(provice, city, street);</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Address <span class="title">getNullableResult</span><span class="params">(ResultSet resultSet, <span class="keyword">int</span> i)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//根据字段名从resultSet对象中获取字段值</span></span><br><span class="line">        String columnValue = resultSet.getString(i);</span><br><span class="line">        <span class="comment">//判断字段值是否有效,主要是判断是否符合制定的规则,即是否带&quot;,&quot;,注意取反 &quot;!columnValue.contains(&quot;,&quot;)&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (columnValue == <span class="keyword">null</span> || columnValue.length() == <span class="number">0</span> || !columnValue.contains(<span class="string">&quot;,&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据&quot;,&quot;对columnValue进行拆分</span></span><br><span class="line">        String[] split = columnValue.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="comment">//获取具体值</span></span><br><span class="line">        <span class="comment">//获取具体值</span></span><br><span class="line">        String provice = split[<span class="number">0</span>];</span><br><span class="line">        String city = split[<span class="number">1</span>];</span><br><span class="line">        String street = split[<span class="number">2</span>];</span><br><span class="line">        <span class="comment">// 拼装成对象</span></span><br><span class="line">        Address address = <span class="keyword">new</span> Address(provice, city, street);</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Address <span class="title">getNullableResult</span><span class="params">(CallableStatement callableStatement, <span class="keyword">int</span> i)</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        <span class="comment">//根据字段名从resultSet对象中获取字段值</span></span><br><span class="line">        String columnValue = callableStatement.getString(i);</span><br><span class="line">        <span class="comment">//判断字段值是否有效,主要是判断是否符合制定的规则,即是否带&quot;,&quot;,注意取反 &quot;!columnValue.contains(&quot;,&quot;)&quot;</span></span><br><span class="line">        <span class="keyword">if</span> (columnValue == <span class="keyword">null</span> || columnValue.length() == <span class="number">0</span> || !columnValue.contains(<span class="string">&quot;,&quot;</span>)) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// 根据&quot;,&quot;对columnValue进行拆分</span></span><br><span class="line">        String[] split = columnValue.split(<span class="string">&quot;,&quot;</span>);</span><br><span class="line">        <span class="comment">//获取具体值</span></span><br><span class="line">        <span class="comment">//获取具体值</span></span><br><span class="line">        String provice = split[<span class="number">0</span>];</span><br><span class="line">        String city = split[<span class="number">1</span>];</span><br><span class="line">        String street = split[<span class="number">2</span>];</span><br><span class="line">        <span class="comment">// 拼装成对象</span></span><br><span class="line">        Address address = <span class="keyword">new</span> Address(provice, city, street);</span><br><span class="line">        <span class="keyword">return</span> address;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>注册自定义类型转换器</p>
<ul>
<li>字段级别,在实体类上添加<code>@ColumnType </code>注解</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// 指定typeHandler 值为自定义的typeHandler类</span></span><br><span class="line"><span class="meta">@ColumnType(typeHandler = AddressTypeHandler.class)</span></span><br><span class="line"><span class="keyword">private</span> Address address;</span><br></pre></td></tr></table></figure>

<ul>
<li><p>全局级别 </p>
<ul>
<li>在属性上添加<code>@Column</code>注解,使其像正常的值一样</li>
<li>在mybatis的配置文件中配置typeHandler</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">typeHandlers</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">typeHandler</span> <span class="attr">handler</span>=<span class="string">&quot;com.wty.mapper2.typeUtil.AddressTypeHandler&quot;</span> <span class="attr">javaType</span>=<span class="string">&quot;com.wty.mapper2.bean.Address&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">typeHandlers</span>&gt;</span></span><br></pre></td></tr></table></figure>

</li>
</ul>
</li>
</ol>
<h2 id="SeasonEnum枚举类"><a href="#SeasonEnum枚举类" class="headerlink" title="SeasonEnum枚举类"></a>SeasonEnum枚举类</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><p><a href="https://www.bilibili.com/video/BV1yW411M7m1?p=53">尚硅谷</a></p>
<p>转换方法分为两种</p>
<ol>
<li><code>SeasonEnum枚举类-&gt;TypeHandler-&gt;字符串</code></li>
<li><code>字符串-&gt;TypeHandler-&gt;SeasonEnum枚举类</code></li>
</ol>
<p>转换器分为两种</p>
<ol>
<li><p>内置转换器</p>
<ul>
<li>class EnumTypeHandler&lt;E extends Enum<E>&gt;</li>
<li>class EnumOrdinalTypeHandler&lt;E extends Enum<E>&gt;</li>
</ul>
<ol start="2">
<li>自定义转换器</li>
</ol>
</li>
</ol>
]]></content>
      <categories>
        <category>mybatis框架</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>mysql8入门</title>
    <url>/2020/11/22/mysql/mysql8%E5%85%A5%E9%97%A8/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p><a href="https://weread.qq.com/web/reader/a0a32c3071a4953da0aef21">微信读书: MySql8 从零开始学</a></p>
<h1 id="操作数据库和数据表"><a href="#操作数据库和数据表" class="headerlink" title="操作数据库和数据表"></a>操作数据库和数据表</h1><h2 id="数据库"><a href="#数据库" class="headerlink" title="数据库"></a>数据库</h2><p>查看当前存在的数据库: <code> show databaes;</code></p>
<p>使用指定的数据库: <code>use test</code></p>
<a id="more"></a>

<p>创建数据库: <code> create database test_db</code></p>
<p>查看创建的数据库的定义: <code>show create database test_db;</code></p>
<p>删除数据库 :<code>  drop database test_db;</code></p>
<h2 id="数据表"><a href="#数据表" class="headerlink" title="数据表"></a>数据表</h2><h3 id="创建表"><a href="#创建表" class="headerlink" title="创建表"></a>创建表</h3><p>首先创建数据库:<code>create database test_db;</code></p>
<p>选择使用的数据库:<code> use test_db;</code></p>
<p>外键创建:</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> tb_emp5(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">INT</span> ( <span class="number">11</span> ) PRIMARY <span class="keyword">KEY</span>, </span><br><span class="line">    deptId <span class="built_in">INT</span> ( <span class="number">11</span> ), </span><br><span class="line">    <span class="keyword">CONSTRAINT</span> fk_emp_dept1 <span class="keyword">FOREIGN</span> <span class="keyword">KEY</span> ( deptId ) <span class="keyword">REFERENCES</span> tb_dept1 ( <span class="keyword">id</span> )</span><br><span class="line">);</span><br></pre></td></tr></table></figure>

<p>自动增加:<code> 字段名 数据类型 AUTO_INCREMENT</code></p>
<p>非空约束:<code>字段名 数据类型 not null</code></p>
<p>唯一性约束: <code>字段名 数据类型  UNIQUE</code></p>
<p>默认约束（Default Constraint）指定某列的默认值:<code>字段名 数据类型 DEFAULT 默认值</code></p>
<h3 id="查看表数据结构"><a href="#查看表数据结构" class="headerlink" title="查看表数据结构"></a>查看表数据结构</h3><p>查看表结构可以使用DESCRIBE和SHOW CREATE TABLE语句。</p>
<h4 id="DESCRIBE"><a href="#DESCRIBE" class="headerlink" title="DESCRIBE"></a>DESCRIBE</h4><p>DESCRIBE/DESC语句可以查看表的字段信息，其中包括：字段名、字段数据类型、是否为主键、是否有默认值等,简写为<code>DESC 表名</code></p>
<h4 id="SHOW-CREATE-TABLE"><a href="#SHOW-CREATE-TABLE" class="headerlink" title="SHOW CREATE TABLE"></a>SHOW CREATE TABLE</h4><p>使用SHOW CREATE TABLE语句不仅可以查看表创建时的详细语句，还可以查看存储引擎和字符编码。使用方式:<code>SHOW TABLE  tb_dept1</code></p>
<h3 id="修改数据表"><a href="#修改数据表" class="headerlink" title="修改数据表"></a>修改数据表</h3><ol>
<li><p>修改表名:<code>ALTER TABLE &lt;旧表名&gt; RENAME [TO]  &lt;新表名&gt;&#39;</code>,例如:<code>alter table tb_emp2 rename tmp2;</code></p>
</li>
<li><p>修改字段类型:<code>ALTER TABLE &lt;表名&gt; MODIFY &lt;字段名&gt; &lt;数据类型&gt;</code>,例如:<code>alter table tmp2 modify name varchar(30);</code></p>
</li>
<li><p>修改字段名:<code>ALTER TABLE &lt;表名&gt; CHANGE &lt;旧字段名&gt; &lt;新字段名&gt; &lt;新数据类型&gt;</code>,例如:<code>alter table tmp2 change id emp_id int;</code></p>
</li>
<li><p>添加字段:</p>
</li>
</ol>
<blockquote>
<p>ALTER TABLE &lt;表名&gt; ADD &lt;新字段名&gt; &lt;数据类型&gt; [约束条件] [FIRST |  AFTER 已存在字段名];</p>
</blockquote>
<p>“新字段名”为需要添加的字段的名称；FIRST为可选参数，其作用是将新添加的字段设置为表的第一个字段；AFTER为可选参数，其作用是将新添加的字段添加到指定的“已存在字段名”的后面。</p>
<ol start="5">
<li>删除字段:<code>ALTER TABLE &lt;表名&gt; DROP &lt;字段名&gt;</code>,例如:<code>alter table tmp2 drop name</code></li>
<li>更改表的存储引擎</li>
</ol>
<p>MySQL中主要的存储引擎有MyISAM、InnoDB、MEMORY（HEAP）、BDB、FEDERATED等。可以使用SHOW ENGINES;语句查看系统支持的存储引擎。</p>
<p>语法如下:<code>ALTER TABLE &lt;表名&gt; ENGINE= &lt;新存储引擎名&gt;</code></p>
<p>先查看当前表的存储引擎 <code>show create table tmp2</code></p>
<p>修改: <code>alter table tmp2 engine=MyISAM;</code></p>
<ol start="7">
<li>删除外键:<code> alter table &lt;表名&gt; drop foreign key &lt;外键约束名&gt;</code></li>
</ol>
<h3 id="删除数据表"><a href="#删除数据表" class="headerlink" title="删除数据表"></a>删除数据表</h3><ol>
<li>删除表:<code>drop table 表1,表2,表3</code></li>
<li>删除父表或者子表<ul>
<li>使用<code>show create table  表名</code> 查看子表或者父表</li>
<li>删除外键 <code> alter table 子表 foreign key  外键名称</code></li>
<li>删除子表或者父表: <code>drop table 表名</code></li>
</ul>
</li>
</ol>
<h2 id="自增变量持久化"><a href="#自增变量持久化" class="headerlink" title="自增变量持久化"></a>自增变量持久化</h2><p>在MySQL 8.0之前，自增主键AUTO_INCREMENT的值如果大于max(primary key)+1，在MySQL重启后，就会重置AUTO_INCREMENT=max(primary key)+1，这种现象在某些情况下会导致业务主键冲突或者其他难以发现的问题。</p>
<h1 id="运算符"><a href="#运算符" class="headerlink" title="运算符"></a>运算符</h1><h2 id="算数运算符"><a href="#算数运算符" class="headerlink" title="算数运算符"></a>算数运算符</h2><blockquote>
<p>算术运算符用于各类数值运算，包括加（+）、减（-）、乘（*）、除（/）、求余（或称模运算，%）。</p>
</blockquote>
<h2 id="比较运算符"><a href="#比较运算符" class="headerlink" title="比较运算符"></a>比较运算符</h2><blockquote>
<p>比较运算符用于比较运算，包括大于（&gt;）、小于（&lt;）、等于（=）、大于等于（&gt;=）、小于等于（&lt;=）、不等于（!=），以及IN、BETWEEN AND、ISNULL、GREATEST、LEAST、LIKE、REGEXP等。</p>
</blockquote>
<p>如图所示：</p>
<table>
<thead>
<tr>
<th align="center">运算符</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">=</td>
<td align="left">等于，判断数字、字符串、表达式是否相同，返回1或0</td>
</tr>
<tr>
<td align="center">&lt;=&gt;</td>
<td align="left">安全的等于，判断null,两个数均为null,返回1，一个为null,返回0</td>
</tr>
<tr>
<td align="center">&lt;&gt; 或者 !=</td>
<td align="left">不等于，判断数字、字符串、表达式是否不相同，返回1或0，不能判断null</td>
</tr>
<tr>
<td align="center">&lt;=</td>
<td align="left">小于等于，返回1或0，不能判断null</td>
</tr>
<tr>
<td align="center">&gt;=</td>
<td align="left">大于等于,返回1或0，不能判断null</td>
</tr>
<tr>
<td align="center">&gt;</td>
<td align="left">大于,返回1或0，不能判断null</td>
</tr>
<tr>
<td align="center">IS NULL 或者 ISNULL</td>
<td align="left">判断一个值是否为空</td>
</tr>
<tr>
<td align="center">IS NOT NULL</td>
<td align="left">判断一个值是否不为空</td>
</tr>
<tr>
<td align="center">BETWEEN AND</td>
<td align="left">判断一个值是否落在两个值之间,between是指 <strong>大于或等于</strong></td>
</tr>
<tr>
<td align="center">LEAST</td>
<td align="left">有两个或者多个值，返回最小值，LEAST(值1,值2,…,值n)，若任意一个自变量为NULL，则LEAST()的返回值为NULL。</td>
</tr>
<tr>
<td align="center">GREATEST</td>
<td align="left">有两个或者多个值，返回最大值，GREATEST(值1, 值2,…,值n)，任意一个自变量为NULL，则GREATEST()的返回值为NULL。</td>
</tr>
<tr>
<td align="center">IN</td>
<td align="left">判断一个值是IN列表中的任意一个值，返回1或0</td>
</tr>
<tr>
<td align="center">NOT IN</td>
<td align="left">判断一个值不是IN列表中的任意一个值，返回1或0</td>
</tr>
<tr>
<td align="center">LIKE</td>
<td align="left">通配符匹配，返回1或0，匹配条件中任何一个为NULL，则结果为NULL。‘%’匹配任意字符，‘_’，只能匹配一个字符。</td>
</tr>
<tr>
<td align="center">REGEXP</td>
<td align="left">正则表达式，返回1或0，匹配条件中任何一个为NULL，则结果为NULL。</td>
</tr>
</tbody></table>
<h2 id="逻辑运算符"><a href="#逻辑运算符" class="headerlink" title="逻辑运算符"></a>逻辑运算符</h2><blockquote>
<p>逻辑运算符的求值所得结果均为1（TRUE）、0（FALSE），这类运算符有逻辑非（NOT或者!）、逻辑与（AND或者&amp;&amp;）、逻辑或（OR或者||）、逻辑异或（XOR）。</p>
</blockquote>
<h2 id="位操作运算符"><a href="#位操作运算符" class="headerlink" title="位操作运算符"></a>位操作运算符</h2><blockquote>
<p>位操作运算符参与运算的操作数按二进制位进行运算，包括位与（&amp;）、位或（|）、位非（~）、位异或（^）、左移（&lt;&lt;）、右移（&gt;&gt;）6种。</p>
</blockquote>
<p>位运算符是在二进制数上进行计算的运算符。位运算符会先将操作数变成二进制数，然后进行位运算，最后将计算结果从二进制变回十进制数。MySQL中提供的位运算符有按位或（|）、按位与（&amp;）、按位异或（^）、按位左移（&lt;&lt;）、按位右移（&gt;&gt;）、按位取反（~）</p>
<h2 id="算数运算符-1"><a href="#算数运算符-1" class="headerlink" title="算数运算符"></a>算数运算符</h2><blockquote>
<p>算术运算符是SQL中基本的运算符，即 +、 -、 *、 /、 %   五个</p>
</blockquote>
<p>最高的优先级是 <code>!</code></p>
<h1 id="插入、更新、删除、计算列"><a href="#插入、更新、删除、计算列" class="headerlink" title="插入、更新、删除、计算列"></a>插入、更新、删除、计算列</h1><h2 id="插入"><a href="#插入" class="headerlink" title="插入"></a>插入</h2><p>插入的方式有：插入完整的记录、插入记录的一部分、插入多条记录、插入另一个查询的结果</p>
<ol>
<li>插入多条记录： <code>insert into tmp14 (num) values (20),(30),(40);</code></li>
<li>插入查询记录: <code>insert into t2 (id,name) select id,name from t3;</code></li>
</ol>
<h2 id="更新"><a href="#更新" class="headerlink" title="更新"></a>更新</h2><ol>
<li>更新一个: <code> uptade 表名 set  字段名=新值 where  条件</code>,例如:<code>  update t2 set name= &#39;d&#39; where id =3;</code></li>
<li>更新指定范围内的值: <code>update t2 set name=&#39;c&#39; where id between 2 and 3;</code></li>
<li>更新所有数据,即不添加where条件时,会更新所有数据</li>
</ol>
<h2 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h2><blockquote>
<p>delete from 表名 [条件]</p>
</blockquote>
<ol>
<li><p>删除指定行,添加where条件</p>
</li>
<li><p>删除所有数据,不添加where</p>
</li>
<li><p>快速删除表数据: <code>truncate table 表名</code>,实质是删除旧表,创建新表</p>
</li>
</ol>
<h2 id="表的计算列"><a href="#表的计算列" class="headerlink" title="表的计算列"></a>表的计算列</h2><blockquote>
<p>什么叫计算列呢？简单来说，就是某一列的值是通过别的列计算得来的，例如a列的值为1，b列的值为2，c列的值不需要手动插入，定义a+ b的结果为c列的值，那么c列就是计算列，是通过别的列计算得来的。</p>
</blockquote>
<p>创表语句</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t1(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">9</span>) auto_increment,</span><br><span class="line">    a <span class="built_in">int</span>(<span class="number">9</span>),</span><br><span class="line">    b <span class="built_in">int</span>(<span class="number">9</span>),</span><br><span class="line">    c <span class="built_in">int</span>(<span class="number">9</span>) <span class="keyword">generated</span> <span class="keyword">always</span> <span class="keyword">as</span> ((a+b)) <span class="keyword">virtual</span>,</span><br><span class="line">    primary <span class="keyword">key</span> (<span class="keyword">id</span>)</span><br><span class="line">);</span><br><span class="line"></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t1 (a,b) <span class="keyword">values</span> (<span class="number">1</span>,<span class="number">2</span>),(<span class="number">3</span>,<span class="number">4</span>),(<span class="number">5</span>,<span class="number">6</span>);</span><br></pre></td></tr></table></figure>

<p>查询结果:</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">mysql&gt; select * from t1;</span><br><span class="line">+----+------+------+------+</span><br><span class="line">| id | a    | b    | c    |</span><br><span class="line">+----+------+------+------+</span><br><span class="line">|  1 |    1 |    2 |    3 |</span><br><span class="line">|  2 |    3 |    4 |    7 |</span><br><span class="line">|  3 |    5 |    6 |   11 |</span><br><span class="line">+----+------+------+------+</span><br></pre></td></tr></table></figure>

<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><blockquote>
<p>索引是一个单独的、存储在磁盘上的数据库结构，包含着对数据表中所有记录的引用指针。使用索引用于快速找出在某个或多个列中有一特定值的行，所有MySQL列类型都可以被索引，对相关列使用索引是提高查询操作速度的最佳途径</p>
</blockquote>
<p>索引的优点主要有以下几条：</p>
<p>（1）通过创建唯一索引，可以保证数据库表中每一行数据的唯一性。</p>
<p>（2）可以大大加快数据的查询速度，这也是创建索引最主要的原因。</p>
<p>（3）在实现数据的参考完整性方面，可以加速表和表之间的连接。</p>
<p>（4）在使用分组和排序子句进行数据查询时，可以显著减少查询中分组和排序的时间。</p>
<p>索引的缺点：</p>
<p>（1）创建索引和维护索引要耗费时间，并且随着数据量的增加，所耗费的时间也会增加。</p>
<p>（2）索引需要占磁盘空间，除了数据表占数据空间之外，每一个索引还要占一定的物理空间，如果有大量的索引，索引文件就可能比数据文件更快达到最大文件尺寸。</p>
<p>（3）当对表中的数据进行增加、删除和修改的时候，索引也要动态地维护，这样就降低了数据的维护速度。</p>
<h2 id="索引分类"><a href="#索引分类" class="headerlink" title="索引分类"></a>索引分类</h2><ul>
<li>普通索引和唯一索引（UNIQUE）</li>
</ul>
<p>普通索引允许重复值和空值，</p>
<p>唯一索引值必须唯一，允许空值</p>
<ul>
<li>单列索引和组合索引</li>
</ul>
<p>单列索引即一个索引只包含单个列，一个表可以有多个单列索引。</p>
<p>组合索引指在表的多个字段组合上创建的索引，只有在查询条件中使用了这些字段的左边字段时，索引才会被使用。使用组合索引时遵循最左前缀集合。</p>
<ul>
<li>全文索引 （FULLTEXT）</li>
</ul>
<p>全文索引类型为FULLTEXT，在定义索引的列上支持值的全文查找，允许在这些索引列中插入重复值和空值。全文索引可以在CHAR、VARCHAR或者TEXT类型的列上创建。MySQL中只有MyISAM存储引擎支持全文索引</p>
<ul>
<li>空间索引（SPATIAL）</li>
</ul>
<p>空间索引是对空间数据类型的字段建立的索引，MySQL中的空间数据类型有4种，分别是GEOMETRY、POINT、LINESTRING和POLYGON。MySQL使用SPATIAL关键字进行扩展，使得能够使用创建正规索引类似的语法创建空间索引。创建空间索引的列，必须将其声明为NOT NULL，空间索引只能在存储引擎为MyISAM的表中创建。</p>
<h2 id="创建索引"><a href="#创建索引" class="headerlink" title="创建索引"></a>创建索引</h2><p>查看索引: <code>show index from 表名;</code></p>
<p>删除索引: <code>drop index  索引名字;</code></p>
<p>创建索引: <code>create index  索引名  (字段名1,字段名2);</code></p>
<p>创建索引: <code>alter table 表名 add index 索引名字 (字段名);</code></p>
<ol>
<li>创建表的时候创建普通索引</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t1(</span><br><span class="line">    <span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">10</span>),</span><br><span class="line">	<span class="keyword">year</span> <span class="built_in">int</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">index</span> (<span class="keyword">year</span>)</span><br><span class="line">);	</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建唯一索引</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t2(</span><br><span class="line">	<span class="keyword">id</span> <span class="built_in">int</span>(<span class="number">11</span>),</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">20</span>),</span><br><span class="line">    <span class="keyword">unique</span> <span class="keyword">index</span> UniQueIndex(<span class="keyword">id</span>)</span><br><span class="line">);</span><br><span class="line"><span class="comment">-- 创建一个一个名称为UniQueIndex的唯一索引</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建单列索引</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">create</span> <span class="keyword">table</span> t2(</span><br><span class="line">    <span class="keyword">name</span> <span class="built_in">varchar</span>(<span class="number">50</span>) <span class="literal">null</span>,</span><br><span class="line">    <span class="keyword">index</span> SingleIdx_a (<span class="keyword">name</span>(<span class="number">20</span>))</span><br><span class="line">)</span><br><span class="line"><span class="comment">-- 创建一个名为SingleIdx_a的索引</span></span><br></pre></td></tr></table></figure>

<ol start="4">
<li><p>创建全文索引</p>
<ul>
<li><p>innoDB不支持全文索引,查看存储引擎:<code>show create table 表名;</code></p>
</li>
<li><p>修改存储引擎为 MyISAM:<code>alter table 表名 engine=MYISAM;</code></p>
</li>
<li><p>建立全文索引: <code>fulltext index  索引名字 (字段名);</code></p>
</li>
</ul>
</li>
<li><p>空间索引</p>
</li>
</ol>
<blockquote>
<p>空间索引必须在MyISAM类型的表中创建，且空间类型的字段必须为非空。</p>
</blockquote>
<p>创建空间索引: <code>spatial index 名称 ( 字段名);</code></p>
<h2 id="删除索引"><a href="#删除索引" class="headerlink" title="删除索引"></a>删除索引</h2><p>删除索引:<code>alter table  表名  drop  index 索引名字</code></p>
<p>删除索引: <code>drop index 名字 on 表名;</code></p>
<h1 id="查询"><a href="#查询" class="headerlink" title="查询"></a>查询</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p>查询的基本语句以及可选参数</p>
<p>•　{* | &lt;字段列表&gt;}包含星号通配符和字段列表，表示查询的字段，其中字段列至少包含一个字段名称，如果要查询多个字段，多个字段之间就要用逗号隔开，最后一个字段后不要加逗号。</p>
<p>•　FROM &lt;表1&gt;,&lt;表2&gt;…，表1和表2表示查询数据的来源，可以是单个或者多个。</p>
<p>•　WHERE子句是可选项，如果选择该项，将限定查询行必须满足的查询条件。</p>
<p>•　GROUP BY &lt;字段&gt;，该子句告诉MySQL如何显示查询出来的数据，并按照指定的字段分组。</p>
<p>•　[ORDER BY &lt;字段&gt;]，该子句告诉MySQL按什么样的顺序显示查询出来的数据，可以进行的排序有：升序（ASC）、降序（DESC）。</p>
<p>•　[LIMIT [<offset>,] <row count>]，该子句告诉MySQL每次显示查询出来的数据条数。</p>
<h2 id="指定查询"><a href="#指定查询" class="headerlink" title="指定查询"></a>指定查询</h2><blockquote>
<p>like查询,匹配任意长度的字符，甚至包括零字符</p>
</blockquote>
<p>以B开头的查询:<code>like &#39;B%&#39;;</code></p>
<p>包含B的查询: <code>like &#39;%B%&#39;;</code></p>
<p>以B开开头,以Y结尾的查询:<code>like &#39;B%Y&#39;;</code></p>
<blockquote>
<p>下画线通配符“_”，一次只能匹配任意一个字符</p>
</blockquote>
<p>查询以字母“y”结尾且“y”前面只有4个字母的记录:<code> like ‘____y’;</code></p>
<blockquote>
<p>查询为空</p>
</blockquote>
<p>查询语句: <code>where xxx is null;</code></p>
<blockquote>
<p>查询不为空</p>
</blockquote>
<p>查询语句: <code>where xxx  is not null;</code></p>
<blockquote>
<p>可以使用AND连接两个甚至多个查询条件，多个条件表达式之间用AND分开。</p>
</blockquote>
<p>查询s_id = 101并且f_price大于等于5: <code>where s_id=‘101’ and f_price&gt;=5;</code></p>
<p><strong>OR可以和AND一起使用，但是在使用时要注意两者的优先级，由于AND的优先级高于OR，因此先对AND两边的操作数进行操作，再与OR中的操作数结合。</strong></p>
<blockquote>
<p>OR表示只需要满足其中一个条件的记录即可返回。OR也可以连接两个甚至多个查询条件，多个条件表达式之间用OR分开。</p>
</blockquote>
<p>查询s_id=101或者s_id=102: <code>where s_id =101 or s_id=102;</code></p>
<blockquote>
<p>去重,DISTINCT关键字</p>
</blockquote>
<p>查询:<code> select distinct 字段名 from 表名;</code></p>
<blockquote>
<p>排序</p>
</blockquote>
<p>查询:<code>where id&lt;27 order by name;</code></p>
<blockquote>
<p>多列排序</p>
<p>在对多列进行排序的时候，首先排序的第一列必须有相同的列值，才会对第二列进行排序。如果第一列数据中所有值都是唯一的，将不再对第二列进行排序。</p>
</blockquote>
<p>查询:<code>order by  字段一,字段二;</code></p>
<blockquote>
<p>降序  order by</p>
</blockquote>
<p>查询: order by id desc;`</p>
<blockquote>
<p>升序  asc  (默认)</p>
</blockquote>
<p>查询: <code>order by id asc;</code></p>
<h2 id="分组查询"><a href="#分组查询" class="headerlink" title="分组查询"></a>分组查询</h2><blockquote>
<p>[group by 字段] [having &lt;条件表达式&gt;]</p>
<p>GROUP BY关键字通常和集合函数一起使用，如MAX()、MIN()、COUNT()、SUM()、AVG()</p>
</blockquote>
<p>GROUP_CONCAT()函数，可以将每个分组中各个字段的值显示出来。例如;<code>SELECT s_id ,GROUP_CONCAT (f_name) as Names FROM fruits GROUP BY s_id;</code></p>
<blockquote>
<p>使用HAVING过滤分组</p>
</blockquote>
<p>GROUP BY可以和HAVING一起限定显示记录所需满足的条件，只有满足条件的分组才会被显示。</p>
<p>【例7.28】根据s_id对fruits表中的数据进行分组，并显示水果种类大于1的分组信息:</p>
<p><code>select s_id,group_concat(f_name) as Names from fruits group by s_id having count(f_name)&gt;1;</code></p>
<p><strong>提示:</strong></p>
<p><strong>HAVING关键字与WHERE关键字都是用来过滤数据的，两者有什么区别呢？其中重要的一点是，HAVING在数据分组之后进行过滤来选择分组，而WHERE在分组之前用来选择记录。另外，WHERE排除的记录不再包括在分组中。</strong></p>
<blockquote>
<p>在GROUP BY子句中使用WITH ROLLUP</p>
</blockquote>
<p>查询: <code>mysql&gt; select id, sum(price) as total  from t1 where id in (30,32,33,34,35,36) group by id with rollup;</code></p>
<p>结果为</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">mysql&gt; select id, sum(price) as total  from t1 where id in (30,32,33,34,35,36) group by id with rollup;</span><br><span class="line">+----+-------+</span><br><span class="line">| id | total |</span><br><span class="line">+----+-------+</span><br><span class="line">| 30 |     6 |</span><br><span class="line">| 32 |     4 |</span><br><span class="line">| 33 |     2 |</span><br><span class="line">| 34 |     5 |</span><br><span class="line">| 35 |     6 |</span><br><span class="line">| 36 |     8 |</span><br><span class="line">| NULL |    31 |</span><br><span class="line">+----+-------+</span><br></pre></td></tr></table></figure>

<p>由结果可以看到，通过GROUP BY分组之后，在显示结果的最后面新添加了一行，该行Total列的值正好是上面所有数值之和。</p>
<blockquote>
<p>使用LIMIT限制查询结果的数量</p>
</blockquote>
<p>语法:<code>limit [位置偏移量,]  行数;</code></p>
<p>第一个“位置偏移量”参数指示MySQL从哪一行开始显示，是一个可选参数，如果不指定“位置偏移量”，就会从表中的第一条记录开始（第一条记录的位置偏移量是0，第二条记录的位置偏移量是1，以此类推）；</p>
<p>查询: <code>select * from t1 limit 0,4;</code></p>
<p><strong>MySQL 8.0中可以使用“LIMIT 4 OFFSET 3”，意思是获取从第5条记录开始后面的3条记录，和“LIMIT 4,3;”返回的结果相同。</strong></p>
<h2 id="聚合函数"><a href="#聚合函数" class="headerlink" title="聚合函数"></a>聚合函数</h2><p>mysql内置的聚合函数</p>
<table>
<thead>
<tr>
<th align="center">聚合函数</th>
<th align="left">作用</th>
</tr>
</thead>
<tbody><tr>
<td align="center">AVG()</td>
<td align="left">平均值</td>
</tr>
<tr>
<td align="center">COUNT()</td>
<td align="left">返回行数</td>
</tr>
<tr>
<td align="center">MAX()</td>
<td align="left">最大值</td>
</tr>
<tr>
<td align="center">MIN()</td>
<td align="left">最小值</td>
</tr>
<tr>
<td align="center">SUM()</td>
<td align="left">和</td>
</tr>
</tbody></table>
<h2 id="连接查询"><a href="#连接查询" class="headerlink" title="连接查询"></a>连接查询</h2><p>七种连接,详细查看本人博客&lt;sql优化&gt;,尚硅谷视频地址:<a href="https://www.bilibili.com/video/BV1KW411u7vy?p=9">哔哩哔哩尚硅谷</a></p>
<h2 id="子查询"><a href="#子查询" class="headerlink" title="子查询"></a>子查询</h2><blockquote>
<p>and</p>
</blockquote>
<p>【例7.53】返回tbl2表的所有num2列，然后将tbl1中的num1的值与之进行比较，只要大于num2的任何一个值，即为符合查询条件的结果。</p>
<p>查询: <code>select num1 from tbl1 where num1 &gt; any (select num2 from tbl2);</code></p>
<p>结果概述:</p>
<p>在子查询中，返回的是tbl2表的所有num2列的结果（6,14,11,20），然后将tbl1中的num1列的值与之进行比较，只要大于num2列的任意一个数即为符合条件的结果。</p>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>java集合</title>
    <url>/2021/03/10/java/javaCollection/</url>
    <content><![CDATA[<h1 id="Collection接口"><a href="#Collection接口" class="headerlink" title="Collection接口"></a>Collection接口</h1><p>图示</p>
<p><img data-src="/images/java/javaCollection/1.png" alt="1.png"></p>
<p><a href="https://blog.csdn.net/xzp_12345/article/details/79251174">参考博客</a></p>
<a id="more"></a>

<h2 id="List接口"><a href="#List接口" class="headerlink" title="List接口"></a>List接口</h2><p>Collection 接口的接口 对象的集合（单列集合）<br>├——├ List 接口：元素按进入先后有序保存，可重复<br>│—————-├ LinkedList 接口实现类， 链表， 插入删除， 没有同步， 线程不安全<br>│—————-├ ArrayList 接口实现类， 数组， 随机访问， 没有同步， 线程不安全<br>│—————-├ Vector 接口实现类 数组， 同步， 线程安全<br>│ ———————-├ Stack 是Vector类的实现类<br> |——├ Set 接口： 仅接收一次，不可重复，并做内部排序<br>├—————-├ HashSet 使用hash表（数组）存储元素<br>│————————├  LinkedHashSet 链表维护元素的插入次序<br>└ —————-├ TreeSet 底层实现为二叉树，元素排好序</p>
<blockquote>
<p>线程安全解决办法</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Vector 在jdk1.0时代就出现了,ArrayList在jdk1.2的时候发布</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Collections作为集合类的工具类,也提供了安全的方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;String&gt; list = Collections.synchronizedList(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* JUC的方法,写入时复制,底层还是用了Lock锁</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> CopyOnWriteArrayList();</span><br></pre></td></tr></table></figure>

<h3 id="ArrayList类"><a href="#ArrayList类" class="headerlink" title="ArrayList类"></a>ArrayList类</h3><p><a href="https://www.iteye.com/blog/zhangshixi-674856">参考博客</a></p>
<p><a href="https://www.cnblogs.com/leesf456/p/5308358.html">参考博客</a></p>
<h4 id="类分析"><a href="#类分析" class="headerlink" title="类分析"></a>类分析</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">        <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">RandomAccess</span>, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br></pre></td></tr></table></figure>

<h4 id="底层实现方式"><a href="#底层实现方式" class="headerlink" title="底层实现方式"></a>底层实现方式</h4><p>底层使用数组方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 存储ArrayList元素的数组缓冲区。</span></span><br><span class="line"><span class="comment">* ArrayList的容量是此数组缓冲区的长度。</span></span><br><span class="line"><span class="comment">* 添加第一个元素时，任何具有elementData == DEFAULTCAPACITY_EMPTY_ELEMENTDATA 的</span></span><br><span class="line"><span class="comment">* 空ArrayList都将扩展为EFAULT_CAPACITY(默认值为10)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="keyword">transient</span> Object[] elementData</span><br></pre></td></tr></table></figure>

<h4 id="源码分析"><a href="#源码分析" class="headerlink" title="源码分析"></a>源码分析</h4><p>默认大小是10</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ArrayList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">extends</span> <span class="title">AbstractList</span>&lt;<span class="title">E</span>&gt; <span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">RandomAccess</span>, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br><span class="line"><span class="class"></span>&#123;</span><br><span class="line">    <span class="comment">// 版本号</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">long</span> serialVersionUID = <span class="number">8683452581122892189L</span>;</span><br><span class="line">    <span class="comment">// 缺省容量,默认初始容量是10</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_CAPACITY = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">// 空对象数组</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line">    <span class="comment">// 缺省空对象数组</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Object[] DEFAULTCAPACITY_EMPTY_ELEMENTDATA = &#123;&#125;;</span><br><span class="line">    <span class="comment">// 核心属性-&gt;元素数组,transient意味着在序列化的时候，此字段是不会被序列化的。</span></span><br><span class="line">    <span class="keyword">transient</span> Object[] elementData;</span><br><span class="line">    <span class="comment">// 实际元素大小，默认为0</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> size;</span><br><span class="line">    <span class="comment">// 最大数组容量,即2147483647-8=2147483639</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAX_ARRAY_SIZE = Integer.MAX_VALUE - <span class="number">8</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="常用方法"><a href="#常用方法" class="headerlink" title="常用方法"></a>常用方法</h4><table>
<thead>
<tr>
<th>boolean add(E e)</th>
<th>将指定的元素添加到此列表的尾部。</th>
</tr>
</thead>
<tbody><tr>
<td>void add(int index, E element)</td>
<td>将指定的元素插入此列表中的指定位置。如果当前位置有元素，则向右移动当前位于该位置的元素以及所有后续元素（将其索引加1）</td>
</tr>
<tr>
<td>boolean addAll(Collection&lt;? extends E&gt; c)</td>
<td>将该collection中的所有元素添加到此列表的尾部。</td>
</tr>
<tr>
<td>boolean addAll(int index, Collection&lt;? extends E&gt; c)</td>
<td>从指定的位置开始，将指定collection中的所有元素插入到此列表中。</td>
</tr>
<tr>
<td>E get(int index)</td>
<td>返回此列表中指定位置上的元素。</td>
</tr>
<tr>
<td>E remove(int index)</td>
<td>移除此列表中指定位置上的元素。</td>
</tr>
<tr>
<td>boolean remove(Object o)</td>
<td>移除此列表中首次出现的指定元素（如果存在),这是因为ArrayList中允许存放重复的元素。</td>
</tr>
</tbody></table>
<p><strong>从数组中移除元素的操作，也会导致被移除的元素以后的所有元素的向左移动一个位置,就是索引-1</strong></p>
<h4 id="扩容"><a href="#扩容" class="headerlink" title="扩容"></a>扩容</h4><p>数组进行扩容时，会将老数组中的元素重新拷贝一份到新的数组中，每次数组容量的增长大约是其原容量的1.5倍</p>
<h4 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h4><ol>
<li>ArrayList是List接口的可变数组非同步实现，并允许包括null在内的所有元素。</li>
<li>该集合是可变长度数组，数组扩容时，会将老数组中的元素重新拷贝一份到新的数组中，每次数组容量增长大约是其容量的1.5倍，这种操作的代价很高。</li>
<li>采用了Fail-Fast机制，面对并发的修改时，迭代器很快就会完全失败，而不是冒着在将来某个不确定时间发生任意不确定行为的风险</li>
<li>remove方法会让下标到数组末尾的元素向前移动一个单位，并把最后一位的值置空，方便GC</li>
<li>底层使用数组实现</li>
</ol>
<h3 id="LinkedList类"><a href="#LinkedList类" class="headerlink" title="LinkedList类"></a>LinkedList类</h3><p><a href="https://www.cnblogs.com/ITtangtang/p/3948610.html#a1">参考博客</a></p>
<p><a href="https://www.cnblogs.com/leesf456/p/5308843.html">参考博客</a></p>
<p><a href="https://blog.csdn.net/freekiteyu/article/details/93617181">参考博客</a></p>
<h4 id="链表简介"><a href="#链表简介" class="headerlink" title="链表简介"></a>链表简介</h4><p><a href="https://www.runoob.com/java/java-linkedlist.html">菜鸟教程</a></p>
<p>链表可分为单向链表和双向链表。</p>
<p>一个单向链表包含两个值: 当前节点的值和一个指向下一个节点的链接。</p>
<p><img data-src="/images/java/javaCollection/danLian.png"></p>
<p>一个双向链表有三个整数值: 数值、向后的节点链接、向前的节点链接。</p>
<p><img data-src="/images/java/javaCollection/shuangLian.png"></p>
<h4 id="类分析-1"><a href="#类分析-1" class="headerlink" title="类分析"></a>类分析</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LinkedList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">	<span class="keyword">extends</span> <span class="title">AbstractSequentialList</span>&lt;<span class="title">E</span>&gt;</span></span><br><span class="line"><span class="class">	<span class="keyword">implements</span> <span class="title">List</span>&lt;<span class="title">E</span>&gt;, <span class="title">Deque</span>&lt;<span class="title">E</span>&gt;, <span class="title">Cloneable</span>, <span class="title">java</span>.<span class="title">io</span>.<span class="title">Serializable</span></span></span><br></pre></td></tr></table></figure>

<p><strong>LinkedList 是一个继承于AbstractSequentialList的双向链表</strong>。它也可以被当作堆栈、队列或双端队列进行操作。<br>LinkedList 实现 List 接口，能对它进行队列操作。<br><strong>LinkedList 实现 Deque 接口，即能将LinkedList当作双端队列使用。</strong><br>LinkedList 实现了Cloneable接口，即覆盖了函数clone()，能克隆。<br>LinkedList 实现java.io.Serializable接口，这意味着LinkedList支持序列化，能通过序列化去传输。<br>LinkedList 是非同步的。</p>
<p><strong>着重要看的是Deque接口</strong></p>
<h4 id="常用操作"><a href="#常用操作" class="headerlink" title="常用操作"></a>常用操作</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LinkedList&lt;String&gt; dataList = <span class="keyword">new</span> LinkedList&lt;&gt;(); <span class="comment">// 创建 LinkedList</span></span><br><span class="line">dataList.add(<span class="string">&quot;test&quot;</span>); <span class="comment">// 添加数据</span></span><br><span class="line">dataList.add(<span class="number">1</span>, <span class="string">&quot;test1&quot;</span>); <span class="comment">// 指定位置，添加数据</span></span><br><span class="line">dataList.addFirst(<span class="string">&quot;first&quot;</span>); <span class="comment">// 添加数据到头部</span></span><br><span class="line">dataList.addLast(<span class="string">&quot;last&quot;</span>); <span class="comment">// 添加数据到尾部</span></span><br><span class="line">dataList.get(<span class="number">0</span>); <span class="comment">// 获取指定位置数据</span></span><br><span class="line">dataList.getFirst(); <span class="comment">// 获取头部数据</span></span><br><span class="line">dataList.getLast(); <span class="comment">// 获取尾部数据</span></span><br><span class="line">dataList.remove(<span class="number">1</span>); <span class="comment">// 移除指定位置的数据</span></span><br><span class="line">dataList.removeFirst(); <span class="comment">// 移除头部数据</span></span><br><span class="line">dataList.removeLast(); <span class="comment">// 移除尾部数据</span></span><br><span class="line">dataList.clear(); <span class="comment">// 清空数据</span></span><br></pre></td></tr></table></figure>

<h4 id="属性字段"><a href="#属性字段" class="headerlink" title="属性字段"></a>属性字段</h4><p>内部类Node就是实际的结点，用于存放实际元素的地方。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">E item; <span class="comment">// 数据域</span></span><br><span class="line">Node&lt;E&gt; next; <span class="comment">// 后继</span></span><br><span class="line">Node&lt;E&gt; prev; <span class="comment">// 前驱</span></span><br></pre></td></tr></table></figure>

<h4 id="数据结构原理"><a href="#数据结构原理" class="headerlink" title="数据结构原理"></a>数据结构原理</h4><p>LinkedList底层的数据结构是基于双向循环链表的，且头结点中不存放数据</p>
<p><img data-src="/images/java/javaCollection/jieDian.jpg"></p>
<h4 id="元素添加"><a href="#元素添加" class="headerlink" title="元素添加"></a>元素添加</h4><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> addAll(size, c);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">addAll</span><span class="params">(<span class="keyword">int</span> index, Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 检查 index 是否越界</span></span><br><span class="line">  checkPositionIndex(index);</span><br><span class="line"></span><br><span class="line">  Object[] a = c.toArray();</span><br><span class="line">  <span class="keyword">int</span> numNew = a.length;</span><br><span class="line">  <span class="keyword">if</span> (numNew == <span class="number">0</span>) <span class="comment">// 需要添加的集合为空，直接返回</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line"></span><br><span class="line">  Node&lt;E&gt; pred, succ;</span><br><span class="line">  <span class="keyword">if</span> (index == size) &#123; <span class="comment">// 插入位置与当前列表数量相同，表示为尾部插入</span></span><br><span class="line">    succ = <span class="keyword">null</span>;</span><br><span class="line">    pred = last;</span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// 否则，寻找 index 所在节点</span></span><br><span class="line">    <span class="comment">// 找到 index 所在位置的节点，</span></span><br><span class="line">    <span class="comment">// 也就是插入集合后的后一个节点</span></span><br><span class="line">    succ = node(index);</span><br><span class="line">    <span class="comment">// index 所在位置的前一个节点，</span></span><br><span class="line">    <span class="comment">// 也就是插入集合后的前一个节点</span></span><br><span class="line">    pred = succ.prev;</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="comment">// 遍历需要添加的集合，逐个插入</span></span><br><span class="line">  <span class="keyword">for</span> (Object o : a) &#123;</span><br><span class="line">    <span class="comment">// 创建一个新的节点，以 pred 为前一个节点，值为 e，null 为后一个节点</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span> E e = (E) o;</span><br><span class="line">    Node&lt;E&gt; newNode = <span class="keyword">new</span> Node&lt;&gt;(pred, e, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">if</span> (pred == <span class="keyword">null</span>) <span class="comment">// 如果 pred 为空，说明是在头部插入</span></span><br><span class="line">      first = newNode; <span class="comment">// 也就是说新建的节点是第一个节点</span></span><br><span class="line">    <span class="keyword">else</span> <span class="comment">// pred 不为空，说明是在中间或者尾部从插入</span></span><br><span class="line">      pred.next = newNode; <span class="comment">// pred 的下一个节点连接上新创建的节点</span></span><br><span class="line">    pred = newNode; <span class="comment">// 依次插入</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  <span class="keyword">if</span> (succ == <span class="keyword">null</span>) &#123; <span class="comment">// 如果 succ 为空，说明是在尾部插入</span></span><br><span class="line">    last = pred; <span class="comment">// 所以最后插入的元素就是最后一个元素</span></span><br><span class="line">  &#125; <span class="keyword">else</span> &#123; <span class="comment">// succ 不为空，说明是在中间插入</span></span><br><span class="line">    pred.next = succ; <span class="comment">// 最后插入的元素连接上后面的一段</span></span><br><span class="line">    succ.prev = pred; <span class="comment">// 后面的一段第一个元素连接上前面的一段</span></span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  size += numNew; <span class="comment">// 数量合并</span></span><br><span class="line">  modCount++;</span><br><span class="line">  <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="清空"><a href="#清空" class="headerlink" title="清空"></a>清空</h4><p>实现逻辑就是全部遍历一遍,然后设置值为空</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">clear</span><span class="params">()</span> </span>&#123;</span><br><span class="line">  <span class="comment">// 遍历一遍全部设置为空</span></span><br><span class="line">  <span class="keyword">for</span> (Node&lt;E&gt; x = first; x != <span class="keyword">null</span>; ) &#123;</span><br><span class="line">    Node&lt;E&gt; next = x.next;</span><br><span class="line">    x.item = <span class="keyword">null</span>;</span><br><span class="line">    x.next = <span class="keyword">null</span>;</span><br><span class="line">    x.prev = <span class="keyword">null</span>;</span><br><span class="line">    x = next;</span><br><span class="line">  &#125;</span><br><span class="line">  first = last = <span class="keyword">null</span>;</span><br><span class="line">  size = <span class="number">0</span>;</span><br><span class="line">  modCount++;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="构造方法"><a href="#构造方法" class="headerlink" title="构造方法"></a>构造方法</h4><p>第一种,无参构造函数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>将header实例的previous和next全部指向header实例,这样整个链表其实就只有header一个节点，用于表示一个空的链表,执行完构造函数后，header实例自身形成一个闭环.</p>
<p><img data-src="/images/java/javaCollection/jie.png"></p>
<p>第二种,有参构造函数</p>
<p>会调用无参构造函数，并且会把集合中所有的元素添加到LinkedList中。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">LinkedList</span><span class="params">(Collection&lt;? extends E&gt; c)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 调用无参构造函数</span></span><br><span class="line">    <span class="keyword">this</span>();</span><br><span class="line">    <span class="comment">// 添加集合中所有的元素</span></span><br><span class="line">    addAll(c);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h4 id="总结-1"><a href="#总结-1" class="headerlink" title="总结"></a>总结</h4><ol>
<li>LinkedList是List接口的双向链表非同步实现，并允许包括null在内的所有元素。</li>
<li>底层的数据结构是基于双向链表的，该数据结构我们称为节点</li>
<li>双向链表节点对应的类Node的实例，Node中包含成员变量：prev，next，item。其中，prev是该节点的上一个节点，next是该节点的下一个节点，item是该节点所包含的值。</li>
<li>它的查找是分两半查找，先判断index是在链表的哪一半，然后再去对应区域查找，这样最多只要遍历链表的一半节点即可找到</li>
</ol>
<h3 id="Vector类"><a href="#Vector类" class="headerlink" title="Vector类"></a>Vector类</h3><h4 id="构造方法-1"><a href="#构造方法-1" class="headerlink" title="构造方法"></a>构造方法</h4><p><a href="https://www.runoob.com/java/java-vector-class.html">菜鸟教程</a></p>
<blockquote>
<p>无参构造</p>
</blockquote>
<p>默认大小10</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">Vector</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>(<span class="number">10</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建指定大小</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Vector(<span class="keyword">int</span> size)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建指定大小的向量，并且增量用 incr 指定。增量表示向量每次增加的元素数目。</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Vector(<span class="keyword">int</span> size,<span class="keyword">int</span> incr)</span><br></pre></td></tr></table></figure>

<blockquote>
<p>创建一个包含集合 c 元素的向量</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Vector(Collection c)</span><br></pre></td></tr></table></figure>



<h2 id="Set接口"><a href="#Set接口" class="headerlink" title="Set接口"></a>Set接口</h2><h3 id="HashSet类"><a href="#HashSet类" class="headerlink" title="HashSet类"></a>HashSet类</h3><h4 id="HashSet-的实现原理"><a href="#HashSet-的实现原理" class="headerlink" title="HashSet 的实现原理"></a>HashSet 的实现原理</h4><ul>
<li>HashSet底层由HashMap实现</li>
<li>HashSet的值存放于HashMap的key上</li>
</ul>
<h3 id="TreeSet类"><a href="#TreeSet类" class="headerlink" title="TreeSet类"></a>TreeSet类</h3><h1 id="Map接口"><a href="#Map接口" class="headerlink" title="Map接口"></a>Map接口</h1><h2 id="HashMap"><a href="#HashMap" class="headerlink" title="HashMap"></a>HashMap</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><p><a href="https://blog.csdn.net/lizhongkaide/article/details/50595719">参考博客</a></p>
<p><strong>在JDK1.8之前，HashMap采用数组+链表实现</strong>，即使用链表处理冲突，同一hash值的链表都存储在一个链表里。但是当位于一个桶中的元素较多，即hash值相等的元素较多时，通过key值依次查找的效率较低。</p>
<p><strong>在JDK1.8中，HashMap采用数组+链表+红黑树实现，当链表长度超过阈值（8）时，将链表转换为红黑树，这样大大减少了查找时间。</strong></p>
<h3 id="底层实现"><a href="#底层实现" class="headerlink" title="底层实现"></a>底层实现</h3><p><a href="https://blog.csdn.net/qq_37113604/article/details/81353626?utm_medium=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.baidujs&dist_request_id=1328641.7733.16155200204643027&depth_1-utm_source=distribute.pc_relevant.none-task-blog-BlogCommendFromMachineLearnPai2-1.baidujs">参考博客</a></p>
<p>hashMap的主干是一个Node数组（jdk1.7及之前为Entry数组）每一个Node包含一个key与value的键值对，与一个next</p>
<p>next指向下一个node，hashMap由多个Node对象组成。</p>
<p>Node是HhaspMap中的一个静态内部类 </p>
<p>在hashMap的结构图中，hash数组就是用Node型数组实现的，许多Node类通过next组成链表，key、value实际存储在Node内部类中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//Node是单向链表，它实现了Map.Entry接口 </span></span><br><span class="line"><span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">Node</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; <span class="keyword">implements</span> <span class="title">Map</span>.<span class="title">Entry</span>&lt;<span class="title">K</span>,<span class="title">V</span>&gt; </span>&#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> hash;</span><br><span class="line">        <span class="keyword">final</span> K key;</span><br><span class="line">        V value;</span><br><span class="line">        Node&lt;K,V&gt; next;</span><br><span class="line"> </span><br><span class="line">        Node(<span class="keyword">int</span> hash, K key, V value, Node&lt;K,V&gt; next) &#123;</span><br><span class="line">            <span class="keyword">this</span>.hash = hash;</span><br><span class="line">            <span class="keyword">this</span>.key = key;</span><br><span class="line">            <span class="keyword">this</span>.value = value;</span><br><span class="line">            <span class="keyword">this</span>.next = next;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> K <span class="title">getKey</span><span class="params">()</span>        </span>&#123; <span class="keyword">return</span> key; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">getValue</span><span class="params">()</span>      </span>&#123; <span class="keyword">return</span> value; &#125;</span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> String <span class="title">toString</span><span class="params">()</span> </span>&#123; <span class="keyword">return</span> key + <span class="string">&quot;=&quot;</span> + value; &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hashCode</span><span class="params">()</span> </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> Objects.hashCode(key) ^ Objects.hashCode(value);</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> V <span class="title">setValue</span><span class="params">(V newValue)</span> </span>&#123;</span><br><span class="line">            V oldValue = value;</span><br><span class="line">            value = newValue;</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line"> </span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">boolean</span> <span class="title">equals</span><span class="params">(Object o)</span> </span>&#123;</span><br><span class="line">            <span class="keyword">if</span> (o == <span class="keyword">this</span>)</span><br><span class="line">                <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            <span class="keyword">if</span> (o <span class="keyword">instanceof</span> Map.Entry) &#123;</span><br><span class="line">                Map.Entry&lt;?,?&gt; e = (Map.Entry&lt;?,?&gt;)o;</span><br><span class="line">                <span class="keyword">if</span> (Objects.equals(key, e.getKey()) &amp;&amp;</span><br><span class="line">                    Objects.equals(value, e.getValue()))</span><br><span class="line">                    <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h3 id="类属性分析"><a href="#类属性分析" class="headerlink" title="类属性分析"></a>类属性分析</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">       *  table就是存储Node类的数组，就是对应上图中左边那一栏，</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">transient</span> Node&lt;K, V&gt;[] table;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       *  记录hashmap中存储键-值对的数量</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">transient</span> <span class="keyword">int</span> size;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * hashmap结构被改变的次数，fail-fast机制</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">transient</span> <span class="keyword">int</span> modCount;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 扩容的门限值，当size大于这个值时，table数组进行扩容</span></span><br><span class="line"><span class="comment">       * 临界值=主干数组容量*负载因子</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">int</span> threshold;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       *</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">float</span> loadFactor;</span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 默认初始容量为16，0000 0001 右移4位 0001 0000为16，主干数组的初始容量为16，而且这个数组必须为2的幂</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> DEFAULT_INITIAL_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">4</span>; <span class="comment">// aka 16</span></span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       *最大容量，如果两个带参数的构造函数隐式指定更高的值，则使用该最大容量</span></span><br><span class="line"><span class="comment">       *最大容量为int的最大值除2</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MAXIMUM_CAPACITY = <span class="number">1</span> &lt;&lt; <span class="number">30</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       *   默认的负载因子</span></span><br><span class="line"><span class="comment">       * 在构造函数中未指定时使用的负载系数</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">float</span> DEFAULT_LOAD_FACTOR = <span class="number">0.75f</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * 这是jdk1.8新加的，这是链表的最大长度，当大于这个长度时，就会将链表转成红黑树</span></span><br><span class="line"><span class="comment">       * 该值必须大于2，并且至少应为8才能与删除树的假设有关收缩后转换回普通箱。</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> TREEIFY_THRESHOLD = <span class="number">8</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       * hash表扩容后，如果发现某一个红黑树的长度小于6，则会重新退化为链表</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> UNTREEIFY_THRESHOLD = <span class="number">6</span>;</span><br><span class="line"></span><br><span class="line">      <span class="comment">/**</span></span><br><span class="line"><span class="comment">       *当hashmap容量大于64时，链表才能转成红黑树</span></span><br><span class="line"><span class="comment">       */</span></span><br><span class="line">      <span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> MIN_TREEIFY_CAPACITY = <span class="number">64</span>;</span><br></pre></td></tr></table></figure>

<h3 id="构造函数"><a href="#构造函数" class="headerlink" title="构造函数"></a>构造函数</h3><blockquote>
<p>无参构造函数</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    *初始化的时候,就是给默认的负载因子赋值,值就是它本身,即0.75f</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR; <span class="comment">// all other fields defaulted</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>有参构造</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 将map直接放入hashmap中</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m)</span> </span>&#123;</span><br><span class="line">	<span class="comment">//默认的初始化</span></span><br><span class="line">    <span class="keyword">this</span>.loadFactor = DEFAULT_LOAD_FACTOR;</span><br><span class="line">    <span class="comment">//调用方法</span></span><br><span class="line">    putMapEntries(m, <span class="keyword">false</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> <span class="keyword">void</span> <span class="title">putMapEntries</span><span class="params">(Map&lt;? extends K, ? extends V&gt; m, <span class="keyword">boolean</span> evict)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">int</span> s = m.size();</span><br><span class="line">    <span class="keyword">if</span> (s &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        <span class="keyword">if</span> (table == <span class="keyword">null</span>) &#123; <span class="comment">// pre-size</span></span><br><span class="line">            <span class="keyword">float</span> ft = ((<span class="keyword">float</span>)s / loadFactor) + <span class="number">1.0F</span>;</span><br><span class="line">            <span class="keyword">int</span> t = ((ft &lt; (<span class="keyword">float</span>)MAXIMUM_CAPACITY) ?</span><br><span class="line">                     (<span class="keyword">int</span>)ft : MAXIMUM_CAPACITY);</span><br><span class="line">            <span class="keyword">if</span> (t &gt; threshold)</span><br><span class="line">                threshold = tableSizeFor(t);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (s &gt; threshold)</span><br><span class="line">            resize();</span><br><span class="line">        <span class="keyword">for</span> (Map.Entry&lt;? extends K, ? extends V&gt; e : m.entrySet()) &#123;</span><br><span class="line">            K key = e.getKey();</span><br><span class="line">            V value = e.getValue();</span><br><span class="line">            putVal(hash(key), key, value, <span class="keyword">false</span>, evict);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>指定初始化值</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//当知道所要构建的数据容量的大小时，最好直接指定大小，提高效率</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashMap</span><span class="params">(<span class="keyword">int</span> initialCapacity)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">this</span>(initialCapacity, DEFAULT_LOAD_FACTOR);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="put方法"><a href="#put方法" class="headerlink" title="put方法"></a>put方法</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> V <span class="title">put</span> <span class="params">(K key, V value)</span></span>&#123;</span><br><span class="line">    <span class="keyword">return</span> putVal(hash(key), key, value, <span class="keyword">false</span>, <span class="keyword">true</span>);</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">static</span> <span class="keyword">final</span> <span class="keyword">int</span> <span class="title">hash</span> <span class="params">(Object key)</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> h;</span><br><span class="line">    <span class="comment">//key的值为null时，hash值返回0，对应的table数组中的位置是0</span></span><br><span class="line">    <span class="keyword">return</span> (key == <span class="keyword">null</span>) ? <span class="number">0</span> : (h = key.hashCode()) ^ (h &gt;&gt;&gt; <span class="number">16</span>);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">final</span> V <span class="title">putVal</span> <span class="params">( <span class="keyword">int</span> hash, K key, V value,<span class="keyword">boolean</span> onlyIfAbsent,<span class="keyword">boolean</span> evict)</span></span>&#123;</span><br><span class="line">    Node&lt;K, V&gt;[] tab;</span><br><span class="line">    Node&lt;K, V&gt; p;</span><br><span class="line">    <span class="keyword">int</span> n, i;</span><br><span class="line">    <span class="comment">//先将table赋给tab，判断table是否为null或大小为0，若为真，就调用resize（）初始化</span></span><br><span class="line">    <span class="keyword">if</span> ((tab = table) == <span class="keyword">null</span> || (n = tab.length) == <span class="number">0</span>)</span><br><span class="line">        n = (tab = resize()).length;</span><br><span class="line">    <span class="comment">//通过i = (n - 1) &amp; hash得到table中的index值，若为null，则直接添加一个newNode</span></span><br><span class="line">    <span class="keyword">if</span> ((p = tab[i = (n - <span class="number">1</span>) &amp; hash]) == <span class="keyword">null</span>)</span><br><span class="line">        tab[i] = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">    <span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="comment">//执行到这里，说明发生碰撞，即tab[i]不为空，需要组成单链表或红黑树</span></span><br><span class="line">        Node&lt;K, V&gt; e;</span><br><span class="line">        K k;</span><br><span class="line">        <span class="keyword">if</span> (p.hash == hash &amp;&amp;</span><br><span class="line">            ((k = p.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">            <span class="comment">//此时p指的是table[i]中存储的那个Node，如果待插入的节点中hash值和key值在p中已经存在，则将p赋给e</span></span><br><span class="line">            e = p;</span><br><span class="line">        <span class="comment">//如果table数组中node类的hash、key的值与将要插入的Node的hash、key不吻合，就需要在这个node节点链表或者树节点中查找。</span></span><br><span class="line">        <span class="keyword">else</span> <span class="keyword">if</span> (p <span class="keyword">instanceof</span> TreeNode)</span><br><span class="line">            <span class="comment">//当p属于红黑树结构时，则按照红黑树方式插入</span></span><br><span class="line">            e = ((TreeNode&lt;K, V&gt;) p).putTreeVal(<span class="keyword">this</span>, tab, hash, key, value);</span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="comment">//到这里说明碰撞的节点以单链表形式存储，for循环用来使单链表依次向后查找</span></span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> binCount = <span class="number">0</span>; ; ++binCount) &#123;</span><br><span class="line">                <span class="comment">//将p的下一个节点赋给e，如果为null，创建一个新节点赋给p的下一个节点</span></span><br><span class="line">                <span class="keyword">if</span> ((e = p.next) == <span class="keyword">null</span>) &#123;</span><br><span class="line">                    p.next = newNode(hash, key, value, <span class="keyword">null</span>);</span><br><span class="line">                    <span class="comment">//如果冲突节点达到8个，调用treeifyBin(tab, hash)，这个treeifyBin首先回去判断当前hash表的长度，如果不足64的话，实际上就只进行resize，扩容table，如果已经达到64，那么才会将冲突项存储结构改为红黑树。</span></span><br><span class="line"></span><br><span class="line">                    <span class="keyword">if</span> (binCount &gt;= TREEIFY_THRESHOLD - <span class="number">1</span>) <span class="comment">// -1 for 1st</span></span><br><span class="line">                        treeifyBin(tab, hash);</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="comment">//如果有相同的hash和key，则退出循环</span></span><br><span class="line">                <span class="keyword">if</span> (e.hash == hash &amp;&amp;</span><br><span class="line">                    ((k = e.key) == key || (key != <span class="keyword">null</span> &amp;&amp; key.equals(k))))</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                <span class="comment">//将p调整为下一个节点</span></span><br><span class="line">                p = e;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//若e不为null，表示已经存在与待插入节点hash、key相同的节点，hashmap后插入的key值对应的value会覆盖以前相同key值对应的value值，就是下面这块代码实现的</span></span><br><span class="line">        <span class="keyword">if</span> (e != <span class="keyword">null</span>) &#123; <span class="comment">// existing mapping for key</span></span><br><span class="line">            V oldValue = e.value;</span><br><span class="line">            <span class="comment">//判断是否修改已插入节点的value</span></span><br><span class="line">            <span class="keyword">if</span> (!onlyIfAbsent || oldValue == <span class="keyword">null</span>)</span><br><span class="line">                e.value = value;</span><br><span class="line">            afterNodeAccess(e);</span><br><span class="line">            <span class="keyword">return</span> oldValue;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//插入新节点后，hashmap的结构调整次数+1</span></span><br><span class="line">    ++modCount;</span><br><span class="line">    <span class="keyword">if</span> (++size &gt; threshold)</span><br><span class="line">        <span class="comment">//HashMap中节点数+1，如果大于threshold，那么要进行一次扩容</span></span><br><span class="line">        resize();</span><br><span class="line">    afterNodeInsertion(evict);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="总结-2"><a href="#总结-2" class="headerlink" title="总结"></a>总结</h3><ol>
<li>HashMap是基于哈希表的Map接口的非同步实现，允许使用null值和null键，但不保证映射的顺序。</li>
<li>底层使用数组实现，数组中每一项是个单向链表，即数组和链表的结合体；当链表长度大于一定阈值时，链表转换为红黑树，这样减少链表查询时间。</li>
<li>HashMap在底层将key-value当成一个整体进行处理，这个整体就是一个Node对象。HashMap底层采用一个Node[]数组来保存所有的key-value对，当需要存储一个Node对象时，会根据key的hash算法来决定其在数组中的存储位置，在根据equals方法决定其在该数组位置上的链表中的存储位置；当需要取出一个Node时，也会根据key的hash算法找到其在数组中的存储位置，再根据equals方法从该位置上的链表中取出该Node。</li>
<li>HashMap进行数组扩容需要重新计算扩容后每个元素在数组中的位置，很耗性能</li>
<li>采用了Fail-Fast机制，通过一个modCount值记录修改次数，对HashMap内容的修改都将增加这个值。迭代器初始化过程中会将这个值赋给迭代器的expectedModCount，在迭代过程中，判断modCount跟expectedModCount是否相等，如果不相等就表示已经有其他线程修改了Map，马上抛出异常</li>
</ol>
<h2 id="TreeMap"><a href="#TreeMap" class="headerlink" title="TreeMap"></a>TreeMap</h2><h2 id="HashTable"><a href="#HashTable" class="headerlink" title="HashTable"></a>HashTable</h2><h1 id="集合扩容图示"><a href="#集合扩容图示" class="headerlink" title="集合扩容图示"></a>集合扩容图示</h1><p><img data-src="/images/java/javaCollection/kuo.png"></p>
<h1 id="常见面试题"><a href="#常见面试题" class="headerlink" title="常见面试题"></a>常见面试题</h1><p><a href="https://mp.weixin.qq.com/s?__biz=MzIwMTY0NDU3Nw==&mid=504458946&idx=1&sn=536fb5dfff90c8ef49f2f56dfba75aa8&chksm=0d0f018c3a78889a20056ef4c0a4c85fd22d149b3419ec4f63f843dd1b21e3ed322f2c3257b6#rd">java团长</a></p>
<blockquote>
<p>HashMap 和 Hashtable 有什么区别？</p>
</blockquote>
<ul>
<li>hashMap去掉了HashTable 的contains方法，但是加上了containsValue（）和containsKey（）方法。</li>
<li>hashTable同步的，而HashMap是非同步的，效率上逼hashTable要高。</li>
<li>hashMap允许空键值，而hashTable不允许。</li>
</ul>
<blockquote>
<p>如何实现数组和 List 之间的转换</p>
</blockquote>
<ul>
<li>List转换成为数组：调用ArrayList的toArray方法。</li>
<li>数组转换成为List：调用Arrays的asList方法。</li>
</ul>
<blockquote>
<p> 哪些集合类是线程安全的？</p>
</blockquote>
<ul>
<li>vector：就比arraylist多了个同步化机制（线程安全），因为效率较低，现在已经不太建议使用。在web应用中，特别是前台页面，往往效率（页面响应速度）是优先考虑的。</li>
<li>statck：堆栈类，先进后出。</li>
<li>hashtable：就比hashmap多了个线程安全。</li>
<li>enumeration：枚举，相当于迭代器。</li>
</ul>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java底层</tag>
      </tags>
  </entry>
  <entry>
    <title>sql优化</title>
    <url>/2020/10/23/mysql/sql%E4%BC%98%E5%8C%96/</url>
    <content><![CDATA[<h1 id="存储引擎"><a href="#存储引擎" class="headerlink" title="存储引擎"></a>存储引擎</h1><p><a href="https://github.com/RingoTangs/LearningNote/blob/master/MySQL/MySQL.md">参考笔记</a></p>
<p>使用navcat批量插入数据</p>
<ol>
<li>打开数据库–函数–创建函数</li>
<li>插入以下代码</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">-- 定义一个变量</span></span><br><span class="line"><span class="keyword">declare</span> i <span class="built_in">int</span>;</span><br><span class="line"><span class="comment">-- 初始值</span></span><br><span class="line"><span class="keyword">set</span> i=<span class="number">0</span>;</span><br><span class="line"><span class="comment">-- 循环的次数</span></span><br><span class="line">while i&lt;10 do</span><br><span class="line"><span class="comment">-- insert语句</span></span><br><span class="line"><span class="keyword">insert</span> <span class="keyword">into</span> t2  <span class="keyword">values</span> (<span class="keyword">RAND</span>());</span><br><span class="line"><span class="keyword">set</span> i=i+<span class="number">1</span>;</span><br><span class="line"><span class="keyword">end</span> <span class="keyword">while</span>;</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><a href="https://www.bilibili.com/video/BV1KW411u7vy?p=9">尚硅谷</a></p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--查看所有的数据库引擎</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">engines</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">-- 查看默认的数据库引擎</span></span><br><span class="line"><span class="keyword">show</span> <span class="keyword">variables</span> <span class="keyword">like</span> <span class="string">&#x27;%storage_engine%&#x27;</span>;</span><br></pre></td></tr></table></figure>

<h2 id="两种存储引擎的对比"><a href="#两种存储引擎的对比" class="headerlink" title="两种存储引擎的对比"></a>两种存储引擎的对比</h2><table>
<thead>
<tr>
<th>对比项</th>
<th>MyISAM</th>
<th>InnoDB</th>
</tr>
</thead>
<tbody><tr>
<td>主外键</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>事务</td>
<td>不支持</td>
<td>支持</td>
</tr>
<tr>
<td>行表锁</td>
<td>表锁，即使操作一条记录也会锁住整张表，<strong>不适合高并发操作</strong></td>
<td>行锁，操作时只锁某一行，不对其他行有影响，<strong>适合高并发操作</strong></td>
</tr>
<tr>
<td>缓存</td>
<td>只缓存索引，不缓存真实数据</td>
<td>不仅缓存索引还要缓存真实数据，対内存要求较高，而且内存大小対性能有决定性影响</td>
</tr>
<tr>
<td>表空间</td>
<td>小</td>
<td>大</td>
</tr>
<tr>
<td>关注点</td>
<td>性能</td>
<td>事务</td>
</tr>
<tr>
<td>默认安装</td>
<td>Y</td>
<td>Y</td>
</tr>
</tbody></table>
<h2 id="sql执行加载顺序"><a href="#sql执行加载顺序" class="headerlink" title="sql执行加载顺序"></a>sql执行加载顺序</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">select              # 5</span><br><span class="line">	... </span><br><span class="line">from                # 1</span><br><span class="line">	... </span><br><span class="line">where               # 2</span><br><span class="line">	.... </span><br><span class="line">group by            # 3</span><br><span class="line">	... </span><br><span class="line">having              # 4</span><br><span class="line">	... </span><br><span class="line">order by            # 6</span><br><span class="line">	... </span><br><span class="line">limit               # 7</span><br><span class="line">	[offset]</span><br></pre></td></tr></table></figure>

<h1 id="join讲解"><a href="#join讲解" class="headerlink" title="join讲解"></a>join讲解</h1><h2 id="join图示"><a href="#join图示" class="headerlink" title="join图示"></a>join图示</h2><p><img data-src="/images/mysql/join.jfif" alt="images/mysql/join.jfif"></p>
<p>说明</p>
<ol>
<li>左外连接: LEFT    JOIN</li>
<li>右外连接:  RIGHT JOIN</li>
<li>公共集: INNER JOIN </li>
<li>A左独有: LEFT JOIN A  + B.KEY IS NULL</li>
<li>B右独有: RIGHT JOIN B + A.KEY IS NULL</li>
<li>全有: FULL   OUTER  JOIN </li>
<li>并集无: FUL OUTER JOIN + WHERE A.KEY IS NULL OR B.KEY IS NULL</li>
</ol>
<h2 id="建表语句"><a href="#建表语句" class="headerlink" title="建表语句"></a>建表语句</h2><figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_dept`</span> (</span><br><span class="line">    <span class="string">`id`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    <span class="string">`deptName`</span> <span class="built_in">VARCHAR</span>(<span class="number">30</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`address`</span> <span class="built_in">VARCHAR</span>(<span class="number">40</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`t_emp`</span> (</span><br><span class="line">    <span class="string">`id`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT,</span><br><span class="line">    <span class="string">`name`</span> <span class="built_in">VARCHAR</span>(<span class="number">20</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`age`</span> <span class="built_in">INT</span>(<span class="number">3</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    <span class="string">`deptId`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span>,</span><br><span class="line">    empno <span class="built_in">int</span> <span class="keyword">not</span> <span class="literal">null</span>,</span><br><span class="line">    PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>),</span><br><span class="line">    <span class="keyword">KEY</span> <span class="string">`idx_dept_id`</span> (<span class="string">`deptId`</span>)</span><br><span class="line">    <span class="comment">#CONSTRAINT `fk_dept_id` FOREIGN KEY (`deptId`) REFERENCES `t_dept` (`id`)</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> AUTO_INCREMENT=<span class="number">1</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_dept(deptName,address) <span class="keyword">VALUES</span>(<span class="string">&#x27;华山&#x27;</span>,<span class="string">&#x27;华山&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_dept(deptName,address) <span class="keyword">VALUES</span>(<span class="string">&#x27;丐帮&#x27;</span>,<span class="string">&#x27;洛阳&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_dept(deptName,address) <span class="keyword">VALUES</span>(<span class="string">&#x27;峨眉&#x27;</span>,<span class="string">&#x27;峨眉山&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_dept(deptName,address) <span class="keyword">VALUES</span>(<span class="string">&#x27;武当&#x27;</span>,<span class="string">&#x27;武当山&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_dept(deptName,address) <span class="keyword">VALUES</span>(<span class="string">&#x27;明教&#x27;</span>,<span class="string">&#x27;光明顶&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_dept(deptName,address) <span class="keyword">VALUES</span>(<span class="string">&#x27;少林&#x27;</span>,<span class="string">&#x27;少林寺&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno) <span class="keyword">VALUES</span>(<span class="string">&#x27;风清扬&#x27;</span>,<span class="number">90</span>,<span class="number">1</span>,<span class="number">100001</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno) <span class="keyword">VALUES</span>(<span class="string">&#x27;岳不群&#x27;</span>,<span class="number">50</span>,<span class="number">1</span>,<span class="number">100002</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno) <span class="keyword">VALUES</span>(<span class="string">&#x27;令狐冲&#x27;</span>,<span class="number">24</span>,<span class="number">1</span>,<span class="number">100003</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno) <span class="keyword">VALUES</span>(<span class="string">&#x27;洪七公&#x27;</span>,<span class="number">70</span>,<span class="number">2</span>,<span class="number">100004</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno) <span class="keyword">VALUES</span>(<span class="string">&#x27;乔峰&#x27;</span>,<span class="number">35</span>,<span class="number">2</span>,<span class="number">100005</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno) <span class="keyword">VALUES</span>(<span class="string">&#x27;灭绝师太&#x27;</span>,<span class="number">70</span>,<span class="number">3</span>,<span class="number">100006</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno) <span class="keyword">VALUES</span>(<span class="string">&#x27;周芷若&#x27;</span>,<span class="number">20</span>,<span class="number">3</span>,<span class="number">100007</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno) <span class="keyword">VALUES</span>(<span class="string">&#x27;张三丰&#x27;</span>,<span class="number">100</span>,<span class="number">4</span>,<span class="number">100008</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno) <span class="keyword">VALUES</span>(<span class="string">&#x27;张无忌&#x27;</span>,<span class="number">25</span>,<span class="number">5</span>,<span class="number">100009</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> t_emp(<span class="keyword">NAME</span>,age,deptId,empno) <span class="keyword">VALUES</span>(<span class="string">&#x27;韦小宝&#x27;</span>,<span class="number">18</span>,<span class="literal">null</span>,<span class="number">100010</span>);</span><br></pre></td></tr></table></figure>

<h2 id="join语句"><a href="#join语句" class="headerlink" title="join语句"></a>join语句</h2><p>t_emp 代表图中的A部分.</p>
<p>t_dept 代表图中的B部分</p>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="comment">--第一种 全A,即全部员工</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span>  E a <span class="keyword">left</span> <span class="keyword">join</span> D b <span class="keyword">on</span> a.deptId=b.id;</span><br><span class="line"><span class="comment">--第二种  全B,即全部门</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> E a <span class="keyword">right</span> <span class="keyword">join</span> D b <span class="keyword">on</span> a.deptId=b.id;</span><br><span class="line"><span class="comment">--第三种  公共集,即员工与已存在的部门对应</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> E a <span class="keyword">inner</span> <span class="keyword">join</span> D b <span class="keyword">on</span> a.deptId=b.id;</span><br><span class="line"><span class="comment">--第四种  A的一部分,即查出不在部门内的员工和对应的部门信息</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> E a <span class="keyword">left</span> <span class="keyword">join</span> D b <span class="keyword">on</span>  a.deptId=b.id <span class="keyword">where</span> b.id <span class="keyword">is</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">--第五种  B的一部分,即查出一个空部门</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> E a <span class="keyword">right</span> <span class="keyword">join</span> D b <span class="keyword">on</span>  a.deptId=b.id <span class="keyword">where</span> a.deptId <span class="keyword">is</span> <span class="literal">null</span>;</span><br><span class="line"><span class="comment">--第六种  AB全部,即A独有+AB共有+B独有,MySQL不支持FULL OUTER JOIN这种语法,</span></span><br><span class="line"><span class="comment">--可以用关键字 UNION 去重</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> E a <span class="keyword">left</span> <span class="keyword">join</span> D b <span class="keyword">on</span> a.deptId=b.id</span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> E a <span class="keyword">right</span> <span class="keyword">join</span> D b <span class="keyword">on</span> a.deptId=b.id;</span><br><span class="line"><span class="comment">--第七种  除了公共集以外</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> E a <span class="keyword">left</span> <span class="keyword">join</span> D b <span class="keyword">on</span>  a.deptId=b.id <span class="keyword">where</span> b.id <span class="keyword">is</span> <span class="literal">null</span></span><br><span class="line"><span class="keyword">union</span></span><br><span class="line"><span class="keyword">select</span> * <span class="keyword">from</span> E a <span class="keyword">right</span> <span class="keyword">join</span> D b <span class="keyword">on</span>  a.deptId=b.id <span class="keyword">where</span> a.deptId <span class="keyword">is</span> <span class="literal">null</span>;</span><br></pre></td></tr></table></figure>

<h1 id="索引"><a href="#索引" class="headerlink" title="索引"></a>索引</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p>MySQL官方对索引的定义为：<strong>索引（INDEX）是帮助MySQL高效获取数据的数据结果。</strong></p>
<p>从而可以获得索引的本质：<strong>索引是排好序的快速查找数据结构。</strong></p>
<p>索引的目的在于提高查询效率，可以类比字典的目录。如果要查<code>mysql</code>这个这个单词，我们肯定要先定位到<code>m</code>字母，然后从上往下找<code>y</code>字母，再找剩下的<code>sql</code>。如果没有索引，那么可能需要<code>a---z</code>，这样全字典扫描，如果我想找<code>Java</code>开头的单词呢？如果我想找<code>Oracle</code>开头的单词呢？？？</p>
<p><strong>重点：索引会影响到MySQL查找(WHERE的查询条件)和排序(ORDER BY)两大功能！</strong></p>
<p><strong>除了数据本身之外，数据库还维护着一个满足特定查找算法的数据结构，这些数据结构以某种方式指向数据，这样就可以在这些数据结构的基础上实现高级查找算法，这种数据结构就是索引。</strong></p>
<p>一般来说，索引本身也很大，不可能全部存储在内存中，因此索引往往以索引文件的形式存储在磁盘上。</p>
<h2 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h2><p>优势：</p>
<ul>
<li><p>提高数据检索的效率，降低数据库的IO成本。</p>
</li>
<li><p>通过索引列对数据进行排序，降低数据排序的成本，降低了CPU的消耗。</p>
</li>
</ul>
<p>劣势：</p>
<ul>
<li>虽然索引大大提高了查询速度，同时却会降低更新表的速度，如对表进行INSERT、UPDATE和DELETE。因为更新表时，MySQL不仅要保存数据，还要保存一下索引文件每次更新添加了索引列的字段，都会调整因为更新所带来的键值变化后的索引信息。</li>
<li>实际上索引也是一张表，该表保存了主键与索引字段，并指向实体表的记录，所以索引列也是要占用空间的。</li>
</ul>
<h2 id="索引的创建时机"><a href="#索引的创建时机" class="headerlink" title="索引的创建时机"></a>索引的创建时机</h2><h3 id="适合创建索引的情况"><a href="#适合创建索引的情况" class="headerlink" title="适合创建索引的情况"></a>适合创建索引的情况</h3><p> 主键自动建立唯一索引；<br> 频繁作为查询条件的字段应该创建索引<br> 查询中与其它表关联的字段，外键关系建立索引<br> 单键/组合索引的选择问题， 组合索引性价比更高<br> 查询中排序的字段，排序字段若通过索引去访问将大大提高排序速度<br> 查询中统计或者分组字段</p>
<h3 id="不适合创建索引的情况"><a href="#不适合创建索引的情况" class="headerlink" title="不适合创建索引的情况"></a>不适合创建索引的情况</h3><p> 表记录太少<br> 经常增删改的表或者字段<br> Where 条件里用不到的字段不创建索引<br> 过滤性不好的不适合建索引</p>
<h2 id="索引分类"><a href="#索引分类" class="headerlink" title="索引分类"></a>索引分类</h2><h3 id="单值索引"><a href="#单值索引" class="headerlink" title="单值索引"></a>单值索引</h3><p>即一个索引只包含单个列，一个表可以有多个单列索引</p>
<h3 id="唯一索引"><a href="#唯一索引" class="headerlink" title="唯一索引"></a>唯一索引</h3><p>索引列的值必须唯一，但是允许空值。</p>
<h3 id="主键索引"><a href="#主键索引" class="headerlink" title="主键索引"></a>主键索引</h3><p> 设定为主键后数据库会自动建立索引，innodb为聚簇索引</p>
<h3 id="复合索引"><a href="#复合索引" class="headerlink" title="复合索引"></a>复合索引</h3><p>一个索引包含多个字段。</p>
<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><p><a href="https://github.com/RingoTangs/LearningNote/blob/master/MySQL/MySQL.md">github 笔记分享</a></p>
<p><strong>建议：一张表建的索引最好不要超过5个！</strong></p>
<p>使用<code>ALTER</code>来创建索引</p>
<blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#x2F;* 1、该语句添加一个主键，这意味着索引值必须是唯一的，并且不能为NULL *&#x2F;</span><br><span class="line">ALTER TABLE tabName ADD PRIMARY KEY(column_list);</span><br><span class="line"></span><br><span class="line">&#x2F;* 2、该语句创建索引的键值必须是唯一的(除了NULL之外，NULL可能会出现多次) *&#x2F;</span><br><span class="line">ALTER TABLE tabName ADD UNIQUE indexName(column_list);</span><br><span class="line"></span><br><span class="line">&#x2F;* 3、该语句创建普通索引，索引值可以出现多次 *&#x2F;</span><br><span class="line">ALTER TABLE tabName ADD INDEX indexName(column_list);</span><br><span class="line"></span><br><span class="line">&#x2F;* 4、该语句指定了索引为FULLTEXT，用于全文检索 *&#x2F;</span><br><span class="line">ALTER TABLE tabName ADD FULLTEXT indexName(column_list);</span><br></pre></td></tr></table></figure>
</blockquote>
<h2 id="索引结构"><a href="#索引结构" class="headerlink" title="索引结构"></a>索引结构</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><p>索引结构分为<code>BTree</code>索引、 <code>Hash</code>索引、 <code>Full-text</code>全文索引、<code>R-Tree</code>索引。</p>
<p>目前学习阶段，重点在<code>BTree</code>索引</p>
<h3 id="BTree索引"><a href="#BTree索引" class="headerlink" title="BTree索引"></a>BTree索引</h3><p>BTree索引图示:</p>
<p><img data-src="/images/mysql/BTree.png"></p>
<p>【查找过程】<br>如果要查找数据项 29，那么首先会把磁盘块 1 由磁盘加载到内存，此时发生一次 IO，在内存中用二分查找确定 29在 17 和 35 之间，锁定磁盘块 1 的 P2 指针，内存时间因为非常短（相比磁盘的 IO）可以忽略不计，通过磁盘块 1的 P2 指针的磁盘地址把磁盘块 3 由磁盘加载到内存，发生第二次 IO，29 在 26 和 30 之间，锁定磁盘块 3 的 P2 指针，通过指针加载磁盘块 8 到内存，发生第三次 IO，同时内存中做二分查找找到 29，结束查询，总计三次 IO。</p>
<p>真实的情况是，3 层的 b+树可以表示上百万的数据，如果上百万的数据查找只需要三次 IO，性能提高将是巨大的，<br>如果没有索引，每个数据项都要发生一次 IO，那么总共需要百万次的 IO，显然成本非常非常高。</p>
<p>B+Tree索引图示:</p>
<p><img data-src="/images/mysql/B+tree.png"></p>
<p>B+Tree 与 B-Tree 的区别<br>1）B-树的关键字和记录是放在一起的，叶子节点可以看作外部节点，不包含任何信息；B+树的非叶子节点中只有关键字和指向下一个节点的索引，记录只放在叶子节点中。<br>2）在 B-树中，越靠近根节点的记录查找时间越快，只要找到关键字即可确定记录的存在；而 B+树中每个记录的查找时间基本是一样的，都需要从根节点走到叶子节点，而且在叶子节点中还要再比较关键字。从这个角度看 B-树的性能好像要比 B+树好，而在实际应用中却是 B+树的性能要好些。因为 B+树的非叶子节点不存放实际的数据，这样每个节点可容纳的元素个数比 B-树多，树高比 B-树小，这样带来的好处是减少磁盘访问次数。尽管 B+树找到一个记录所需的比较次数要比 B-树多，但是一次磁盘访问的时间相当于成百上千次内存比较的时间，因此实际中B+树的性能可能还会好些，而且 B+树的叶子节点使用指针连接在一起，方便顺序遍历（例如查看一个目录下的所有<br>文件，一个表中的所有记录等），这也是很多数据库和文件系统使用 B+树的缘故。</p>
<h1 id="Explain-性能分析"><a href="#Explain-性能分析" class="headerlink" title="Explain 性能分析"></a>Explain 性能分析</h1><h2 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h2><p>使用 EXPLAIN 关键字可以模拟优化器执行 SQL 查询语句，从而知道 MySQL 是如何处理你的 SQL 语句的。分析你的查询语句或是表结构的性能瓶颈。</p>
<p>用法： Explain+SQL 语句。</p>
<p>Explain 执行后返回的信息：</p>
<p><img data-src="/images/mysql/explain.jpg"></p>
<h2 id="名词解释"><a href="#名词解释" class="headerlink" title="名词解释"></a>名词解释</h2><blockquote>
<p>id</p>
</blockquote>
<p><code>id</code>:select 查询的序列号,包含一组数字，表示查询中执行 select 子句或操作的表的的读取和加载顺序。</p>
<p>值分为三种情况</p>
<ul>
<li><code>id</code>相同，执行顺序由上至下。</li>
<li><code>id</code>不同，如果是子查询，id的序号会递增，<strong>id值越大优先级越高，越先被执行。</strong></li>
<li><code>id</code>相同不同，同时存在。<strong>永远是id大的优先级最高，id相等的时候顺序执行。</strong></li>
</ul>
<p>id 如果相同，可以认为是一组，从上往下顺序执行；在所有组中，id 值越大，优先级越高，越先执行(DERIVED的翻译是衍生)</p>
<p>关注点：id 号每个号码，表示一趟独立的查询。一个 sql 的查询趟数越少越好。</p>
<blockquote>
<p>select_type</p>
</blockquote>
<p><code>select_type</code>：数据查询的类型，主要是用于区别普通查询、联合查询、子查询等的复杂查询。</p>
<ul>
<li><code>SIMPLE</code>：简单的<code>SELECT</code>查询，查询中不包含子查询或者<code>UNION </code>。</li>
<li><code>PRIMARY</code>：查询中如果包含任何复杂的子部分，最外层查询则被标记为<code>PRIMARY</code>,简单理解就是最后加载的表是<code>PRIMARY</code>。</li>
<li><code>SUBQUERY</code>：在<code>SELECT</code>或者<code>WHERE</code>子句中包含了子查询。</li>
<li><code>DERIVED</code>：在<code>FROM</code>子句中包含的子查询被标记为<code>DERIVED(衍生)</code>，MySQL会递归执行这些子查询，把结果放在临时表中。</li>
<li><code>UNION</code>：如果第二个<code>SELECT</code>出现在<code>UNION</code>之后，则被标记为<code>UNION</code>；若<code>UNION</code>包含在<code>FROM</code>子句的子查询中，外层<code>SELECT</code>将被标记为<code>DERIVED</code>。</li>
<li><code>UNION RESULT</code>：从<code>UNION</code>表获取结果的<code>SELECT</code>。</li>
</ul>
<blockquote>
<p>type</p>
</blockquote>
<p><code>type</code>：访问类型排列。</p>
<p><strong>从最好到最差依次是：</strong><code>system</code>&gt;<code>const</code>&gt;<code>eq_ref</code>&gt;<code>ref</code>&gt;<code>range</code>&gt;<code>index</code>&gt;<code>ALL</code>。除了<code>ALL</code>没有用到索引，其他级别都用到索引了。</p>
<p>一般来说，得保证查询至少达到<code>range</code>级别，最好达到<code>ref</code>。</p>
<ul>
<li><code>system</code>：表只有一行记录（等于系统表），这是const类型的特例，平时不会出现，这个也可以忽略不计。</li>
<li><code>const</code>：表示通过索引一次就找到了，const用于比较primary key或者unique索引。因为只匹配一行数据，所以很快。如将主键置于where列表中，MySQL就能将该查询转化为一个常量。<code>select * from (select * from t1 where id =1) d1</code>中,id=1就是常量,一个明确指出来的数据。</li>
<li><code>eq_ref</code>：唯一性索引扫描，读取本表中和关联表表中的每行组合成的一行，查出来只有一条记录。除 了 <code>system</code> 和<code> const</code> 类型之外, 这是最好的联接类型。</li>
<li><code>ref</code>：非唯一性索引扫描，返回匹配某个单独值的所有行.本质上也是一种索引访问，它返回所有匹配某个单独值的行，然而，它可能会找到多个符合条件的行，所以他应该属于查找和扫描的混合体。</li>
<li><code>range</code>：只检索给定范围的行，一般就是在<code>WHERE</code>语句中出现了<code>BETWEEN</code>、<code>&lt; &gt;</code>、<code>in</code>等的查询。这种范围扫描索引比全表扫描要好，因为它只需要开始于索引树的某一点，而结束于另一点，不用扫描全部索引。</li>
<li><code>index</code>：<code>Full Index Scan</code>，全索引扫描，<code>index</code>和<code>ALL</code>的区别为<code>index</code>类型只遍历索引树。<strong>也就是说虽然<code>ALL</code>和<code>index</code>都是读全表，但是<code>index</code>是从索引中读的，<code>ALL</code>是从磁盘中读取的。</strong></li>
<li><code>ALL</code>：<code>Full Table Scan</code>，没有用到索引，全表扫描。</li>
</ul>
<blockquote>
<p>possible_keys 和 key</p>
</blockquote>
<p><code>possible_keys</code>：显示可以应用在本表上的索引，一个或者多个。查询涉及到的字段上若存在索引，则该索引将被列出，<strong>但不一定被查询实际使用。</strong></p>
<p><code>key</code>：实际使用的索引,如果为<code>NULL</code>，则没有使用索引。查询中如果使用了覆盖索引，则该索引仅仅出现在<code>key</code>列表中。</p>
<blockquote>
<p>key_len</p>
</blockquote>
<p><code>key_len</code>：表示索引中使用的字节数，可通过该列计算查询中使用的索引的长度。<code>key_len</code>显示的值为索引字段的最大可能长度，并非实际使用长度，即<code>key_len</code>是根据表定义计算而得，不是通过表内检索出的。<strong>在不损失精度的情况下，长度越短越好。</strong></p>
<p><code>key_len</code>计算规则：<strong><a href="https://blog.csdn.net/qq_34930488/article/details/102931490">https://blog.csdn.net/qq_34930488/article/details/102931490</a></strong></p>
<blockquote>
<p>ref</p>
</blockquote>
<p><code>ref</code>：显示索引的哪一列被使用了，如果可能的话，是一个常数。哪些列或常量被用于查找索引列上的值。</p>
<blockquote>
<p>rows</p>
</blockquote>
<p><code>rows</code>：根据表统计信息及索引选用情况，大致估算出找到所需的记录需要读取的行数即每张表被多少个优化器查询,<strong>行数越小越好</strong></p>
<blockquote>
<p>Extra</p>
</blockquote>
<p><code>Extra</code>：包含不适合在其他列中显示但十分重要的额外信息。</p>
<ul>
<li><code>Using filesort</code>：说明MySQL会对数据使用一个外部的索引排序，而不是按照表内的索引顺序进行读取。<strong>MySQL中无法利用索引完成的排序操作称为”文件内排序”。</strong></li>
<li><code>Using temporary</code>：使用了临时表保存中间结果，MySQL在対查询结果排序时使用了临时表。常见于排序<code>order by</code>和分组查询<code>group by</code>。<strong>临时表対系统性能损耗很大。</strong></li>
<li><code>Using index</code>：表示相应的<code>SELECT</code>操作中使用了覆盖索引，避免访问了表的数据行，效率不错！如果同时出现<code>Using where</code>，表示索引被用来执行索引键值的查找；如果没有同时出现<code>Using where</code>，表明索引用来读取数据而非执行查找动作。</li>
<li><code>Using where</code>：表明使用了<code>WHERE</code>过滤。</li>
<li><code>Using join buffer</code>：使用了连接缓存。</li>
<li><code>impossible where</code>：<code>WHERE</code>子句的值总是false，不能用来获取任何元组。eg: <code>select * from tea where name = &#39;张三&#39; and name =&#39;李四&#39;;</code></li>
</ul>
]]></content>
      <categories>
        <category>mysql</category>
      </categories>
      <tags>
        <tag>sql</tag>
      </tags>
  </entry>
  <entry>
    <title>多线程</title>
    <url>/2020/03/24/java/%E5%A4%9A%E7%BA%BF%E7%A8%8B/</url>
    <content><![CDATA[<p><a href="https://www.bilibili.com/video/BV1V4411p7EF?p=2">狂神说视频地址</a></p>
<p><a href="https://www.bilibili.com/video/BV1Rk4y1B7By?p=1">尚学堂视频地址</a></p>
<h1 id="实现线程"><a href="#实现线程" class="headerlink" title="实现线程"></a>实现线程</h1><h2 id="继承Thread类"><a href="#继承Thread类" class="headerlink" title="继承Thread类"></a>继承Thread类</h2><h3 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h3><ol>
<li>继承类Thread</li>
<li>重写run方法</li>
<li>用自定义线程的实例去启动线程</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;自定义线程---&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//自定义线程</span></span><br><span class="line">        <span class="keyword">new</span> MyThread().start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;主线程---&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="下载图片例子"><a href="#下载图片例子" class="headerlink" title="下载图片例子"></a>下载图片例子</h3><ol>
<li>利用多线程,下载一个图片到本地</li>
<li>需要用到<code>commons-io</code>包</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PictureThread</span> <span class="keyword">extends</span> <span class="title">Thread</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PictureThread</span><span class="params">(String url, String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.url = url;</span><br><span class="line">        <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> DownloadPicture().down(url, fileName);</span><br><span class="line">        System.out.println(<span class="string">&quot;下载了&quot;</span>+fileName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String url = <span class="string">&quot;https://p2.music.126.net/ElRT-ChRgyTkWYK7xNrc2w==/18876415626032363.jpg&quot;</span>;</span><br><span class="line">        PictureThread p1 = <span class="keyword">new</span> PictureThread(url, <span class="string">&quot;p1.png&quot;</span>);</span><br><span class="line">        PictureThread p2 = <span class="keyword">new</span> PictureThread(url, <span class="string">&quot;p2.png&quot;</span>);</span><br><span class="line">        PictureThread p3 = <span class="keyword">new</span> PictureThread(url, <span class="string">&quot;p3.png&quot;</span>);</span><br><span class="line">        PictureThread p4 = <span class="keyword">new</span> PictureThread(url, <span class="string">&quot;p4.png&quot;</span>);</span><br><span class="line">        p1.start();</span><br><span class="line">        p2.start();</span><br><span class="line">        p3.start();</span><br><span class="line">        p4.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//下载器类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DownloadPicture</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">down</span><span class="params">(String url, String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyURLToFile(<span class="keyword">new</span> URL(url), <span class="keyword">new</span> File(fileName));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;IO异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="实现Runnable接口"><a href="#实现Runnable接口" class="headerlink" title="实现Runnable接口"></a>实现Runnable接口</h2><h3 id="实现-1"><a href="#实现-1" class="headerlink" title="实现"></a>实现</h3><ol>
<li>实现<code>Runnable</code>接口</li>
<li>调用Runnable接口的实现类</li>
<li>启动线程</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;自定义线程---&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> MyThread()).start();</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">20</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;主线程---&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="多线程下载图片例子"><a href="#多线程下载图片例子" class="headerlink" title="多线程下载图片例子"></a>多线程下载图片例子</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PictureThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String fileName;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">PictureThread</span><span class="params">(String url, String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.url = url;</span><br><span class="line">        <span class="keyword">this</span>.fileName = fileName;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">new</span> DownloadPicture().down(url, fileName);</span><br><span class="line">        System.out.println(<span class="string">&quot;下载了&quot;</span>+fileName);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        String url = <span class="string">&quot;https://p2.music.126.net/ElRT-ChRgyTkWYK7xNrc2w==/18876415626032363.jpg&quot;</span>;</span><br><span class="line">        PictureThread p1 = <span class="keyword">new</span> PictureThread(url, <span class="string">&quot;p1.png&quot;</span>);</span><br><span class="line">        PictureThread p2 = <span class="keyword">new</span> PictureThread(url, <span class="string">&quot;p2.png&quot;</span>);</span><br><span class="line">        PictureThread p3 = <span class="keyword">new</span> PictureThread(url, <span class="string">&quot;p3.png&quot;</span>);</span><br><span class="line">        PictureThread p4 = <span class="keyword">new</span> PictureThread(url, <span class="string">&quot;p4.png&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(p1).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(p2).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(p3).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(p4).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//下载器类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">DownloadPicture</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">down</span><span class="params">(String url, String fileName)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            FileUtils.copyURLToFile(<span class="keyword">new</span> URL(url), <span class="keyword">new</span> File(fileName));</span><br><span class="line">        &#125; <span class="keyword">catch</span> (IOException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;IO异常&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="线程的六大状态"><a href="#线程的六大状态" class="headerlink" title="线程的六大状态"></a>线程的六大状态</h1><h2 id="查看线程的状态"><a href="#查看线程的状态" class="headerlink" title="查看线程的状态"></a>查看线程的状态</h2><p>在jdk的文档里，线程的状态分为以下几种</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">new 线程尚未开始在这个国家。</span><br><span class="line">runnable    处于这种状态中的java虚拟机执行的线程。</span><br><span class="line">blocked   线程阻塞等待监控锁在这个国家。</span><br><span class="line">waiting    处于这种状态的线程被无限期地等待另一个线程来执行特定的动作。</span><br><span class="line">timed_waiting   处于这种状态的线程正在等待另一个线程上执行一个动作指定的等待时间。</span><br><span class="line">terminated   处于这种状态的线程退出。</span><br></pre></td></tr></table></figure>

<p>我们可以用代码来查看线程的状态</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyThread01</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread() &#123;</span><br><span class="line">            <span class="meta">@Override</span></span><br><span class="line">            <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">                System.out.println(<span class="string">&quot;....&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;;</span><br><span class="line">        Thread.State state = t1.getState();</span><br><span class="line">        <span class="comment">//NEW  线程尚未开始</span></span><br><span class="line">        System.out.println(state);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        state = t1.getState();</span><br><span class="line">        <span class="comment">//RUNNABLE  处于这种状态中的java虚拟机执行的线程,俗称运行中</span></span><br><span class="line">        System.out.println(state);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><a href="https://www.bilibili.com/video/BV1Rk4y1B7By?p=11">尚学堂</a></p>
<p><img data-src="/images/javase/thread.png"></p>
<blockquote>
<p>New：新创建的线程，尚未执行； </p>
<p>Runnable：运行中的线程，正在执行run()方法的Java代码； </p>
<p>Blocked：运行中的线程，因为某些操作被阻塞而挂起； </p>
<p>Waiting：运行中的线程，因为某些操作在等待中； </p>
<p>Timed Waiting：运行中的线程，因为执行sleep()方法正在计时等待； </p>
<p>Terminated：线程已终止，因为run()方法执行完毕。</p>
</blockquote>
<blockquote>
<ol>
<li>new   进入到新生状态</li>
<li>调用start方法，进入就绪状态</li>
<li>cpu调度，进入到运行状态</li>
<li>运行状态中出现问题，进入阻塞状态</li>
<li>线程正常终止或者用加入标志位的方法停止线程，进入死亡状态</li>
</ol>
</blockquote>
<h2 id="终止"><a href="#终止" class="headerlink" title="终止"></a>终止</h2><p>终止线程一般分为两种情况</p>
<ol>
<li>线程自动停止,自动停止指的是次数的限制,比如执行了100次,自己停止。</li>
<li>加入外部标识,通过外部标识来停止线程。</li>
<li>不要使用stop或者destory这样的方法，已废弃。</li>
</ol>
<p>线程终止例子</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TerminateThread</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//1.加入标识符</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">int</span> i = <span class="number">0</span>;</span><br><span class="line">        <span class="comment">//2. 关联标识</span></span><br><span class="line">        <span class="keyword">while</span> (flag) &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt;&quot;</span> + i++);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//3.对外提供方法改变标识</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">terminate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.flag = <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TerminateThread t1 = <span class="keyword">new</span> TerminateThread();</span><br><span class="line">        <span class="keyword">new</span> Thread(t1, <span class="string">&quot;C罗&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;= <span class="number">99</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span> (i == <span class="number">88</span>) &#123;</span><br><span class="line">                <span class="comment">//终止线程</span></span><br><span class="line">                t1.terminate();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(<span class="string">&quot;主线程==&gt;&quot;</span> + i);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="阻塞"><a href="#阻塞" class="headerlink" title="阻塞"></a>阻塞</h2><h3 id="sleep"><a href="#sleep" class="headerlink" title="sleep"></a>sleep</h3><ol>
<li>sleep会抱着资源睡觉，拿走锁，并且不会释放锁</li>
<li>由原来的运行状态，进入到阻塞状态</li>
<li>sleep设定的时间执行完毕后，进入就绪状态</li>
</ol>
<blockquote>
<p>原来正在运行—(sleep)—–阻塞—(时间执行完毕)—就绪(等待CPU调度)—运行—死亡</p>
</blockquote>
<h3 id="yield"><a href="#yield" class="headerlink" title="yield"></a>yield</h3><p><strong>礼让不一定成功</strong></p>
<ol>
<li>跟sleep一样，可以让线程休眠</li>
<li>yield直接让线程从运行状态，跳回就绪状态</li>
<li>yield礼让线程，退让线程，让CPU调度器重新调度</li>
</ol>
<h3 id="join"><a href="#join" class="headerlink" title="join"></a>join</h3><ol>
<li><p>join合并线程，待此线程执行完毕后，再执行其他线程，其他线程阻塞</p>
</li>
<li><p>join被Thread的实例对象使用</p>
</li>
<li><p>join可以传递一个毫秒数，如果毫秒数过去了，还不执行，CPU就不管了，直接调度别的线程</p>
</li>
</ol>
<blockquote>
<p>通过一个儿子给老爸买烟的小例子，来实践一下线程合并，儿子加入线程，爸爸线程被阻塞</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">FatherAndSon</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;老爸让儿子去买烟的故事&quot;</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(<span class="keyword">new</span> Father()).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Father</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;老爸想抽烟了,发现烟没了&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;拿出零钱,让儿子去买烟&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;儿子过来了&quot;</span>);</span><br><span class="line">        Thread son = <span class="keyword">new</span> Thread(<span class="keyword">new</span> Son());</span><br><span class="line">        son.start();</span><br><span class="line">        <span class="comment">//儿子加入</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            son.join();</span><br><span class="line">            System.out.println(<span class="string">&quot;加入成功&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;老爸接过烟, 把零钱给了儿子..&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            System.out.println(<span class="string">&quot;加入失败&quot;</span>);</span><br><span class="line">            System.out.println(<span class="string">&quot;老爸出门去找儿子&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Son</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;儿子接过钱出门了&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;看到路边有个游戏厅,进去玩十秒&quot;</span>);</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(i + <span class="string">&quot;秒过去了....&quot;</span>);</span><br><span class="line">                Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;赶紧去买烟&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;买了一包烟&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">老爸让儿子去买烟的故事</span><br><span class="line">老爸想抽烟了,发现烟没了</span><br><span class="line">拿出零钱,让儿子去买烟</span><br><span class="line">儿子过来了</span><br><span class="line">儿子接过钱出门了</span><br><span class="line">看到路边有个游戏厅,进去玩十秒</span><br><span class="line">0秒过去了....</span><br><span class="line">1秒过去了....</span><br><span class="line">2秒过去了....</span><br><span class="line">3秒过去了....</span><br><span class="line">4秒过去了....</span><br><span class="line">5秒过去了....</span><br><span class="line">6秒过去了....</span><br><span class="line">7秒过去了....</span><br><span class="line">8秒过去了....</span><br><span class="line">9秒过去了....</span><br><span class="line">赶紧去买烟</span><br><span class="line">买了一包烟</span><br><span class="line">加入成功</span><br><span class="line">老爸接过烟, 把零钱给了儿子..</span><br></pre></td></tr></table></figure>

<h1 id="优先级"><a href="#优先级" class="headerlink" title="优先级"></a>优先级</h1><p><a href="https://www.bilibili.com/video/BV1Rk4y1B7By?p=16">尚学堂视频地址</a></p>
<p>优先级代表的是概率的大小，不代表运行顺序，运行的取值范围是1~10，优先级需要在start之前设置</p>
<blockquote>
<p>MAX_PRIORITY  最大优先级–10<br>MIN_PRIORITY  最小优先级–1<br>NORM_PRIORITY 默认优先级–5</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MaxTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt;&quot;</span>+Thread.currentThread().getPriority());</span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> myP(),<span class="string">&quot;t1&quot;</span>);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> myP(),<span class="string">&quot;t2&quot;</span>);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(<span class="keyword">new</span> myP(),<span class="string">&quot;t3&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="comment">//一定要在运行前设置优先级</span></span><br><span class="line">        t1.setPriority(Thread.MAX_PRIORITY);</span><br><span class="line">        t2.setPriority(Thread.MIN_PRIORITY);</span><br><span class="line">        t3.setPriority(Thread.NORM_PRIORITY);</span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">myP</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt;&quot;</span>+Thread.currentThread().getPriority());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="守护线程"><a href="#守护线程" class="headerlink" title="守护线程"></a>守护线程</h1><blockquote>
<p>守护线程是指为其他线程服务的线程。在JVM中，所有非守护线程都执行完毕后，无论有没有守护线程，虚拟机都会自动退出。</p>
<p>因此，JVM退出时，不必关心守护线程是否已结束。</p>
<p>所有非守护线程都执行完毕后，虚拟机退出；</p>
<p>守护线程不能持有需要关闭的资源（如打开文件等）</p>
</blockquote>
<p>以下例子说明，当用户线程执行的时候，上帝线程会一直执行，当用户线程执行完毕，上帝线程也会自动关闭</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DaemoDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        God god = <span class="keyword">new</span> God();</span><br><span class="line">        My my = <span class="keyword">new</span> My();</span><br><span class="line"></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(god);</span><br><span class="line">        t1.setDaemon(<span class="keyword">true</span>);</span><br><span class="line">        t1.start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(my).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//上帝</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">God</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;上帝保佑着你&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//我</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">My</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            System.out.println(i + <span class="string">&quot;天过去了...&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;goodBuy World&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="并发（线程同步）"><a href="#并发（线程同步）" class="headerlink" title="并发（线程同步）"></a>并发（线程同步）</h1><h2 id="购票不安全示例"><a href="#购票不安全示例" class="headerlink" title="购票不安全示例"></a>购票不安全示例</h2><p><a href="https://www.bilibili.com/video/BV1V4411p7EF?p=19">视频观看地址</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*线程不安全，有负数，多个人买同一张票</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ticket</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        ByTicket byTicket = <span class="keyword">new</span> ByTicket();</span><br><span class="line"></span><br><span class="line">        Thread t1 = <span class="keyword">new</span> Thread(byTicket, <span class="string">&quot;小明&quot;</span>);</span><br><span class="line">        Thread t2 = <span class="keyword">new</span> Thread(byTicket, <span class="string">&quot;老师&quot;</span>);</span><br><span class="line">        Thread t3 = <span class="keyword">new</span> Thread(byTicket, <span class="string">&quot;黄牛党&quot;</span>);</span><br><span class="line"></span><br><span class="line">        t1.start();</span><br><span class="line">        t2.start();</span><br><span class="line">        t3.start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">ByTicket</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="comment">//定义一个票</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> tickNum = <span class="number">10</span>;</span><br><span class="line">    <span class="comment">//定义一个标志位</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//买票</span></span><br><span class="line">        <span class="keyword">while</span> (flag) &#123;</span><br><span class="line">            buy();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//买票</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span>  <span class="keyword">void</span> <span class="title">buy</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//判断是否有票</span></span><br><span class="line">        <span class="keyword">if</span> (tickNum &lt;= <span class="number">0</span>) &#123;</span><br><span class="line">            flag = <span class="keyword">false</span>;</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;拿到了&quot;</span> + (tickNum--));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="List不安全示例"><a href="#List不安全示例" class="headerlink" title="List不安全示例"></a>List不安全示例</h2><p><a href="https://www.bilibili.com/video/BV1Rk4y1B7By?p=19">尚学堂视频地址 </a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (list) &#123;</span><br><span class="line">                list.add(Thread.currentThread().getName());</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(list.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>更改为安全锁</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    CopyOnWriteArrayList&lt;String&gt; list = <span class="keyword">new</span> CopyOnWriteArrayList&lt;String&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10000</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            list.add(Thread.currentThread().getName());</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">    Thread.sleep(<span class="number">100</span>);</span><br><span class="line">    System.out.println(list.size());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="死锁"><a href="#死锁" class="headerlink" title="死锁"></a>死锁</h1><p>并发的时候，对同一个对象添加了过多的锁，导致AB双方都抱着对方的锁不释放，就形成了死锁，死锁会一直等待。</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LockDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MarkUp m1 = <span class="keyword">new</span> MarkUp(<span class="number">0</span>);</span><br><span class="line">        MarkUp m2 = <span class="keyword">new</span> MarkUp(<span class="number">1</span>);</span><br><span class="line">        <span class="keyword">new</span> Thread(m1, <span class="string">&quot;灰姑凉&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(m2, <span class="string">&quot;白雪公主&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//口红</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Lipstick</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//镜子</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Mirror</span> </span>&#123;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//化妆</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MarkUp</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="comment">//一个口红,一个镜子,为了确保是一个,加static</span></span><br><span class="line">    <span class="keyword">static</span> Lipstick lipstick = <span class="keyword">new</span> Lipstick();</span><br><span class="line">    <span class="keyword">static</span> Mirror mirror = <span class="keyword">new</span> Mirror();</span><br><span class="line">    <span class="comment">//选择</span></span><br><span class="line">    <span class="keyword">int</span> choice;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">MarkUp</span><span class="params">(<span class="keyword">int</span> choice)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.choice = choice;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//化妆</span></span><br><span class="line">        markUp();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//相互持有对方锁</span></span><br><span class="line">    <span class="function"><span class="keyword">private</span> <span class="keyword">void</span> <span class="title">markUp</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (choice == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (lipstick) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;获得口红&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;休息一秒后,&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;想要获得镜子&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (mirror) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;获得镜子&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            <span class="keyword">synchronized</span> (mirror) &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;获得镜子&quot;</span>);</span><br><span class="line">                System.out.println(<span class="string">&quot;休息两秒后,&quot;</span> + Thread.currentThread().getName() + <span class="string">&quot;想要获得口红&quot;</span>);</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">2000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                <span class="keyword">synchronized</span> (lipstick) &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;获得口红&quot;</span>);</span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Lock锁"><a href="#Lock锁" class="headerlink" title="Lock锁"></a>Lock锁</h1><ol>
<li>lock锁为显示声明的锁</li>
<li>lock只能锁代码块</li>
<li>lock锁要写在try catch finally语句块里</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TicketLock</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TickerL t1 = <span class="keyword">new</span> TickerL();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(t1, <span class="string">&quot;一号&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(t1, <span class="string">&quot;二号&quot;</span>).start();</span><br><span class="line">        <span class="keyword">new</span> Thread(t1, <span class="string">&quot;三号&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TickerL</span> <span class="keyword">implements</span> <span class="title">Runnable</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> tickNum = <span class="number">10</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> ReentrantLock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (<span class="keyword">true</span>) &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">try</span> &#123;</span><br><span class="line">                    Thread.sleep(<span class="number">1000</span>);</span><br><span class="line">                &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                    e.printStackTrace();</span><br><span class="line">                &#125;</span><br><span class="line">                lock.lock();</span><br><span class="line">                <span class="keyword">if</span> (tickNum &gt; <span class="number">0</span>) &#123;</span><br><span class="line"></span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;--&quot;</span> + tickNum--);</span><br><span class="line">                &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                    <span class="keyword">break</span>;</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">                lock.unlock();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="生产消费者问题"><a href="#生产消费者问题" class="headerlink" title="生产消费者问题"></a>生产消费者问题</h1><p><a href="https://www.bilibili.com/video/BV1V4411p7EF?p=24">狂神说</a></p>
<p><a href="https://www.bilibili.com/video/BV1B7411L7tE?p=7&spm_id_from=pageDriver">传统的消费者和生产者问题</a></p>
<blockquote>
<p><strong>传统的代码太过于繁琐,可以直接使用JUC</strong></p>
</blockquote>
<p>Java提供了几个方法解决线程之间的通信问题</p>
<p>wait()  表示线程一直等待,直到其他线程通知,与leep不同，会释放锁<br>wait(long timeout)  指定等待的毫秒数<br>notify()  唤醒一个处于等待状态的线程<br>notifyAll()  唤醒同-个对象上所有调用wait()方法的线程，优先级 别高的线程优先调度</p>
<p>注意:均是0bject类的方法,都只能在同步方法或者同步代码块中使用，否则会抛出异常legalMonitorStateException</p>
<blockquote>
<p>代码演示</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//测试：生产者消费者模型--&gt;利用缓冲区解决：管程法</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPC</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SynContainer synContainer = <span class="keyword">new</span> SynContainer();</span><br><span class="line">        <span class="keyword">new</span> Productor(synContainer).start();</span><br><span class="line">        <span class="keyword">new</span> Consumer(synContainer).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//生产者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Productor</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    SynContainer synContainer;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Productor</span><span class="params">(SynContainer synContainer)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.synContainer = synContainer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//生产</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">15</span>; i++) &#123;</span><br><span class="line">            synContainer.push(<span class="keyword">new</span> Chicken(i));</span><br><span class="line">            System.out.println(<span class="string">&quot;生产了&quot;</span>+i+<span class="string">&quot;只鸡&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//消费者</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Consumer</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    SynContainer synContainer;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Consumer</span><span class="params">(SynContainer synContainer)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.synContainer = synContainer;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//消费</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">15</span>; i++) &#123;</span><br><span class="line">            System.out.println(<span class="string">&quot;消费了第&quot;</span>+synContainer.pop().id +<span class="string">&quot;只鸡&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//产品</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Chicken</span></span>&#123;</span><br><span class="line">    <span class="keyword">int</span> id;<span class="comment">//产品编号</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Chicken</span><span class="params">(<span class="keyword">int</span> id)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.id = id;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//缓冲区</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SynContainer</span></span>&#123;</span><br><span class="line">    <span class="comment">//需要一个容器大小</span></span><br><span class="line">    Chicken[] chickens = <span class="keyword">new</span> Chicken[<span class="number">10</span>];</span><br><span class="line">    <span class="comment">//容器计数器</span></span><br><span class="line">    <span class="keyword">int</span> count = <span class="number">0</span>;</span><br><span class="line">    <span class="comment">//生产者放入产品</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">push</span><span class="params">(Chicken chicken)</span></span>&#123;</span><br><span class="line">        <span class="comment">//如果容器满了，就需要等待消费者消费产品</span></span><br><span class="line">        <span class="keyword">if</span>(count == chickens.length)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//如果没有满，就需要放入产品</span></span><br><span class="line">        chickens[count] = chicken;</span><br><span class="line">        count ++;</span><br><span class="line">        <span class="comment">//可以通知消费者取走产品了</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//消费者取走产品</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> Chicken <span class="title">pop</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="comment">//判断是否可以消费</span></span><br><span class="line">        <span class="keyword">if</span>(count == <span class="number">0</span>)&#123;</span><br><span class="line">            <span class="comment">//等待生产者生产</span></span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        count --;</span><br><span class="line">        Chicken chicken = chickens[count];</span><br><span class="line">        <span class="comment">//通知生产者生产</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">        <span class="keyword">return</span> chicken;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">生产了1只鸡</span><br><span class="line">生产了2只鸡</span><br><span class="line">生产了3只鸡</span><br><span class="line">生产了4只鸡</span><br><span class="line">生产了5只鸡</span><br><span class="line">生产了6只鸡</span><br><span class="line">生产了7只鸡</span><br><span class="line">生产了8只鸡</span><br><span class="line">生产了9只鸡</span><br><span class="line">生产了10只鸡</span><br><span class="line">消费了第10只鸡</span><br><span class="line">生产了11只鸡</span><br><span class="line">消费了第11只鸡</span><br><span class="line">生产了12只鸡</span><br><span class="line">消费了第12只鸡</span><br><span class="line">生产了13只鸡</span><br><span class="line">消费了第13只鸡</span><br><span class="line">生产了14只鸡</span><br><span class="line">消费了第14只鸡</span><br><span class="line">生产了15只鸡</span><br><span class="line">消费了第15只鸡</span><br><span class="line">消费了第9只鸡</span><br><span class="line">消费了第8只鸡</span><br><span class="line">消费了第7只鸡</span><br><span class="line">消费了第6只鸡</span><br><span class="line">消费了第5只鸡</span><br><span class="line">消费了第4只鸡</span><br><span class="line">消费了第3只鸡</span><br><span class="line">消费了第2只鸡</span><br><span class="line">消费了第1只鸡</span><br><span class="line"></span><br><span class="line">进程已结束，退出代码 0</span><br></pre></td></tr></table></figure>

<h2 id="线程通信"><a href="#线程通信" class="headerlink" title="线程通信"></a>线程通信</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><ol>
<li><p>线程通信是一个同步问题，类似于生产者和消费者共享同一个资源，并且相互依赖，互为条件</p>
</li>
<li><p>在生产者消费者问题中，仅有synchronized是不够的，因为它不能用来进行消息的传递</p>
</li>
<li><p>消息的传递是Object提供的，即每一个对象都可以进行通信</p>
</li>
<li><p>所有的通信都只能在同步方法或者同步代码块中执行，否则抛出异常</p>
</li>
<li><p>消息通信有两种实现方式，第一种是管程法，第二种是信号灯法</p>
</li>
</ol>
<h2 id="管程法"><a href="#管程法" class="headerlink" title="管程法"></a>管程法</h2><p><a href="https://www.bilibili.com/video/BV1Rk4y1B7By?p=29">尚学堂</a></p>
<blockquote>
<p>即消息队列，用容器来实现，添加了缓存区</p>
</blockquote>
<h2 id="信号灯法"><a href="#信号灯法" class="headerlink" title="信号灯法"></a>信号灯法</h2><blockquote>
<p>根据真假,来进行切换,就是所谓的信号灯法</p>
</blockquote>
<p>代码演示</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//测试：生产者消费者模型2--&gt;信号灯法，标志位解决</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TestPC2</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        TV tv = <span class="keyword">new</span> TV();</span><br><span class="line">        <span class="keyword">new</span> Player(tv).start();</span><br><span class="line">        <span class="keyword">new</span> Watcher(tv).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//生产者--&gt;演员</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Player</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    TV tv;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Player</span><span class="params">(TV tv)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tv = tv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">if</span>(i%<span class="number">2</span>==<span class="number">0</span>)&#123;</span><br><span class="line">                <span class="keyword">this</span>.tv.play(<span class="string">&quot;快乐大本营正在播放！&quot;</span>);</span><br><span class="line">            &#125;<span class="keyword">else</span>&#123;</span><br><span class="line">                <span class="keyword">this</span>.tv.play(<span class="string">&quot;抖音：记录美好生活！&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//消费者--&gt;观众</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Watcher</span> <span class="keyword">extends</span> <span class="title">Thread</span></span>&#123;</span><br><span class="line">    TV tv;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="title">Watcher</span><span class="params">(TV tv)</span></span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.tv = tv;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">run</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">this</span>.tv.watch();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//产品--&gt;节目</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">TV</span></span>&#123;</span><br><span class="line">    <span class="comment">//演员表演，观众等待  T</span></span><br><span class="line">    <span class="comment">//观众观看，演员等待  F</span></span><br><span class="line">    String voice;<span class="comment">//表演节目</span></span><br><span class="line">    <span class="keyword">boolean</span> flag = <span class="keyword">true</span>;</span><br><span class="line">    <span class="comment">//表演</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">play</span><span class="params">(String voice)</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(!flag)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;演员表演了&quot;</span>+voice);</span><br><span class="line">        <span class="comment">//通知观众观看</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">        <span class="keyword">this</span>.voice = voice;</span><br><span class="line">        <span class="keyword">this</span>.flag = !<span class="keyword">this</span>.flag;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">watch</span><span class="params">()</span></span>&#123;</span><br><span class="line">        <span class="keyword">if</span>(flag)&#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">this</span>.wait();</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;观众观看了&quot;</span>+voice);</span><br><span class="line">        <span class="comment">//通知演员表演</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">        <span class="keyword">this</span>.flag = !<span class="keyword">this</span>.flag;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">演员表演了快乐大本营正在播放！</span><br><span class="line">观众观看了快乐大本营正在播放！</span><br><span class="line">演员表演了抖音：记录美好生活！</span><br><span class="line">观众观看了抖音：记录美好生活！</span><br><span class="line">演员表演了快乐大本营正在播放！</span><br><span class="line">观众观看了快乐大本营正在播放！</span><br><span class="line">演员表演了抖音：记录美好生活！</span><br><span class="line">观众观看了抖音：记录美好生活！</span><br><span class="line">演员表演了快乐大本营正在播放！</span><br><span class="line">观众观看了快乐大本营正在播放！</span><br><span class="line">演员表演了抖音：记录美好生活！</span><br><span class="line">观众观看了抖音：记录美好生活！</span><br><span class="line">演员表演了快乐大本营正在播放！</span><br><span class="line">观众观看了快乐大本营正在播放！</span><br><span class="line">演员表演了抖音：记录美好生活！</span><br><span class="line">观众观看了抖音：记录美好生活！</span><br><span class="line">演员表演了快乐大本营正在播放！</span><br><span class="line">观众观看了快乐大本营正在播放！</span><br><span class="line">演员表演了抖音：记录美好生活！</span><br><span class="line">观众观看了抖音：记录美好生活！</span><br><span class="line"></span><br><span class="line">进程已结束，退出代码 0</span><br></pre></td></tr></table></figure>









































































]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java基础</tag>
        <tag>线程</tag>
      </tags>
  </entry>
  <entry>
    <title>计算机一级</title>
    <url>/2021/02/15/other/computer/</url>
    <content><![CDATA[<h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p><a href="https://ncre-bm.neea.edu.cn/">计算机报名</a></p>
<p><a href="https://www.ncrecn.com/">全国计算机文档及软件地址</a></p>
<p><a href="http://ncre.neea.edu.cn/html1/report/20122/1392-1.htm">全国计算机等级考试考试大纲</a></p>
<a id="more"></a>

<h1 id="计算机"><a href="#计算机" class="headerlink" title="计算机"></a>计算机</h1><h2 id="发展史"><a href="#发展史" class="headerlink" title="发展史"></a>发展史</h2><blockquote>
<p>计算机的概念</p>
</blockquote>
<p>电子计算机是一种能自动高速而精确地对信息进行处理，具有内部存储能力，由程序来控制其操作过程的现代化电子装置。</p>
<blockquote>
<p>详细解释</p>
</blockquote>
<p><a href="https://www.bilibili.com/video/BV1vV411m7R7?p=4&spm_id_from=pageDriver">哔哩哔哩视频</a></p>
<p>第一台计算机<strong>ENIAC（电子数字积分计算机）</strong><br><strong>1946年2月</strong>诞生于美国宾夕法尼亚大学<br>由数学家冯·诺依曼、莫克利和埃克特研制出<br>冯·诺依曼提出的其原理和思想为：</p>
<ol>
<li>采用二进制</li>
<li>存储程序控制</li>
</ol>
<ul>
<li>程序和数据存储在存储器中。</li>
</ul>
<ol start="3">
<li>计算机由五个基本部件组成</li>
</ol>
<ul>
<li>运算器、存储器、控制器、输入设备、输出设备</li>
</ul>
<blockquote>
<p>按照元器件方式</p>
</blockquote>
<p><a href="https://www.bilibili.com/video/BV1rV41187ex?p=16">千锋教育</a></p>
<p>第一代   电子管</p>
<p>第二代   晶体管</p>
<p>第三代   集成电路</p>
<p>第四代  大规模集成电路</p>
<p>第五代  智能计算机</p>
<p>第六代  生物计算机</p>
<blockquote>
<p>按照体积</p>
</blockquote>
<p>巨型机 大型机 中型机 小型机  微型机</p>
<blockquote>
<p>发展总趋势</p>
</blockquote>
<p>巨型化、微型化、网络化、多媒体化、智能化</p>
<blockquote>
<p>微型计算机</p>
</blockquote>
<p>1971年，第一片微处理器诞生，标志进入了微型机阶段。</p>
<blockquote>
<p>我国计算机的发展</p>
</blockquote>
<p>1958年我国研制成功第一台计算机103机,银河、曙光、神威是我国研制的高性能巨型计算机。</p>
<blockquote>
<p>计算机的特点</p>
</blockquote>
<ul>
<li>高速、精确的运算能力</li>
<li>准确的逻辑判断能力</li>
<li>强大的存储能力</li>
<li>自动功能</li>
<li>网络与通信功能</li>
</ul>
<blockquote>
<p>计算机辅助</p>
</blockquote>
<p>计算机辅助设计（CAD）</p>
<p>计算机辅助制造（CAM）</p>
<p>计算机辅助教育（CAI）</p>
<p>计算机辅助技术（CAT）</p>
<h2 id="硬件"><a href="#硬件" class="headerlink" title="硬件"></a>硬件</h2><p>五个功能部件: 输入设备、运算器、存储器、控制器、输出设备<br>其中运算器和控制器，合称中央处理器，简称CPU。</p>
<blockquote>
<p>存储器</p>
</blockquote>
<p>功能:用来存储当前要执行的程序、数据及结果，具有存数和取数功能。<br>存数:指向存储器里”写入”数据<br>取数:指从存储器里“读取”数据_<br>访问:读写操作统称对存储器访问<br>分类:<br>内存储器(内存) : CPU可以直接访问其里的数据。<br>外存储器(外存) : CPU不可直接访问其里的数据，只有先调入内存方可使用。</p>
<blockquote>
<p>输入输出设备(I/0设备)</p>
</blockquote>
<p>(1)输入设备<br>功能:向计算机输入命令、程序、数据等信息。把这些信息转换为计算机能识别的二进制代码。</p>
<p>例如:键盘、鼠标、扫描仪、手写板、麦克、照相机、摄像机、游戏操作杆、条形码阅读器、光学字符阅读器、触摸屏、光笔等。<br>(2)输出设备<br>功能:将计算机处理后的各种内部格式信息转换为人们能识别的形式表达出来。</p>
<p>例如:显示器、打印机、绘图仪、音响等。</p>
<blockquote>
<p>计算机连接方式</p>
</blockquote>
<p>(1)直接连接</p>
<p>(2)总线结构<br>总线:是一组连接各个部件的公共通信线。<br>三种总线:<br>数据总线: 传输数据信号的公共通路<br>地址总线: 传输地址信号的公共通路<br>控制总线: 除数控制信号的公共通路</p>
<blockquote>
<p>存储器</p>
</blockquote>
<p><strong>主存储器</strong></p>
<p>主存储器放在主机内部的，用于存放当前运行的程序和数据。<br>内存储器</p>
<ul>
<li>随机访问存储器(RAM)</li>
</ul>
<p>RAM是PC的主要存储区域;它允许读写数据;它是易失性存储器。</p>
<ul>
<li>只读存储器(ROM)</li>
</ul>
<p>它包含可以访问和读取但不能修改的程序与数据;它是非易失性存储器。</p>
<p><strong>辅助存储器</strong></p>
<p>硬盘、usb优盘</p>
<p>光盘（VCD-DVD-EVD）</p>
<ul>
<li>只读型光盘CD-ROM</li>
<li>一次性写入光盘CD-R</li>
<li>可擦除型光盘CD-RW </li>
<li>DVD光盘</li>
</ul>
<h2 id="软件"><a href="#软件" class="headerlink" title="软件"></a>软件</h2><blockquote>
<p>概念</p>
</blockquote>
<p>为运行、管理和维护计算机而编制的各种程序、数据和文档的总称。</p>
<h2 id="进制"><a href="#进制" class="headerlink" title="进制"></a>进制</h2><p><a href="https://www.bilibili.com/video/BV1rV41187ex?p=17&spm_id_from=pageDriver">千锋教育  26:30</a></p>
<blockquote>
<p>基数和权值</p>
</blockquote>
<p>基数: 例如二进制的基数是0和1,十进制的基数是0,1,2,3等等</p>
<p>权值: 即<code>a^n</code>,a的取值决定于当前进制,例如二进制取2,八进制取8,n的取值永远从0开始</p>
<h3 id="十进制转二进制"><a href="#十进制转二进制" class="headerlink" title="十进制转二进制"></a>十进制转二进制</h3><blockquote>
<p>思想</p>
</blockquote>
<p>除法运算:用十进制数字一直除以2,直到除不尽为止,然后拿上最后的商倒着做拼接</p>
<p><a href="https://www.bilibili.com/video/BV1rV41187ex?p=17&spm_id_from=pageDriver">千锋教育 37:00</a></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以175为例，步骤如下</span><br><span class="line"></span><br><span class="line">175/2=87.......1</span><br><span class="line"></span><br><span class="line">87/2=43.........1</span><br><span class="line"></span><br><span class="line">43/2=21.........1</span><br><span class="line"></span><br><span class="line">21/2=10.........1</span><br><span class="line"></span><br><span class="line">10/2=5............0</span><br><span class="line"></span><br><span class="line">5/2=2..............1</span><br><span class="line"></span><br><span class="line">2/2=1..............0</span><br><span class="line"></span><br><span class="line">1/2=0...............1</span><br><span class="line"></span><br><span class="line">则175（十进制）=10101111（二进制）</span><br></pre></td></tr></table></figure>

<h3 id="二进制转十进制"><a href="#二进制转十进制" class="headerlink" title="二进制转十进制"></a>二进制转十进制</h3><p><a href="https://www.bilibili.com/video/BV1rV41187ex?p=17&spm_id_from=pageDriver">44:13</a></p>
<blockquote>
<p>思想</p>
</blockquote>
<p>乘法运算:<code>从右向左</code>开始,拿上每一位的基数,乘以权值,然后全部相加</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以 10011为例</span><br><span class="line"></span><br><span class="line">1 0 0 1 1</span><br><span class="line">权值一直是从0开始,二进制的基数是2</span><br><span class="line">即 1*2^4 + 0*2^3 + 0*2^2 + 1*2^1 + 1*2^0</span><br><span class="line">= 16+0+0+2+1</span><br><span class="line">= 19</span><br></pre></td></tr></table></figure>

<h3 id="十进制转八进制"><a href="#十进制转八进制" class="headerlink" title="十进制转八进制"></a>十进制转八进制</h3><p><a href="https://www.bilibili.com/video/BV1rV41187ex?p=18&spm_id_from=pageDriver">千锋教育</a></p>
<blockquote>
<p>思想</p>
</blockquote>
<p>除法:十进制一直除以8,直到除不尽为止,拿上最后的商倒着和余数做拼接</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以256为例</span><br><span class="line"></span><br><span class="line">265/8=32...........0</span><br><span class="line">32/8=4.............0</span><br><span class="line">4/8 除不尽,余4......4</span><br><span class="line">即256的八进制是400</span><br></pre></td></tr></table></figure>

<h3 id="八进制转十进制"><a href="#八进制转十进制" class="headerlink" title="八进制转十进制"></a>八进制转十进制</h3><p><a href="https://baike.baidu.com/item/%E5%85%AB%E8%BF%9B%E5%88%B6">百度百科八进制</a></p>
<p><a href="https://www.bilibili.com/video/BV1rV41187ex?p=18&spm_id_from=pageDriver">千锋教育 3:18</a></p>
<blockquote>
<p>思想</p>
</blockquote>
<p>乘法:<code>从右向左</code>开始,拿到每一位的基数,乘以权值,最后相加</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以400为例</span><br><span class="line"> 4  0   0</span><br><span class="line">4*8^2 + 0*8^1 + 0*8^0</span><br><span class="line">= 256 + 0 +0</span><br><span class="line">= 256</span><br></pre></td></tr></table></figure>

<h3 id="十进制转十六进制"><a href="#十进制转十六进制" class="headerlink" title="十进制转十六进制"></a>十进制转十六进制</h3><p><a href="https://www.bilibili.com/video/BV1rV41187ex?p=18&spm_id_from=pageDriver">千锋教育 10:00</a></p>
<p>一般用数字0到9和字母A到F（或a-f ）表示，其中A-F表示10~15，这些称作<strong>十六进制数字</strong>。</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">A   B   C   D   E   F</span><br><span class="line">10  11  12  13  14  15</span><br></pre></td></tr></table></figure>

<blockquote>
<p>思想</p>
</blockquote>
<p>除法:十进制一直除以16,一直到除不尽为止,最后拿着商,倒着做拼接,然后加上前缀修饰符<code>0x</code>,字母<code>x</code></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以98为例</span><br><span class="line">98/16=6.......2</span><br><span class="line">6/16=除不尽....6</span><br><span class="line">即最终结果为 0x62</span><br><span class="line"></span><br><span class="line">以734为例</span><br><span class="line">734/16=45....14</span><br><span class="line">45/16=2......13</span><br><span class="line">2/16=除不尽...2</span><br><span class="line">结果是 2 13 14,但是13超过了10,用D表示,14用E表示</span><br><span class="line">所有最终结果是 0x2DE</span><br></pre></td></tr></table></figure>

<h3 id="十六进制转换为十进制"><a href="#十六进制转换为十进制" class="headerlink" title="十六进制转换为十进制"></a>十六进制转换为十进制</h3><p><a href="https://www.bilibili.com/video/BV1rV41187ex?p=18&spm_id_from=pageDriver">千锋教育 21:30</a></p>
<blockquote>
<p>思想</p>
</blockquote>
<p>乘法:拿每一位的基础,乘以权值,最后相加</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以0xAB为例</span><br><span class="line">转换 0x1011</span><br><span class="line">=10*16^1+11*16^0</span><br><span class="line">=160+11</span><br><span class="line">=171</span><br></pre></td></tr></table></figure>

<h3 id="二进制转八进制"><a href="#二进制转八进制" class="headerlink" title="二进制转八进制"></a>二进制转八进制</h3><blockquote>
<p>思想</p>
</blockquote>
<p>三合一:<code>从右向左</code>,每三个看作一个整体,把整体转换为十进制,最后做拼接</p>
<h3 id="八进制转二进制"><a href="#八进制转二进制" class="headerlink" title="八进制转二进制"></a>八进制转二进制</h3><p><a href="https://www.bilibili.com/video/BV1rV41187ex?p=19&spm_id_from=pageDriver">千锋教育</a></p>
<blockquote>
<p>思想</p>
</blockquote>
<p>一拆三:<code>从右向左</code>开始,把八进制每一位拆分成二进制,最后做拼接,不够三位数的,在前面补<code>0</code>,即<code>10</code>不够三位数,前缀补0为<code>010</code>,如果拼接后最前缀是<code>0</code>,可以省略,即<code>0111</code>可以省略为<code>111</code></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以67为例</span><br><span class="line">拆分 6为110,7为111</span><br><span class="line">最终结果是 110111</span><br><span class="line"></span><br><span class="line">以32为例,需要补0</span><br><span class="line">3为011</span><br><span class="line">2为010</span><br><span class="line">结果是011010</span><br></pre></td></tr></table></figure>

<h3 id="二进制转十六进制"><a href="#二进制转十六进制" class="headerlink" title="二进制转十六进制"></a>二进制转十六进制</h3><p><a href="https://www.bilibili.com/video/BV1rV41187ex?p=19&spm_id_from=pageDriver">5:40</a></p>
<blockquote>
<p>思想</p>
</blockquote>
<p>四合一:<code>从右向左</code>开始,每四位看成一个整体,把这个整体转换为十进制,然后拼接</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以11101111为例</span><br><span class="line">拆分  1110   1111</span><br><span class="line">1110进行二进制转十进制 1*2^3 + 1*2^2 + 1*2^1 + 0*2^0=8+4+2+0=14 转换为16进制是E</span><br><span class="line">1111进行二进制转十进制 1*2^3 + 1*2^2 + 1*2^1 + 1*2^0=8+4+2+1=15 转换为16进制是F</span><br><span class="line">所以最终结果是 0xEF</span><br><span class="line"></span><br><span class="line">100110 </span><br><span class="line">进行四拆分时,不够四位数的,加前缀0</span><br><span class="line">拆分结果是 0010 0110</span><br></pre></td></tr></table></figure>

<h3 id="十六进制转二进制"><a href="#十六进制转二进制" class="headerlink" title="十六进制转二进制"></a>十六进制转二进制</h3><p><a href="https://www.bilibili.com/video/BV1rV41187ex?p=19&spm_id_from=pageDriver">11:20</a></p>
<blockquote>
<p>思想</p>
</blockquote>
<p>一拆四:<code>从右向左</code>开始,把每一位上面的基数,拆解成四位二进制数,进行拼接</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以0xAB为例</span><br><span class="line">A指的是10,根据8421原则,可以拆分为8+2,即缺少4和1,对4和1为止进行补0,最终为1010</span><br><span class="line">B指的是11,根据8421原则,可以拆分为8+2+1,即缺少4,对4补0,最终为1011,</span><br><span class="line">进行拼接操作,结果是10101011</span><br><span class="line"></span><br><span class="line">0x32E</span><br><span class="line">拆分为   3  2 14</span><br><span class="line">根据8421原则,再拆分 0011 0010 1110</span><br><span class="line">拼接 001100101110</span><br><span class="line">可省略前缀0 1100101110</span><br></pre></td></tr></table></figure>

<h2 id="网络"><a href="#网络" class="headerlink" title="网络"></a>网络</h2><blockquote>
<p>顶级域名</p>
</blockquote>
<p><code>Com</code>商业结构<br><code>Org</code>非盈利组织<br><code>Gov</code>政府部门<br><code>Net</code>网络组织<br><code>Edu</code>教育机构<br><code>Mil</code>军事部门<br><code>Int</code>国际组织<br><code>Biz</code>商业<br><code>Info</code>网络信息服务组织</p>
<h2 id="多媒体"><a href="#多媒体" class="headerlink" title="多媒体"></a>多媒体</h2><p>媒体: 指文字、声音、图像、动画和视频等内容。<br>多媒体: 指能够同时对两种或两种以上媒体进行采集、操作、编辑、存储的综合处理技术。<br>多媒体特性: 交互性、集成性。</p>
<h2 id="病毒"><a href="#病毒" class="headerlink" title="病毒"></a>病毒</h2><p><a href="https://www.bilibili.com/video/BV1rV41187ex?p=25&spm_id_from=pageDriver">千锋教育</a></p>
<blockquote>
<p>概念</p>
</blockquote>
<p>计算机病毒是一种人为编制的具有破坏作用的计算机程序</p>
<blockquote>
<p>特点</p>
</blockquote>
<p>寄生性、破坏性、传染性、潜伏性、隐蔽性、可触发性</p>
<blockquote>
<p>分类</p>
</blockquote>
<p>根据媒体分类：网络病毒、文件病毒、引导病毒</p>
<p>根据破坏能力：无害型、无危险型、危险型、非常危险型</p>
<p>根据病毒算法：伴随型病毒、蠕虫型病毒、寄生型病毒</p>
<blockquote>
<p>病毒防治</p>
</blockquote>
<ol>
<li>专机专用</li>
<li>利用写保护</li>
<li>慎用网上下载的软件</li>
<li>分类管理数据</li>
<li>建立备份</li>
<li>采用防毒软件或防毒卡</li>
<li>定期检查</li>
<li>准备系统盘</li>
</ol>
<h1 id="考试真题"><a href="#考试真题" class="headerlink" title="考试真题"></a>考试真题</h1><p>ASCII的排序方式</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">符号(null) &lt; 数字 &lt; (+ - * / &gt; &lt; ? @) &lt; 大写字母&lt; ([ \ ] ^ _) &lt; 小写字母 &lt; (&#123; | &#125; ~ del)</span><br></pre></td></tr></table></figure>

<h2 id="真题1"><a href="#真题1" class="headerlink" title="真题1"></a><a href="https://www.bilibili.com/video/BV1rV41187ex?p=6&spm_id_from=pageDriver">真题1</a></h2><ol>
<li>CPU不能读取硬盘上的数据，但是能直接访问内存储器;CPU主要包括运算器和控制器:CPU是整个计算机的核心部件，主要用于控制计算机的操作。</li>
<li>1946年首台电子数字计算机ENIAC问世后，冯诺依曼(VonNeumann)在研制EDVAC计算机时，提 出两个重要的改进，它们是采用<strong>二进制</strong>和<strong>存储程序控制</strong>的概念.</li>
<li>汇编语言是一种依赖于计算机的<strong>低级</strong>程序设计语言</li>
<li>1GB=1024MB=2^10 MB    128MB=2^7 MB， 10GB=80*128 MB</li>
</ol>
<h2 id="真题2"><a href="#真题2" class="headerlink" title="真题2"></a><a href="https://www.bilibili.com/video/BV1rV41187ex?p=7&spm_id_from=pageDriver">真题2</a></h2><ol start="5">
<li><p>计算机硬件包括CPU、存储器、输入设备、输出设备</p>
</li>
<li><p>在一个非零无符号二进制整数之后添加一个0,则此数的值为原数的<strong>2倍</strong>,因为最后位加0等于前面所有位都乘以2再相加，所以是2倍。</p>
</li>
<li><p>Pentium(奔腾)微机的字长是<strong>32位</strong></p>
</li>
<li><p>ASCII:<strong>所有大写英文字母的ASCI码值都小于小写英文字母”a”的ASCI码值</strong>,可以参照  <a href="https://baike.baidu.com/item/ASCII/309296">百度百科</a></p>
</li>
<li><p>CD光盘存储容量一般达650MB，有只读型光盘CD-ROM、一次性写入光盘CD-R和可擦除型光盘CD~RW等</p>
</li>
<li><p>一个字长为5位的无符号二进制数能表示的十进制数值范围是:0~31,无符号二进制数的第一位可为0， 所以当全为0时最小值为0，当全为1时最大值为2^5-1=31</p>
</li>
<li><p>计算机病毒是指<strong>特殊的小程序</strong></p>
</li>
<li><p>在计算机中，每个存储单元都有一个连续的编号，此编号称为<strong>单元地址</strong>,即内存地址</p>
</li>
<li><p>系统软件包括:Linux Unix Windows7,字处理软件不是系统软件,百度百科中对于字处理软件的定义是office一类的软件</p>
</li>
<li><p>ADSL(非对称数字用户线路)是目前用电话接入因特网的主流技术，采用这种方式接入因特网，需要使用调制解调器。这是PC通过电话接入网络的必备设备，具有调制和解调两种功能，并分为外置和内置两种</p>
</li>
<li><p>ASCII最小的是二进制是<code>0000 0000</code>,换算成十进制是<code>0</code>,解释是<code>空字符串</code>,最大的二进制是<code>0111 1111</code>,换算成十进制是<code>127</code>,解释是<code>删除DEL</code>,参照 <a href="https://baike.baidu.com/item/ASCII/309296">百度百科</a></p>
</li>
</ol>
<blockquote>
<p>ASCII码值(用十进制表示)分别为:空格对应32, 0对应48，A对应65,a对应97</p>
</blockquote>
<ol start="17">
<li><p>二进制<code>100011</code>转换成十进制是<code>35</code></p>
<p>运算思路:数字中从右到左共有三个1,即第六位一个,第二位一个,第一位一个,然后对应十进制数即2的0次方+2的1次方+2的5次方,即100011=32+0+0+0+2+1=35</p>
<p>十进制转换二进制,采用<code>除2取余倒计法</code></p>
<p><a href="https://www.bilibili.com/video/BV1ox411R7F5?from=search&seid=12471333654157858263">十进制转二进制</a></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">以175为例，步骤如下</span><br><span class="line"></span><br><span class="line">175/2=87.......1</span><br><span class="line"></span><br><span class="line">87/2=43.........1</span><br><span class="line"></span><br><span class="line">43/2=21.........1</span><br><span class="line"></span><br><span class="line">21/2=10.........1</span><br><span class="line"></span><br><span class="line">10/2=5............0</span><br><span class="line"></span><br><span class="line">5/2=2..............1</span><br><span class="line"></span><br><span class="line">2/2=1..............0</span><br><span class="line"></span><br><span class="line">1/2=0...............1</span><br><span class="line"></span><br><span class="line">则175（十进制）=10101111（二进制）</span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="真题3"><a href="#真题3" class="headerlink" title="真题3"></a><a href="https://www.bilibili.com/video/BV1rV41187ex?p=8&spm_id_from=pageDriver">真题3</a></h2><ol start="18">
<li>政府机关的域名为<code>.gov</code>;商业组织的域名为<code>.com</code>;军事部门的域名为<code>.mil</code></li>
<li>用比较容易识别、记忆的助记符号代替机器语言的二进制代码，这种符号化了的机器语言叫做汇编语言，同样也依赖于具体的机器，因此该语言是汇编语言</li>
<li>鼠标是输入设备,打印机,显示器,绘图仪等是输出设备</li>
</ol>
<h2 id="真题4"><a href="#真题4" class="headerlink" title="真题4"></a><a href="https://www.bilibili.com/video/BV1rV41187ex?p=9&spm_id_from=pageDriver">真题4</a></h2><ol>
<li>第一台计算机ENIAC（电子数字积分计算机）1946年2月诞生于美国宾夕法尼亚大学,主设计师是冯·诺依曼</li>
<li>CPU主要是由<code>控制器</code>和<code>运算器</code>组成的</li>
<li>十进制29转换为二进制是<code>11101</code></li>
<li>10GB=100亿B,从小到大排列是:B-字节，KB-千比特，MB-兆比特，GB-吉比特</li>
<li>微型机的主机部分包括 CPU、内存、IO接口电路、系统总线</li>
<li><code>m</code>的ASCII码是<code>6DH</code>,那么<code>q</code>对应的是<code>71H</code></li>
<li>一个字长为6位的无符号二进制数能表示的十进制数值范围是<code>0~63</code>,无符号二进制数的第一位可为0， 所以当全为0时最小值为0，当全为1时最大值为2^6-1=63</li>
</ol>
<h2 id="真题5"><a href="#真题5" class="headerlink" title="真题5"></a><a href="https://www.bilibili.com/video/BV1rV41187ex?p=10&spm_id_from=pageDriver">真题5</a></h2><ol start="8">
<li><p>输入设备包括 鼠标</p>
</li>
<li><p>操作系统对磁盘进行读写操作的单位是<code>扇区</code></p>
</li>
<li><p>国标码两个字节的最高位都为0，机内码两个字节的最高位都为1</p>
</li>
<li><p>汇编语言属于<code>低级语言</code></p>
</li>
<li><p>ACSII码中,从上往下是 <code>数字</code>––&gt;<code>A</code>—&gt;<code>a</code>,越往下越大,所有最大的是<code>a</code>,最小的是<code>数字</code></p>
</li>
<li><p>非法的IP地址是 <code>112.256.23.8</code>,IP地址是由4个字节组成的，习惯写法是将每个字节作为–段并以十进制数来表示，而且段间用””分隔。每个段的十进制范围是0-255，选项C中的第二个字节超出了范围</p>
</li>
<li><p>时钟频率也叫主频，是指计算机CPU的时钟频率。一般主频越高，计算机的运算速度就越快。主频的单位是兆赫兹(MHZ)</p>
</li>
<li><p>ChinaDDN网、Chinanet网、 Internet为广域网,Novell属于局域网</p>
</li>
<li><p>计算机硬件系统主要包括控制器、运算器、存储器、输入设备、输出设备、接口和总线等<br>常见的输入设备有鼠标、键盘、扫描仪、条形码阅读器、触摸屏、手写笔、麦克风、摄像头和数码相机等<br>常见的输出设备包括显示器、打印机、绘图仪、音响、耳机、视频投影仪等</p>
</li>
<li><p>把内存中数据传送到计算机硬盘中去，称为写盘。把硬盘上的数据传送到计算机的内存中去，称为读盘。</p>
</li>
<li><p>A高级语言必须要经过翻译成机器语言后才能被计算机执行;<br>B用高级语言编写的程序具有良好的可读性和移植性;<br>C高级语言执行效率低，可读性好;<br>D高级语言不依赖于计算机，所以可移植性好。</p>
</li>
</ol>
<h2 id="真题8"><a href="#真题8" class="headerlink" title="真题8"></a><a href="https://www.bilibili.com/video/BV1rV41187ex?p=13&spm_id_from=pageDriver">真题8</a></h2><ol>
<li><p>软件系统主要包括系统软件和应用软件。办公自动化软件、管理信息系统、指挥信息系统都是属于应用软件，Windows XP属于系统软件</p>
</li>
<li><p><code>m</code>的<code>ASCII</code>码是<code>6DH</code>,那么<code>71H</code>对应的是<code>q</code></p>
<p>6DH为16进制(在进制运算中，B代表的是二进制数，D表示的是十进制数，0表示的是八进制数，H表示的是十六进制数)。</p>
<p>m的ASCII码值为6DH，用十进制表示即为6x16+13=109 (D在10进制中为13,这里的D指的是十进制的<code>0x0D</code>)。q的ASCII码值在m的后面4位，即是113,对应转换为16进制，即为71H</p>
</li>
<li><p>指挥、协调计算机各部件工作是控制器的功能;<br>进行算术运算与逻辑运算是运算器的功能。</p>
</li>
<li><p>微型计算机的主要技术性能指标包括字长、时钟主频、运算速度、存储容量、存取周期等。</p>
</li>
<li><p>空格&lt;A&lt;a</p>
</li>
<li><p>声音和视频在计算机中的表现形式是<code>二进制</code></p>
</li>
<li><p>计算机系统中最核心的是<code>操作系统</code></p>
</li>
<li><p>能直接和CPU做交互的存储器是<code>内存存储器</code>,即CPU只能直接访问存储在内存中的数据</p>
</li>
<li><p>RAM即<code>随机存储器</code>,具有可读可写和易失的特点,即断开电源,数据立即消失</p>
</li>
<li><p>IP地址的范围是<code>0~255</code></p>
</li>
</ol>
<h2 id="真题9"><a href="#真题9" class="headerlink" title="真题9"></a><a href="https://www.bilibili.com/video/BV1rV41187ex?p=14&spm_id_from=pageDriver">真题9</a></h2><ol start="14">
<li><p>因特网最初创建的目的是用于军事,详见 <a href="https://zhidao.baidu.com/question/8193852.html">百度知道</a></p>
</li>
<li><p>某800万像素的数码相机,拍摄出的照片最大分辨率是 <code>3200*2400</code>,数码相机像素=能拍摄的最大照片的长边像素x宽边像素值，四个选项中，拍摄出来的照片分辨率计算后只有<code>3200*2400</code>选项大约在800万像素左右</p>
</li>
<li><p>微机系统中最核心的是<code>CPU</code></p>
</li>
<li><p><code>1kb</code>的准确值是<code>1kb=2^10Bytes=1024Bytes</code></p>
</li>
<li><p>DVD是外接设备,ROM是只读存储,DVD-ROM是只读外部存储器</p>
</li>
<li><p>硬盘或者u盘连接电脑的接口被称为<code>usb</code>接口</p>
</li>
</ol>
<h1 id="考试大纲"><a href="#考试大纲" class="headerlink" title="考试大纲"></a>考试大纲</h1><blockquote>
<p>计算机的发展、类型及其应用领域。</p>
</blockquote>
<p><a href="https://www.baike.com/wiki/%E8%AE%A1%E7%AE%97%E6%9C%BA%E5%8F%91%E5%B1%95%E5%8F%B2?view_id=5h5whcple1c000">快懂百科</a></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1946年,第一台计算机问世,第一代计算机属于电子管计算机,体积巨大,这一带的计算机主要应用于军事和科学计算</span><br><span class="line">第二代计算机采用了晶体管的方式,比第一代的性能大大提升,同时也诞生了最早的编程语言,也开始在数据处理及过程控制放面得到应用</span><br><span class="line">第三代计算机采用中小规模的集成电路,使得计算机的体积更小,提高了计算机的可靠性,在软件放面,有了标准的程序设计语言,其应用领域进一步扩大</span><br><span class="line">第四代计算机由超大规模的集成电路组成,这一时期,出现了精简指令,软件系统实现了工程化,理论化,程序设计自动化,微型计算机在社会上的应用范围进一步扩大</span><br></pre></td></tr></table></figure>

<blockquote>
<p>计算机中数据的表示、存储与处理。</p>
</blockquote>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">数据采用二进制进行表示</span><br><span class="line">使用字节进行存储,分别是B、KB、MB、GB、TB,每种存储方式之间都是1024倍</span><br><span class="line">处理方式采用ACSII码</span><br></pre></td></tr></table></figure>

<blockquote>
<p>多媒体技术的概念与应用</p>
</blockquote>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">多媒体是指把文字、音频、图形、视频等多媒体信息通过计算机进行数字化采集分析等处理，再表现出来的一种一体化技术</span><br><span class="line">多媒体具有 交互性、集成性、多样性、实时性、</span><br><span class="line">应用领域:教育方面的多媒体教学、通信放面的视频会议、医疗方面的网络远程诊断</span><br></pre></td></tr></table></figure>

<blockquote>
<p>计算机病毒的概念、特征、分类与防治</p>
</blockquote>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">概念:计算机病毒是一种人为编制的具有破坏作用的计算机程序</span><br><span class="line">特征:隐藏性、破坏性、潜伏性、传染性等</span><br><span class="line">分类：</span><br><span class="line">根据媒体类可分为网络、文件、引导病毒</span><br><span class="line">根据破坏能力分为无害型、无危险型、危险型、非常危险型</span><br><span class="line">防治：专机专用、建立备份、定期检查、安装杀毒软件</span><br></pre></td></tr></table></figure>

<blockquote>
<p>计算机网络的概念、组成和分类；计算机与网络信息安全的概念和防控</p>
</blockquote>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">概念:计算机网络是一个将分散的、具有独立功能的计算机系统，通过通信设备与线路连接起来，由功能完善的软件实现资源共享和信息传递的系统，是一些互联网、自治的计算机系统的集合</span><br><span class="line">组成：一个完整的计算机网络主要由硬件、软件、通信协议三大部分组成，缺一不可</span><br><span class="line">分类：按照分布范围分为广域网、城域网、局域网、个人网</span><br><span class="line">按照使用者分为公用网、专用网</span><br><span class="line">按照传输介质分为有线和无线两大类，有线分为双绞线网络等，无线分为蓝牙等</span><br><span class="line"></span><br><span class="line">网络安全的概念:为数据处理系统建立安全保护，保护计算机硬件和软件不因偶然的或者恶意的原因而遭到破坏、更改和暴露</span><br><span class="line">防控：1.对来历不明的软件要先检测再安装使用</span><br><span class="line">2. 对重要数据进行定期备份和写保护</span><br><span class="line">3. 不要轻易安装各类软件</span><br><span class="line">4. 定期查杀计算机</span><br><span class="line">5. 不要将病毒带入计算机</span><br></pre></td></tr></table></figure>

<blockquote>
<p>因特网网络服务的概念、原理和应用</p>
</blockquote>
<p><a href="http://www.pinlue.com/article/2017/03/2411/39831195948.html">参考</a></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">概念:由全球开方式计算机网络连接而成的计算机互联网</span><br><span class="line">主要概念包括：</span><br><span class="line">1.TCP/IP协议：互联网信息交换和规范的集合体</span><br><span class="line">2.Ip地址:每一台计算机在全世界范围内的唯一标记</span><br><span class="line">3.DNS域名：完成Internet主机名和IP地址的映射，把域名和IP地址能互相翻译</span><br><span class="line"></span><br><span class="line">原理:</span><br><span class="line">1. 拨号上网，需要调职调节器</span><br><span class="line">2. 局域网接入：通过双绞线接入局域网</span><br><span class="line"></span><br><span class="line">应用：</span><br><span class="line">1.www服务,即环球网,是当前应用最广泛的Internet服务,术语:超文本、超链接、html</span><br><span class="line">2.电子邮件，计算机之间通过网络急视传送信件</span><br><span class="line">3.文件传输，即FTP,各种主机之间进行文件传输</span><br><span class="line">4.其他：网络聊天、网上购物、IP电话、网络游戏等</span><br></pre></td></tr></table></figure>





















]]></content>
      <categories>
        <category>计算机</category>
      </categories>
      <tags>
        <tag>计算机</tag>
      </tags>
  </entry>
  <entry>
    <title>shiro</title>
    <url>/2020/12/05/other/shiro/</url>
    <content><![CDATA[<h1 id="Shiro"><a href="#Shiro" class="headerlink" title="Shiro"></a>Shiro</h1><p><a href="http://shiro.apache.org/">shiro官网地址</a></p>
<h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><ul>
<li>Apache Shiro 是 Java 的一个安全（权限）框架。</li>
<li>Shiro 可以非常容易的开发出足够好的应用，其不仅可以用在JavaSE 环境，也可以用在 JavaEE 环境。</li>
<li>Shiro 可以完成：认证、授权、加密、会话管理、与Web 集成、缓存等</li>
</ul>
<a id="more"></a>

<h2 id="图示"><a href="#图示" class="headerlink" title="图示"></a>图示</h2><h3 id="基本功能"><a href="#基本功能" class="headerlink" title="基本功能"></a>基本功能</h3><p><img data-src="/images/framework/shiro/shiro-1.webp"></p>
<ul>
<li>Authentication：身份认证/登录，验证用户是不是拥有相应的身份；</li>
<li>Authorization：授权，即权限验证，验证某个已认证的用户是否拥有某个权限；即判断用户是否能进行什么操作，如：验证某个用户是否拥有某个角色。或者细粒度的验证某个用户对某个资源是否具有某个权限；</li>
<li>Cryptography：加密，保护数据的安全性，如密码加密存储到数据库，而不是明文存储；</li>
<li>Web Support：Web 支持，可以非常容易的集成到Web 环境；</li>
<li>Caching：缓存，比如用户登录后，其用户信息、拥有的角色/权限不必每次去查，这样可以提高效率；</li>
<li>Concurrency：Shiro 支持多线程应用的并发验证，即如在一个线程中开启另一个线程，能把权限自动传播过去；</li>
<li>Testing：提供测试支持；</li>
<li>Run As：允许一个用户假装为另一个用户（如果他们允许）的身份进行访问；</li>
<li>Remember Me：记住我，这个是非常常见的功能，即一次登录后，下次再来的话不用登录了</li>
</ul>
<h3 id="shiro架构-外部"><a href="#shiro架构-外部" class="headerlink" title="shiro架构(外部)"></a>shiro架构(外部)</h3><p><img data-src="/images/framework/shiro/shiro-2.webp"></p>
<ul>
<li>Subject：应用代码直接交互的对象是 Subject，也就是说 Shiro 的对外API 核心就是 Subject。Subject 代表了当前“用户”， 这个用户不一定是一个具体的人，与当前应用交互的任何东西都是 Subject，如网络爬虫，机器人等；与 Subject 的所有交互都会委托给 SecurityManager；Subject 其实是一个门面，SecurityManager 才是实际的执行者；</li>
<li>SecurityManager：安全管理器；即所有与安全有关的操作都会与SecurityManager 交互；且其管理着所有 Subject；可以看出它是 Shiro的核心，它负责与 Shiro 的其他组件进行交互，它相当于 SpringMVC 中DispatcherServlet 的角色</li>
<li>Realm：Shiro 从 Realm 获取安全数据（如用户、角色、权限），就是说SecurityManager 要验证用户身份，那么它需要从 Realm 获取相应的用户进行比较以确定用户身份是否合法；也需要从 Realm 得到用户相应的角色权限进行验证用户是否能进行操作；可以把 Realm 看成 DataSource</li>
</ul>
<h3 id="shiro架构-内部"><a href="#shiro架构-内部" class="headerlink" title="shiro架构(内部)"></a>shiro架构(内部)</h3><p><img data-src="/images/framework/shiro/shiro-3.webp"></p>
<p>• Subject：任何可以与应用交互的“用户”；<br>• SecurityManager ：相当于SpringMVC 中的 DispatcherServlet；是 Shiro 的心脏；所有具体的交互都通过 SecurityManager 进行控制；它管理着所有 Subject、且负责进行认证、授权、会话及缓存的管理。<br>• Authenticator：负责 Subject 认证，是一个扩展点，可以自定义实现；可以使用认证策略（Authentication Strategy），即什么情况下算用户认证通过了；<br>• Authorizer：授权器、即访问控制器，用来决定主体是否有权限进行相应的操作；即控制着用户能访问应用中的哪些功能；<br>• Realm：可以有 1 个或多个 Realm，可以认为是安全实体数据源，即用于获取安全实体的；可以是JDBC 实现，也可以是内存实现等等；由用户提供；所以一般在应用中都需要实现自己的 Realm；<br>• SessionManager：管理 Session 生命周期的组件；而 Shiro 并不仅仅可以用在 Web环境，也可以用在如普通的 JavaSE 环境<br>• CacheManager：缓存控制器，来管理如用户、角色、权限等的缓存的；因为这些数据基本上很少改变，放到缓存中后可以提高访问的性能<br>• Cryptography：密码模块，Shiro 提高了一些常见的加密组件用于如密码加密/解密</p>
<h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><p><a href="https://mvnrepository.com/artifact/org.apache.shiro">maven地址</a></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--shiro--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-spring<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jcl-over-slf4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.slf4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>slf4j-log4j12<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.30<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>log4j<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.17<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="入门"><a href="#入门" class="headerlink" title="入门"></a>入门</h1><p><a href="https://www.bilibili.com/video/BV1E4411K7hj">攻城狮视频</a></p>
<h2 id="shiro-ini"><a href="#shiro-ini" class="headerlink" title="shiro.ini"></a>shiro.ini</h2><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="section">[users]</span></span><br><span class="line"><span class="attr">admin</span>=<span class="number">123456</span></span><br><span class="line"><span class="attr">zs</span>=<span class="number">123</span></span><br><span class="line"><span class="attr">ls</span>=<span class="number">123</span></span><br></pre></td></tr></table></figure>

<h2 id="验证登录"><a href="#验证登录" class="headerlink" title="验证登录"></a>验证登录</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//生成核心类SecurityManager</span></span><br><span class="line">Factory&lt;SecurityManager&gt; factory = <span class="keyword">new</span> IniSecurityManagerFactory(<span class="string">&quot;classpath:shiro.ini&quot;</span>);</span><br><span class="line">SecurityManager securityManager = factory.getInstance();</span><br><span class="line"><span class="comment">// 绑定安全管理器</span></span><br><span class="line">SecurityUtils.setSecurityManager(securityManager);</span><br><span class="line"><span class="comment">//获取当前用户 Subject</span></span><br><span class="line">Subject subject = SecurityUtils.getSubject();</span><br><span class="line"><span class="comment">//模拟前台传输过来的账号和密码</span></span><br><span class="line">UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">&quot;zs&quot;</span>, <span class="string">&quot;1233&quot;</span>);</span><br><span class="line"><span class="comment">//登录</span></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    subject.login(token);</span><br><span class="line">    System.out.println(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (UnknownAccountException e) &#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;账号异常&quot;</span>);</span><br><span class="line">&#125; <span class="keyword">catch</span> (IncorrectCredentialsException e) &#123;</span><br><span class="line">    System..out.println(<span class="string">&quot;密码异常&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="连接数据库"><a href="#连接数据库" class="headerlink" title="连接数据库"></a>连接数据库</h1><h2 id="maven-1"><a href="#maven-1" class="headerlink" title="maven"></a>maven</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--mysql数据库--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="表初始化"><a href="#表初始化" class="headerlink" title="表初始化"></a>表初始化</h2><p><a href="https://www.bilibili.com/video/BV1E4411K7hj?p=2">攻城狮视频</a></p>
<ol>
<li>表名是<code>users</code>固定</li>
<li>用户名是<code>username</code>固定</li>
</ol>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`users`</span> (</span><br><span class="line">  <span class="string">`id`</span> <span class="built_in">bigint</span> <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT <span class="keyword">COMMENT</span> <span class="string">&#x27;主键ID&#x27;</span>,</span><br><span class="line">  <span class="string">`username`</span> <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="built_in">CHARACTER</span> <span class="keyword">SET</span> utf8 <span class="keyword">COLLATE</span> utf8_general_ci <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;姓名&#x27;</span>,</span><br><span class="line">  <span class="string">`password`</span> <span class="built_in">varchar</span>(<span class="number">40</span>) <span class="keyword">DEFAULT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;密码&#x27;</span>,</span><br><span class="line">   PRIMARY <span class="keyword">KEY</span> (<span class="string">`id`</span>)</span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">InnoDB</span> AUTO_INCREMENT=<span class="number">6</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br></pre></td></tr></table></figure>

<h2 id="jdbc-realm-ini配置文件"><a href="#jdbc-realm-ini配置文件" class="headerlink" title="jdbc_realm.ini配置文件"></a>jdbc_realm.ini配置文件</h2><figure class="highlight ini"><table><tr><td class="code"><pre><span class="line"><span class="comment">#shiro提供</span></span><br><span class="line"><span class="attr">jdbcRealm</span> = org.apache.shiro.realm.jdbc.JdbcRealm</span><br><span class="line"><span class="comment">#druid数据库连接池</span></span><br><span class="line"><span class="attr">dataSource</span> = com.alibaba.druid.pool.DruidDataSource</span><br><span class="line"><span class="attr">dataSource.driverClassName</span> = com.mysql.cj.jdbc.Driver</span><br><span class="line"><span class="attr">dataSource.url</span> = jdbc:mysql:///wty?serverTimezone=UTC</span><br><span class="line"><span class="attr">dataSource.username</span> = root</span><br><span class="line"><span class="attr">dataSource.password</span> = root</span><br><span class="line"><span class="comment"># 引用</span></span><br><span class="line"><span class="attr">jdbcRealm.dataSource</span> = <span class="variable">$dataSource</span></span><br><span class="line"><span class="attr">securityManager.realms</span> = <span class="variable">$jdbcRealm</span></span><br></pre></td></tr></table></figure>

<h2 id="java测试"><a href="#java测试" class="headerlink" title="java测试"></a>java测试</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function">pblic <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Factory&lt;SecurityManager&gt; factory = <span class="keyword">new</span> IniSecurityManagerFactory(<span class="string">&quot;classpath:jdbc_realm.ini&quot;</span>);</span><br><span class="line">    SecurityManager securityManager = factory.getInstance();</span><br><span class="line">    SecurityUtils.setSecurityManager(securityManager);</span><br><span class="line"></span><br><span class="line">    Subject subject = SecurityUtils.getSubject();</span><br><span class="line">    <span class="comment">//模拟前台传输过来的账号和密码</span></span><br><span class="line">    UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(<span class="string">&quot;zs&quot;</span>, <span class="string">&quot;20&quot;</span>);</span><br><span class="line">    <span class="comment">//登录</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        subject.login(token);</span><br><span class="line">        System.out.println(<span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnknownAccountException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;账号异常&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IncorrectCredentialsException e) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;密码异常&quot;</span>);</span><br><span class="line">    &#125;<span class="keyword">catch</span> (Exception e)&#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="shiro过滤器"><a href="#shiro过滤器" class="headerlink" title="shiro过滤器"></a>shiro过滤器</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><a href="https://www.bilibili.com/video/BV1YW411M7S3?p=6">尚硅谷</a></p>
<p>在<code>org.apache.shiro.web.filter.mgt.DefaultFilter</code>枚举类中可以查看过滤器缩写</p>
<table>
<thead>
<tr>
<th>配置缩写</th>
<th>对应的过滤器</th>
<th>功能</th>
</tr>
</thead>
<tbody><tr>
<td>身份验证相关的</td>
<td></td>
<td></td>
</tr>
<tr>
<td>anon</td>
<td>AnonymousFilter</td>
<td>指定url可以匿名访问</td>
</tr>
<tr>
<td>authc</td>
<td>FormAuthenticationFilter</td>
<td>基于表单的拦截器；如“/**=authc”，如果没有登录会跳到相应的登录页面登录；主要属性：usernameParam：表单提交的用户名参数名（ username）； passwordParam：表单提交的密码参数名（password）； rememberMeParam：表单提交的密码参数名（rememberMe）； loginUrl：登录页面地址（/login.jsp）；successUrl：登录成功后的默认重定向地址； failureKeyAttribute：登录失败后错误信息存储key（shiroLoginFailure）</td>
</tr>
<tr>
<td>authcBasic</td>
<td>BasicHttpAuthenticationFilter</td>
<td>Basic HTTP身份验证拦截器，主要属性： applicationName：弹出登录框显示的信息（application）</td>
</tr>
<tr>
<td>logout</td>
<td>authc.LogoutFilter</td>
<td>退出拦截器，主要属性：redirectUrl：退出成功后重定向的地址（/）</td>
</tr>
<tr>
<td>user</td>
<td>UserFilter</td>
<td>用户拦截器，用户已经身份验证/记住我登录的都可</td>
</tr>
<tr>
<td>授权相关的</td>
<td></td>
<td></td>
</tr>
<tr>
<td>roles</td>
<td>RolesAuthorizationFilter</td>
<td>角色授权拦截器，验证用户是否拥有所有角色；主要属性： loginUrl：登录页面地址（/login.jsp）；unauthorizedUrl：未授权后重定向的地址；示例“/admin/**=roles[admin]”</td>
</tr>
<tr>
<td>perms</td>
<td>PermissionsAuthorizationFilter</td>
<td>权限授权拦截器，验证用户是否拥有所有权限；属性和roles一样；示例“/user/**=perms[“user:create”]”</td>
</tr>
<tr>
<td>port</td>
<td>PortFilter</td>
<td>端口拦截器，主要属性：port（80）：可以通过的端口；示例“/test= port[80]”，如果用户访问该页面是非80，将自动将请求端口改为80并重定向到该80端口，其他路径/参数等都一样</td>
</tr>
<tr>
<td>rest</td>
<td>HttpMethodPermissionFilter</td>
<td>rest风格拦截器，自动根据请求方法构建权限字符串（GET=read, POST=create,PUT=update,DELETE=delete,HEAD=read,TRACE=read,OPTIONS=read, MKCOL=create）构建权限字符串；示例“/users=rest[user]”，会自动拼出“user:read,user:create,user:update,user:delete”权限字符串进行权限匹配（所有都得匹配，isPermittedAll）</td>
</tr>
<tr>
<td>ssl</td>
<td>SslFilter</td>
<td>SSL拦截器，只有请求协议是https才能通过；否则自动跳转会https端口（443）；其他和port拦截器一样</td>
</tr>
<tr>
<td>noSessionCreation</td>
<td>NoSessionCreationAuthorizationFilter</td>
<td>需要指定权限才能访问</td>
</tr>
</tbody></table>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><blockquote>
<p>url 模式使用 Ant 风格模式<br>• Ant 路径通配符支持 ?、*、**，注意通配符匹配不<br>包括目录分隔符“/”：<br>– ?：匹配一个字符，如 /admin? 将匹配 /admin1，但不匹配 /admin 或 /admin/；<br>– <em>：匹配零个或多个字符串，如 /admin 将匹配 /admin、/admin123，但不匹配 /admin/1；<br>– * * ：匹配路径中的零个或多个路径，如 /admin/</em> * 将匹配 /admin/a 或 /admin/a/b</p>
<p>URL 权限采取第一次匹配优先的方式</p>
<p>首先配置小的范围,最后配置大的范围,</p>
<p>eg: /user/login=anon</p>
<p>/**=authc</p>
</blockquote>
<h1 id="认证"><a href="#认证" class="headerlink" title="认证"></a>认证</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p><a href="https://www.bilibili.com/video/BV1uz4y197Zm?p=7">百知教育视频</a></p>
<p>自定义Realm的本意是将授权/认证的数据来源转换为数据库中存在的数据</p>
<ol>
<li>需要继承<code>AuthorizingRealm</code>类</li>
<li><code>AuthorizingRealm</code>类中的<code>doGetAuthorizationInfo</code>是授权</li>
<li><code>AuthorizingRealm</code>类中的<code>doGetAuthenticationInfo</code>是认证</li>
</ol>
<h2 id="代码实现"><a href="#代码实现" class="headerlink" title="代码实现"></a>代码实现</h2><p><a href="https://www.bilibili.com/video/BV1PE411i7CV?p=42">狂神说springboott教程</a></p>
<p>认证流程:</p>
<p>当执行了<code>subject.login(token)</code>方法时,首先会进入到自定义Realm的<code>doGetAuthenticationInfo</code>认证中,查看返回值是否是<code>null</code>,如果不是,认证通过,如果是,抛出账号异常<code>UnknownAccountException</code>.</p>
<h3 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/login&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">login</span><span class="params">(<span class="meta">@RequestParam</span> String username,<span class="meta">@RequestParam</span> String password)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//获取当前用户</span></span><br><span class="line">    Subject subject = SecurityUtils.getSubject();</span><br><span class="line">    UsernamePasswordToken token = <span class="keyword">new</span> UsernamePasswordToken(username, password);</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        subject.login(token);</span><br><span class="line">        <span class="keyword">return</span> R.success().add(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;登录成功&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (UnknownAccountException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.fail().add(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;账号异常&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (IncorrectCredentialsException e) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.fail().add(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;密码异常&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        <span class="keyword">return</span> R.fail().add(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;登录失败&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义realm"><a href="#自定义realm" class="headerlink" title="自定义realm"></a>自定义realm</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> <span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> </span></span><br><span class="line"><span class="function">    <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">    <span class="comment">//1. 获取当前用户</span></span><br><span class="line">    UsernamePasswordToken userToken = (UsernamePasswordToken) token;</span><br><span class="line">    <span class="comment">//2. 根据当前用户名,查询数据库信息</span></span><br><span class="line">    QueryWrapper&lt;Users&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;username&quot;</span>, userToken.getUsername());</span><br><span class="line">    Users users = usersService.getOne(wrapper);</span><br><span class="line">    <span class="comment">//3.返回给登录操作,传入用户名(数据库查询或者前端输入都可以),密码,Realm(一般调用父类名称即可)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(userToken.getUsername(), </span><br><span class="line">                                        users.getPassword(), </span><br><span class="line">                                        getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="shiro配置"><a href="#shiro配置" class="headerlink" title="shiro配置"></a>shiro配置</h3><p>如果没有认证,就跳转到登录页面</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ShiroFilterFactoryBean bean = <span class="keyword">new</span> ShiroFilterFactoryBean();</span><br><span class="line"><span class="comment">//绑定安全管理器</span></span><br><span class="line">bean.setSecurityManager(securityManager);</span><br><span class="line"><span class="comment">//未登录</span></span><br><span class="line">bean.setLoginUrl(<span class="string">&quot;/users/toLogin&quot;</span>);</span><br><span class="line"><span class="comment">//设置拦截路径</span></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">  * anon 无需认证</span></span><br><span class="line"><span class="comment">  * authc  必须认证</span></span><br><span class="line"><span class="comment">  * user  记住我 功能</span></span><br><span class="line"><span class="comment">  * perms  拥有对某个资源的权限</span></span><br><span class="line"><span class="comment">  * role  拥有角色权限</span></span><br><span class="line"><span class="comment">  * logout  登出</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="comment">//最好是按照顺序来编写权限,所有建议实例化成LinkedHashMap</span></span><br><span class="line">Map&lt;String, String&gt; filterMap = <span class="keyword">new</span> LinkedHashMap&lt;&gt;();</span><br><span class="line">filterMap.put(<span class="string">&quot;/users/login&quot;</span>, <span class="string">&quot;anon&quot;</span>);</span><br><span class="line">filterMap.put(<span class="string">&quot;/users/logout&quot;</span>, <span class="string">&quot;logout&quot;</span>);</span><br><span class="line">filterMap.put(<span class="string">&quot;/users/update&quot;</span>, <span class="string">&quot;authc&quot;</span>);</span><br><span class="line">filterMap.put(<span class="string">&quot;/users/add&quot;</span>, <span class="string">&quot;authc&quot;</span>);</span><br><span class="line"></span><br><span class="line">bean.setFilterChainDefinitionMap(filterMap);</span><br><span class="line"><span class="keyword">return</span> bean;</span><br></pre></td></tr></table></figure>

<h2 id="认证流程"><a href="#认证流程" class="headerlink" title="认证流程"></a>认证流程</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><p><a href="https://www.bilibili.com/video/BV1uz4y197Zm?p=6">百知教育</a></p>
<blockquote>
<ol>
<li>首先执行subject.log(token)方法</li>
<li>在<code>SimpleAccountRealm</code>的<code>doGetAuthenticationInfo</code>中完成了对用户名的校验</li>
<li>在<code>AuthenticatingRealm</code>的<code>assertCredentialsMatch</code>中完成了对密码的校验,如果不匹配,就发生了<code>IncorrectCredentialsException</code></li>
</ol>
</blockquote>
<h3 id="图示-1"><a href="#图示-1" class="headerlink" title="图示"></a>图示</h3><p><img data-src="/images/framework/shiro/shiro-2.png" alt="shiro-2.png"></p>
<ol>
<li><code>Realm</code>是所有XXXRealm的父类</li>
<li><code>AuthenticatingRealm</code>中<code>doGetAuthenticationInfo</code>实现了认证realm</li>
<li><code>AuthorizingRealm</code>中<code>doGetAuthorizationInfo</code>实现了授权realm</li>
<li><code>SimpleAccountRealm</code>继承了AuthorizingRealm类,拥有了以上两种接口的方法</li>
</ol>
<h2 id="密码加密"><a href="#密码加密" class="headerlink" title="密码加密"></a>密码加密</h2><h3 id="快速入门"><a href="#快速入门" class="headerlink" title="快速入门"></a>快速入门</h3><p><a href="https://www.bilibili.com/video/BV1uz4y197Zm?p=9">百知教育</a></p>
<p><a href="https://blog.csdn.net/qq_35416214/article/details/106231460">CSDN博客文章</a></p>
<p>使用MD5加密,需要在自定义Realm中添加一个<code>密码匹配凭证管理器</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// md5</span></span><br><span class="line">Md5Hash md5Hash = <span class="keyword">new</span> Md5Hash(<span class="string">&quot;1234&quot;</span>);</span><br><span class="line"><span class="comment">//81dc9bdb52d04dc20036dbd8313ed055</span></span><br><span class="line">System.out.println(md5Hash.toHex());</span><br><span class="line"></span><br><span class="line"><span class="comment">//md5+salt</span></span><br><span class="line">Md5Hash md5Hash1 = <span class="keyword">new</span> Md5Hash(<span class="string">&quot;1234&quot;</span>, <span class="string">&quot;SdFGTy&quot;</span>);</span><br><span class="line"><span class="comment">//6edbc9e0eabf0d98fd16a7a97ee06aef</span></span><br><span class="line">System.out.println(md5Hash1);</span><br><span class="line"></span><br><span class="line"><span class="comment">//md5+salt+hash散列(对结果散列多少次)</span></span><br><span class="line">Md5Hash md5Hash2 = <span class="keyword">new</span> Md5Hash(<span class="string">&quot;1234&quot;</span>, <span class="string">&quot;SdFGTy&quot;</span>, <span class="number">1024</span>);</span><br><span class="line"><span class="comment">//78a2ad447fcf315b50b8e40fd2c3bc9a</span></span><br><span class="line">System.out.println(md5Hash2);</span><br></pre></td></tr></table></figure>

<h3 id="注册"><a href="#注册" class="headerlink" title="注册"></a>注册</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@PostMapping(&quot;/register&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">register</span><span class="params">(<span class="meta">@RequestBody</span> Users user)</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 将用户名作为盐值</span></span><br><span class="line">    ByteSource salt = ByteSource.Util.bytes(user.getUsername());</span><br><span class="line">    <span class="comment">/*</span></span><br><span class="line"><span class="comment">    * MD5加密：</span></span><br><span class="line"><span class="comment">    * 使用SimpleHash类对原始密码进行加密。</span></span><br><span class="line"><span class="comment">    * 第一个参数代表使用MD5方式加密</span></span><br><span class="line"><span class="comment">    * 第二个参数为原始密码</span></span><br><span class="line"><span class="comment">    * 第三个参数为盐值，即用户名</span></span><br><span class="line"><span class="comment">    * 第四个参数为加密次数</span></span><br><span class="line"><span class="comment">    * 最后用toHex()方法将加密后的密码转成String</span></span><br><span class="line"><span class="comment">    * */</span></span><br><span class="line">    String newPs = <span class="keyword">new</span> SimpleHash(<span class="string">&quot;MD5&quot;</span>,</span><br><span class="line">                                  user.getPassword(),</span><br><span class="line">                                  salt,</span><br><span class="line">                                  <span class="number">1024</span>).toHex();</span><br><span class="line">    user.setPassword(newPs);</span><br><span class="line">    usersService.save(user);</span><br><span class="line">    <span class="keyword">return</span> R.success().add(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;成功添加一个用户:&quot;</span> + user.getUsername());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Realm中配置加密"><a href="#Realm中配置加密" class="headerlink" title="Realm中配置加密"></a>Realm中配置加密</h3><p>添加一个<code>密码匹配凭证管理器</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(name = &quot;customRealm&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CustomRealm <span class="title">customRealm</span><span class="params">(<span class="meta">@Qualifier(&quot;credentialsMatcher&quot;)</span> HashedCredentialsMatcher matcher)</span> </span>&#123;</span><br><span class="line">    CustomRealm realm = <span class="keyword">new</span> CustomRealm();</span><br><span class="line">    <span class="comment">//绑定密码管理器</span></span><br><span class="line">    realm.setCredentialsMatcher(matcher);</span><br><span class="line">    <span class="keyword">return</span> realm;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * 密码匹配凭证管理器</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="meta">@Bean(name = &quot;credentialsMatcher&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> HashedCredentialsMatcher <span class="title">hashedCredentialsMatcher</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    HashedCredentialsMatcher matcher = <span class="keyword">new</span> HashedCredentialsMatcher();</span><br><span class="line">    <span class="comment">// 采用MD5方式加密</span></span><br><span class="line">    matcher.setHashAlgorithmName(<span class="string">&quot;MD5&quot;</span>);</span><br><span class="line">    <span class="comment">// 设置加密次数 1024</span></span><br><span class="line">    matcher.setHashIterations(<span class="number">1024</span>);</span><br><span class="line">    <span class="keyword">return</span> matcher;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="自定义Realm"><a href="#自定义Realm" class="headerlink" title="自定义Realm"></a>自定义Realm</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthenticationInfo <span class="title">doGetAuthenticationInfo</span><span class="params">(AuthenticationToken token)</span> <span class="keyword">throws</span> AuthenticationException </span>&#123;</span><br><span class="line">    <span class="comment">//1. 获取当前用户</span></span><br><span class="line">    UsernamePasswordToken userToken = (UsernamePasswordToken) token;</span><br><span class="line">    <span class="comment">//2. 根据当前用户名,查询数据库信息</span></span><br><span class="line">    QueryWrapper&lt;Users&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.eq(<span class="string">&quot;username&quot;</span>, userToken.getUsername());</span><br><span class="line">    Users users = usersService.getOne(wrapper);</span><br><span class="line">    <span class="comment">//3. 加密,盐值,</span></span><br><span class="line">    <span class="comment">// 获取盐值，即用户名</span></span><br><span class="line">    ByteSource salt = ByteSource.Util.bytes(userToken.getUsername());</span><br><span class="line">    <span class="comment">//4.返回给登录操作,传入用户名(数据库查询或者前端输入都可以),密码,盐值,Realm(一般调用父类名称即可)</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> SimpleAuthenticationInfo(userToken.getUsername(), users.getPassword(), salt, getName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="授权"><a href="#授权" class="headerlink" title="授权"></a>授权</h1><h2 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h2><p><a href="https://www.bilibili.com/video/BV1YW411M7S3?p=16">尚硅谷</a></p>
<p>授权，也叫访问控制，即在应用中控制谁访问哪些资源（如访问页面/编辑数据/页面操作等）。在授权中需了解的几个关键对象：主体（Subject）、资源（Resource）、权限（Permission）、角色（Role）。<br>• 主体(Subject)：访问应用的用户，在 Shiro 中使用 Subject 代表该用户。用户只有授权后才允许访问相应的资源。<br>• 资源(Resource)：在应用中用户可以访问的 URL，比如访问 JSP 页面、查看/编辑某些数据、访问某个业务方法、打印文本等等都是资源。用户只要授权后才能访问。<br>• 权限(Permission)：安全策略中的原子授权单位，通过权限我们可以表示在应用中用户有没有操作某个资源的权力。即权限表示在应用中用户能不能访问某个资源，如：访问用户列表页面查看/新增/修改/删除用户数据（即很多时候都是CRUD（增查改删）式权限控制）等。权限代表了用户有没有操作某个资源的权利，即反映在某个资源上的操作允不允许。<br>• Shiro 有粗粒度权限（如用户模块的所有权限）和细粒度权限（操作某个用户的权限，即实例级别的）<br>• 角色(Role)：权限的集合，一般情况下会赋予用户角色而不是权限，即这样用户可以拥有一组权限，赋予权限时比较方便。典型的如：项目经理、技术总监、CTO、开发工程师等都是角色，不同的角色拥有一组不同的权限。</p>
<h2 id="三种实现"><a href="#三种实现" class="headerlink" title="三种实现"></a>三种实现</h2><p>Shiro 支持三种方式的授权：<br>– 编程式：通过写if/else 授权代码块完成<br>– 注解式：通过在执行的Java方法上放置相应的注解完成，没有权限将抛出相应的异常<br>– JSP/GSP 标签：在JSP/GSP 页面通过相应的标签完成</p>
<h2 id="编程实现"><a href="#编程实现" class="headerlink" title="编程实现"></a>编程实现</h2><p><a href="https://www.bilibili.com/video/BV1uz4y197Zm?p=18">编程不良人  16:17s</a></p>
<h3 id="第一种"><a href="#第一种" class="headerlink" title="第一种"></a>第一种</h3><ol>
<li>在shiro的配置文件中,配置资源的权限</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">filterMap.put(<span class="string">&quot;/users/add&quot;</span>, <span class="string">&quot;perms[user]&quot;</span>);</span><br><span class="line">filterMap.put(<span class="string">&quot;/users/update&quot;</span>, <span class="string">&quot;perms[admin]&quot;</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在自定义的Realm中,进行授权</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">protected</span> AuthorizationInfo <span class="title">doGetAuthorizationInfo</span><span class="params">(PrincipalCollection principalCollection)</span> </span>&#123;</span><br><span class="line">    String username = (String) principalCollection.getPrimaryPrincipal();</span><br><span class="line">    log.warn(<span class="string">&quot;用户名:&quot;</span> + username);</span><br><span class="line">    <span class="comment">//根据用户名查询权限或者角色信息</span></span><br><span class="line">    QueryWrapper&lt;Users&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line">    wrapper.select(<span class="string">&quot;permission&quot;</span>).eq(<span class="string">&quot;username&quot;</span>, username);</span><br><span class="line">    Users users = usersService.getOne(wrapper);</span><br><span class="line">    <span class="comment">//权限授权</span></span><br><span class="line">    SimpleAuthorizationInfo info = <span class="keyword">new</span> SimpleAuthorizationInfo();</span><br><span class="line">    info.addStringPermission(users.getPermission());</span><br><span class="line">    <span class="keyword">return</span> info;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>授权方法没有运行时,可以进行如下两步操作<ul>
<li>强制在自定义Realm的类上添加注解<code>@Component</code></li>
<li>在springboot中配置<code>spring.main.allow-bean-definition-overriding=true</code></li>
</ul>
</li>
</ol>
<h3 id="第二种"><a href="#第二种" class="headerlink" title="第二种"></a>第二种</h3><p>不需要在shiro配置文件中编写资源访问权限</p>
<ol>
<li>在自定义Realm中进行授权</li>
<li>在代码中通过if/else进行权限验证</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@GetMapping(&quot;/add&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> R <span class="title">add</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    Subject subject = SecurityUtils.getSubject();</span><br><span class="line">    <span class="keyword">if</span> (subject.isPermitted(<span class="string">&quot;admin&quot;</span>)) &#123;</span><br><span class="line">   	 	<span class="keyword">return</span> R.success().add(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;进行了一次增加操作&quot;</span>);</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">    	<span class="keyword">return</span> R.fail().add(<span class="string">&quot;msg&quot;</span>, <span class="string">&quot;没有权限&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="EhCache本地缓存"><a href="#EhCache本地缓存" class="headerlink" title="EhCache本地缓存"></a>EhCache本地缓存</h1><ol>
<li>引入缓存的依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--shiro-缓存--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.apache.shiro<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>shiro-ehcache<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.7.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在shiro全局配置的Realm中,开启缓存</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(name = &quot;customRealm&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> CustomRealm <span class="title">customRealm</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    CustomRealm realm = <span class="keyword">new</span> CustomRealm();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//开启缓存管理</span></span><br><span class="line">    realm.setCacheManager(<span class="keyword">new</span> EhCacheManager());</span><br><span class="line">    <span class="comment">//开启全局缓存</span></span><br><span class="line">    realm.setCachingEnabled(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">//开启认证缓存</span></span><br><span class="line">    realm.setAuthenticationCachingEnabled(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">//认证缓存的别名</span></span><br><span class="line">    realm.setAuthenticationCacheName(<span class="string">&quot;authenticationCache&quot;</span>);</span><br><span class="line">    <span class="comment">//开启授权缓存</span></span><br><span class="line">    realm.setAuthorizationCachingEnabled(<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">//授权缓存的别名</span></span><br><span class="line">    realm.setAuthorizationCacheName(<span class="string">&quot;authorizationCache&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> realm;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>






























]]></content>
      <categories>
        <category>其他框架</category>
      </categories>
      <tags>
        <tag>框架</tag>
      </tags>
  </entry>
  <entry>
    <title>ssm整合</title>
    <url>/2020/05/29/other/ssm/</url>
    <content><![CDATA[<h1 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h1><p>ssm配置中使用前后端分离技术,为了引入方便,maven使用springboot.</p>
<p>使用到的技术</p>
<ol>
<li>pageHelper</li>
<li>swagger</li>
<li>mybatis-generator</li>
<li>mysql8</li>
</ol>
<a id="more"></a>

<h1 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h1><p>引入父类</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;parent&gt;</span><br><span class="line">       &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">       &lt;artifactId&gt;spring-boot-starter-parent&lt;&#x2F;artifactId&gt;</span><br><span class="line">       &lt;version&gt;2.2.6.RELEASE&lt;&#x2F;version&gt;</span><br><span class="line">       &lt;relativePath&#x2F;&gt;</span><br><span class="line">   &lt;&#x2F;parent&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-boot-starter-jdbc&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;spring-boot-starter-web&lt;&#x2F;artifactId&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.mybatis.spring.boot&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;mybatis-spring-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.1.2&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      &lt;!--swagger--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;springfox-swagger-ui&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.9.2&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;io.springfox&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;springfox-swagger2&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.9.2&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;com.mangofactory&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;swagger-springmvc&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;1.0.2&lt;&#x2F;version&gt;</span><br><span class="line">          &lt;exclusions&gt;</span><br><span class="line">              &lt;exclusion&gt;</span><br><span class="line">                  &lt;artifactId&gt;guava&lt;&#x2F;artifactId&gt;</span><br><span class="line">                  &lt;groupId&gt;com.google.guava&lt;&#x2F;groupId&gt;</span><br><span class="line">              &lt;&#x2F;exclusion&gt;</span><br><span class="line">          &lt;&#x2F;exclusions&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;com.github.penggle&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;kaptcha&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;2.3.2&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!-- MBG --&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.mybatis.generator&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;mybatis-generator-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;1.3.5&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--el表达式--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;jstl&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;jstl&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;1.2&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--druid数据源--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;com.alibaba&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;druid&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;1.1.22&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--数据库--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;8.0.19&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--log4j--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;log4j&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;log4j&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;1.2.12&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">      &lt;!-- junit --&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;junit&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;junit&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;4.12&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--lombok--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;!--&lt;version&gt;1.16.22&lt;&#x2F;version&gt;--&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">      &lt;!--pagehelper--&gt;</span><br><span class="line">      &lt;dependency&gt;</span><br><span class="line">          &lt;groupId&gt;com.github.pagehelper&lt;&#x2F;groupId&gt;</span><br><span class="line">          &lt;artifactId&gt;pagehelper&lt;&#x2F;artifactId&gt;</span><br><span class="line">          &lt;version&gt;5.1.11&lt;&#x2F;version&gt;</span><br><span class="line">      &lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<p>静态资源以及编译</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;build&gt;</span><br><span class="line">     &lt;plugins&gt;</span><br><span class="line">         &lt;!--设置jdk1.8编译--&gt;</span><br><span class="line">         &lt;plugin&gt;</span><br><span class="line">             &lt;groupId&gt;org.apache.maven.plugins&lt;&#x2F;groupId&gt;</span><br><span class="line">             &lt;artifactId&gt;maven-compiler-plugin&lt;&#x2F;artifactId&gt;</span><br><span class="line">             &lt;version&gt;3.5&lt;&#x2F;version&gt;</span><br><span class="line">             &lt;configuration&gt;</span><br><span class="line">                 &lt;source&gt;1.8&lt;&#x2F;source&gt;</span><br><span class="line">                 &lt;target&gt;1.8&lt;&#x2F;target&gt;</span><br><span class="line">             &lt;&#x2F;configuration&gt;</span><br><span class="line">         &lt;&#x2F;plugin&gt;</span><br><span class="line">     &lt;&#x2F;plugins&gt;</span><br><span class="line">     &lt;!--静态资源处理--&gt;</span><br><span class="line">     &lt;resources&gt;</span><br><span class="line">         &lt;resource&gt;</span><br><span class="line">             &lt;directory&gt;src&#x2F;main&#x2F;java&lt;&#x2F;directory&gt;</span><br><span class="line">             &lt;includes&gt;</span><br><span class="line">                 &lt;include&gt;**&#x2F;*.properties&lt;&#x2F;include&gt;</span><br><span class="line">                 &lt;include&gt;**&#x2F;*.xml&lt;&#x2F;include&gt;</span><br><span class="line">             &lt;&#x2F;includes&gt;</span><br><span class="line">             &lt;filtering&gt;false&lt;&#x2F;filtering&gt;</span><br><span class="line">         &lt;&#x2F;resource&gt;</span><br><span class="line">         &lt;resource&gt;</span><br><span class="line">             &lt;directory&gt;src&#x2F;main&#x2F;resources&lt;&#x2F;directory&gt;</span><br><span class="line">             &lt;includes&gt;</span><br><span class="line">                 &lt;include&gt;**&#x2F;*.properties&lt;&#x2F;include&gt;</span><br><span class="line">                 &lt;include&gt;**&#x2F;*.xml&lt;&#x2F;include&gt;</span><br><span class="line">             &lt;&#x2F;includes&gt;</span><br><span class="line">             &lt;filtering&gt;false&lt;&#x2F;filtering&gt;</span><br><span class="line">         &lt;&#x2F;resource&gt;</span><br><span class="line">     &lt;&#x2F;resources&gt;</span><br><span class="line"> &lt;&#x2F;build&gt;</span><br></pre></td></tr></table></figure>

<h1 id="MBG"><a href="#MBG" class="headerlink" title="MBG"></a>MBG</h1><blockquote>
<p><strong>MBG.xml文件放置在项目根目录下面</strong></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&#x27;1.0&#x27; encoding=&#x27;UTF-8&#x27;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">generatorConfiguration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD MyBatis Generator Configuration 1.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-generator-config_1_0.dtd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">generatorConfiguration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context</span> <span class="attr">id</span>=<span class="string">&quot;mybatisGenerator&quot;</span> <span class="attr">targetRuntime</span>=<span class="string">&quot;MyBatis3&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 是否去除自动生成的注释 true：是 ： false:否 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suppressAllComments&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">commentGenerator</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--链接数据库 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">jdbcConnection</span> <span class="attr">driverClass</span>=<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">connectionURL</span>=<span class="string">&quot;jdbc:mysql://localhost:3306/wty?rewriteBatchedStatements=true<span class="symbol">&amp;amp;</span>useUnicode=true<span class="symbol">&amp;amp;</span>characterEncoding=utf8<span class="symbol">&amp;amp;</span>serverTimezone=UTC&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">userId</span>=<span class="string">&quot;root&quot;</span></span></span><br><span class="line"><span class="tag">                        <span class="attr">password</span>=<span class="string">&quot;root&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">jdbcConnection</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 默认false，把JDBC DECIMAL 和 NUMERIC 类型解析为 Integer，为 true时把JDBC DECIMAL 和</span></span><br><span class="line"><span class="comment">            NUMERIC 类型解析为java.math.BigDecimal --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;forceBigDecimals&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaTypeResolver</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- targetProject:生成javabean类的位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaModelGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;com.wty.ssm.bean&quot;</span></span></span><br><span class="line"><span class="tag">                            <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\java&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- enableSubPackages:是否让schema作为包的后缀 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 从数据库返回的值被清理前后的空格 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;trimStrings&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaModelGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- targetProject:mapper映射文件生成的位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">sqlMapGenerator</span> <span class="attr">targetPackage</span>=<span class="string">&quot;mybatis\mapper&quot;</span></span></span><br><span class="line"><span class="tag">                         <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\resources&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- enableSubPackages:是否让schema作为包的后缀 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">sqlMapGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- targetPackage：mapper接口生成的位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">javaClientGenerator</span> <span class="attr">type</span>=<span class="string">&quot;XMLMAPPER&quot;</span></span></span><br><span class="line"><span class="tag">                             <span class="attr">targetPackage</span>=<span class="string">&quot;com.wty.ssm.dao&quot;</span></span></span><br><span class="line"><span class="tag">                             <span class="attr">targetProject</span>=<span class="string">&quot;.\src\main\java&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- enableSubPackages:是否让schema作为包的后缀 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;enableSubPackages&quot;</span> <span class="attr">value</span>=<span class="string">&quot;false&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">javaClientGenerator</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!-- 指定数据库表 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">table</span> <span class="attr">tableName</span>=<span class="string">&quot;books&quot;</span> <span class="attr">domainObjectName</span>=<span class="string">&quot;Books&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">generatorConfiguration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h1><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">id</span>=<span class="string">&quot;WebApp_ID&quot;</span> <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--1、启动Spring的容器  --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 整个项目加载的时候 会加载该启动器 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/applicationContext.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context-param</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- Bootstraps the root web application context before servlet initialization --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">listener</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">listener-class</span>&gt;</span>org.springframework.web.context.ContextLoaderListener<span class="tag">&lt;/<span class="name">listener-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">listener</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--2、springmvc的前端控制器，拦截所有请求  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置springMvc配置文件的位置和名称--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:spring/spring-mvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--应答所有请求--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 3、字符编码过滤器，一定要放在所有过滤器之前 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceRequestEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceResponseEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 4、使用Rest风格的URI，将页面普通的post请求转为指定的delete或者put请求 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="resources"><a href="#resources" class="headerlink" title="resources"></a>resources</h1><blockquote>
<p>目录结构</p>
</blockquote>
<p><img data-src="/images/framework/ssm-1.png" alt="images/framework/ssm-1.png"></p>
<h2 id="dbconfig-properties"><a href="#dbconfig-properties" class="headerlink" title="dbconfig.properties"></a>dbconfig.properties</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">jdbc.url=jdbc:mysql://localhost:3306/wty?rewriteBatchedStatements=true&amp;useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC</span><br><span class="line">jdbc.driver=com.mysql.cj.jdbc.Driver</span><br><span class="line">jdbc.user=root</span><br><span class="line">jdbc.password=root</span><br></pre></td></tr></table></figure>

<h2 id="mybatis-config"><a href="#mybatis-config" class="headerlink" title="mybatis-config"></a>mybatis-config</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">configuration</span></span></span><br><span class="line"><span class="meta">        <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Config 3.0//EN&quot;</span></span></span><br><span class="line"><span class="meta">        <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-config.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">plugins</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">plugin</span> <span class="attr">interceptor</span>=<span class="string">&quot;com.github.pagehelper.PageInterceptor&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--分页参数合理化  --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;reasonable&quot;</span> <span class="attr">value</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">plugin</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">plugins</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="mapper模板"><a href="#mapper模板" class="headerlink" title="mapper模板"></a>mapper模板</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">mapper</span> <span class="meta-keyword">PUBLIC</span> <span class="meta-string">&quot;-//mybatis.org//DTD Mapper 3.0//EN&quot;</span> <span class="meta-string">&quot;http://mybatis.org/dtd/mybatis-3-mapper.dtd&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mapper</span> <span class="attr">namespace</span>=<span class="string">&quot;com&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">mapper</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="application-xml"><a href="#application-xml" class="headerlink" title="application.xml"></a>application.xml</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 包扫描 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.wty.ssm&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:exclude-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-mvc.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-tx.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">import</span> <span class="attr">resource</span>=<span class="string">&quot;spring-dao.xml&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="spring-dao-xml"><a href="#spring-dao-xml" class="headerlink" title="spring-dao.xml"></a>spring-dao.xml</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mybatis-spring</span>=<span class="string">&quot;http://mybatis.org/schema/mybatis-spring&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://mybatis.org/schema/mybatis-spring http://mybatis.org/schema/mybatis-spring-1.2.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context http://www.springframework.org/schema/context/spring-context-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 引入数据库的配置文件 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:config/dbconfig.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.user&#125;&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--整合mybatis--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--创建出SqlSessionFactory对象  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSessionFactoryBean&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionFactoryBean&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- configLocation指定全局配置文件的位置 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;configLocation&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis/mybatis-config.xml&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--mapperLocations: 指定mapper文件的位置--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;mapperLocations&quot;</span> <span class="attr">value</span>=<span class="string">&quot;classpath:mybatis/mapper/*.xml&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--配置一个可以进行批量执行的sqlSession  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;sqlSession&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.mybatis.spring.SqlSessionTemplate&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;sqlSessionFactory&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;sqlSessionFactoryBean&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">constructor-arg</span> <span class="attr">name</span>=<span class="string">&quot;executorType&quot;</span> <span class="attr">value</span>=<span class="string">&quot;BATCH&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 扫描所有的mapper接口的实现，让这些mapper能够自动注入:@Autowired；</span></span><br><span class="line"><span class="comment">    base-package：指定mapper接口的包名</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mybatis-spring:scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.wty.ssm.dao&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="spring-mvc-xml"><a href="#spring-mvc-xml" class="headerlink" title="spring-mvc.xml"></a>spring-mvc.xml</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/mvc/spring-mvc.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.wty.ssm.controller&quot;</span> <span class="attr">use-default-filters</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 视图解析器：逻辑视图  物理视图--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/page&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.html&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;springfox.documentation.swagger2.configuration.Swagger2DocumentationConfiguration&quot;</span> <span class="attr">id</span>=<span class="string">&quot;swagger2Config&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.wty.ssm.util.SwaggerConfig&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">&quot;classpath:/META-INF/resources/&quot;</span> <span class="attr">mapping</span>=<span class="string">&quot;swagger-ui.html&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:resources</span> <span class="attr">location</span>=<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span> <span class="attr">mapping</span>=<span class="string">&quot;/webjars/**&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="spring-tx-xml"><a href="#spring-tx-xml" class="headerlink" title="spring-tx.xml"></a>spring-tx.xml</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/tx http://www.springframework.org/schema/tx/spring-tx-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 开启基于注解的事务 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;dataSourceTransactionManager&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- spring事务管理 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSourceTransactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="log4j-xml"><a href="#log4j-xml" class="headerlink" title="log4j.xml"></a>log4j.xml</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot; ?&gt;</span></span><br><span class="line"><span class="meta">&lt;!DOCTYPE <span class="meta-keyword">log4j</span>:configuration <span class="meta-keyword">SYSTEM</span> <span class="meta-string">&quot;log4j.dtd&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"><span class="tag">&lt;<span class="name">log4j:configuration</span> <span class="attr">xmlns:log4j</span>=<span class="string">&quot;http://jakarta.apache.org/log4j/&quot;</span>&gt;</span></span><br><span class="line"> </span><br><span class="line"> <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;STDOUT&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;Encoding&quot;</span> <span class="attr">value</span>=<span class="string">&quot;UTF-8&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;org.apache.log4j.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">param</span> <span class="attr">name</span>=<span class="string">&quot;ConversionPattern&quot;</span> <span class="attr">value</span>=<span class="string">&quot;%-5p %d&#123;MM-dd HH:mm:ss,SSS&#125; %m  (%F:%L) \n&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;java.sql&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.apache.ibatis&quot;</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;info&quot;</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"> <span class="tag">&lt;<span class="name">root</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">level</span> <span class="attr">value</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;STDOUT&quot;</span> /&gt;</span></span><br><span class="line"> <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">log4j:configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="java部分"><a href="#java部分" class="headerlink" title="java部分"></a>java部分</h1><h2 id="逆向生成"><a href="#逆向生成" class="headerlink" title="逆向生成"></a>逆向生成</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">       List&lt;String&gt; warnings = <span class="keyword">new</span> ArrayList&lt;String&gt;();</span><br><span class="line">       <span class="keyword">boolean</span> overwrite = <span class="keyword">true</span>;</span><br><span class="line">       File configFile = <span class="keyword">new</span> File(<span class="string">&quot;MBG.xml&quot;</span>);</span><br><span class="line">       ConfigurationParser cp = <span class="keyword">new</span> ConfigurationParser(warnings);</span><br><span class="line">       Configuration config = cp.parseConfiguration(configFile);</span><br><span class="line">       DefaultShellCallback callback = <span class="keyword">new</span> DefaultShellCallback(overwrite);</span><br><span class="line">       MyBatisGenerator myBatisGenerator = <span class="keyword">new</span> MyBatisGenerator(config, callback, warnings);</span><br><span class="line">       myBatisGenerator.generate(<span class="keyword">null</span>);</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="json数据封装"><a href="#json数据封装" class="headerlink" title="json数据封装"></a>json数据封装</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Getter</span><br><span class="line">@Setter</span><br><span class="line">public class Msg &#123;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 状态码   100-成功    200-失败</span><br><span class="line">     *&#x2F;</span><br><span class="line"></span><br><span class="line">    private int code;</span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 提示信息</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private String msg;</span><br><span class="line"></span><br><span class="line">    &#x2F;**</span><br><span class="line">     * 用户要返回给浏览器的数据</span><br><span class="line">     *&#x2F;</span><br><span class="line">    private Map&lt;String, Object&gt; extend &#x3D; new HashMap&lt;String, Object&gt;();</span><br><span class="line"></span><br><span class="line">    public static Msg success() &#123;</span><br><span class="line">        Msg result &#x3D; new Msg();</span><br><span class="line">        result.setCode(100);</span><br><span class="line">        result.setMsg(&quot;处理成功！&quot;);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public static Msg fail() &#123;</span><br><span class="line">        Msg result &#x3D; new Msg();</span><br><span class="line">        result.setCode(200);</span><br><span class="line">        result.setMsg(&quot;处理失败！&quot;);</span><br><span class="line">        return result;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    public Msg add(String key, Object value) &#123;</span><br><span class="line">        this.getExtend().put(key, value);</span><br><span class="line">        return this;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="swagger配置"><a href="#swagger配置" class="headerlink" title="swagger配置"></a>swagger配置</h2><ol>
<li>maven</li>
<li>springmvc配置</li>
<li>java代码</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">@Configuration</span><br><span class="line">@EnableSwagger2</span><br><span class="line">public class SwaggerConfig &#123;</span><br><span class="line">    &#x2F;&#x2F;配置swagger的docket实例</span><br><span class="line">    public Docket docket() &#123;</span><br><span class="line">        return new Docket(DocumentationType.SWAGGER_2)</span><br><span class="line">                .apiInfo(apiInfo())</span><br><span class="line">                .groupName(&quot;XXX&quot;)</span><br><span class="line">                .select()</span><br><span class="line">                .apis(RequestHandlerSelectors.basePackage(&quot;com.wty.ssm.controller&quot;))</span><br><span class="line">                .build();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    private ApiInfo apiInfo() &#123;</span><br><span class="line">        &#x2F;&#x2F;作者信息</span><br><span class="line">        Contact contact &#x3D; new Contact(&quot;XXX&quot;, &quot;https:&#x2F;&#x2F;javawty.github.io&#x2F;&quot;, &quot;123@qq.com&quot;);</span><br><span class="line">        return new ApiInfo(&quot;XXX的swaggerAPI接口&quot;,</span><br><span class="line">                &quot;描述&quot;,</span><br><span class="line">                &quot;v1.0&quot;,</span><br><span class="line">                &quot;https:&#x2F;&#x2F;javawty.github.io&#x2F;&quot;,</span><br><span class="line">                contact,</span><br><span class="line">                &quot;个人博客&quot;,</span><br><span class="line">                &quot;https:&#x2F;&#x2F;javawty.github.io&#x2F;&quot;,</span><br><span class="line">                new ArrayList());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="controller实例"><a href="#controller实例" class="headerlink" title="controller实例"></a>controller实例</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询全部</span></span><br><span class="line"><span class="comment">* http://localhost:8080/wty/bookAll</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> pn 如果有pn=页数,则跳转到指定页数,没有pn,默认查询第一页</span></span><br><span class="line"><span class="comment">* <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/bookAll&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Msg <span class="title">getAll</span><span class="params">(<span class="meta">@RequestParam(value = &quot;pn&quot;, defaultValue = &quot;1&quot;)</span> Integer pn)</span> </span>&#123;</span><br><span class="line">        PageHelper.startPage(pn, <span class="number">100</span>);</span><br><span class="line">        List&lt;Books&gt; books = booksService.selectByExample(<span class="keyword">null</span>);</span><br><span class="line">        PageInfo&lt;Books&gt; pageInfo = <span class="keyword">new</span> PageInfo&lt;&gt;(books, <span class="number">5</span>);</span><br><span class="line">        <span class="keyword">return</span> Msg.success().add(<span class="string">&quot;pageInfo&quot;</span>, pageInfo);</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>















]]></content>
      <categories>
        <category>其他框架</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>vue</title>
    <url>/2020/06/16/other/vue/</url>
    <content><![CDATA[<h1 id="基础语法"><a href="#基础语法" class="headerlink" title="基础语法"></a>基础语法</h1><h2 id="引入vue"><a href="#引入vue" class="headerlink" title="引入vue"></a>引入vue</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="差值表达式"><a href="#差值表达式" class="headerlink" title="差值表达式"></a>差值表达式</h2><h3 id="el挂载点"><a href="#el挂载点" class="headerlink" title="el挂载点"></a>el挂载点</h3><p><a href="https://www.bilibili.com/video/BV12J411m7MG?p=4">视频地址</a></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">被el选中的挂载点,才可以使用 &#123;&#123;&#125;&#125;,el选择挂载到的时候,可以是 id--&gt;#  class--&gt;.  标签选择器.例如 div</span><br></pre></td></tr></table></figure>

<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app1&quot;</span>&gt;</span></span><br><span class="line">	&#123;&#123;msg&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">    el: &#x27;#app1&#x27;,</span><br><span class="line">    data:&#123;</span><br><span class="line">  		  msg: &#x27;hello world&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="data举例-数组-对象"><a href="#data举例-数组-对象" class="headerlink" title="data举例.数组,对象"></a>data举例.数组,对象</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    获取对象:<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">   		 <span class="tag">&lt;<span class="name">p</span>&gt;</span>&#123;&#123;user.name&#125;&#125;--&#123;&#123;user.age&#125;&#125;<span class="tag">&lt;/<span class="name">p</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">    获取数组:<span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;books[0]&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;books[1]&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span>&gt;</span>&#123;&#123;books[2]&#125;&#125;<span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">    el: &#x27;#app&#x27;,</span><br><span class="line">    data: &#123;</span><br><span class="line">        user: &#123;</span><br><span class="line">            name: &quot;小明&quot;,</span><br><span class="line">            age: &quot;20&quot;</span><br><span class="line">        &#125;,</span><br><span class="line">        books: [&quot;水浒传&quot;,&quot;红楼梦&quot;,&quot;西游记&quot;]</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h2 id="数据与方法"><a href="#数据与方法" class="headerlink" title="数据与方法  $"></a>数据与方法  $</h2><p><a href="https://learning.dcloud.io/#/?vid=3">视频地址</a></p>
<ol>
<li>定义了一个外部数据user,在vue中可以通过data来引用</li>
<li>如果调试需要该表值,可以使用<code>vue.$data.name=&#39;李四2&#39;</code>或者<code>user.name=&#39;李四2&#39;</code>来改变值</li>
<li>$watch 是一个实例方法,用来监控数据<ul>
<li>$watch有两个参数,第一个是需要监控的对象数据,第二个是回调函数</li>
<li>回调函数包括两个数据,一个是新数据,一个是旧数据</li>
<li>且监控需要放在新数据之前才能被执行</li>
</ul>
</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">	<span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">		&#123;&#123;name&#125;&#125;</span><br><span class="line">	<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> user=&#123;<span class="attr">name</span>: <span class="string">&#x27;张三&#x27;</span>&#125;;</span></span><br><span class="line">	</span><br><span class="line"><span class="javascript">	<span class="keyword">var</span> vue=<span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">		el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">		data: user</span><br><span class="line">	&#125;);</span><br><span class="line"><span class="javascript">	vue.$watch(<span class="string">&#x27;name&#x27;</span>,<span class="function"><span class="keyword">function</span>(<span class="params">newData,oldData</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">		<span class="built_in">console</span>.log(<span class="string">&quot;新数据:&quot;</span>+newData);</span></span><br><span class="line"><span class="javascript">		<span class="built_in">console</span>.log(<span class="string">&quot;旧数据:&quot;</span>+oldData);</span></span><br><span class="line">	&#125;)</span><br><span class="line"><span class="javascript">	vue.$data.name=<span class="string">&#x27;李四2&#x27;</span></span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="指令"><a href="#指令" class="headerlink" title="指令"></a>指令</h2><h3 id="只能插入一次值-v-once"><a href="#只能插入一次值-v-once" class="headerlink" title="只能插入一次值 v-once"></a>只能插入一次值 v-once</h3><p>该指令表明,属性赋值之后,不能够再进行二次赋值,下面的例子中,李四这个值不会生效</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span> <span class="attr">v-once</span>&gt;</span></span><br><span class="line">    &#123;&#123;name&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> vm=<span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">	el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">	data: &#123;</span><br><span class="line"><span class="javascript">		name: <span class="string">&#x27;张三&#x27;</span></span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="javascript">vm.$data.name=<span class="string">&quot;李四&quot;</span>;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="v-html"><a href="#v-html" class="headerlink" title="v-html"></a>v-html</h3><p>输出携带样式的html页面</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span> <span class="attr">v-html</span>=<span class="string">&quot;sy&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> vm=<span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">	el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">	data: &#123;</span><br><span class="line"><span class="handlebars"><span class="xml">		sy: &#x27;<span class="tag">&lt;<span class="name">span</span> <span class="attr">style</span>=<span class="string">&quot;color:red&quot;</span>&gt;</span>hello vue v-html<span class="tag">&lt;/<span class="name">span</span>&gt;</span>&#x27;</span></span></span><br><span class="line">	&#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="判断-v-if"><a href="#判断-v-if" class="headerlink" title="判断 v-if"></a>判断 v-if</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app2&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>  <span class="attr">v-if</span>=<span class="string">&quot;seen&quot;</span>&gt;</span>可视<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">p</span>  <span class="attr">v-if</span>=<span class="string">&quot;seen===false&quot;</span>&gt;</span>不可视<span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">    el: &#x27;#app2&#x27;,</span><br><span class="line">    data:&#123;</span><br><span class="line">    	seen: true</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<p><a href="https://www.bilibili.com/video/BV1y7411y7am?p=48">尚硅谷 谷粒学院视频</a></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;checkbox&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;isAgree&quot;</span>&gt;</span>同意此协议</span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-if</span>=<span class="string">&quot;isAgree&quot;</span>&gt;</span>尚硅谷<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">h1</span> <span class="attr">v-else</span>&gt;</span>谷粒学院<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="javascript">        isAgree:<span class="literal">false</span></span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="单向数据绑定-v-bind"><a href="#单向数据绑定-v-bind" class="headerlink" title="单向数据绑定 v-bind"></a>单向数据绑定 v-bind</h3><blockquote>
<p>属性指的是src href title class这类,</p>
<p>写法为: v-bind:属性名=表达式</p>
<p>简写:  v-bind:src=XXX   :src=XXX</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app3&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">img</span> <span class="attr">:src</span>=<span class="string">&quot;imgSrc&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">    el: &#x27;#app3&#x27;,</span><br><span class="line">    data: &#123;</span><br><span class="line">   		 imgSrc:&#x27;https://pic4.zhimg.com/80/v2-a47051e92cf74930bedd7469978e6c08_hd.png&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="循环-v-for"><a href="#循环-v-for" class="headerlink" title="循环 v-for"></a>循环 v-for</h3><h4 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">ul</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;item in arr&quot;</span>&gt;</span></span><br><span class="line">        	中国地区:&#123;&#123;item&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">li</span> <span class="attr">v-for</span>=<span class="string">&quot;(item,index) in arr&quot;</span>&gt;</span></span><br><span class="line">        	&#123;&#123;index&#125;&#125;中国地区:&#123;&#123;item&#125;&#125;</span><br><span class="line">        <span class="tag">&lt;/<span class="name">li</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">ul</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">new Vue(&#123;</span><br><span class="line">    el: &#x27;#app3&#x27;,</span><br><span class="line">    data: &#123;</span><br><span class="line">        arr: [&quot;北京&quot;, &quot;上海&quot;, &quot;深圳&quot;]</span><br><span class="line">     &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">table</span> <span class="attr">border</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tr</span> <span class="attr">v-for</span>=<span class="string">&quot;user in userList&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;user.id&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;user.name&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">td</span>&gt;</span>&#123;&#123;user.age&#125;&#125;<span class="tag">&lt;/<span class="name">td</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">tr</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">table</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line">            userList: [</span><br><span class="line"><span class="javascript">                &#123; <span class="attr">id</span>: <span class="number">1</span>, <span class="attr">name</span>: <span class="string">&quot;小米&quot;</span>, <span class="attr">age</span>: <span class="number">10</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="attr">id</span>: <span class="number">2</span>, <span class="attr">name</span>: <span class="string">&quot;小米1&quot;</span>, <span class="attr">age</span>: <span class="number">20</span> &#125;,</span></span><br><span class="line"><span class="javascript">                &#123; <span class="attr">id</span>: <span class="number">3</span>, <span class="attr">name</span>: <span class="string">&quot;小米2&quot;</span>, <span class="attr">age</span>: <span class="number">30</span> &#125;</span></span><br><span class="line">            ]</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="事件-v-on"><a href="#事件-v-on" class="headerlink" title="事件 v-on"></a>事件 v-on</h3><h4 id="基础语法-1"><a href="#基础语法-1" class="headerlink" title="基础语法"></a>基础语法</h4><p><a href="https://www.w3school.com.cn/tags/html_ref_eventattributes.asp">事件查看</a></p>
<ol>
<li>事件需要放在methods中才能生效, v-on:click 单击事件,可以简写成 @click</li>
<li>点击子节点的时候,父节点也会运行</li>
<li>添加<code>.stop</code>可以在子节点运行完毕后停止父节点的运行</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div1&quot;</span> <span class="attr">v-on:click</span>=<span class="string">&quot;div1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;div2&quot;</span> @<span class="attr">click.stop</span>=<span class="string">&quot;div2&quot;</span>&gt;</span></span><br><span class="line">            点击一下</span><br><span class="line">        <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> vue = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">    el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">    methods: &#123;</span><br><span class="line"><span class="javascript">        div1: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;父节点被点击了&quot;</span>);</span></span><br><span class="line">        &#125;,</span><br><span class="line"><span class="javascript">        div2: <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;子节点被点击了&quot;</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h4 id="传递参数"><a href="#传递参数" class="headerlink" title="传递参数"></a>传递参数</h4><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app3&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">v-on:click</span>=<span class="string">&quot;say(&#x27;hi&#x27;)&quot;</span> &gt;</span>say hi<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">    el: &#x27;#app3&#x27;,</span><br><span class="line">    methods: &#123;</span><br><span class="line">        say:function(msg)&#123;</span><br><span class="line">        	alert(msg);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h4 id="事件修饰符"><a href="#事件修饰符" class="headerlink" title="事件修饰符"></a>事件修饰符</h4><blockquote>
<p>事件修饰符,可以理解为,只有指定的事件触发时,才可以进行事件的发生</p>
</blockquote>
<p>下面这个例子,说明只有在输入框内输入完数据,并且按下回车键,才会触发事件,<code>enter</code>代表回车事件</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app3&quot;</span>&gt;</span></span><br><span class="line">	<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> @<span class="attr">keyup.enter</span>=<span class="string">&quot;sayHi&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">		</span><br><span class="line">new Vue(&#123;</span><br><span class="line">     el: &#x27;#app3&#x27;,</span><br><span class="line">     methods: &#123;</span><br><span class="line">         sayHi:function()&#123;</span><br><span class="line">         	alert(&quot;你好啊&quot;)</span><br><span class="line">    	 &#125;</span><br><span class="line">     &#125;</span><br><span class="line"> &#125;);</span><br></pre></td></tr></table></figure>

<h3 id="双向数据绑定-v-model"><a href="#双向数据绑定-v-model" class="headerlink" title="双向数据绑定  v-model"></a>双向数据绑定  v-model</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app3&quot;</span>&gt;</span></span><br><span class="line">	用户姓名:<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;da&quot;</span> /&gt;</span>&#123;&#123;da&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">    el: &#x27;#app3&#x27;,</span><br><span class="line">    data: &#123;</span><br><span class="line">   		 da:&#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 下拉框 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app6&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">select</span> <span class="attr">v-model</span>=<span class="string">&quot;wty&quot;</span> &gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span> <span class="attr">value</span>=<span class="string">&quot;&quot;</span> <span class="attr">disabled</span>=<span class="string">&quot;disabled&quot;</span>&gt;</span>--请选择--<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>A<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>B<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">option</span>&gt;</span>C<span class="tag">&lt;/<span class="name">option</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br><span class="line">    选择的是:&#123;&#123;wty&#125;&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"></span><br><span class="line">new Vue(&#123;</span><br><span class="line">    el: &#x27;#app6&#x27;,</span><br><span class="line">    data: &#123;</span><br><span class="line">    	wty: &#x27;&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;);</span><br></pre></td></tr></table></figure>

<h3 id="阻止表单提交的默认行为-prevent"><a href="#阻止表单提交的默认行为-prevent" class="headerlink" title="阻止表单提交的默认行为 .prevent"></a>阻止表单提交的默认行为 <code>.prevent</code></h3><p><code>.prevent</code>阻止表单提交的默认行为</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--prevent 属性会阻止提交的默认行为,然后执行指定的方法  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;save&quot;</span> @<span class="attr">submit.prevent</span>=<span class="string">&quot;onSubmit()&quot;</span> <span class="attr">method</span>=<span class="string">&quot;POST&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 通过双向绑定,判断是否输入值 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">id</span>=<span class="string">&quot;fid&quot;</span> <span class="attr">v-model</span>=<span class="string">&quot;user.name&quot;</span>/&gt;</span><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        data: &#123;</span><br><span class="line"><span class="javascript">            <span class="comment">// 定义一个user对象</span></span></span><br><span class="line">            user: &#123;&#125;</span><br><span class="line">        &#125;,</span><br><span class="line">        methods: &#123;</span><br><span class="line">            onSubmit() &#123;</span><br><span class="line"><span class="javascript">                <span class="keyword">if</span> (<span class="built_in">this</span>.user.name) &#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(<span class="string">&quot;输入了用户名&quot;</span>);</span></span><br><span class="line"><span class="javascript">                &#125; <span class="keyword">else</span> &#123;</span></span><br><span class="line"><span class="javascript">                    alert(<span class="string">&quot;请输入用户姓名&quot;</span>);</span></span><br><span class="line">                &#125;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="组件"><a href="#组件" class="headerlink" title="组件"></a>组件</h1><h2 id="全局注册"><a href="#全局注册" class="headerlink" title="全局注册"></a>全局注册</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line">//在vue-component/nav.js 定义一个全局组件</span><br><span class="line">Vue.component(&#x27;aaa&#x27;,&#123;</span><br><span class="line">    template: &#x27;<span class="tag">&lt;<span class="name">ul</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>演示组件<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span>&#x27;</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">//使用全局组件</span><br><span class="line">//1. 引入全局组件 </span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;vue-component/nav.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">//2. 使用全局组件</span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aaa</span>&gt;</span><span class="tag">&lt;/<span class="name">aaa</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">            el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="局部注册"><a href="#局部注册" class="headerlink" title="局部注册"></a>局部注册</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">comp</span>&gt;</span><span class="tag">&lt;/<span class="name">comp</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        components: &#123;</span><br><span class="line"><span class="javascript">            <span class="comment">//组件名称 comp</span></span></span><br><span class="line"><span class="javascript">            <span class="string">&#x27;comp&#x27;</span>: &#123;</span></span><br><span class="line"><span class="javascript">                <span class="comment">//组件模板</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                template: &#x27;<span class="tag">&lt;<span class="name">ul</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;<span class="name">li</span>&gt;</span>演示组件<span class="tag">&lt;/<span class="name">li</span>&gt;</span><span class="tag">&lt;/<span class="name">ul</span>&gt;</span>&#x27;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="插槽"><a href="#插槽" class="headerlink" title="插槽"></a>插槽</h2><p>如果要在自定义的组件中添加html内容,需要加入插槽<code>&lt;slot&gt;</code>标签</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;ad&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">test</span> <span class="attr">abc</span>=<span class="string">&quot;aaa&quot;</span>&gt;</span></span><br><span class="line">		// 在组件内添加了一个h1标签</span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>123<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">test</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#ad&#x27;</span>,</span></span><br><span class="line">        components: &#123;</span><br><span class="line">            test: &#123;</span><br><span class="line"><span class="javascript">                props: [<span class="string">&#x27;abc&#x27;</span>],</span></span><br><span class="line"><span class="javascript">                <span class="comment">//开启&lt;slot&gt;插槽之后,才能使添加的html标签生效		</span></span></span><br><span class="line"><span class="handlebars"><span class="xml">                template: &quot;<span class="tag">&lt;<span class="name">h2</span>&gt;</span></span><span class="template-variable">&#123;&#123;<span class="name">abc</span>&#125;&#125;</span><span class="xml">h23423333...<span class="tag">&lt;<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">slot</span>&gt;</span><span class="tag">&lt;/<span class="name">h2</span>&gt;</span>&quot;</span></span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;);</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="vue生命周期"><a href="#vue生命周期" class="headerlink" title="vue生命周期"></a>vue生命周期</h1><p><img data-src="/images/framework/vue-1.png" alt="图示"></p>
<p><a href="https://cn.vuejs.org/v2/guide/instance.html#%E5%AE%9E%E4%BE%8B%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90">官网地址</a></p>
<p><a href="https://cn.vuejs.org/v2/api/#%E9%80%89%E9%A1%B9-%E7%94%9F%E5%91%BD%E5%91%A8%E6%9C%9F%E9%92%A9%E5%AD%90">官网api</a></p>
<p>在vue2.5之后,新增了一个生命周期<code>errorCaptured</code>,一共是十一个生命周期</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">beforeCreate    在实例初始化之后，数据观测 (data observer) 和 event/watcher 事件配置之前被调用。</span><br><span class="line">created         在实例创建完成后被立即调用,常用于页面加载之前</span><br><span class="line">beforeMount		在挂载开始之前被调用：相关的 render 函数首次被调用。</span><br><span class="line">mounted			实例被挂载后调用，这时 el 被新创建的 vm.$el 替换了,常用于页面加载之后</span><br><span class="line">beforeUpdate</span><br><span class="line">updated</span><br><span class="line">activated		被 keep-alive 缓存的组件激活时调用。</span><br><span class="line">deactivated		被 keep-alive 缓存的组件停用时调用。</span><br><span class="line">beforeDestroy	实例销毁之前调用。在这一步，实例仍然完全可用。</span><br><span class="line">destroyed		实例销毁后调用。该钩子被调用后，对应 Vue 实例的所有指令都被解绑，所有的事件监听器被移除，所有的子实例也都被销毁。</span><br><span class="line">errorCaptured   当捕获一个来自子孙组件的错误时被调用。此钩子会收到三个参数：错误对象、发生错误的组件实例以及一个包含错误来源信息的字符串</span><br></pre></td></tr></table></figure>

<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">    <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">        el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">        created() &#123;</span><br><span class="line"><span class="javascript">            <span class="comment">//断点调试</span></span></span><br><span class="line"><span class="javascript">            <span class="keyword">debugger</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//页面渲染之前调用</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;created............&quot;</span>);</span></span><br><span class="line">        &#125;,</span><br><span class="line">        mounted() &#123;</span><br><span class="line"><span class="javascript">            <span class="keyword">debugger</span></span></span><br><span class="line"><span class="javascript">            <span class="comment">//页面渲染完成之后调用</span></span></span><br><span class="line"><span class="javascript">            <span class="built_in">console</span>.log(<span class="string">&quot;mounted............&quot;</span>);</span></span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;)</span><br><span class="line"><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="路由"><a href="#路由" class="headerlink" title="路由"></a>路由</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p><a href="https://cn.vuejs.org/v2/guide/routing.html">官网地址</a></p>
<p><a href="https://www.bilibili.com/video/BV1dQ4y1A75e?p=52">尚硅谷视频地址</a></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>菜鸟教程路由镜像</p>
<figure class="highlight javascript"><table><tr><td class="code"><pre><span class="line">&lt;script src=<span class="string">&quot;https://unpkg.com/vue-router/dist/vue-router.js&quot;</span>&gt;&lt;/script&gt;</span><br></pre></td></tr></table></figure>

<p>在引入外部文件的时候,首先引入vue.js,随后引入vue-router.js</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;app&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">h1</span>&gt;</span>Hello App!<span class="tag">&lt;/<span class="name">h1</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">p</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/&quot;</span>&gt;</span>首页<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/student&quot;</span>&gt;</span>会员管理<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">router-link</span> <span class="attr">to</span>=<span class="string">&quot;/teacher&quot;</span>&gt;</span>讲师管理<span class="tag">&lt;/<span class="name">router-link</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">router-view</span>&gt;</span><span class="tag">&lt;/<span class="name">router-view</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/vue-router/dist/vue-router.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 1. 定义（路由）组件。</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 可以从其他文件 import 进来</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> Welcome = &#123; <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;欢迎&lt;/div&gt;&#x27;</span> &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> Student = &#123; <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;student list&lt;/div&gt;&#x27;</span> &#125;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> Teacher = &#123; <span class="attr">template</span>: <span class="string">&#x27;&lt;div&gt;teacher list&lt;/div&gt;&#x27;</span> &#125;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// 2. 定义路由</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 每个路由应该映射一个组件。</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> routes = [</span></span><br><span class="line"><span class="javascript">            &#123; <span class="attr">path</span>: <span class="string">&#x27;/&#x27;</span>, <span class="attr">redirect</span>: <span class="string">&#x27;/welcome&#x27;</span> &#125;, <span class="comment">//设置默认指向的路径</span></span></span><br><span class="line"><span class="javascript">            &#123; <span class="attr">path</span>: <span class="string">&#x27;/welcome&#x27;</span>, <span class="attr">component</span>: Welcome &#125;,</span></span><br><span class="line"><span class="javascript">            &#123; <span class="attr">path</span>: <span class="string">&#x27;/student&#x27;</span>, <span class="attr">component</span>: Student &#125;,</span></span><br><span class="line"><span class="javascript">            &#123; <span class="attr">path</span>: <span class="string">&#x27;/teacher&#x27;</span>, <span class="attr">component</span>: Teacher &#125;</span></span><br><span class="line">        ]</span><br><span class="line"><span class="javascript">        <span class="comment">// 3. 创建 router 实例，然后传 `routes` 配置</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> router = <span class="keyword">new</span> VueRouter(&#123;</span></span><br><span class="line"><span class="javascript">            routes <span class="comment">// （缩写）相当于 routes: routes</span></span></span><br><span class="line">        &#125;)</span><br><span class="line"><span class="javascript">        <span class="comment">// 4. 创建和挂载根实例。</span></span></span><br><span class="line"><span class="javascript">        <span class="comment">// 从而让整个应用都有路由功能</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">const</span> app = <span class="keyword">new</span> Vue(&#123;</span></span><br><span class="line"><span class="javascript">            el: <span class="string">&#x27;#app&#x27;</span>,</span></span><br><span class="line">            router</span><br><span class="line">        &#125;)</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="网络传输–axios"><a href="#网络传输–axios" class="headerlink" title="网络传输–axios"></a>网络传输–axios</h1><h2 id="引入"><a href="#引入" class="headerlink" title="引入"></a>引入</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h2><figure class="highlight"><table><tr><td class="code"><pre><span class="line">axios.get(url).then(<span class="function"><span class="keyword">function</span>(<span class="params">resopnse</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(resopnse);</span><br><span class="line">&#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(error);</span><br><span class="line">&#125;);</span><br><span class="line"># axios.get() 发送一个get请求,get里面是url地址</span><br><span class="line">#then后面跟两个回调函数,第一个函数封装了响应信息,第二个函数包含了错误信息</span><br><span class="line"></span><br><span class="line">#post方式再传参时,格式是: axios.post(url,&#123;固定参数:要传输的值&#125;)</span><br></pre></td></tr></table></figure>

<h2 id="get"><a href="#get" class="headerlink" title="get"></a>get</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">接口1：随机笑话</span><br><span class="line">请求地址：https:&#x2F;&#x2F;autumnfish.cn&#x2F;api&#x2F;joke&#x2F;list</span><br><span class="line">请求方法：get</span><br><span class="line">请求参数：num（笑话条数，数字）</span><br><span class="line">响应内容：随机笑话</span><br></pre></td></tr></table></figure>

<p>代码示例</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;pGet&quot;</span>&gt;</span>发送get请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#pGet&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                axios.get(<span class="string">&quot;https://autumnfish.cn/api/joke/list?num=3&quot;</span>)</span></span><br><span class="line"><span class="javascript">                    .then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(response);</span></span><br><span class="line"><span class="javascript">                &#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(error);</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="post"><a href="#post" class="headerlink" title="post"></a>post</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">接口2：用户注册</span><br><span class="line">请求地址：https:&#x2F;&#x2F;autumnfish.cn&#x2F;api&#x2F;user&#x2F;reg</span><br><span class="line">请求方法：post</span><br><span class="line">请求参数：username（用户名，字符串）</span><br><span class="line">响应内容：注册成功或失败</span><br></pre></td></tr></table></figure>

<p>代码示例</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">&quot;utf-8&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">title</span>&gt;</span><span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://unpkg.com/axios/dist/axios.min.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.jsdelivr.net/npm/vue/dist/vue.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">&quot;https://cdn.bootcdn.net/ajax/libs/jquery/3.5.1/jquery.js&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">&quot;p1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">button</span> <span class="attr">type</span>=<span class="string">&quot;button&quot;</span> <span class="attr">id</span>=<span class="string">&quot;pPost&quot;</span>&gt;</span>发送post请求<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">script</span> <span class="attr">type</span>=<span class="string">&quot;text/javascript&quot;</span>&gt;</span></span><br><span class="line"><span class="javascript">        $(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">            $(<span class="string">&quot;#pPost&quot;</span>).click(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                axios.post(<span class="string">&quot;https://autumnfish.cn/api/user/reg&quot;</span>,&#123;<span class="attr">username</span>:<span class="string">&quot;jack&quot;</span>&#125;)</span></span><br><span class="line"><span class="javascript">                    .then(<span class="function"><span class="keyword">function</span>(<span class="params">response</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(response);</span></span><br><span class="line"><span class="javascript">                &#125;,<span class="function"><span class="keyword">function</span>(<span class="params">error</span>)</span>&#123;</span></span><br><span class="line"><span class="javascript">                    <span class="built_in">console</span>.log(error);</span></span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    <span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="Node-js"><a href="#Node-js" class="headerlink" title="Node.js"></a>Node.js</h1><h2 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h2><ol>
<li>node.jsp安装 <a href="https://nodejs.org/zh-cn/">中文网址</a></li>
<li>确认安装是否成功</li>
</ol>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">node -v</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>安装vue-cli3.0 <code>cnpm install @vue/cli -g </code></li>
<li>卸载 <code>npm uninstall vue-cli -g</code></li>
</ol>
<p>安装完成后,可以使用<code>vue list</code>查看基于哪些模板创建vue</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">★  browserify - A full-featured Browserify + vueify setup with hot-reload, linting &amp; unit testing.</span><br><span class="line">★  browserify-simple - A simple Browserify + vueify setup <span class="keyword">for</span> quick prototyping.</span><br><span class="line">★  pwa - PWA template <span class="keyword">for</span> vue-cli based on the webpack template</span><br><span class="line">★  simple - The simplest possible Vue setup <span class="keyword">in</span> a single HTML file</span><br><span class="line">★  webpack - A full-featured Webpack + vue-loader setup with hot reload, linting, testing &amp; css extraction.</span><br><span class="line">★  webpack-simple - A simple Webpack + vue-loader setup <span class="keyword">for</span> quick prototyping.</span><br></pre></td></tr></table></figure>

<h2 id="命令行创建vue"><a href="#命令行创建vue" class="headerlink" title="命令行创建vue"></a>命令行创建vue</h2><ol>
<li>创建项目</li>
</ol>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="function">G:\<span class="title">workspace</span>\<span class="title">test</span>&gt;<span class="title">vue</span> <span class="title">init</span> <span class="title">webpack</span> <span class="title">myvue</span></span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">? <span class="title">Project</span> <span class="title">name</span> <span class="title">myvue</span></span></span><br><span class="line"><span class="function">? <span class="title">Project</span> <span class="title">description</span> 项目描述</span></span><br><span class="line"><span class="function">? <span class="title">Author</span> <span class="title">wty</span></span></span><br><span class="line"><span class="function">? <span class="title">Vue</span> <span class="title">build</span> <span class="title">standalone</span></span></span><br><span class="line"><span class="function">? <span class="title">Install</span> <span class="title">vue</span>-<span class="title">router</span>? <span class="title">No</span></span></span><br><span class="line"><span class="function">? <span class="title">Use</span> <span class="title">ESLint</span> <span class="title">to</span> <span class="title">lint</span> <span class="title">your</span> <span class="title">code</span>? <span class="title">No</span></span></span><br><span class="line"><span class="function">? <span class="title">Set</span> <span class="title">up</span> <span class="title">unit</span> <span class="title">tests</span> <span class="title">No</span></span></span><br><span class="line"><span class="function">? <span class="title">Setup</span> <span class="title">e2e</span> <span class="title">tests</span> <span class="title">with</span> <span class="title">Nightwatch</span>? <span class="title">No</span></span></span><br><span class="line"><span class="function">? <span class="title">Should</span> <span class="title">we</span> <span class="title">run</span> `<span class="title">npm</span> <span class="title">install</span>` <span class="title">for</span> <span class="title">you</span> <span class="title">after</span> <span class="title">the</span> <span class="title">project</span> <span class="title">has</span> <span class="title">been</span> <span class="title">created</span>? (<span class="title">recommended</span>) <span class="title">no</span></span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>常规操作</li>
</ol>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line"><span class="built_in">cd</span> myvue  #进入到项目</span><br><span class="line">npm install  #安装依赖环境以及包管理</span><br><span class="line">npm run dev  # 运行</span><br><span class="line"></span><br><span class="line"><span class="function">http://<span class="title">localhost</span>:8080/  # 进入到项目</span></span><br><span class="line"><span class="function"></span></span><br><span class="line"><span class="function">#打包程序</span></span><br><span class="line"><span class="function">#进入到<span class="title">config</span>/<span class="title">index.js</span>文件,修改<span class="title">build</span>中的<span class="title">assetsPublicPath</span> <span class="title">assetsPublicPath</span>: &#x27;./&#x27;,</span></span><br><span class="line"><span class="function"># 然后运行<span class="title">npm</span> <span class="title">run</span> <span class="title">build</span></span></span><br></pre></td></tr></table></figure>

<h2 id="图形化界面创建vue"><a href="#图形化界面创建vue" class="headerlink" title="图形化界面创建vue"></a>图形化界面创建vue</h2><p>cmd命令中运行<code>vue ui</code>就可以了</p>
<h1 id="Npm"><a href="#Npm" class="headerlink" title="Npm"></a>Npm</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p><a href="https://www.bilibili.com/video/BV1dQ4y1A75e?p=59">尚硅谷 谷粒学院视频地址</a></p>
<p>NPM全称Node Package Manager，是Node.js包管理工具，是全球最大的模块生态系统，里面所有的模<br>块都是开源免费的；也是Node.js的包管理工具，相当于前端的Maven 。</p>
<p>我们通过npm 可以很方便地下载js库，管理前端工程。<br>Node.js默认安装的npm包和工具的位置：Node.js目录\node_modules</p>
<h2 id="安装Cnpm"><a href="#安装Cnpm" class="headerlink" title="安装Cnpm"></a>安装Cnpm</h2><p>查看Npm的版本</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">npm -v</span><br></pre></td></tr></table></figure>

<p>全局安装cnpm(淘宝镜像)</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install cnpm -g  --registry&#x3D;https:&#x2F;&#x2F;r.npm.taobao.org</span><br></pre></td></tr></table></figure>

<p>安装完成后,查看<code>C:\Users\MI\AppData\Roaming\npm</code>路径</p>
<p>查看npm配置</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">npm config list</span><br></pre></td></tr></table></figure>

<h2 id="初始化项目"><a href="#初始化项目" class="headerlink" title="初始化项目"></a>初始化项目</h2><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">cnpm init -y   #-y参数表示直接默认创建</span><br></pre></td></tr></table></figure>

<h2 id="下载依赖"><a href="#下载依赖" class="headerlink" title="下载依赖"></a>下载依赖</h2><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">#默认安装最新版的依赖</span><br><span class="line">npm install jquery</span><br><span class="line"></span><br><span class="line">#指定版本的依赖下载</span><br><span class="line">npm install jquery@<span class="number">2</span>.<span class="number">1</span>.x</span><br><span class="line"></span><br><span class="line">#根据配置文件,下载依赖</span><br><span class="line">npm install</span><br><span class="line"></span><br><span class="line">#更新包（更新到最新版本）</span><br><span class="line">npm update 包名</span><br><span class="line"></span><br><span class="line">#全局更新</span><br><span class="line">npm update -g 包名</span><br><span class="line"></span><br><span class="line">#卸载包</span><br><span class="line">npm uninstall 包名</span><br><span class="line"></span><br><span class="line">#全局卸载</span><br><span class="line">npm uninstall -g 包名</span><br></pre></td></tr></table></figure>

<h1 id="Babel"><a href="#Babel" class="headerlink" title="Babel"></a>Babel</h1><h2 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h2><p>Babel是一个广泛使用的转码器，可以将ES6代码转为ES5代码，从而在现有环境执行执行。<br>这意味着，你可以现在就用 ES6 编写程序，而不用担心现有环境是否支持。</p>
<h2 id="安装-1"><a href="#安装-1" class="headerlink" title="安装"></a>安装</h2><p>Babel提供babel-cli工具，用于命令行转码</p>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">npm install --global babel-cli</span><br><span class="line">#查看是否安装成功</span><br><span class="line">babel --version</span><br></pre></td></tr></table></figure>

<h2 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h2><ol>
<li>初始化一个npm <code>npm init -y</code></li>
<li>编写一个es6代码,名称是 01.js</li>
</ol>
<figure class="highlight js"><table><tr><td class="code"><pre><span class="line"><span class="keyword">let</span> input = [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]</span><br><span class="line"><span class="comment">// 将数组的每个元素 +1</span></span><br><span class="line">input = input.map(<span class="function"><span class="params">item</span> =&gt;</span> item + <span class="number">1</span>)</span><br><span class="line"><span class="built_in">console</span>.log(input)</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>创建一个babel的配置文件,后缀名是<code>.babelrc</code>,内容如下</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&#123;</span><br><span class="line">    &quot;presets&quot;: [&quot;es2015&quot;],</span><br><span class="line">    &quot;plugins&quot;: []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>当前项目中安装转码器</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">npm install --save-dev babel-preset-es2015</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>转码命令</li>
</ol>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">#根据文件转码  参数 o</span><br><span class="line">babel es6/<span class="number">01</span>.js -o dist/<span class="number">001</span>.js</span><br><span class="line"></span><br><span class="line">#根据文件夹转码 参数 d</span><br><span class="line">babel es6 -d dist</span><br></pre></td></tr></table></figure>

<h1 id="webpack"><a href="#webpack" class="headerlink" title="webpack"></a>webpack</h1><h2 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h2><p>webpack是一个现代JavaScript 应用程序的静态模块打包器（module bundler),Webpack是当下最热门的前端资源模块化管理和打包工具，它可以将许多松散耦合的模块按照依赖和规则打包成符合生产环境部署的前端资源。还可以将按需加载的模块进行代码分离，等到实际需要时再异步加载。通过loader转换，任何形式的资源都可以当做模块，比如CommonsJS、AMD、ES6、CSS、JSON、CoffeeScript、LESS等；</p>
<h2 id="安装-2"><a href="#安装-2" class="headerlink" title="安装"></a>安装</h2><figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">cnpm install  webpack -g   #安装webpack</span><br><span class="line">cnpm install  webpack-cli -g  #安装webpack客户端</span><br><span class="line"></span><br><span class="line">webpack -v</span><br><span class="line">webpack-cli -v</span><br></pre></td></tr></table></figure>

<h2 id="配置-了解"><a href="#配置-了解" class="headerlink" title="配置(了解)"></a>配置(了解)</h2><p>创建webpack.config.js配置文件</p>
<ul>
<li>entry：入口文件，指定WebPack用哪个文件作为项目的入口</li>
<li>output：输出，指定WebPack把处理完成的文件放置到指定路径</li>
<li>module：模块，用于处理各种类型的文件</li>
<li>plugins：插件，如：热更新、代码重用等</li>
<li>resolve：设置路径指向</li>
<li>watch：监听，用于设置文件改动后直接打包</li>
</ul>
<h2 id="打包js"><a href="#打包js" class="headerlink" title="打包js"></a>打包js</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line"># 初始化一个项目</span><br><span class="line">npm init -y</span><br><span class="line"></span><br><span class="line"># 创建webpack配置文件 名字固定为webpack.config.js</span><br><span class="line"># Node.js内置模块</span><br><span class="line">const path = require(&quot;path&quot;); </span><br><span class="line">module.exports = &#123;</span><br><span class="line">    # 配置入口文件</span><br><span class="line">    entry: &#x27;./src/main.js&#x27;, </span><br><span class="line">    output: &#123;</span><br><span class="line">        # 输出路径，__dirname：当前文件所在路径</span><br><span class="line">        path: path.resolve(__dirname, &#x27;./dist&#x27;),</span><br><span class="line">         # 输出文件的名字</span><br><span class="line">        filename: &#x27;bundle.js&#x27;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"># 打包</span><br><span class="line">webpack #有黄色警告,黄色警告提示没有设置 mode,mode分为development和production</span><br><span class="line"></span><br><span class="line">webpack --mode=development #没有警告</span><br><span class="line"></span><br><span class="line"># 最终测试</span><br><span class="line">#创建一个html文件,引入打包后的js文件,运行html文件即可</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 也可以配置项目的npm运行命令，修改package.json文件</span><br><span class="line">&quot;scripts&quot;: &#123;</span><br><span class="line">	//...,</span><br><span class="line">	&quot;dev&quot;: &quot;webpack --mode=development&quot;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">#  运行此命令 进行打包</span><br><span class="line">npm run dev</span><br></pre></td></tr></table></figure>

<h2 id="打包css"><a href="#打包css" class="headerlink" title="打包css"></a>打包css</h2><p>Webpack 本身只能处理 JavaScript 模块，如果要处理其他类型的文件，就需要使用 loader 进行转换。<br>Loader 可以理解为是模块和资源的转换器。<br>首先我们需要安装相关Loader插件，css-loader 是将 css 装载到 javascript；style-loader 是让 javascript<br>认识css</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line"># 安装转换器</span><br><span class="line">npm install --save-dev style-loader css-loader</span><br><span class="line"></span><br><span class="line"># 创建一个css文件</span><br><span class="line"></span><br><span class="line"># 在main.js中引入css文件</span><br><span class="line"></span><br><span class="line">#在webpack.config.js文件中引入以下固定内容</span><br><span class="line">module: &#123;</span><br><span class="line">        rules: [</span><br><span class="line">            &#123;</span><br><span class="line">                test: /\.css$/, //打包规则应用到以css结尾的文件上</span><br><span class="line">                use: [&#x27;style-loader&#x27;, &#x27;css-loader&#x27;]</span><br><span class="line">            &#125;</span><br><span class="line">        ]</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"># 打包</span><br><span class="line">webpack --mode=development</span><br><span class="line"></span><br><span class="line"># 测试</span><br><span class="line">#创建一个html文件,引入打包后的js文件,运行html文件即可</span><br></pre></td></tr></table></figure>























]]></content>
      <categories>
        <category>其他框架</category>
      </categories>
      <tags>
        <tag>前端</tag>
        <tag>vue</tag>
      </tags>
  </entry>
  <entry>
    <title>MyBatisPlus</title>
    <url>/2020/08/21/mybatis/mybatis-plus/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p><a href="https://mp.baomidou.com/guide/">MyBatis-Plus官方网址</a></p>
<p>MyBatis-Plus特性:</p>
<ul>
<li>无侵入：只做增强不做改变，引入它不会对现有工程产生影响，如丝般顺滑</li>
</ul>
<ul>
<li>损耗小：启动即会自动注入基本 CURD，性能基本无损耗，直接面向对象操作</li>
<li>强大的 CRUD 操作：内置通用 Mapper、通用 Service，仅仅通过少量配置即可实现单表大部分 CRUD 操作，更有强大的条件构造器，满足各类使用需求</li>
</ul>
<a id="more"></a>

<ul>
<li>支持 Lambda 形式调用：通过 Lambda 表达式，方便的编写各类查询条件，无需再担心字段写错</li>
<li>支持主键自动生成：支持多达 4 种主键策略（内含分布式唯一 ID 生成器 - Sequence），可自由配置，完美解决主键问题</li>
<li>支持 ActiveRecord 模式：支持 ActiveRecord 形式调用，实体类只需继承 Model 类即可进行强大的 CRUD 操作</li>
<li>支持自定义全局通用操作：支持全局通用方法注入（ Write once, use anywhere ）</li>
<li>内置代码生成器：采用代码或者 Maven 插件可快速生成 Mapper 、 Model 、 Service 、 Controller 层代码，支持模板引擎，更有超多自定义配置等您来使用</li>
<li>内置分页插件：基于 MyBatis 物理分页，开发者无需关心具体操作，配置好插件之后，写分页等同于普通 List 查询</li>
<li>分页插件支持多种数据库：支持 MySQL、MariaDB、Oracle、DB2、H2、HSQL、SQLite、Postgre、SQLServer 等多种数据库</li>
<li>内置性能分析插件：可输出 Sql 语句以及其执行时间，建议开发测试时启用该功能，能快速揪出慢查询</li>
<li>内置全局拦截插件：提供全表 delete 、 update 操作智能分析阻断，也可自定义拦截规则，预防误操作</li>
</ul>
<h1 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h1><p><a href="https://mp.baomidou.com/guide/quick-start.html">helloWorld官网地址</a></p>
<p><a href="https://www.imooc.com/video/19494">慕课网快速入门小例子</a></p>
<h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.projectlombok&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;lombok&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;optional&gt;true&lt;&#x2F;optional&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;mysql&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mysql-connector-java&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;scope&gt;runtime&lt;&#x2F;scope&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.baomidou&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;mybatis-plus-boot-starter&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;3.3.2&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="sql"><a href="#sql" class="headerlink" title="sql"></a>sql</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">#创建用户表</span><br><span class="line">CREATE TABLE user (</span><br><span class="line">    id BIGINT(20) PRIMARY KEY NOT NULL COMMENT &#39;主键&#39;,</span><br><span class="line">    name VARCHAR(30) DEFAULT NULL COMMENT &#39;姓名&#39;,</span><br><span class="line">    age INT(11) DEFAULT NULL COMMENT &#39;年龄&#39;,</span><br><span class="line">    email VARCHAR(50) DEFAULT NULL COMMENT &#39;邮箱&#39;,</span><br><span class="line">    manager_id BIGINT(20) DEFAULT NULL COMMENT &#39;直属上级id&#39;,</span><br><span class="line">    create_time DATETIME DEFAULT NULL COMMENT &#39;创建时间&#39;,</span><br><span class="line">    CONSTRAINT manager_fk FOREIGN KEY (manager_id)</span><br><span class="line">        REFERENCES user (id)</span><br><span class="line">)  ENGINE&#x3D;INNODB CHARSET&#x3D;UTF8;</span><br><span class="line"></span><br><span class="line">#初始化数据：</span><br><span class="line">INSERT INTO user (id, name, age, email, manager_id, create_time)</span><br><span class="line">VALUES (1087982257332887553, &#39;大boss&#39;, 40, &#39;boss@baomidou.com&#39;, NULL, &#39;2019-01-11 14:20:20&#39;),</span><br><span class="line">	(1088248166370832385, &#39;王天风&#39;, 25, &#39;wtf@baomidou.com&#39;, 1087982257332887553	, &#39;2019-02-05 11:12:22&#39;),</span><br><span class="line">	(1088250446457389058, &#39;李艺伟&#39;, 28, &#39;lyw@baomidou.com&#39;, 1088248166370832385	, &#39;2019-02-14 08:31:16&#39;),</span><br><span class="line">	(1094590409767661570, &#39;张雨琪&#39;, 31, &#39;zjq@baomidou.com&#39;, 1088248166370832385	, &#39;2019-01-14 09:15:15&#39;),</span><br><span class="line">	(1094592041087729666, &#39;刘红雨&#39;, 32, &#39;lhm@baomidou.com&#39;, 1088248166370832385	, &#39;2019-01-14 09:48:16&#39;);</span><br></pre></td></tr></table></figure>

<h2 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h2><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 数据库</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql:///wty?serverTimezone=UTC</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># 日志</span></span><br><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">    </span><br><span class="line"><span class="attr">logging:</span></span><br><span class="line">  <span class="attr">level:</span></span><br><span class="line">    <span class="attr">root:</span> <span class="string">warn</span></span><br><span class="line">    <span class="attr">com.wty.mapper:</span> <span class="string">trace</span></span><br><span class="line">  <span class="attr">pattern:</span></span><br><span class="line">    <span class="attr">console:</span> <span class="string">&#x27;%p%m%n&#x27;</span></span><br></pre></td></tr></table></figure>

<h2 id="Bean"><a href="#Bean" class="headerlink" title="Bean"></a>Bean</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">User</span> </span>&#123;</span><br><span class="line">    <span class="comment">//主键</span></span><br><span class="line">    <span class="keyword">private</span> Long id;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">    <span class="keyword">private</span> String email;</span><br><span class="line">    <span class="comment">//上级ID</span></span><br><span class="line">    <span class="keyword">private</span> Long managerId;</span><br><span class="line">    <span class="comment">//创建时间</span></span><br><span class="line">    <span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Mapper"><a href="#Mapper" class="headerlink" title="Mapper"></a>Mapper</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">interface</span> <span class="title">UserMapper</span> <span class="keyword">extends</span> <span class="title">BaseMapper</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="主启动类"><a href="#主启动类" class="headerlink" title="主启动类"></a>主启动类</h2><p>在主启动类上要添加包扫描是<code>@MapperScan(&quot;com.wty.mapper&quot;)</code></p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringbootMybatisplusApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> UserMapper userMapper;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">testSelect</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        List&lt;User&gt; userList = userMapper.selectList(<span class="keyword">null</span>);</span><br><span class="line">        userList.forEach(System.out::println);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="CRUD操作"><a href="#CRUD操作" class="headerlink" title="CRUD操作"></a>CRUD操作</h1><p><a href="https://www.imooc.com/video/19496">慕课网视频</a></p>
<h2 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h2><h3 id="TableName"><a href="#TableName" class="headerlink" title="@TableName"></a>@TableName</h3><p>该注解添加在实体类上,当数据库表名和实体类表明不一致时,可以进行绑定</p>
<h3 id="TableId"><a href="#TableId" class="headerlink" title="@TableId"></a>@TableId</h3><p>mybatisPlus默认识别的主键名称是“id”,当数据库主键字段不是名称为”id”时,可以在实体类的属性上添加此注解,说明是主键。</p>
<h3 id="TableField"><a href="#TableField" class="headerlink" title="@TableField"></a>@TableField</h3><p>当数据库字段和实体类属性名称不一致时，可以添加此注解进行绑定，此注解值为数据库的字段名。</p>
<h3 id="排除非表字段"><a href="#排除非表字段" class="headerlink" title="排除非表字段"></a>排除非表字段</h3><p>三种方式:</p>
<ol>
<li><p>在实体类属性添加关键字<code>transient</code>,表示此属性不参与序列化</p>
</li>
<li><p>在实体类属性添加关键字<code>statis</code></p>
</li>
<li><p>在实体类属性上添加注解<code>@TableField(exist=false)</code>，exist指是否为数据库表字段</p>
</li>
</ol>
<h2 id="条件修改"><a href="#条件修改" class="headerlink" title="条件修改"></a>条件修改</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setAge(<span class="number">33</span>);</span><br><span class="line">userUpdateWrapper.eq(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小七&quot;</span>);</span><br><span class="line">userMapper.update(user, userUpdateWrapper);</span><br><span class="line"></span><br><span class="line"><span class="comment">//执行sql</span></span><br><span class="line"><span class="comment">//UPDATE user SET age=? WHERE (name = ?) </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//set</span></span><br><span class="line"><span class="comment">//可以不用构建user实例,在update的第一个参数中传入null即可</span></span><br><span class="line">UpdateWrapper&lt;User&gt; userUpdateWrapper = <span class="keyword">new</span> UpdateWrapper&lt;&gt;();</span><br><span class="line">userUpdateWrapper.eq(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;小七&quot;</span>).set(<span class="string">&quot;age&quot;</span>,<span class="string">&quot;34&quot;</span>);</span><br><span class="line">userMapper.update(<span class="keyword">null</span>, userUpdateWrapper);</span><br></pre></td></tr></table></figure>

<h2 id="条件删除"><a href="#条件删除" class="headerlink" title="条件删除"></a>条件删除</h2><p><a href="https://www.imooc.com/video/19512">慕课网地址</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LambdaQueryWrapper&lt;User&gt; wrapper = Wrappers.&lt;User&gt;lambdaQuery();</span><br><span class="line">wrapper.eq(User::getName,<span class="string">&quot;叶凡&quot;</span>);</span><br><span class="line">userMapper.delete(wrapper);</span><br></pre></td></tr></table></figure>

<h2 id="基本查询"><a href="#基本查询" class="headerlink" title="基本查询"></a>基本查询</h2><h3 id="批量查询"><a href="#批量查询" class="headerlink" title="批量查询"></a>批量查询</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询（根据ID 批量查询）</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> idList 主键ID列表(不能为 null 以及 empty)</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">List&lt;T&gt; <span class="title">selectBatchIds</span><span class="params">(<span class="meta">@Param(Constants.COLLECTION)</span> Collection&lt;? extends Serializable&gt; idList)</span></span>;</span><br></pre></td></tr></table></figure>

<p>批量查询需要传入一个集合，可以使用工具类Arrays，eg:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Arrays.asList(<span class="number">1286897820166635521L</span>,<span class="number">1286904334675660802L</span>)</span><br></pre></td></tr></table></figure>

<h3 id="Map查询"><a href="#Map查询" class="headerlink" title="Map查询"></a>Map查询</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 查询（根据 columnMap 条件）</span></span><br><span class="line"><span class="comment">*</span></span><br><span class="line"><span class="comment">* <span class="doctag">@param</span> columnMap 表字段 map 对象</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line"><span class="function">List&lt;T&gt; <span class="title">selectByMap</span><span class="params">(<span class="meta">@Param(Constants.COLUMN_MAP)</span> Map&lt;String, Object&gt; columnMap)</span></span>;</span><br></pre></td></tr></table></figure>

<p>Map的key为数据库的字段名，value为数据库中的数据，eg:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map map = <span class="keyword">new</span> HashMap();</span><br><span class="line">map.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;杨宁&quot;</span>);</span><br><span class="line">List list = userMapper.selectByMap(map);</span><br><span class="line">list.forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h1 id="条件构造器查询"><a href="#条件构造器查询" class="headerlink" title="条件构造器查询"></a>条件构造器查询</h1><p><a href="https://mp.baomidou.com/guide/wrapper.html#abstractwrapper">条件查询官网地址</a></p>
<h2 id="创建条件构造"><a href="#创建条件构造" class="headerlink" title="创建条件构造"></a>创建条件构造</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//第一种创建方式</span></span><br><span class="line">QueryWrapper&lt;User&gt; queryWrapper = <span class="keyword">new</span> QueryWrapper&lt;&gt;();</span><br><span class="line"><span class="comment">//第二种创建方式</span></span><br><span class="line">QueryWrapper&lt;User&gt; query = Wrappers.query();</span><br></pre></td></tr></table></figure>

<h2 id="查询部分字段"><a href="#查询部分字段" class="headerlink" title="查询部分字段"></a>查询部分字段</h2><blockquote>
<p>数据库表中有10条字段,需要查询id,name,email</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">wrapper.select(<span class="string">&quot;id&quot;</span>,<span class="string">&quot;name&quot;</span>,<span class="string">&quot;age&quot;</span>).like(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;雨&quot;</span>).lt(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;40&quot;</span>);</span><br></pre></td></tr></table></figure>

<blockquote>
<p>数据库表中有20条字段,需要排除上级id,创建时间,只查询其他剩余的字段</p>
</blockquote>
<p><code>!info.getColumn().equals(&quot;manager_id&quot;)</code>  表示 排除<code>manager_id</code>字段</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">wrapper.like(&quot;name&quot;, &quot;雨&quot;).lt(&quot;age&quot;, &quot;40&quot;).select(User.class, info-&gt;!info.getColumn().equals(&quot;manager_id&quot;)&amp;&amp;!info.getColumn().equals(&quot;create_time&quot;));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>like的模糊查询,可以分为 likeLeft=&gt;%?    likeRight=&gt; ?%</p>
</blockquote>
<h2 id="condition的使用"><a href="#condition的使用" class="headerlink" title="condition的使用"></a>condition的使用</h2><p><code>condition</code>是一个boolean类型,主要用在条件构造器中,可以控制创建的条件,不加入到sql语句的where中</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">QueryWrapper&lt;User&gt; wrapper=<span class="keyword">new</span> QueryWrapper();</span><br><span class="line">wrapper.like(StringUtils.isNotColumnName(<span class="string">&quot;name&quot;</span>),<span class="string">&quot;name&quot;</span>,<span class="string">&quot;王&quot;</span>).like(<span class="string">&quot;email&quot;</span>,<span class="string">&quot;&quot;</span>);</span><br><span class="line">List&lt;User&gt; userList = userMapper.selectList(wrapper);</span><br><span class="line">userList.forEach(System.out::println);</span><br><span class="line"></span><br><span class="line"><span class="comment">//wrapper.like(StringUtils.isNotColumnName(&quot;name&quot;),&quot;name&quot;,&quot;王&quot;).like(&quot;email&quot;,&quot;&quot;);</span></span><br><span class="line"><span class="comment">//SELECT id,name,age,email,manager_id,create_time FROM user WHERE (email LIKE ?) </span></span><br><span class="line"></span><br><span class="line"><span class="comment">//wrapper.like(&quot;name&quot;,&quot;王&quot;).like(&quot;email&quot;,&quot;&quot;);</span></span><br><span class="line"><span class="comment">//SELECT id,name,age,email,manager_id,create_time FROM user WHERE (name LIKE ? AND email LIKE ?) </span></span><br></pre></td></tr></table></figure>

<h2 id="Lambda构造器"><a href="#Lambda构造器" class="headerlink" title="Lambda构造器"></a>Lambda构造器</h2><h3 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h3><p>有三种创建方式</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//通过原始条件构造器点出lambda</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; wrapper = <span class="keyword">new</span> QueryWrapper&lt;User&gt;().lambda();</span><br><span class="line"></span><br><span class="line"><span class="comment">//直接new实例化</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; wrapper1 = <span class="keyword">new</span> LambdaQueryWrapper&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">//使用工具类Wrappers</span></span><br><span class="line">LambdaQueryWrapper&lt;User&gt; wrapper2 = Wrappers.lambdaQuery();</span><br><span class="line"></span><br><span class="line"><span class="comment">//创建一个LambdaQueryChainWrapper构造器,需要传入一个通用mapper</span></span><br><span class="line">LambdaQueryChainWrapper&lt;User&gt; wrapper3 = <span class="keyword">new</span> LambdaQueryChainWrapper&lt;&gt;(userMapper);</span><br></pre></td></tr></table></figure>

<h3 id="使用LambdaQueryWrapper"><a href="#使用LambdaQueryWrapper" class="headerlink" title="使用LambdaQueryWrapper"></a>使用LambdaQueryWrapper</h3><p>使用lambda条件构造器,创建有一个条件时,例如<code>like(User::getName,&quot;雨&quot;)</code>,前面跟实体类的get方法,后面跟参数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LambdaQueryWrapper&lt;User&gt; wrapper = Wrappers.&lt;User&gt;lambdaQuery();</span><br><span class="line"><span class="comment">// WHERE (name LIKE %雨% AND age &lt; 32)</span></span><br><span class="line">wrapper.like(User::getName,<span class="string">&quot;雨&quot;</span>).lt(User::getAge,<span class="number">32</span>);</span><br><span class="line">List&lt;User&gt; userList = userMapper.selectList(wrapper);</span><br><span class="line">userList.forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h3 id="使用LambdaQueryWrapper-1"><a href="#使用LambdaQueryWrapper-1" class="headerlink" title="使用LambdaQueryWrapper"></a>使用LambdaQueryWrapper</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">List&lt;User&gt; list = <span class="keyword">new</span> LambdaQueryChainWrapper&lt;&gt;(userMapper).like(User::getName, <span class="string">&quot;雨&quot;</span>).lt(User::getAge, <span class="number">40</span>).list();</span><br><span class="line">list.forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h2 id="关键字一览表"><a href="#关键字一览表" class="headerlink" title="关键字一览表"></a>关键字一览表</h2><p><a href="https://www.cnblogs.com/amberbar/p/12152838.html">摘抄自amberbar的博客</a></p>
<table>
<thead>
<tr>
<th align="center">查询方式</th>
<th align="center">说明</th>
</tr>
</thead>
<tbody><tr>
<td align="center">setSqlSelect</td>
<td align="center">设置 SELECT 查询字段</td>
</tr>
<tr>
<td align="center">where</td>
<td align="center">WHERE 语句，拼接 + WHERE 条件</td>
</tr>
<tr>
<td align="center">and</td>
<td align="center">AND 语句，拼接 + AND 字段=值</td>
</tr>
<tr>
<td align="center">andNew</td>
<td align="center">AND 语句，拼接 + AND (字段=值)</td>
</tr>
<tr>
<td align="center">or</td>
<td align="center">OR 语句，拼接 + OR 字段=值</td>
</tr>
<tr>
<td align="center">orNew</td>
<td align="center">OR 语句，拼接 + OR (字段=值)</td>
</tr>
<tr>
<td align="center">eq</td>
<td align="center">等于=</td>
</tr>
<tr>
<td align="center">allEq</td>
<td align="center">基于 map 内容等于=</td>
</tr>
<tr>
<td align="center">ne</td>
<td align="center">不等于&lt;&gt;</td>
</tr>
<tr>
<td align="center">gt</td>
<td align="center">大于&gt;</td>
</tr>
<tr>
<td align="center">ge</td>
<td align="center">大于等于&gt;=</td>
</tr>
<tr>
<td align="center">lt</td>
<td align="center">小于&lt;</td>
</tr>
<tr>
<td align="center">le</td>
<td align="center">小于等于&lt;=</td>
</tr>
<tr>
<td align="center">like</td>
<td align="center">模糊查询 LIKE</td>
</tr>
<tr>
<td align="center">notLike</td>
<td align="center">模糊查询 NOT LIKE</td>
</tr>
<tr>
<td align="center">in</td>
<td align="center">IN 查询</td>
</tr>
<tr>
<td align="center">notIn</td>
<td align="center">NOT IN 查询</td>
</tr>
<tr>
<td align="center">isNull</td>
<td align="center">NULL 值查询</td>
</tr>
<tr>
<td align="center">isNotNull</td>
<td align="center">IS NOT NULL</td>
</tr>
<tr>
<td align="center">groupBy</td>
<td align="center">分组 GROUP BY</td>
</tr>
<tr>
<td align="center">having</td>
<td align="center">HAVING 关键词</td>
</tr>
<tr>
<td align="center">orderBy</td>
<td align="center">排序 ORDER BY</td>
</tr>
<tr>
<td align="center">ordeByAsc</td>
<td align="center">升序 排序 ORDER BY</td>
</tr>
<tr>
<td align="center">orderByDesc</td>
<td align="center">降序 排序 ORDER BY</td>
</tr>
<tr>
<td align="center">exists</td>
<td align="center">EXISTS 条件语句</td>
</tr>
<tr>
<td align="center">notExists</td>
<td align="center">NOT EXISTS 条件语句</td>
</tr>
<tr>
<td align="center">between</td>
<td align="center">BETWEEN 条件语句</td>
</tr>
<tr>
<td align="center">notBetween</td>
<td align="center">NOT BETWEEN 条件语句</td>
</tr>
<tr>
<td align="center">addFilter</td>
<td align="center">自由拼接 SQL</td>
</tr>
<tr>
<td align="center">last</td>
<td align="center">拼接在最后，例如：last(“LIMIT 1”)</td>
</tr>
<tr>
<td align="center">apply</td>
<td align="center">拼接sql</td>
</tr>
</tbody></table>
<h1 id="自定义Sql带分页"><a href="#自定义Sql带分页" class="headerlink" title="自定义Sql带分页"></a>自定义Sql带分页</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p><a href="https://baomidou.com/guide/wrapper.html#%E4%BD%BF%E7%94%A8-wrapper-%E8%87%AA%E5%AE%9A%E4%B9%89sql">官网地址</a></p>
<p>MP3.0.7版本以后,才会有自定义sql</p>
<h2 id="注解版"><a href="#注解版" class="headerlink" title="注解版"></a>注解版</h2><h3 id="mapper"><a href="#mapper" class="headerlink" title="mapper"></a>mapper</h3><ol>
<li><code>Constants.WRAPPER</code>是一个固定写法</li>
<li>参数<code>Wrapper</code>是<code>com.baomidou.mybatisplus.core.conditions.Wrapper</code>包下面的</li>
<li>sql语句中<code>ew.customSqlSegment</code>是固定写法,<code>ew</code>指的就是<code>Constants.WRAPPER</code></li>
<li>sql语句中 不用加<code>where</code>关键字</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Select(&quot;select * from user $&#123;ew.customSqlSegment&#125;&quot;)</span></span><br><span class="line"><span class="function">List&lt;User&gt; <span class="title">selectAll</span><span class="params">(<span class="meta">@Param(Constants.WRAPPER)</span> Wrapper&lt;User&gt; wrapper)</span></span>;</span><br></pre></td></tr></table></figure>

<h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">LambdaQueryWrapper&lt;User&gt; wrapper = Wrappers.&lt;User&gt;lambdaQuery();</span><br><span class="line">wrapper.like(User::getName,<span class="string">&quot;雨&quot;</span>).lt(User::getAge,<span class="number">32</span>);</span><br><span class="line">List&lt;User&gt; userList = userMapper.selectAll(wrapper);</span><br><span class="line">userList.forEach(System.out::println);</span><br></pre></td></tr></table></figure>

<h2 id="xml版"><a href="#xml版" class="headerlink" title="xml版"></a>xml版</h2><h3 id="mapper接口"><a href="#mapper接口" class="headerlink" title="mapper接口"></a>mapper接口</h3><p>page需要放在第一个参数位置上,</p>
<p> @Param(Constants.WRAPPER)是固定写法</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">IPage&lt;ShareVO&gt; detailed(Page&lt;ShareVO&gt; page, @Param(Constants.WRAPPER) Wrapper&lt;ShareVO&gt; wrapper);</span><br></pre></td></tr></table></figure>

<h3 id="yaml配置xml文件位置"><a href="#yaml配置xml文件位置" class="headerlink" title="yaml配置xml文件位置"></a>yaml配置xml文件位置</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span></span><br><span class="line">    <span class="attr">log-impl:</span> <span class="string">org.apache.ibatis.logging.stdout.StdOutImpl</span></span><br><span class="line">  <span class="attr">mapper-locations:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">classpath:mapper/*.xml</span></span><br></pre></td></tr></table></figure>

<h3 id="xml编写"><a href="#xml编写" class="headerlink" title="xml编写"></a>xml编写</h3><p>编写玩sql语句后,需要在最后添加${ew.customSqlSegment}</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">select</span> <span class="attr">id</span>=<span class="string">&quot;selectAll&quot;</span> <span class="attr">resultType</span>=<span class="string">&quot;com.wty.bean.User&quot;</span>&gt;</span></span><br><span class="line">	select * from user $&#123;ew.customSqlSegment&#125;</span><br><span class="line"><span class="tag">&lt;/<span class="name">select</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="分页查询"><a href="#分页查询" class="headerlink" title="分页查询"></a>分页查询</h1><p><a href="https://mp.baomidou.com/guide/page.html">分页官网地址</a></p>
<h2 id="引入分页插件"><a href="#引入分页插件" class="headerlink" title="引入分页插件"></a>引入分页插件</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> PaginationInterceptor <span class="title">paginationInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> PaginationInterceptor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="返回List类型查询"><a href="#返回List类型查询" class="headerlink" title="返回List类型查询"></a>返回List类型查询</h2><blockquote>
<p>特别注意</p>
<p>代码<code>Page&lt;User&gt; userPage = new Page&lt;&gt;(1, 2)</code>中,<code>1</code>指的是<code>当前页</code>,指的是页数,<code>2</code>指的是本页数据展示的条数</p>
<p>mysql中的<code>limit 0,3</code>中,<code>0</code>指的是<code>第几条数据</code>而不是当前页</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//查看第1页,每页2条数据</span></span><br><span class="line">Page&lt;User&gt; userPage = <span class="keyword">new</span> Page&lt;&gt;(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">wrapper.gt(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;20&quot;</span>);</span><br><span class="line"></span><br><span class="line">Page&lt;User&gt; page = userMapper.selectPage(userPage, wrapper);</span><br><span class="line">System.out.println(<span class="string">&quot;本页数据的条数==&quot;</span> + page.getSize());</span><br><span class="line">System.out.println(<span class="string">&quot;所有数据的详细信息==&quot;</span> + page.getRecords());</span><br><span class="line">System.out.println(<span class="string">&quot;数据的总个数==&quot;</span> + page.getTotal());</span><br><span class="line">System.out.println(<span class="string">&quot;总页数,即最后一页==&quot;</span> + page.getPages());</span><br></pre></td></tr></table></figure>

<h2 id="返回Map类型查询"><a href="#返回Map类型查询" class="headerlink" title="返回Map类型查询"></a>返回Map类型查询</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">IPage&lt;Map&lt;String, Object&gt;&gt; mapIPage = <span class="keyword">new</span> Page&lt;&gt;(<span class="number">1</span>, <span class="number">2</span>);</span><br><span class="line">wrapper.gt(<span class="string">&quot;age&quot;</span>, <span class="string">&quot;20&quot;</span>);</span><br><span class="line"></span><br><span class="line">IPage&lt;Map&lt;String, Object&gt;&gt; page = userMapper.selectMapsPage(mapIPage, wrapper);</span><br><span class="line">System.out.println(<span class="string">&quot;本页数据的条数==&quot;</span> + page.getSize());</span><br><span class="line">System.out.println(<span class="string">&quot;所有数据的详细信息==&quot;</span> + page.getRecords());</span><br><span class="line">System.out.println(<span class="string">&quot;数据的总个数==&quot;</span> + page.getTotal());</span><br><span class="line">System.out.println(<span class="string">&quot;总页数,即最后一页==&quot;</span> + page.getPages());</span><br></pre></td></tr></table></figure>

<h1 id="AR模式"><a href="#AR模式" class="headerlink" title="AR模式"></a>AR模式</h1><p><a href="https://www.imooc.com/video/19513">慕课网视频</a></p>
<blockquote>
<p>AR模式,可以直接通过操作实体类来操作数据库</p>
<ol>
<li>实体类继承Model&lt;&gt;类</li>
<li>继承通用mapper</li>
<li>通过实体类操作数据库</li>
</ol>
</blockquote>
<h2 id="代码示例"><a href="#代码示例" class="headerlink" title="代码示例"></a>代码示例</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//构造实体类</span></span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setName(<span class="string">&quot;裴元&quot;</span>);</span><br><span class="line">    user.setAge(<span class="number">35</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;py@baomidou.com&quot;</span>);</span><br><span class="line">    user.setCreateTime(LocalDate.now());</span><br><span class="line">    user.setManagerId(<span class="number">1088248166370832385L</span>);</span><br><span class="line">    <span class="comment">//插入操作</span></span><br><span class="line">    <span class="keyword">boolean</span> insert = user.insert();</span><br><span class="line">    System.out.println(<span class="string">&quot;插入是否成功==&gt;&quot;</span> + insert);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">select</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    User user1 = user.selectById(<span class="number">1287665164459372546L</span>);</span><br><span class="line">    <span class="comment">//两个对象不一样</span></span><br><span class="line">    System.out.println(user == user1);</span><br><span class="line">    System.out.println(user1);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">update</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setAge(<span class="number">40</span>);</span><br><span class="line">    UpdateWrapper&lt;User&gt; updateWrapper = <span class="keyword">new</span> UpdateWrapper&lt;&gt;();</span><br><span class="line">    updateWrapper.eq(<span class="string">&quot;name&quot;</span>,<span class="string">&quot;裴元&quot;</span>);</span><br><span class="line">    user.update(updateWrapper);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">delete</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    LambdaQueryWrapper&lt;User&gt; deleteWrapper = Wrappers.lambdaQuery();</span><br><span class="line">    deleteWrapper.eq(User::getName,<span class="string">&quot;裴元&quot;</span>);</span><br><span class="line">    user.delete(deleteWrapper);</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">*如果没有设置id,执行插入操作</span></span><br><span class="line"><span class="comment">*如果设置了id,就进行修改操作</span></span><br><span class="line"><span class="comment">*设置了一个不存在的id,会进行插入操作</span></span><br><span class="line"><span class="comment">**/</span></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertOrUpdate</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    User user = <span class="keyword">new</span> User();</span><br><span class="line">    user.setName(<span class="string">&quot;张强&quot;</span>);</span><br><span class="line">    user.setId(<span class="number">1286897820166635521L</span>);</span><br><span class="line">    user.setAge(<span class="number">40</span>);</span><br><span class="line">    user.setEmail(<span class="string">&quot;123@qq.com&quot;</span>);</span><br><span class="line">    user.setCreateTime(LocalDate.now());</span><br><span class="line">    user.setManagerId(<span class="number">1088248166370832385L</span>);</span><br><span class="line">    user.insertOrUpdate();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="MP配置"><a href="#MP配置" class="headerlink" title="MP配置"></a>MP配置</h1><p><a href="https://mp.baomidou.com/config/#%E5%9F%BA%E6%9C%AC%E9%85%8D%E7%BD%AE">官网地址</a></p>
<p><a href="https://www.imooc.com/video/19515">慕课网视频地址</a></p>
<h2 id="基本配置"><a href="#基本配置" class="headerlink" title="基本配置"></a>基本配置</h2><h3 id="configLocation"><a href="#configLocation" class="headerlink" title="configLocation"></a>configLocation</h3><p><code>configLocation</code>与<code>mapUnderscoreToCamelCase</code>不能同时定义</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">configuration:</span> <span class="string">classpath:mybatisConfig.xml</span></span><br></pre></td></tr></table></figure>

<h3 id="mapperLocations"><a href="#mapperLocations" class="headerlink" title="mapperLocations"></a>mapperLocations</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="comment"># 多模块配置</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath*:/mapper/**/*.xml</span></span><br><span class="line">  <span class="comment"># 单模块配置</span></span><br><span class="line">  <span class="attr">mapper-locations:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">classpath:/mapper/*.xml</span></span><br></pre></td></tr></table></figure>

<h3 id="typeAliasesPackage"><a href="#typeAliasesPackage" class="headerlink" title="typeAliasesPackage"></a>typeAliasesPackage</h3><p>别名配置</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">type-aliases-package:</span> <span class="string">com.wty.bean</span></span><br></pre></td></tr></table></figure>

<h3 id="mapUnderscoreToCamelCase"><a href="#mapUnderscoreToCamelCase" class="headerlink" title="mapUnderscoreToCamelCase"></a>mapUnderscoreToCamelCase</h3><p>驼峰命名,默认是<code>true</code>,取值是四个范围<code>true</code>,<code>false</code>,<code>on</code> ,<code>off</code></p>
<p><code>configLocation</code>与<code>mapUnderscoreToCamelCase</code>不能同时定义</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">mybatis-plus:</span><br><span class="line">  configuration:</span><br><span class="line">    map-underscore-to-camel-case: true</span><br></pre></td></tr></table></figure>

<h1 id="主键策略"><a href="#主键策略" class="headerlink" title="主键策略"></a>主键策略</h1><p><a href="https://mp.baomidou.com/guide/id-generator.html#spring-boot">官方地址</a></p>
<blockquote>
<ol>
<li>主键策略定义在了枚举类<code>IdType</code>上</li>
<li>局部和全局策略都设置后,局部策略优先</li>
<li>设置全局策略,就不用设置局部策略了</li>
</ol>
</blockquote>
<h2 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h2><ol>
<li><code>com.baomidou.mybatisplus.annotation.IdType</code>类定义了MP的主键策略</li>
<li>局部主键策略使用<code>TableId</code>注解来进行设置</li>
<li>全局主键策略在yaml中直接配置就行</li>
<li>局部策略优先于全局策略</li>
</ol>
<h2 id="局部"><a href="#局部" class="headerlink" title="局部"></a>局部</h2><p><code>@TableId</code>中可以设置主键的自增方式</p>
<p><code>ASSIGN_UUID</code>类型的主键,需要把实体类主键设置成<code>String</code>类型,把数据库主键设置成<code>varchar</code>类型</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">IdType</span> </span>&#123;</span><br><span class="line">    AUTO(<span class="number">0</span>),  <span class="comment">//自动</span></span><br><span class="line">    NONE(<span class="number">1</span>), <span class="comment">//不增</span></span><br><span class="line">    INPUT(<span class="number">2</span>), <span class="comment">//手动增加,需要在增加实体类的时候,手动Set一个id</span></span><br><span class="line">    ASSIGN_ID(<span class="number">3</span>),</span><br><span class="line">    ASSIGN_UUID(<span class="number">4</span>),</span><br><span class="line">    ID_WORKER(<span class="number">3</span>), <span class="comment">//默认的全局唯一ID</span></span><br><span class="line">    ID_WORKER_STR(<span class="number">3</span>),<span class="comment">//字符串表示法的全局唯一ID</span></span><br><span class="line">    UUID(<span class="number">4</span>); <span class="comment">//全局唯一ID,需要实体类id是String类型</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//eg</span></span><br><span class="line"><span class="meta">@TableId(type = IdType.AUTO)</span></span><br><span class="line"><span class="keyword">private</span> Long id;</span><br></pre></td></tr></table></figure>

<h2 id="全局"><a href="#全局" class="headerlink" title="全局"></a>全局</h2><blockquote>
<p>局部策略优先于全局策略</p>
</blockquote>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">id-type:</span> <span class="string">id_worker</span></span><br></pre></td></tr></table></figure>

<h1 id="逻辑删除"><a href="#逻辑删除" class="headerlink" title="逻辑删除"></a>逻辑删除</h1><h2 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h2><p><a href="https://baomidou.com/guide/logic-delete.html">官网地址</a></p>
<p><a href="https://www.imooc.com/video/20086">慕课网视频</a></p>
<blockquote>
<p>说明:</p>
<p>只对自动注入的sql起效:</p>
<ul>
<li>插入: 不作限制</li>
<li>查找: 追加where条件过滤掉已删除数据,且使用 wrapper.entity 生成的where条件会忽略该字段</li>
<li>更新: 追加where条件防止更新到已删除数据,且使用 wrapper.entity 生成的where条件会忽略该字段</li>
<li>删除: 转变为 更新</li>
<li>例如:<ul>
<li>删除: <code>update user set deleted=1 where id = 1 and deleted=0</code></li>
<li>查找: <code>select id,name,deleted from user where deleted=0</code></li>
</ul>
</li>
</ul>
</blockquote>
<h2 id="逻辑删除实现"><a href="#逻辑删除实现" class="headerlink" title="逻辑删除实现"></a>逻辑删除实现</h2><p>步骤一</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis-plus:</span></span><br><span class="line">  <span class="attr">global-config:</span></span><br><span class="line">    <span class="attr">db-config:</span></span><br><span class="line">      <span class="attr">logic-delete-value:</span> <span class="number">1</span> <span class="comment"># 逻辑已删除值(默认为 1)</span></span><br><span class="line">      <span class="attr">logic-not-delete-value:</span> <span class="number">0</span> <span class="comment"># 逻辑未删除值(默认为 0)</span></span><br></pre></td></tr></table></figure>

<p>步骤二</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//逻辑删除标识（0.未删除，1.已删除）</span></span><br><span class="line"><span class="meta">@TableLogic</span></span><br><span class="line"><span class="keyword">private</span> Integer deleted;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> i = userMapper.deleteById(<span class="number">1094592041087729666L</span>);</span><br><span class="line">System.out.println(<span class="string">&quot;影响行数:&quot;</span> + i);</span><br><span class="line"></span><br><span class="line"><span class="comment">//实际执行语句为  UPDATE user SET deleted=1 WHERE id=? AND deleted=0 </span></span><br></pre></td></tr></table></figure>

<h2 id="sql中排除逻辑删除字段"><a href="#sql中排除逻辑删除字段" class="headerlink" title="sql中排除逻辑删除字段"></a>sql中排除逻辑删除字段</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@TableField(select = false)</span></span><br><span class="line"><span class="keyword">private</span> Integer deleted;</span><br></pre></td></tr></table></figure>

<h1 id="自动填充"><a href="#自动填充" class="headerlink" title="自动填充"></a>自动填充</h1><h2 id="概述-4"><a href="#概述-4" class="headerlink" title="概述"></a>概述</h2><p><a href="https://www.imooc.com/video/20089">慕课网视频</a></p>
<p><a href="https://baomidou.com/guide/auto-fill-metainfo.html">官网地址</a></p>
<ul>
<li>填充原理是直接给<code>Entity</code>的属性设置值!!!</li>
<li>注解则是指定该属性在对应情况下必有值,如果无值则入库会是<code>null</code></li>
<li><code>MetaObjectHandler</code>提供的默认方法的策略均为:如果属性有值则不覆盖,如果填充值为<code>null</code>则不填充</li>
<li>字段必须声明<code>TableField</code>注解,属性<code>fill</code>选择对应策略,该声明告知<code>Mybatis-Plus</code>需要预留注入<code>SQL</code>字段</li>
<li>填充处理器<code>MyMetaObjectHandler</code>在 Spring Boot 中需要声明<code>@Component</code>或<code>@Bean</code>注入</li>
<li>要想根据注解<code>FieldFill.xxx</code>和<code>字段名</code>以及<code>字段类型</code>来区分必须使用父类的<code>strictInsertFill</code>或者<code>strictUpdateFill</code>方法</li>
<li>不需要根据任何来区分可以使用父类的<code>fillStrategy</code>方法</li>
</ul>
<h2 id="实现步骤"><a href="#实现步骤" class="headerlink" title="实现步骤"></a>实现步骤</h2><ol>
<li>在实体类属性上添加注解,声明这是需要在什么条件下进行填充</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建时间</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.INSERT)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime createTime;</span><br><span class="line"><span class="comment">//修改时间</span></span><br><span class="line"><span class="meta">@TableField(fill = FieldFill.UPDATE)</span></span><br><span class="line"><span class="keyword">private</span> LocalDateTime updateTime;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>创建自动填充器,在内部进行自动填充实现</p>
<p>要加入<code>@Component</code>注解,声明被spring接管</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyMetaObjectHandler</span> <span class="keyword">implements</span> <span class="title">MetaObjectHandler</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insertFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * createTime是实体类的属性名</span></span><br><span class="line"><span class="comment">         * hasSetter:当实体类有setCreateTime时才会执行</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        <span class="keyword">boolean</span> createTime = metaObject.hasSetter(<span class="string">&quot;createTime&quot;</span>);</span><br><span class="line">         <span class="keyword">if</span> (createTime) &#123;</span><br><span class="line">            <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;createTime&quot;</span>, LocalDateTime.now(), metaObject);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         *  getFieldValByName: 获取修改时间,当修改时间为空,就进行修改操作</span></span><br><span class="line"><span class="comment">         *   Object udpTime是获取到的修改数据</span></span><br><span class="line"><span class="comment">         * 当修改时间不为空,即在实体类修改时手动添加了修改时间,就不会进行自动填充</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Object udpTime = <span class="keyword">this</span>.getFieldValByName(<span class="string">&quot;udpTime&quot;</span>, metaObject);</span><br><span class="line">        <span class="keyword">if</span> (udpTime == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;udpTime&quot;</span>, LocalDateTime.now(), metaObject);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">updateFill</span><span class="params">(MetaObject metaObject)</span> </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 当已经在插入数据的时候,设定了修改时间,此时会获取到修改时间是否为空</span></span><br><span class="line"><span class="comment">         * 如果为空,就进行自动填充</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        Object udpTime = <span class="keyword">this</span>.getFieldValByName(<span class="string">&quot;udpTime&quot;</span>, metaObject);</span><br><span class="line">        <span class="keyword">if</span> (udpTime == <span class="keyword">null</span>) &#123;</span><br><span class="line">            <span class="keyword">this</span>.setFieldValByName(<span class="string">&quot;udpTime&quot;</span>, LocalDateTime.now(), metaObject);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h1><h2 id="概述-5"><a href="#概述-5" class="headerlink" title="概述"></a>概述</h2><p><a href="https://baomidou.com/guide/optimistic-locker-plugin.html">官网地址</a></p>
<p><a href="https://www.imooc.com/video/20092">慕课网地址</a></p>
<p>乐观锁实现方式：</p>
<ul>
<li>取出记录时，获取当前version</li>
<li>更新时，带上这个version</li>
<li>执行更新时， set version = newVersion where version = oldVersion</li>
<li>如果version不对，就更新失败</li>
</ul>
<p>特别说明:</p>
<ul>
<li>支持的数据类型只有:int,Integer,long,Long,Date,Timestamp,LocalDateTime</li>
<li>整数类型下 <code>newVersion = oldVersion + 1</code></li>
<li><code>newVersion</code> 会回写到 <code>entity</code> 中</li>
<li>仅支持 <code>updateById(id)</code> 与 <code>update(entity, wrapper)</code> 方法</li>
<li><strong>在 <code>update(entity, wrapper)</code> 方法下, <code>wrapper</code> 不能复用!!!</strong></li>
</ul>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><p>分为两步,</p>
<ol>
<li>添加乐观锁的插件<code>OptimisticLockerInterceptor</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> OptimisticLockerInterceptor <span class="title">optimisticLockerInterceptor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> OptimisticLockerInterceptor();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在实体类属性上添加<code>@Version</code>注解</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Version</span></span><br><span class="line"><span class="keyword">private</span> Integer version;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>代码示例</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"> QueryWrapper&lt;User&gt; query = Wrappers.query();</span><br><span class="line"> query.eq(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;张雨琪&quot;</span>);</span><br><span class="line"> <span class="comment">// 通过查询数据库,version版本为1</span></span><br><span class="line"> Integer version = userMapper.selectOne(query).getVersion();</span><br><span class="line"></span><br><span class="line"><span class="comment">//需要修改后的数据</span></span><br><span class="line">User user = <span class="keyword">new</span> User();</span><br><span class="line">user.setAge(<span class="number">32</span>);</span><br><span class="line"><span class="comment">//必须要带版本号</span></span><br><span class="line">user.setVersion(version);</span><br><span class="line"></span><br><span class="line"><span class="comment">//修改操作</span></span><br><span class="line"><span class="keyword">int</span> update = userMapper.update(user, query);</span><br><span class="line">System.out.println(<span class="string">&quot;影响行数&quot;</span> + update);</span><br><span class="line"></span><br><span class="line"><span class="comment">//UPDATE user SET age=?, update_time=?, version=? WHERE (name = ? AND version = ?) </span></span><br></pre></td></tr></table></figure>



































]]></content>
      <categories>
        <category>mybatis框架</category>
      </categories>
      <tags>
        <tag>mybatis</tag>
      </tags>
  </entry>
  <entry>
    <title>spring</title>
    <url>/2020/05/31/spring/spring/</url>
    <content><![CDATA[<h1 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h1><blockquote>
<p>Spring是一个轻量级控制反转(IoC)和面向切面(AOP)的容器框架。</p>
</blockquote>
<p><img data-src="/images/framework/spring-1.png"></p>
<a id="more"></a>

<blockquote>
<p>Core Controller 中 <strong>SpEL</strong>   对应的是 <strong>spring-expression</strong></p>
<p>Data Access   中  <strong>Transactions</strong>   对应的是 <strong>spring-tx  事务</strong></p>
<p>Web 分为以下三种</p>
<ol>
<li><p>Servlet        spring-web</p>
</li>
<li><p>Web      spring-webmvc</p>
</li>
<li><p>Portlet      spring-webmvc-portlet   开发web应用的组件集成</p>
</li>
</ol>
</blockquote>
<ul>
<li><strong>核心容器</strong>：核心容器提供 Spring 框架的基本功能。核心容器的主要组件是 <code>BeanFactory</code>，它是工厂模式的实现。<code>BeanFactory</code> 使用控制反转(IOC） 模式将应用程序的配置和依赖性规范与实际的应用程序代码分开。</li>
<li><strong>Spring 上下文</strong>：Spring 上下文是一个配置文件，向 Spring 框架提供上下文信息。Spring 上下文包括企业服务，例如 JNDI、EJB、电子邮件、国际化、校验和调度功能。</li>
<li><strong>Spring AOP</strong>：通过配置管理特性，Spring AOP 模块直接将面向方面的编程功能集成到了 Spring 框架中。所以，可以很容易地使 Spring 框架管理的任何对象支持 AOP。Spring AOP 模块为基于 Spring 的应用程序中的对象提供了事务管理服务。通过使用 Spring AOP，不用依赖 EJB 组件，就可以将声明性事务管理集成到应用程序中。</li>
<li><strong>Spring DAO</strong>：JDBC DAO 抽象层提供了有意义的异常层次结构，可用该结构来管理异常处理和不同数据库供应商抛出的错误消息。异常层次结构简化了错误处理，并且极大地降低了需要编写的异常代码数量（例如打开和关闭连接）。Spring DAO 的面向 JDBC 的异常遵从通用的 DAO 异常层次结构。</li>
<li><strong>Spring ORM</strong>：Spring 框架插入了若干个 ORM 框架，从而提供了 ORM 的对象关系工具，其中包括 JDO、Hibernate 和 iBatis SQL Map。所有这些都遵从 Spring 的通用事务和 DAO 异常层次结构。</li>
<li><strong>Spring Web 模块</strong>：Web 上下文模块建立在应用程序上下文模块之上，为基于 Web 的应用程序提供了上下文。所以，Spring 框架支持与 Jakarta Struts 的集成。Web 模块还简化了处理多部分请求以及将请求参数绑定到域对象的工作。</li>
<li><strong>Spring MVC 框架</strong>：MVC 框架是一个全功能的构建 Web 应用程序的 MVC 实现。通过策略接口，MVC 框架变成为高度可配置的，MVC 容纳了大量视图技术，其中包括 JSP、Velocity、Tiles、iText 和 POI。</li>
</ul>
<h1 id="HelloWorld"><a href="#HelloWorld" class="headerlink" title="HelloWorld"></a>HelloWorld</h1><h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>bean</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">package</span> com.wty.spring.bean;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName22222</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">say</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;你好&quot;</span> + name);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>spring.xml</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloWorld&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wty.spring.bean.HelloWorld&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name22222&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小米&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>test</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">       ApplicationContext applicationContext = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;classpath:spring.xml&quot;</span>);</span><br><span class="line">       HelloWorld world = (HelloWorld) applicationContext.getBean(<span class="string">&quot;helloWorld&quot;</span>);</span><br><span class="line">       world.say();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><blockquote>
<p>在spring.xml中,javaBean的属性在进行赋值时,name的值和javaBean的set方法名字保持一致.</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">&lt;property name=<span class="string">&quot;name22222&quot;</span> value=<span class="string">&quot;小米&quot;</span>/&gt;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">setName22222</span><span class="params">(String name)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = name;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="IOC–DI"><a href="#IOC–DI" class="headerlink" title="IOC–DI"></a>IOC–DI</h1><h2 id="IOC"><a href="#IOC" class="headerlink" title="IOC"></a>IOC</h2><p>在helloWorld的配置文件中以下代码,代表的是IOC,即控制反转</p>
<blockquote>
<p><strong>Ioc—Inversion of Control，即“控制反转”，不是什么技术，而是一种设计思想。在Java开发中，Ioc意味着将你设计好的对象交给容器控制，而不是传统的在你的对象内部直接控制。如何理解好Ioc呢？理解好Ioc的关键是要明确“谁控制谁，控制什么，为何是反转（有反转就应该有正转了），哪些方面反转了”，那我们来深入分析一下：</strong></p>
<p>　　<strong>●谁控制谁，控制什么：传统Java SE程序设计，我们直接在对象内部通过new进行创建对象，是程序主动去创建依赖对象；而IoC是有专门一个容器来创建这些对象，即由Ioc容器来控制对 象的创建；谁控制谁？当然是IoC 容器控制了对象；控制什么？那就是主要控制了外部资源获取（不只是对象包括比如文件等）。</strong></p>
<p>　　<strong>●为何是反转，哪些方面反转了：有反转就有正转，传统应用程序是由我们自己在对象中主动控制去直接获取依赖对象，也就是正转；而反转则是由容器来帮忙创建及注入依赖对象；为何是反转？因为由容器帮我们查找及注入依赖对象，对象只是被动的接受依赖对象，所以是反转；哪些方面反转了？依赖对象的获取被反转了。</strong></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloWorld&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wty.spring.bean.HelloWorld&quot;</span>&gt;</span></span><br><span class="line">      </span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="IOC注解"><a href="#IOC注解" class="headerlink" title="IOC注解"></a>IOC注解</h2><h3 id="1-引入context约束"><a href="#1-引入context约束" class="headerlink" title="1.引入context约束"></a><strong>1.引入context约束</strong></h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/context/spring-context.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="2-application-xml配置"><a href="#2-application-xml配置" class="headerlink" title="2.application.xml配置"></a><strong>2.application.xml配置</strong></h3><blockquote>
<p><strong>2.1.applicationContext.xml开启组件扫描,只会扫描类注解,比如</strong></p>
</blockquote>
<p><strong>@Service</strong> </p>
<p><strong>@Controller</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.wty.spring&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:include-filter</span> <span class="attr">type</span>=<span class="string">&quot;annotation&quot;</span> </span></span><br><span class="line"><span class="tag">        <span class="attr">expression</span>=<span class="string">&quot;org.springframework.stereotype.Controller&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">context:component-scan</span>&gt;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p><strong>2.2  如果类上没有注解,依然要用注解方式,需要开启</strong></p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:annotation-config</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="3-使用注解"><a href="#3-使用注解" class="headerlink" title="3.使用注解"></a><strong>3.使用注解</strong></h3><p> @Component  可以看成是以下三个的父类注解</p>
<blockquote>
<p> <strong>@Repository   :  dao层</strong> </p>
<p><strong>@Service  :  service层</strong></p>
<p><strong>@Controller  : web层</strong></p>
</blockquote>
<h3 id="4-Bean自动装配"><a href="#4-Bean自动装配" class="headerlink" title="4.Bean自动装配"></a><strong>4.Bean自动装配</strong></h3><blockquote>
<p>dao调用service层,可以使用@Autowired来自动注入,</p>
<p>如果bean没有被spring管理,使用@Autowired的时候会报错,</p>
<p>可以使用@Autowired*(<em>required=false</em>)*<em>来规避</em></p>
</blockquote>
<h3 id="5-属性设置值"><a href="#5-属性设置值" class="headerlink" title="5.属性设置值"></a><strong>5.属性设置值</strong></h3><ul>
<li>普通属性  @Value</li>
</ul>
<blockquote>
<p>1.有set方法,直接在set方法上面加 @value</p>
<p>2.只有属性,在属性上加@value</p>
</blockquote>
<ul>
<li>对象属性  @Autowired</li>
</ul>
<ul>
<li>service 调用 dao  时,加注解 @Autowired</li>
</ul>
<blockquote>
<p>@Qualifier    和@Autowired 强制按照名称注入</p>
<p>@Resource(name=” “)   以上两种的替代品</p>
</blockquote>
<h3 id="6-初始化和销毁"><a href="#6-初始化和销毁" class="headerlink" title="6.初始化和销毁"></a><strong>6.初始化和销毁</strong></h3><blockquote>
<p>@PostConstruct ：初始化方法</p>
<p>@PreDestroy  ：销毁方法</p>
</blockquote>
<h3 id="7-作用范围注解"><a href="#7-作用范围注解" class="headerlink" title="7.作用范围注解"></a><strong>7.作用范围注解</strong></h3><p><strong>@**</strong>Scope**: 直接加在类上面</p>
<blockquote>
<p>singleton ;默认单例</p>
<p>prototype : 多例</p>
</blockquote>
<h2 id="DI"><a href="#DI" class="headerlink" title="DI"></a>DI</h2><p>DI就是依赖注入,即赋值</p>
<blockquote>
<p>　DI—Dependency Injection，即“依赖注入”：组件之间依赖关系由容器在运行期决定，形象的说，即由容器动态的将某个依赖关系注入到组件之中。依赖注入的目的并非为软件系统带来更多功能，而是为了提升组件重用的频率，并为系统搭建一个灵活、可扩展的平台。通过依赖注入机制，我们只需要通过简单的配置，而无需任何代码就可指定目标需要的资源，完成自身的业务逻辑，而不需要关心具体的资源来自何处，由谁实现。</p>
<p>　　<strong>理解DI的关键是：“谁依赖谁，为什么需要依赖，谁注入谁，注入了什么”，那我们来深入分析一下：</strong></p>
<p>　　<strong>●谁依赖于谁：当然是应用程序依赖于IoC容器；</strong></p>
<p>　　<strong>●为什么需要依赖：</strong>应用程序需要IoC容器来提供对象需要的外部资源<strong>；</strong></p>
<p>　　<strong>●谁注入谁：很明显是IoC容器注入应用程序某个对象，应用程序依赖的对象；</strong></p>
<p>　　<strong>●注入了什么：就是注入某个对象所需要的外部资源（包括对象、资源、常量数据）。</strong></p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name22222&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小米&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>
</blockquote>
<h1 id="Bean"><a href="#Bean" class="headerlink" title="Bean"></a>Bean</h1><h2 id="初始化和销毁"><a href="#初始化和销毁" class="headerlink" title="初始化和销毁"></a>初始化和销毁</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">// init-method 定义初始化方法,值为javaBean的方法名字</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloWorld&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wty.spring.bean.HelloWorld&quot;</span> <span class="attr">init-method</span>=<span class="string">&quot;say&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">//destory-method  定义销毁方法</span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;helloWorld&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wty.spring.bean.HelloWorld&quot;</span> <span class="attr">destroy-method</span>=<span class="string">&quot;say&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="作用范围"><a href="#作用范围" class="headerlink" title="作用范围"></a>作用范围</h2><p><strong>singleton</strong></p>
<blockquote>
<p>当一个bean的作用域为singleton, 那么Spring IoC容器中只会存在一个共享的bean实例，并且所有对bean的请求，只要id与该bean定义相匹配，则只会返回bean的同一实例。</p>
</blockquote>
<p><strong>prototype</strong></p>
<blockquote>
<p>Prototype作用域的bean会导致在每次对该bean请求（将其注入到另一个bean中，或者以程序的方式调用容器的getBean() 方法）时都会创建一个新的bean实例。根据经验，对所有有状态的bean应该使用prototype作用域，而对无状态的bean则应该使用 singleton作用域</p>
</blockquote>
<p><strong>request</strong></p>
<blockquote>
<p>在一次HTTP请求中，一个bean定义对应一个实例；即每次HTTP请求将会有各自的bean实例， 它们依据某个bean定义创建而成。该作用 域仅在基于web的Spring ApplicationContext情形下有效。</p>
</blockquote>
<p><strong>session</strong></p>
<blockquote>
<p>在一个HTTP Session中，一个bean定义对应一个实例。该作用域仅在基于web的Spring ApplicationContext情形下有效。</p>
</blockquote>
<p><strong>global session</strong></p>
<blockquote>
<p>在一个全局的HTTP Session中，一个bean定义对应一个实例。典型情况下，仅在使用portlet context的时候有效。该作用域仅在基于 web的Spring ApplicationContext情形下有效。</p>
</blockquote>
<p>最常用的有两种:<strong><code>singleton</code></strong> , <strong><code>prototype</code></strong></p>
<blockquote>
<p><strong>Singleton (默认)</strong>,在IOC容器中Bean以单例方式存在，可执行关闭方法</p>
</blockquote>
<blockquote>
<p><strong><code>prototype</code></strong>:每次获取Bean的时候会有一个新的实例,即每次调用getBean()时，相当于执行newXxxBean() ,多例模式</p>
</blockquote>
<h1 id="属性注入"><a href="#属性注入" class="headerlink" title="属性注入"></a>属性注入</h1><h2 id="三种常见的注入"><a href="#三种常见的注入" class="headerlink" title="三种常见的注入"></a>三种常见的注入</h2><p><img data-src="/images/framework/spring-2.png"></p>
<p>spring支持构造器注入和setter方法注入</p>
<p>  构造器注入，通过 <code>&lt;constructor-arg&gt;</code> 元素完成注入</p>
<p>  setter方法注入， 通过 <code>&lt;property&gt;</code> 元素完成注入【开发中常用方式】</p>
<h2 id="复杂属性注入"><a href="#复杂属性注入" class="headerlink" title="复杂属性注入"></a>复杂属性注入</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">private</span> String[] arr;</span><br><span class="line"><span class="keyword">private</span> List list;</span><br><span class="line"><span class="keyword">private</span> Set set;</span><br><span class="line"><span class="keyword">private</span> Map&lt;String, String&gt; map;</span><br></pre></td></tr></table></figure>

<h3 id="数组"><a href="#数组" class="headerlink" title="数组"></a>数组</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--数组 String[] arr--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;arr&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span>数组一<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span>数组二<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span>数组三<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="list"><a href="#list" class="headerlink" title="list"></a>list</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--集合 List list--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;list&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">list</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span>集合一<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">value</span>&gt;</span>集合二<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">list</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="set"><a href="#set" class="headerlink" title="set"></a>set</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--Set  set--&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;set&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">set</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">value</span>&gt;</span>set一<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">           <span class="tag">&lt;<span class="name">value</span>&gt;</span>set二<span class="tag">&lt;/<span class="name">value</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;/<span class="name">set</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="map"><a href="#map" class="headerlink" title="map"></a>map</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--Map&lt;String, String&gt; map--&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">map</span>&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;mapKey一&quot;</span> <span class="attr">value</span>=<span class="string">&quot;map一&quot;</span>/&gt;</span></span><br><span class="line">          <span class="tag">&lt;<span class="name">entry</span> <span class="attr">key</span>=<span class="string">&quot;mapKey二&quot;</span> <span class="attr">value</span>=<span class="string">&quot;map二&quot;</span>/&gt;</span></span><br><span class="line">      <span class="tag">&lt;/<span class="name">map</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="Util名称空间"><a href="#Util名称空间" class="headerlink" title="Util名称空间"></a>Util名称空间</h3><ol>
<li>引入命名空间</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:util</span>=<span class="string">&quot;http://www.springframework.org/schema/util&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/util</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">       http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在xml中创建可以被重复被引用的数据,例如map,id是必须要有的</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">util:map</span> <span class="attr">id</span>=<span class="string">&quot;map&quot;</span>&gt;</span></span><br><span class="line">       <span class="tag">&lt;<span class="name">entry</span>&gt;</span>1<span class="tag">&lt;/<span class="name">entry</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">util:map</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在别的属性中,通过ref可以引用</li>
</ol>
<h3 id="p名称空间"><a href="#p名称空间" class="headerlink" title="p名称空间"></a>p名称空间</h3><ol>
<li>引入约束</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:p</span>=<span class="string">&quot;http://www.springframework.org/schema/p&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd&quot;</span>&gt;</span></span><br><span class="line">    </span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>设置属性 p:属性=”值”</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;Pcar2&quot;</span> <span class="attr">class</span>=<span class="string">&quot;demo2.Car2&quot;</span> <span class="attr">p:carname</span>=<span class="string">&quot;小汽车&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>对象属性</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;demo2.Employee&quot;</span> <span class="attr">p:name</span>=<span class="string">&quot;臭弟弟&quot;</span> <span class="attr">p:car-ref</span>=<span class="string">&quot;car&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="SpEL名称空间"><a href="#SpEL名称空间" class="headerlink" title="SpEL名称空间"></a>SpEL名称空间</h3><p>对象 ,赋值的时候,需要加单引号 </p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;demo2.Employee&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;&#x27;侯卿&#x27;&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;car&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;car&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>属性,方法</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;emp&quot;</span> <span class="attr">class</span>=<span class="string">&quot;demo2.Employee&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;&#x27;侯卿&#x27;&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;car&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;car&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;empal&quot;</span> <span class="attr">class</span>=<span class="string">&quot;demo2.Employeeal&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name1&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;emp.name1&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;car&quot;</span> <span class="attr">value</span>=<span class="string">&quot;#&#123;emp.getCarPrice()&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="AOP的xml配置"><a href="#AOP的xml配置" class="headerlink" title="AOP的xml配置"></a>AOP的xml配置</h1><h2 id="1-通知的类型"><a href="#1-通知的类型" class="headerlink" title="1. 通知的类型"></a>1. 通知的类型</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">前置通知	Before   </span><br><span class="line">后置通知	AfterReturning</span><br><span class="line">环绕通知	Around</span><br><span class="line">异常通知	AfterThrowing</span><br><span class="line">最终通知	After</span><br></pre></td></tr></table></figure>

<h2 id="2-约束文件"><a href="#2-约束文件" class="headerlink" title="2. 约束文件"></a>2. 约束文件</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/beans/spring-beans-3.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">    http://www.springframework.org/schema/aop/spring-aop-3.0.xsd &quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="3-配置"><a href="#3-配置" class="headerlink" title="3. 配置"></a>3. 配置</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"> <span class="comment">&lt;!--配置需要增强的类--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;accountService&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wty.spring.service.impl.IAccountServiceImpl&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置增强类--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;log&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wty.spring.log.Logger&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--切面配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">id</span>=<span class="string">&quot;po1&quot;</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.wty.spring.service.impl.*.*(..))&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--order定义优先级--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:aspect</span> <span class="attr">ref</span>=<span class="string">&quot;log&quot;</span> <span class="attr">order</span>=<span class="string">&quot;1&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">aop:around</span> <span class="attr">method</span>=<span class="string">&quot;AroundLogger&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;po1&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- &lt;aop:before method=&quot;befoteLogger&quot; pointcut-ref=&quot;po1&quot;/&gt;</span></span><br><span class="line"><span class="comment">            &lt;aop:after-returning method=&quot;AfterReturningLogger&quot; pointcut-ref=&quot;po1&quot;/&gt;</span></span><br><span class="line"><span class="comment">            &lt;aop:after method=&quot;AfterLogger&quot; pointcut-ref=&quot;po1&quot;/&gt;</span></span><br><span class="line"><span class="comment">            &lt;aop:after-throwing method=&quot;AfterThrowingLogger&quot; pointcut-ref=&quot;po1&quot;/&gt;--&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">aop:aspect</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="声明式事务"><a href="#声明式事务" class="headerlink" title="声明式事务"></a>声明式事务</h1><h2 id="注解声明式"><a href="#注解声明式" class="headerlink" title="注解声明式"></a>注解声明式</h2><ol>
<li>在xml文件中引入平台事务管理器</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;transactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>开启注解事务</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">tx:annotation-driven</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;transactionManager&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<p>3.在业务层添加注解 </p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Transactional</span> </span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AccountServiceImpl</span> <span class="keyword">implements</span> <span class="title">AccountService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="xml声明式"><a href="#xml声明式" class="headerlink" title="xml声明式"></a>xml声明式</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 引入数据库的配置文件 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:dbconfig.properties&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 配置 数据源 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.alibaba.druid.pool.DruidDataSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;driverClassName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.driver&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;url&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.url&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;username&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.user&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;password&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;jdbc.password&#125;&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- spring事务管理 --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;dataSourceTransactionManager&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.jdbc.datasource.DataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;dataSource&quot;</span> <span class="attr">ref</span>=<span class="string">&quot;dataSource&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!-- 开启基于注解的事务 xml配置式的--&gt;</span></span><br><span class="line"><span class="comment">&lt;!--开启基于注解的事务，使用xml配置形式的事务（必要主要的都是使用配置式）  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">aop:config</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 切入点表达式 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:pointcut</span> <span class="attr">expression</span>=<span class="string">&quot;execution(* com.wty.ssm.service..*(..))&quot;</span> <span class="attr">id</span>=<span class="string">&quot;txPoint&quot;</span>/&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置事务增强 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">aop:advisor</span> <span class="attr">advice-ref</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">pointcut-ref</span>=<span class="string">&quot;txPoint&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">aop:config</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置事务增强，事务如何切入  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">tx:advice</span> <span class="attr">id</span>=<span class="string">&quot;txAdvice&quot;</span> <span class="attr">transaction-manager</span>=<span class="string">&quot;dataSourceTransactionManager&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 所有方法都是事务方法 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;*&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--以get开始的所有方法  --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">tx:method</span> <span class="attr">name</span>=<span class="string">&quot;get*&quot;</span> <span class="attr">read-only</span>=<span class="string">&quot;true&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">tx:attributes</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">tx:advice</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="整合测试"><a href="#整合测试" class="headerlink" title="整合测试"></a>整合测试</h1><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringJUnit4ClassRunner.class)</span></span><br><span class="line"><span class="meta">@ContextConfiguration(locations = &#123;&quot;classpath:applicationContext.xml&quot;, &quot;classpath:springmvc.xml&quot;&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test_tx</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Service service;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">//然后调用service的方法</span></span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h1 id="spring完整约束"><a href="#spring完整约束" class="headerlink" title="spring完整约束"></a>spring完整约束</h1><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span>      </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span>   </span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:tx</span>=<span class="string">&quot;http://www.springframework.org/schema/tx&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:aop</span>=<span class="string">&quot;http://www.springframework.org/schema/aop&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span>            </span></span><br><span class="line"><span class="tag">	<span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;                                             </span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/beans  </span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/beans/spring-beans.xsd  </span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/context   </span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/context/spring-context.xsd  </span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/mvc  </span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/mvc/spring-mvc.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/tx </span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/tx/spring-tx.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/aop</span></span></span><br><span class="line"><span class="tag"><span class="string">            http://www.springframework.org/schema/aop/spring-aop.xsd &quot;</span></span></span><br><span class="line"><span class="tag">	<span class="attr">default-autowire</span>=<span class="string">&quot;byName&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h1><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">properties</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">project.build.sourceEncoding</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">project.build.sourceEncoding</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.source</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.source</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">maven.compiler.target</span>&gt;</span>1.8<span class="tag">&lt;/<span class="name">maven.compiler.target</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">spring.version</span>&gt;</span> 5.2.4.RELEASE<span class="tag">&lt;/<span class="name">spring.version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">properties</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring  Test--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-test<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring  core--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-beans<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-context<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring  aop--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aop<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.aspectj<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>aspectjweaver<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.9.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--spring  jdbc--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-orm<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--spring  web--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-webmvc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-web<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-expression<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-tx<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>$&#123;spring.version&#125;<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>junit<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.13<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.16.6<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br></pre></td></tr></table></figure>

]]></content>
      <categories>
        <category>spring框架</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>spring注解版</title>
    <url>/2020/08/01/spring/spring%E6%B3%A8%E8%A7%A3%E7%89%88/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p><a href="https://www.bilibili.com/video/BV1gW411W7wy?p=2">尚硅谷视频地址</a></p>
<p><a href="https://blog.csdn.net/lymboy/article/details/84979604">参考博客</a></p>
<h1 id="AnotationConfigApplicationContext"><a href="#AnotationConfigApplicationContext" class="headerlink" title="AnotationConfigApplicationContext"></a>AnotationConfigApplicationContext</h1><p>此注解用来实现注解版的配置文件的加载</p>
<a id="more"></a>

<h2 id="xml版的bean注入"><a href="#xml版的bean注入" class="headerlink" title="xml版的bean注入"></a>xml版的bean注入</h2><p>初始类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>xml配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wty.bean.Person&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;小米&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">ApplicationContext app = <span class="keyword">new</span> ClassPathXmlApplicationContext(<span class="string">&quot;classpath:applicationContext.xml&quot;</span>);</span><br><span class="line">Person person = (Person) app.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">System.out.println(person);</span><br></pre></td></tr></table></figure>

<p>打印输出</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Person(name=小米, age=20)</span><br></pre></td></tr></table></figure>

<h2 id="注解版的bean注入"><a href="#注解版的bean注入" class="headerlink" title="注解版的bean注入"></a>注解版的bean注入</h2><p>用<code>@Configuration</code>声明一个注解类,代替xml配置</p>
<p>用<code>@bean</code>来注册一个bean,name属性可以为这个bean取一个别名.</p>
<p>一个bean的默认名字是方法名</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config01</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean(name = &quot;person&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">per</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">&quot;小米&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>新建一个测试类,使用<code>AnnotationConfigApplicationContext</code>装配配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AnnotationConfigApplicationContext app = <span class="keyword">new</span> AnnotationConfigApplicationContext(Config01.class);</span><br><span class="line"><span class="comment">//Person person = (Person) app.getBean(&quot;person&quot;);</span></span><br><span class="line">Person person = app.getBean(Person.class);</span><br><span class="line">System.out.println(person);</span><br></pre></td></tr></table></figure>

<p>打印输出</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Person(name=小米, age=<span class="number">20</span>)</span><br></pre></td></tr></table></figure>

<h1 id="组件注册"><a href="#组件注册" class="headerlink" title="组件注册"></a>组件注册</h1><h2 id="xml版方式"><a href="#xml版方式" class="headerlink" title="xml版方式"></a>xml版方式</h2><p>在xml中配置包扫描,只会扫描添加了<code>@Controller</code> 、<code>@Repository</code> 、<code>@Component</code>、 <code>@Service</code>这些注解的类</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.wty&quot;</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="注解版方式"><a href="#注解版方式" class="headerlink" title="注解版方式"></a>注解版方式</h2><p>只需要在配置类上添加<code>@ComponentScan</code>即可</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><ol>
<li>创建一个<code>PersonController</code>类,添加<code>@Controller</code>注解</li>
<li>配置类上添加包扫描<code>@ComponentScan</code></li>
<li>通过容器的<code>getBeanDefinitionNames()</code>方法获取所有的包扫描下的组件,遍历一下</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">String[] na = app.getBeanDefinitionNames();</span><br><span class="line"><span class="keyword">for</span> (String s : na) &#123;</span><br><span class="line">	System.out.println(s);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>输出</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">org.springframework.context.annotation.internalConfigurationAnnotationProcessor</span><br><span class="line">org.springframework.context.annotation.internalAutowiredAnnotationProcessor</span><br><span class="line">org.springframework.context.annotation.internalRequiredAnnotationProcessor</span><br><span class="line">org.springframework.context.annotation.internalCommonAnnotationProcessor</span><br><span class="line">org.springframework.context.event.internalEventListenerProcessor</span><br><span class="line">org.springframework.context.event.internalEventListenerFactory</span><br><span class="line">personController   //自定义了一个PersonController</span><br></pre></td></tr></table></figure>

<h2 id="ComponentScan扩展"><a href="#ComponentScan扩展" class="headerlink" title="@ComponentScan扩展"></a>@ComponentScan扩展</h2><ul>
<li>value:指定要扫描的包</li>
<li>useDefaultFilters   默认全部包都扫描</li>
<li>excludeFilters: 排除要扫描的包,常用的是根据类型排除</li>
<li>includeFilters    只包含的包扫描</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@AliasFor(&quot;basePackages&quot;)</span></span><br><span class="line">String[] value() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">boolean</span> <span class="title">useDefaultFilters</span><span class="params">()</span> <span class="keyword">default</span> <span class="keyword">true</span></span>;</span><br><span class="line"></span><br><span class="line">ComponentScan.Filter[] includeFilters() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line"></span><br><span class="line">ComponentScan.Filter[] excludeFilters() <span class="keyword">default</span> &#123;&#125;;</span><br></pre></td></tr></table></figure>

<h3 id="排除示例"><a href="#排除示例" class="headerlink" title="排除示例"></a>排除示例</h3><p>配置了一个排除扫描,根据注解排除,排除的是添加了<code>@Controller</code>和<code>@Service</code>注解的类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(value = &quot;com.wty&quot;,excludeFilters = &#123;</span></span><br><span class="line"><span class="meta">        @ComponentScan.Filter(type = FilterType.ANNOTATION,value = &#123;Controller.class, Service.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">config</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="只包含示例"><a href="#只包含示例" class="headerlink" title="只包含示例"></a>只包含示例</h3><p>配置只包含的时候,需要关闭spring默认的扫描才能生效</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ComponentScan(value = &quot;com.wty&quot;,includeFilters = &#123;</span></span><br><span class="line"><span class="meta">        @ComponentScan.Filter(type = FilterType.ANNOTATION,value = &#123;Controller.class, Service.class&#125;)</span></span><br><span class="line"><span class="meta">&#125;,useDefaultFilters = false)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> class <span class="title">config</span><span class="params">()</span></span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="快速导入组件"><a href="#快速导入组件" class="headerlink" title="快速导入组件"></a>快速导入组件</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p><a href="https://www.bilibili.com/video/BV1gW411W7wy?p=8">尚硅谷视频地址</a></p>
<p>导入组件,一般使用三种方式</p>
<ol>
<li>包扫描+组件注解(@Controller @Service)这类,局限于自己写的类</li>
<li>@Bean:导入第三方包里的组件</li>
<li>@Import:如果我们使用<code>@Bean</code>导入一个组件,只是简单的返回了一个new对象,类似于如下这种,就可以使用<code>@Import</code>来快速导入一个</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">per</span><span class="params">()</span> </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Import"><a href="#Import" class="headerlink" title="@Import"></a>@Import</h2><ol>
<li>在配置类上直接添加此注解</li>
<li>导入单个类直接写类名的class即可,默认bean的id是类名的全路径<code>com.wty.bean.User</code></li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(User.class)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config02</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>导入多个bean,需要把value值写成数组形式即可</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@Import(&#123;User.class,User1.class,User2.class&#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config02</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="FactoryBean"><a href="#FactoryBean" class="headerlink" title="@FactoryBean"></a>@FactoryBean</h2><p><a href="https://www.bilibili.com/video/BV1gW411W7wy?p=11">视频地址</a></p>
<h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><ol>
<li><code>FactoryBean&lt;T&gt;</code>是一个接口</li>
<li>自定义一个Bean,可以实现<code>FactoryBean&lt;T&gt;</code>接口</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyFactoryBean</span> <span class="keyword">implements</span> <span class="title">FactoryBean</span>&lt;<span class="title">User</span>&gt; </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getObject</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="keyword">public</span> Class&lt;?&gt; getObjectType() &#123;</span><br><span class="line">        <span class="keyword">return</span> User.class;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//是否单例,默认返回false</span></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">isSingleton</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>可以通过<code>@Bean</code>方法,将<code>MyFactoryBean</code>添加进配置类的Bean</li>
<li>测试</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Object bean = app.getBean(<span class="string">&quot;myFactoryBean&quot;</span>);</span><br><span class="line">Object bean2= app.getBean(<span class="string">&quot;myFactoryBean&quot;</span>);</span><br><span class="line"><span class="comment">//BeanFactory类,定义了一个前缀:String FACTORY_BEAN_PREFIX = &quot;&amp;&quot;;</span></span><br><span class="line">Object bean3= app.getBean(<span class="string">&quot;&amp;myFactoryBean&quot;</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">//获取到的对象class com.wty.bean.User</span></span><br><span class="line">System.out.println(<span class="string">&quot;获取到的对象&quot;</span> + bean.getClass());</span><br><span class="line"><span class="comment">//如果MyFactoryBean定义是单例,打印输出 true</span></span><br><span class="line"><span class="comment">//如果MyFactoryBean定义是多例,打印输出 false</span></span><br><span class="line">System.out.println(bean==bean2);</span><br><span class="line"><span class="comment">//添加了&quot;&amp;&quot;符号后,就可以获取到配置类中的Bean class com.wty.bean.MyFactoryBean</span></span><br><span class="line">System.out.println(bean3.getClass());</span><br></pre></td></tr></table></figure>

























<h1 id="组件作用域"><a href="#组件作用域" class="headerlink" title="组件作用域"></a>组件作用域</h1><h2 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h2><p>组件的作用域使用<code>@Scope</code>来定义,值可以使用以下几个</p>
<ul>
<li>prototype - 多实例</li>
<li>singleton - 默认,单实例</li>
<li>request - 同一次请求,创建一个实例,用于web环境,不常用</li>
<li>session - 同一个session,创建一个实例,用于web环境,不常用</li>
</ul>
<p>示例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Config02</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;person&quot;)</span></span><br><span class="line">    <span class="meta">@Scope(value = &quot;prototype&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Person <span class="title">per</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="singleton-详解"><a href="#singleton-详解" class="headerlink" title="singleton 详解"></a>singleton 详解</h2><p>配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(name = &quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Scope</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">per</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;创建了一个bean.....&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AnnotationConfigApplicationContext app3 = <span class="keyword">new</span> AnnotationConfigApplicationContext(Config02.class);</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">创建了一个bean.....</span><br></pre></td></tr></table></figure>

<ol>
<li>创建一个单例的bean</li>
<li>在测试中创建IOC容器</li>
<li>当IOC容器启动的时候,就会调用方法,创建对象方法IOC容器中,以后每次获取,就从容器中拿,类似于map.get()</li>
</ol>
<h2 id="prototype-详解"><a href="#prototype-详解" class="headerlink" title="prototype 详解"></a>prototype 详解</h2><p>配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(name = &quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Scope(value = &quot;prototype&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">per</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;创建了一个bean.....&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AnnotationConfigApplicationContext app3 = <span class="keyword">new</span> AnnotationConfigApplicationContext(Config02.class);</span><br><span class="line">System.out.println(<span class="string">&quot;IOC容器创建完毕&quot;</span>);</span><br><span class="line">Person p1 = (Person) app3.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">Person p2 = (Person) app3.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">System.out.println(p1 == p2);</span><br></pre></td></tr></table></figure>

<p>输出</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">IOC容器创建完毕</span><br><span class="line">创建了一个bean.....</span><br><span class="line">创建了一个bean.....</span><br><span class="line">false</span><br></pre></td></tr></table></figure>

<ol>
<li>IOC容器并不会在启动的时候去调用方法创建对象放到容器中,而是会在每次获取( app3.getBean(“person”)的时候,才会调用方法创建对象</li>
</ol>
<h1 id="懒加载"><a href="#懒加载" class="headerlink" title="懒加载"></a>懒加载</h1><h2 id="概述-4"><a href="#概述-4" class="headerlink" title="概述"></a>概述</h2><p>懒加载是相对于单实例来说的</p>
<p>懒加载:容器启动的时候,先不创建对象,登高第一次获取(创建)对象的时候,才会加载</p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>配置类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(name = &quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Scope</span></span><br><span class="line"><span class="meta">@Lazy</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> Person <span class="title">per</span><span class="params">()</span> </span>&#123;</span><br><span class="line">System.out.println(<span class="string">&quot;创建了一个bean.....&quot;</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">new</span> Person(<span class="string">&quot;张三&quot;</span>, <span class="number">20</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AnnotationConfigApplicationContext app3 = <span class="keyword">new</span> AnnotationConfigApplicationContext(Config02.class);</span><br><span class="line">System.out.println(<span class="string">&quot;IOC容器创建完毕&quot;</span>);</span><br><span class="line">Person p1 = (Person) app3.getBean(<span class="string">&quot;person&quot;</span>);</span><br><span class="line">Person p2 = (Person) app3.getBean(<span class="string">&quot;person&quot;</span>);</span><br></pre></td></tr></table></figure>

<h3 id="解说"><a href="#解说" class="headerlink" title="解说"></a>解说</h3><ol>
<li>配置类中配置一个单实例的bean,并标记了懒加载注解<code>@lazy</code></li>
<li>在测试的时候,创建完对象<code>app3</code>的时候,不会加载bean</li>
<li>当对象开始获取bean的时候,IOC容器就调用<code> app3.getBean(&quot;person&quot;)</code>方法,加载了bean</li>
<li>第二次获取bean的时候,不会再次创建bean</li>
</ol>
<h1 id="Bean生命周期"><a href="#Bean生命周期" class="headerlink" title="Bean生命周期"></a>Bean生命周期</h1><p>以<code>@Bean</code>为例</p>
<ol>
<li>创建一个User类,定义一个初始化方法<code>init</code>,定义一个销毁方法<code>destroy</code></li>
<li>在配置类中添加User</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean(initMethod = &quot;init&quot;, destroyMethod = &quot;destroy&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> User <span class="title">user</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>测试</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建IOC容器的时候,就开始创建对象的无参函数和进行对象的初始化操作</span></span><br><span class="line">AnnotationConfigApplicationContext app = <span class="keyword">new</span> AnnotationConfigApplicationContext(Config3.class);</span><br><span class="line">User bean = app.getBean(User.class);</span><br><span class="line"><span class="comment">//class com.wty.bean.User</span></span><br><span class="line">System.out.println(bean.getClass());</span><br><span class="line"><span class="comment">//关闭的时候,进行了销毁操作</span></span><br><span class="line">app.close();</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>注意<ul>
<li>单实例的Bean,有初始化和销毁操作,都会被容器自动执行</li>
<li>多实例的Bean,只有初始化操作,销毁需要自己手动写方法</li>
</ul>
</li>
</ol>
<h1 id="Value赋值"><a href="#Value赋值" class="headerlink" title="@Value赋值"></a>@Value赋值</h1><p><a href="https://www.bilibili.com/video/BV1gW411W7wy?p=18">尚硅谷</a></p>
<h2 id="概述-5"><a href="#概述-5" class="headerlink" title="概述"></a>概述</h2><ol>
<li>常规值:String,Integer等</li>
<li>SpEL值:  #{20-2}</li>
<li>${} :取出配置文件(一般是properties)的值</li>
</ol>
<h2 id="示例"><a href="#示例" class="headerlink" title="${} 示例"></a>${} 示例</h2><h3 id="xml方式"><a href="#xml方式" class="headerlink" title="xml方式"></a>xml方式</h3><ol>
<li>创建一个person.properties文件,内容为<code>person.name=小花花</code></li>
<li>在applicationContext.xml中配置</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">context:property-placeholder</span> <span class="attr">location</span>=<span class="string">&quot;classpath:person.properties&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;person&quot;</span> <span class="attr">class</span>=<span class="string">&quot;com.wty.bean.Person&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;name&quot;</span> <span class="attr">value</span>=<span class="string">&quot;$&#123;person.name&#125;&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span> <span class="attr">value</span>=<span class="string">&quot;20&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="注解方式"><a href="#注解方式" class="headerlink" title="注解方式"></a>注解方式</h3><ol>
<li>创建一个person.properties文件,内容为<code>person.name=小花花</code></li>
<li>在配置类中用<code>@PropertySource(value = &#123;&quot;classpath:/person.properties&quot;&#125;)</code>来引入一个配置文件</li>
<li>在实体类的<code>name</code>属性上添加注解<code>@Value($&#123;person.name&#125;)</code></li>
<li>测试即可</li>
</ol>
<h1 id="自动装配"><a href="#自动装配" class="headerlink" title="自动装配"></a>自动装配</h1><p><strong>@Autowired</strong>  </p>
<p>根据类型,自动装配,类似于<code>app.getBean(User.class)</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AnnotationConfigApplicationContext app = <span class="keyword">new</span> AnnotationConfigApplicationContext(Config3.class);</span><br><span class="line">User bean = app.getBean(User.class);</span><br></pre></td></tr></table></figure>

<p><strong>@Qualifier(“person”)</strong></p>
<p>根据Bean的名称自动装配,使用此注解就是指定一个需要装配的Bean</p>
<p><strong>@Primary</strong></p>
<p>当存在多个相同Bean的实例化的时候,在一个Bean上添加此注解,表明这个Bean是首要选择的自动装配,不能和<code>@Qualifier</code>一起使用</p>
<h1 id="Profile环境"><a href="#Profile环境" class="headerlink" title="Profile环境"></a>Profile环境</h1><blockquote>
<p>两种激活方式</p>
<ol>
<li>在启动的时候,在VM上添加参数  -Dspring.profiles.active=test</li>
<li>在代码中指定环境</li>
</ol>
</blockquote>
<ol>
<li>创建三个环境</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProfileConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// 开发环境</span></span><br><span class="line">    <span class="meta">@Profile(&quot;devP&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">u1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;开发环境&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//测试环境</span></span><br><span class="line">    <span class="meta">@Profile(&quot;testP&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">u2</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;测试环境&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//生产环境</span></span><br><span class="line">    <span class="meta">@Profile(&quot;prodP&quot;)</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">u3</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User(<span class="string">&quot;生产环境&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>创建测试类</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//1.创建无参</span></span><br><span class="line">AnnotationConfigApplicationContext app = <span class="keyword">new</span> AnnotationConfigApplicationContext();</span><br><span class="line"><span class="comment">//2.激活环境</span></span><br><span class="line">app.getEnvironment().setActiveProfiles(<span class="string">&quot;test&quot;</span>);</span><br><span class="line"><span class="comment">//3.注册</span></span><br><span class="line">app.register(ProfileConfig.class);</span><br><span class="line"><span class="comment">//4.启动刷新</span></span><br><span class="line">app.refresh();</span><br><span class="line"></span><br><span class="line">String[] names = app.getBeanNamesForType(User.class);</span><br><span class="line"><span class="keyword">for</span> (String name : names) &#123;</span><br><span class="line">	System.out.println(name);</span><br><span class="line">&#125;</span><br><span class="line">app.close();</span><br></pre></td></tr></table></figure>

<h1 id="AOP"><a href="#AOP" class="headerlink" title="AOP"></a>AOP</h1><h2 id="概述-6"><a href="#概述-6" class="headerlink" title="概述"></a>概述</h2><p><a href="https://www.bilibili.com/video/BV1gW411W7wy?p=27">尚硅谷视频</a></p>
<p>aop需要导入<code>spring-aspects</code>包</p>
<p><strong>动态代理 :</strong> 指在程序运行期间动态地将某段代码切入带指定位置进行运行的编程方式</p>
<p>相关概念</p>
<ul>
<li><strong><em>Aspects</em></strong>: 切面, 通常是一个类, 即所谓的切面类,切面类中定义了切入点和通知</li>
<li><strong><em>JointPoint</em></strong>: 连接点, 执行的方法(需要通知的方法), 即下面的 <strong><em>div()</em></strong>方法</li>
<li><strong><em>Advice</em></strong>: 通知, 即什么(类型)通知, <em>eg: @Before, @After, @AfterReturning…</em></li>
<li><strong><em>Pointcut</em></strong>: 切入点, 对连接点进行拦截的定义, <em>即下面的 logStart(), logEnd()</em> 等等</li>
</ul>
<h2 id="步骤"><a href="#步骤" class="headerlink" title="步骤"></a>步骤</h2><ol>
<li>导入 <em>aspects</em> 依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-aspects<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.25.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>定义业务逻辑类, 定义一个实验方法</p>
</li>
<li><p>定义一个切面类</p>
</li>
<li><p>定义相关通知和切入点</p>
<p>通知方法</p>
</li>
</ol>
<ul>
<li>前置通知: 在目标方法(切点) 运行之前运行</li>
<li>后置通知: 在目标方法(切点) 运行之后运行</li>
<li>返回通知: 在目标方法(切点) 正常返回之后运行</li>
<li>异常通知: 在目标方法(切点) 运行出现异常之后运行</li>
<li>环绕通知: 动态代理, 目标方法运行前后运行</li>
</ul>
<ol start="5">
<li><p>将切面和业务逻辑类交由容器管理</p>
</li>
<li><p>给切面类添加 <em>@Aspect</em> 注解, 指明其是切面类</p>
</li>
<li><p>在配置类中添加 <em>@EnableAspectJAutoProxy</em> 注解, 开启注解版的 AOP 功能</p>
</li>
</ol>
<p>要点</p>
<ul>
<li>通知(<em>@Before(), @After()</em>) 中填入的是切点表达式: <em>@Before(“execution(public int com.lymboy.spring.annotation.aop.MathCalculator.\</em>(…))”)*</li>
<li>为了避免在通知中重复写相同的切点表达式可以使用 <em>@PointCut</em> 注解</li>
</ul>
<h2 id="代码-1"><a href="#代码-1" class="headerlink" title="代码"></a>代码</h2><p>业务类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MathCalculator</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">int</span> <span class="title">div</span><span class="params">(<span class="keyword">int</span> a, <span class="keyword">int</span> b)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> a / b;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>切面类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Aspect</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">LogAspects</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//公共方法</span></span><br><span class="line">    <span class="meta">@Pointcut(&quot;execution(public int com.wty.service.MathCalculator.*(..))&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">pointCut</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Before(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logStart</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        Object[] args = joinPoint.getArgs();</span><br><span class="line">        System.out.println(joinPoint.getSignature().getName() + <span class="string">&quot;开始...参数列表是&#123;&quot;</span> + Arrays.asList(args) + <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@After(&quot;pointCut()&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logEnd</span><span class="params">(JoinPoint joinPoint)</span> </span>&#123;</span><br><span class="line">        System.out.println(joinPoint.getSignature().getName() + <span class="string">&quot;结束...&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterReturning(value = &quot;pointCut()&quot;, returning = &quot;result&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logReturn</span><span class="params">(JoinPoint joinPoint, Object result)</span> </span>&#123;</span><br><span class="line">        System.out.println(joinPoint.getSignature().getName() + <span class="string">&quot;正常返回...运行结果&#123;&quot;</span> + result + <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@AfterThrowing(value = &quot;pointCut()&quot;, throwing = &quot;e&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">logException</span><span class="params">(JoinPoint joinPoint, Exception e)</span> </span>&#123;</span><br><span class="line">        System.out.println(joinPoint.getSignature().getName() + <span class="string">&quot;出现异常...异常信息&#123;&quot;</span> + e + <span class="string">&quot;&#125;&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>配置类</p>
<p>配置类需要开启注解<code>@EnableAspectJAutoProxy</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@EnableAspectJAutoProxy</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//业务类</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> MathCalculator <span class="title">mathCalculator</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> MathCalculator();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//切面类</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> LogAspects <span class="title">logAspects</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> LogAspects();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>测试类</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">AopTest</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        AnnotationConfigApplicationContext app = <span class="keyword">new</span> AnnotationConfigApplicationContext(AopConfig.class);</span><br><span class="line">        MathCalculator bean = (MathCalculator) app.getBean(<span class="string">&quot;mathCalculator&quot;</span>);</span><br><span class="line">        bean.div(<span class="number">10</span>,<span class="number">0</span>);</span><br><span class="line">        app.close();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="声明式事务"><a href="#声明式事务" class="headerlink" title="声明式事务"></a>声明式事务</h1><h2 id="代码-2"><a href="#代码-2" class="headerlink" title="代码"></a>代码</h2><ol>
<li>导入数据库包,spring-jdbc包,数据库连接池包</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--mysql--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.0.19<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--数据源--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>c3p0<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>0.9.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--spring-jdbc--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.3.25.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编写dao层<ul>
<li>TxDao把添加到容器中</li>
<li>使用<code>JdbcTemplate</code>模板</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Repository</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TxDao</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> JdbcTemplate jdbcTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        String sql = <span class="string">&quot;insert into books (book_name, book_counts, book_detail) VALUES (?,?,?)&quot;</span>;</span><br><span class="line">        jdbcTemplate.update(sql, <span class="string">&quot;哑舍2&quot;</span>, <span class="number">10</span>, <span class="string">&quot;古董小说1&quot;</span>);</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">10</span> / <span class="number">0</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>编写service层<ul>
<li>把<code>TxService</code>添加到容器中</li>
<li>在业务方法上添加<code> @Transactional</code>注解</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Service</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TxService</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired(required = false)</span></span><br><span class="line">    <span class="keyword">private</span> TxDao txDao;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Transactional</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">insert</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        txDao.insert();</span><br><span class="line">        System.out.println(<span class="string">&quot;事务执行完毕&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>配置类<ul>
<li>标注配置注解</li>
<li>配置包扫描</li>
<li>配置开启事务注解</li>
<li>配置数据源</li>
<li>配置JdbcTemplate模板</li>
<li>配置事务管理器</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="meta">@ComponentScan(&quot;com.wty.tx&quot;)</span></span><br><span class="line"><span class="meta">@EnableTransactionManagement</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TxConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 数据源</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     * <span class="doctag">@throws</span> PropertyVetoException</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> DataSource <span class="title">dataSource</span><span class="params">()</span> <span class="keyword">throws</span> PropertyVetoException </span>&#123;</span><br><span class="line">        ComboPooledDataSource dataSource = <span class="keyword">new</span> ComboPooledDataSource();</span><br><span class="line">        dataSource.setUser(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSource.setPassword(<span class="string">&quot;root&quot;</span>);</span><br><span class="line">        dataSource.setJdbcUrl(<span class="string">&quot;jdbc:mysql://localhost:3306/wty?serverTimezone=UTC&quot;</span>);</span><br><span class="line">        dataSource.setDriverClass(<span class="string">&quot;com.mysql.cj.jdbc.Driver&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> dataSource;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> JdbcTemplate <span class="title">jdbcTemplate</span><span class="params">()</span> <span class="keyword">throws</span> PropertyVetoException </span>&#123;</span><br><span class="line">        JdbcTemplate jdbcTemplate = <span class="keyword">new</span> JdbcTemplate(dataSource());</span><br><span class="line">        <span class="keyword">return</span> jdbcTemplate;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> PlatformTransactionManager <span class="title">platformTransactionManager</span><span class="params">()</span> <span class="keyword">throws</span> PropertyVetoException </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> DataSourceTransactionManager(dataSource());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="5">
<li>测试</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">AnnotationConfigApplicationContext app = <span class="keyword">new</span> AnnotationConfigApplicationContext(TxConfig.class);</span><br><span class="line">TxService bean = app.getBean(TxService.class);</span><br><span class="line">bean.insert();</span><br><span class="line">app.close();</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li><p>需要导入 数据库连接池  mysql驱动  spring-jdbc</p>
</li>
<li><p>业务类中,需要在方法上添加<code>@Transactional</code>注解,说明这个方法被事务管理了</p>
</li>
<li><p>配置类中</p>
<ul>
<li>配置包扫描,扫描dao以及service</li>
<li>开启事务—<code>@EnableTransactionManagement</code></li>
<li>配置数据源–<code>DataSource</code></li>
<li>配置jdbc模板–<code>JdbcTemplate</code></li>
<li>配置事务管理器–<code>PlatformTransactionManager</code></li>
</ul>
</li>
<li><p>其他的正常测试即可</p>
</li>
</ol>
]]></content>
      <categories>
        <category>spring框架</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>springMVC</title>
    <url>/2020/05/31/spring/springmvc/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><blockquote>
<p>• Spring 为展现层提供的基于 MVC 设计理念的优秀的Web 框架，是目前最主流的 MVC 框架之一<br>• Spring3.0 后全面超越 Struts2，成为最优秀的 MVC 框架<br>• Spring MVC 通过一套 MVC 注解，让 POJO 成为处理请求的控制器，而无须实现任何接口。<br>• 支持 REST 风格的 URL 请求<br>• 采用了松散耦合可插拔组件结构，比其他 MVC 框架更具扩展性和灵活性</p>
</blockquote>
<a id="more"></a>

<h1 id="web-xml"><a href="#web-xml" class="headerlink" title="web.xml"></a>web.xml</h1><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">web-app</span> <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xmlns</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://java.sun.com/xml/ns/javaee</span></span></span><br><span class="line"><span class="tag"><span class="string">                             http://java.sun.com/xml/ns/javaee/web-app_2_5.xsd&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">id</span>=<span class="string">&quot;WebApp_ID&quot;</span> <span class="attr">version</span>=<span class="string">&quot;2.5&quot;</span>&gt;</span></span><br><span class="line">         </span><br><span class="line">    <span class="comment">&lt;!--配置DispatcherServlet--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-class</span>&gt;</span>org.springframework.web.servlet.DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-class</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置springMvc配置文件的位置和名称--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>contextConfigLocation<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>classpath:springmvc.xml<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">load-on-startup</span>&gt;</span>1<span class="tag">&lt;/<span class="name">load-on-startup</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">servlet-name</span>&gt;</span>DispatcherServlet<span class="tag">&lt;/<span class="name">servlet-name</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--应答所有请求--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">servlet-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 字符编码过滤器，一定要放在所有过滤器之前 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>encoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>utf-8<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceRequestEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">init-param</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-name</span>&gt;</span>forceResponseEncoding<span class="tag">&lt;/<span class="name">param-name</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">param-value</span>&gt;</span>true<span class="tag">&lt;/<span class="name">param-value</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">init-param</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>CharacterEncodingFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--REST风格配置--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">web-app</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="springmvc-xml"><a href="#springmvc-xml" class="headerlink" title="springmvc.xml"></a>springmvc.xml</h1><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">beans</span> <span class="attr">xmlns</span>=<span class="string">&quot;http://www.springframework.org/schema/beans&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:xsi</span>=<span class="string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:context</span>=<span class="string">&quot;http://www.springframework.org/schema/context&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xmlns:mvc</span>=<span class="string">&quot;http://www.springframework.org/schema/mvc&quot;</span></span></span><br><span class="line"><span class="tag">       <span class="attr">xsi:schemaLocation</span>=<span class="string">&quot;http://www.springframework.org/schema/beans</span></span></span><br><span class="line"><span class="tag"><span class="string">        http://www.springframework.org/schema/beans/spring-beans.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/context/spring-context-4.0.xsd</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc</span></span></span><br><span class="line"><span class="tag"><span class="string">		http://www.springframework.org/schema/mvc/spring-mvc-4.0.xsd&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--SpringMVC的配置文件，包含网站跳转逻辑的控制，配置  --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.wty&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--视图解析器--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/page/&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--springmvc的两个标配--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">beans</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="常用注解"><a href="#常用注解" class="headerlink" title="常用注解"></a>常用注解</h1><h2 id="RequestMapping"><a href="#RequestMapping" class="headerlink" title="@RequestMapping"></a><strong>@RequestMapping</strong></h2><p>此注解可以添加在<code>类</code>或者<code>方法</code>上</p>
<blockquote>
<p>@RequestMapping(value = “/me”,method = RequestMethod.GET)</p>
<p>value            请求url</p>
<p>method           请求方式  <strong>GET or DELETE</strong></p>
<p>params            请求参数</p>
<p>head        请求头</p>
<p>headers           headers = {}</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">http://localhost:8080/h1name?name=aaa&amp;age=11    //可以进入</span><br></pre></td></tr></table></figure>

<h2 id="RequestBody"><a href="#RequestBody" class="headerlink" title="@RequestBody"></a><strong>@RequestBody</strong></h2><p><strong>映射请求体中的全部数据,get方法不适用</strong></p>
<ol>
<li>创建一个Post请求的表单</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/res&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    年龄：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;age&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    邮箱：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;email&quot;</span>&gt;</span><span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>获取请求体</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/res&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testMyView</span><span class="params">(<span class="meta">@RequestBody</span> String person)</span> </span>&#123;</span><br><span class="line">    System.out.println(person);</span><br><span class="line">    <span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="PathVariable"><a href="#PathVariable" class="headerlink" title="@PathVariable"></a><strong>@PathVariable</strong></h2><p>  <strong>映射url中的占位符</strong></p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;pathVariable/1&quot;</span>&gt;</span>test pathVariable<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(value = &quot;/pathVariable/&#123;id&#125;&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">pathVariable</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;请求到的id &quot;</span> + id);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="RequestParam"><a href="#RequestParam" class="headerlink" title="@RequestParam"></a><strong>@RequestParam</strong></h2><p><strong>获取请求参数</strong></p>
<blockquote>
<p>value   url地址中的参数 testRequestParam?username=ai&amp;age=11</p>
<p>required     该参数是否为必须</p>
<p>defaultValue   设置默认值</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/requestParam?name=ai&amp;age=11&quot;</span>&gt;</span>RequestParam<span class="tag">&lt;/<span class="name">a</span>&gt;</span> //age传参 是Integer类型,不是int类型</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/requestParam&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">RequestParam</span><span class="params">(<span class="meta">@RequestParam</span> String name,</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="meta">@RequestParam(required = false,defaultValue = &quot;7&quot; Integer age)</span> &#123;</span></span></span><br><span class="line"><span class="function"><span class="params">    System.out.println(<span class="string">&quot;user is &quot;</span> + name + <span class="string">&quot;,age is &quot;</span> + age)</span></span>;</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="RestFul"><a href="#RestFul" class="headerlink" title="RestFul"></a>RestFul</h1><h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><p><img data-src="/images/framework/springmvc-2.png"></p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">– /order/1	  GET ：查询 id = 1 的 order</span><br><span class="line">– /order/1	  DELETE：删除 id = 1的 order</span><br><span class="line">– /order/1    PUT：更新id = 1的 order</span><br><span class="line">– /order      POST：添加 order</span><br></pre></td></tr></table></figure>

<h2 id="web-xml-1"><a href="#web-xml-1" class="headerlink" title="web.xml"></a>web.xml</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--REST风格配置--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-class</span>&gt;</span>org.springframework.web.filter.HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-class</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">filter-mapping</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">filter-name</span>&gt;</span>HiddenHttpMethodFilter<span class="tag">&lt;/<span class="name">filter-name</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">url-pattern</span>&gt;</span>/*<span class="tag">&lt;/<span class="name">url-pattern</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">filter-mapping</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="实现方式"><a href="#实现方式" class="headerlink" title="实现方式"></a>实现方式</h2><ol>
<li><strong>发送请求</strong></li>
</ol>
<blockquote>
<p>delete和put都发送POST请求,在发送POST请求时，携带一个name=”_method”的隐藏域，值为DELETE或者PUT</p>
</blockquote>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/testRest/1&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Put&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;更新:Put&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/testRest/1&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;hidden&quot;</span> <span class="attr">name</span>=<span class="string">&quot;_method&quot;</span> <span class="attr">value</span>=<span class="string">&quot;Delete&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot; 删除: Delete&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/testRest/1&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;新增: Post&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">br</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;/testRest/1&quot;</span>&gt;</span>获取:Get<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li><strong>controller编写</strong></li>
</ol>
<blockquote>
<p>spring4.3版本以后出现了以下四个注解</p>
<p><code>@GetMapping</code><br><code>@PostMapping</code><br><code>@DeleteMapping</code><br><code>@PutMapping</code></p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RestFul</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> String SUCCESS = <span class="string">&quot;success&quot;</span>;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@GetMapping(&quot;/testRest/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">get</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;GET:&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PostMapping(&quot;/testRest/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">post</span><span class="params">()</span> </span>&#123;</span><br><span class="line">          <span class="keyword">return</span> SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@DeleteMapping(&quot;/testRest/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">delete</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;delete:&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@PutMapping(&quot;/testRest/&#123;id&#125;&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">put</span><span class="params">(<span class="meta">@PathVariable(&quot;id&quot;)</span> Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;put:&quot;</span> + id);</span><br><span class="line">        <span class="keyword">return</span> SUCCESS;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><strong>JSPs only permit GET POST or HEAD解决办法</strong></p>
<p>在返回页面(举例为success.jsp页面) 添加代码</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">page</span> <span class="attr">language</span>=<span class="string">&quot;java&quot;</span> <span class="attr">contentType</span>=<span class="string">&quot;text/html; charset=UTF-8&quot;</span></span></span><br><span class="line"><span class="tag">         <span class="attr">pageEncoding</span>=<span class="string">&quot;UTF-8&quot;</span> <span class="attr">isErrorPage</span>=<span class="string">&quot;true&quot;</span> %&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="处理模型数据"><a href="#处理模型数据" class="headerlink" title="处理模型数据"></a>处理模型数据</h1><p><img data-src="/images/framework/springmvc-2.png"></p>
<h2 id="ModelAndView"><a href="#ModelAndView" class="headerlink" title="ModelAndView"></a>ModelAndView</h2><blockquote>
<p><strong>注意: 返回类型和返回值都是 ModelAndView</strong>   </p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/testModelAndView&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ModelAndView <span class="title">testModelAndView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ModelAndView mav = <span class="keyword">new</span> ModelAndView(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    mav.addObject(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;zs&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> mav;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>取值</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">$&#123;requestScope.name&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">$&#123;name&#125; </span><br></pre></td></tr></table></figure>

<h2 id="Map-amp-Model"><a href="#Map-amp-Model" class="headerlink" title="Map  &amp;  Model"></a>Map  &amp;  Model</h2><blockquote>
<p>注意:方法参数必须有Map</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/map&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testmap</span><span class="params">(Map map)</span> </span>&#123;</span><br><span class="line">    map.put(<span class="string">&quot;jd&quot;</span>, <span class="string">&quot;jk&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="SessionAttributes"><a href="#SessionAttributes" class="headerlink" title="@SessionAttributes"></a>@SessionAttributes</h2><p><strong>类注解</strong></p>
<blockquote>
<p>说明:1.SessionAttributes添加在类注解上,value中的值在request和session中共存</p>
<p>value 可以传递多个值</p>
<p>types  可以传递多个类型   例子中name的值是String属性</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SessionAttributes(value = &#123;&quot;user1&quot;, &quot;user2&quot;,&quot;name&quot;&#125;, types = &#123;String.class&#125;)</span></span><br><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ModelDemo</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/map&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testmodel</span><span class="params">(Map map)</span> </span>&#123;</span><br><span class="line">        map.put(<span class="string">&quot;user1&quot;</span>, <span class="keyword">new</span> User(<span class="number">1</span>, <span class="string">&quot;小红&quot;</span>));</span><br><span class="line">        map.put(<span class="string">&quot;user2&quot;</span>, <span class="keyword">new</span> User(<span class="number">2</span>, <span class="string">&quot;小蓝&quot;</span>));</span><br><span class="line">        map.put(<span class="string">&quot;name&quot;</span>, <span class="keyword">new</span> User(<span class="number">3</span>, <span class="string">&quot;中国&quot;</span>));</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">user:$&#123;requestScope.user1&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line"></span><br><span class="line">$&#123;sessionScope.user1&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">$&#123;sessionScope.user2&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">$&#123;sessionScope.name&#125;<span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="ModelAttribute"><a href="#ModelAttribute" class="headerlink" title="@ModelAttribute"></a>@ModelAttribute</h2><blockquote>
<p> 被@ModelAttribute注释的方法会在此controller每个方法执行前被执行</p>
</blockquote>
<h1 id="自定义视图"><a href="#自定义视图" class="headerlink" title="自定义视图"></a>自定义视图</h1><h2 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h2><blockquote>
<p>什么时候用到自定义视图<br>通常我们所用到的视图就是jsp等网页，有些时候，我们会根据我们的需求自定义视图。比如我们要提交一个表单，然后把表单的内容导出为Excel，这时候我们就可以定义一个导出Excel的视图。<br>springmvc给我们提供了一些接口，包括导出Excel的接口：AbstractExcelView</p>
</blockquote>
<h2 id="实现"><a href="#实现" class="headerlink" title="实现"></a>实现</h2><ol>
<li>在springmvc.xml中配置</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--SpringMVC的配置文件，包含网站跳转逻辑的控制，配置  --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">context:component-scan</span> <span class="attr">base-package</span>=<span class="string">&quot;com.wty&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--springmvc的两个标配--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:annotation-driven</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">mvc:default-servlet-handler</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--视图解析器--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.InternalResourceViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;prefix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/WEB-INF/page/&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;suffix&quot;</span> <span class="attr">value</span>=<span class="string">&quot;.jsp&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="comment">&lt;!--配置BeanNameViewResolver视图解析器,用于解析自定义视图,</span></span><br><span class="line"><span class="comment">    使用order属性来确定视图解析器的优先级,值越小,优先级越高--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.web.servlet.view.BeanNameViewResolver&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;order&quot;</span> <span class="attr">value</span>=<span class="string">&quot;100&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编写实现类</li>
</ol>
<ul>
<li>实现<code>org.springframework.web.servlet.View</code>接口</li>
<li>添加<code>@Component</code>注解,表示被spring接管</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloView</span> <span class="keyword">implements</span> <span class="title">View</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">getContentType</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;text/html&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">render</span><span class="params">(Map&lt;String, ?&gt; map, HttpServletRequest httpServletRequest, HttpServletResponse httpServletResponse)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        httpServletResponse.setContentType(<span class="string">&quot;text/html;charset=utf-8&quot;</span>);</span><br><span class="line">        httpServletResponse.getWriter().write(<span class="string">&quot;本段文字输出到页面:&quot;</span> + <span class="keyword">new</span> Date());</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>控制层编写</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Controller</span></span><br><span class="line"><span class="meta">@RequestMapping(&quot;/springmvc&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HeloController</span> </span>&#123;</span><br><span class="line">    <span class="meta">@RequestMapping(&quot;/helloView&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">testMyView</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;helloView&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>url编写</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">a</span> <span class="attr">href</span>=<span class="string">&quot;springmvc/helloView&quot;</span>&gt;</span>TestHelloWorldView<span class="tag">&lt;/<span class="name">a</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="数据格式化"><a href="#数据格式化" class="headerlink" title="数据格式化"></a>数据格式化</h1><ol>
<li>javaBean</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@AllArgsConstructor</span></span><br><span class="line"><span class="meta">@NoArgsConstructor</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这就是格式化，当输入字符串为（yyyy-MM-dd）类型的时候就会自动转化为Date类型：</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@DateTimeFormat(pattern = &quot;yyyy-MM-dd&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> Date birthday;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 这个是通用式，无论多少数字都可以转为double类型</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@NumberFormat(pattern = &quot;#,###,###.##&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">double</span> money;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>表单</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">form</span> <span class="attr">action</span>=<span class="string">&quot;/register&quot;</span> <span class="attr">method</span>=<span class="string">&quot;post&quot;</span>&gt;</span></span><br><span class="line">    生日：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;birthday&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    工资：<span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;text&quot;</span> <span class="attr">name</span>=<span class="string">&quot;money&quot;</span>&gt;</span> <span class="tag">&lt;<span class="name">br</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">input</span> <span class="attr">type</span>=<span class="string">&quot;submit&quot;</span> <span class="attr">value</span>=<span class="string">&quot;提交&quot;</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">form</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>controller</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/person&quot;)</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> String <span class="title">testMyView</span><span class="params">(Person person, BindingResult result)</span> </span>&#123;</span><br><span class="line">       <span class="keyword">if</span> (result.getErrorCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">           System.out.println(<span class="string">&quot;出错了&quot;</span>);</span><br><span class="line">           <span class="keyword">for</span> (FieldError error : result.getFieldErrors()) &#123;</span><br><span class="line">               System.out.println(error);</span><br><span class="line">           &#125;</span><br><span class="line">           <span class="comment">//跳转到错误页面</span></span><br><span class="line">           <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">       &#125;</span><br><span class="line">       System.out.println(person);</span><br><span class="line">       <span class="keyword">return</span> <span class="string">&quot;success&quot;</span>;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h1 id="jsr303"><a href="#jsr303" class="headerlink" title="jsr303"></a>jsr303</h1><ol>
<li>maven</li>
</ol>
<blockquote>
<p>Tomcat7 以及以上,只需要导入一个包</p>
</blockquote>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;org.hibernate&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;hibernate-validator&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;6.0.17.Final&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>javaBean</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Past</span></span><br><span class="line"><span class="keyword">private</span> Date birthday;</span><br><span class="line"></span><br><span class="line"><span class="meta">@NotEmpty</span></span><br><span class="line"><span class="keyword">private</span> <span class="keyword">double</span> money;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>在目标方法添加@Valid</li>
</ol>
<blockquote>
<p>javaBean和BindingResult中间不能有任何东西</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RequestMapping(&quot;/reVal&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> String <span class="title">testMyView</span><span class="params">(Person person, BindingResult result)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (result.getErrorCount() &gt; <span class="number">0</span>) &#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;出错了&quot;</span>);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">for</span> (FieldError error : result.getFieldErrors()) &#123;</span><br><span class="line">            System.out.println(error.getField() + <span class="string">&quot;:&quot;</span> + error.getDefaultMessage());</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">//跳转到错误页面</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">&quot;error&quot;</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(person);</span><br><span class="line">    <span class="keyword">return</span> SUCCESS;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="spring的form标签"><a href="#spring的form标签" class="headerlink" title="spring的form标签"></a>spring的form标签</h1><ol>
<li>引入</li>
</ol>
<figure class="highlight jsp"><table><tr><td class="code"><pre><span class="line">&lt;%<span class="meta">@taglib</span> uri=<span class="string">&quot;http://www.springframework.org/tags/form&quot;</span> prefix=<span class="string">&quot;form&quot;</span> %&gt;  </span><br></pre></td></tr></table></figure>

<ol start="2">
<li><a href="http://c.biancheng.net/view/4420.html">文档</a></li>
</ol>
<h1 id="json"><a href="#json" class="headerlink" title="json"></a>json</h1><h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-core&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.8&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-annotations&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.8&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br><span class="line"></span><br><span class="line">&lt;!-- 返回json字符串的支持,只引入这个也可以 --&gt;</span><br><span class="line">&lt;dependency&gt;</span><br><span class="line">    &lt;groupId&gt;com.fasterxml.jackson.core&lt;&#x2F;groupId&gt;</span><br><span class="line">    &lt;artifactId&gt;jackson-databind&lt;&#x2F;artifactId&gt;</span><br><span class="line">    &lt;version&gt;2.9.8&lt;&#x2F;version&gt;</span><br><span class="line">&lt;&#x2F;dependency&gt;</span><br></pre></td></tr></table></figure>

<h2 id="注解"><a href="#注解" class="headerlink" title="注解"></a>注解</h2><p> @ResponseBody  :  注解在方法上</p>
<p>@JsonIgnore  :  javaBean属性添加此注解,就不会转为json</p>
<p>@JsonFormat(pattern = “yyyy-MM-dd”)  </p>
<h1 id="国际化"><a href="#国际化" class="headerlink" title="国际化"></a>国际化</h1><h2 id="观看视频"><a href="#观看视频" class="headerlink" title="观看视频"></a>观看视频</h2><p><a href="https://www.bilibili.com/video/av24883875?p=7">视频</a></p>
<blockquote>
<p>国际化命名规则:基名_国家_地区.properties</p>
<p>eg:</p>
<ul>
<li><p>i18n_en.properties：所有英文语言的资源</p>
</li>
<li><p>i18n_en_US.properties：美国地区，英文语言的资源</p>
</li>
<li><p>i18n_zh.properties：所有中文语言的资源</p>
</li>
<li><p>i18n_zh_CN.properties：中国大陆的，中文语言的资源</p>
</li>
<li><p>i18n_zh_HK.properties：中国香港，中文语言的资源</p>
</li>
</ul>
</blockquote>
<h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><ol>
<li>maven</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jstl<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>taglibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>standard<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>xml配置</li>
</ol>
<blockquote>
<ol>
<li><p>把id为<code>messageSource</code>的bean,添加到springmvc,<code>id=&quot;messageSource&quot; </code> 名称固定不可更改</p>
</li>
<li><p>把国际化资源文件,添加到messageSource中</p>
</li>
<li><p>basename的value取值可以是路径名:loginPage.i18n</p>
</li>
</ol>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">bean</span> <span class="attr">id</span>=<span class="string">&quot;messageSource&quot;</span> <span class="attr">class</span>=<span class="string">&quot;org.springframework.context.support.ResourceBundleMessageSource&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--basename:基名,会根据value的名字找到国际化资源文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;basename&quot;</span> <span class="attr">value</span>=<span class="string">&quot;i18n&quot;</span>/&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">bean</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>国际化编写</li>
</ol>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">i18n.username&#x3D; admin</span><br></pre></td></tr></table></figure>

<ol>
<li>页面写法</li>
</ol>
<ul>
<li>引入</li>
</ul>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">%@</span> <span class="attr">taglib</span> <span class="attr">uri</span>=<span class="string">&quot;http://java.sun.com/jsp/jstl/fmt&quot;</span> <span class="attr">prefix</span>=<span class="string">&quot;fmt&quot;</span> %&gt;</span></span><br></pre></td></tr></table></figure>

<ul>
<li>使用</li>
</ul>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">fmt:bundle</span> <span class="attr">basename</span>=<span class="string">&quot;i18n&quot;</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">fmt:message</span> <span class="attr">key</span>=<span class="string">&quot;i18n.username&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">fmt:message</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">fmt:bundle</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="文件上传"><a href="#文件上传" class="headerlink" title="文件上传"></a>文件上传</h1><h2 id="文档"><a href="#文档" class="headerlink" title="文档"></a>文档</h2><p><a href="http://c.biancheng.net/view/4473.html">文档说明</a></p>
<h1 id="拦截器"><a href="#拦截器" class="headerlink" title="拦截器"></a>拦截器</h1><h2 id="操作步骤"><a href="#操作步骤" class="headerlink" title="操作步骤"></a>操作步骤</h2><ol>
<li>实现<code>HandlerInterceptor</code>接口</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">MyInterceptor</span> <span class="keyword">implements</span> <span class="title">HandlerInterceptor</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">preHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">postHandle</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, ModelAndView modelAndView)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">afterCompletion</span><span class="params">(HttpServletRequest request, HttpServletResponse response, Object handler, Exception ex)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>在springmvc.xml中注册拦截器</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">mvc:interceptors</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--任何执行方法都会被拦截--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--&lt;bean class=&quot;com.wty.springmvc.interceptor.MyInterceptor&quot;/&gt;--&gt;</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">&lt;!--指定拦截方法--&gt;</span></span><br><span class="line">     <span class="tag">&lt;<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置拦截器作用的路径--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:mapping</span> <span class="attr">path</span>=<span class="string">&quot;/helloworld&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.handle.FirstHandle&quot;</span>/&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--配置拦器不作用的路径--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">mvc:exclude-mapping</span> <span class="attr">path</span>=<span class="string">&quot;/helloworld&quot;</span>/&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">bean</span> <span class="attr">class</span>=<span class="string">&quot;com.spring.handle.FirstHandle&quot;</span>/&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">mvc:interceptor</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">mvc:interceptors</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="执行顺序"><a href="#执行顺序" class="headerlink" title="执行顺序"></a>执行顺序</h2><blockquote>
<p>preHandle—–目标方法—.postHandle—-页面—-afterCompletion</p>
</blockquote>
<p>拦截器的preHandle是按照顺序执行的</p>
<p>拦截器的postHandle是按照逆序执行的</p>
<p>拦截器的afterCompletion是按照逆序执行的</p>
<h2 id="说明-2"><a href="#说明-2" class="headerlink" title="说明"></a>说明</h2><blockquote>
<ol>
<li><p>只要preHandle返回值是false,就没有后面的流程</p>
</li>
<li><p>任何一个环节出现了问题,afterCompletion总会执行</p>
</li>
</ol>
</blockquote>
<h2 id="多拦截器"><a href="#多拦截器" class="headerlink" title="多拦截器"></a>多拦截器</h2><blockquote>
<p>已经放行的拦截器,afterCompletion总会执行</p>
</blockquote>
<h1 id="执行流程"><a href="#执行流程" class="headerlink" title="执行流程"></a>执行流程</h1><p><img data-src="/images/framework/springmvc-3.png"></p>
<ol>
<li><p>用户发送请求至前端控制器DispatcherServlet</p>
</li>
<li><p>DispatcherServlet收到请求调用HandlerMapping处理器映射器。</p>
</li>
<li><p>处理器映射器找到具体的处理器，生成处理器对象及处理器拦截器(如果有则生成)一并返回给DispatcherServlet。</p>
</li>
<li><p>DispatcherServlet调用HandlerAdapter处理器适配器</p>
</li>
<li><p>HandlerAdapter经过适配调用具体的处理器(Controller，也叫后端控制器)。</p>
</li>
<li><p>Controller执行完成返回ModelAndView</p>
</li>
<li><p>HandlerAdapter将controller执行结果ModelAndView返回给DispatcherServlet</p>
</li>
<li><p>DispatcherServlet将ModelAndView传给ViewReslover视图解析器</p>
</li>
<li><p>ViewReslover解析后返回具体View</p>
</li>
<li><p>DispatcherServlet根据View进行渲染视图（即将模型数据填充至视图中）。</p>
</li>
<li><p>DispatcherServlet响应用户</p>
</li>
</ol>
]]></content>
      <categories>
        <category>spring框架</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>JUC</title>
    <url>/2021/03/03/java/juc/</url>
    <content><![CDATA[<h1 id="JUC"><a href="#JUC" class="headerlink" title="JUC"></a>JUC</h1><h2 id="简介"><a href="#简介" class="headerlink" title="简介"></a>简介</h2><p>JUC就是java.util .concurrent工具包的简称。这是一个处理线程的工具包，JDK 1.5开始出现的。</p>
<p>在jdk文档中,原文是这样的</p>
<table>
<thead>
<tr>
<th>java.util.concurrent</th>
<th>在并发编程中常用的实用类。</th>
</tr>
</thead>
<tbody><tr>
<td>java.util.concurrent.atomic</td>
<td>一个支持单变量无锁线程安全编程的类的小工具包。</td>
</tr>
<tr>
<td>java.util.concurrent.locks</td>
<td>接口和类提供了一个锁定和等待条件的框架，这种情况与内置的同步和监视器不同。</td>
</tr>
</tbody></table>
<a id="more"></a>

<h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p><a href="https://www.bilibili.com/video/BV1B7411L7tE?p=2&spm_id_from=pageDriver">狂神说</a></p>
<blockquote>
<p>java默认线程</p>
</blockquote>
<p>java默认有两个线程,一个是main线程,一个是GC线程</p>
<blockquote>
<p>java是否可以开启一个线程</p>
</blockquote>
<p>不能</p>
<p>最终调用的还是本地方法<code>private native void start0();</code>,然后调用底层的C语言</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> Thread().start();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">start</span><span class="params">()</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">if</span> (threadStatus != <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalThreadStateException();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//添加进线程组</span></span><br><span class="line">    group.add(<span class="keyword">this</span>);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">boolean</span> started = <span class="keyword">false</span>;</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="comment">//本地方法,调用底层的C语言</span></span><br><span class="line">        start0();</span><br><span class="line">        started = <span class="keyword">true</span>;</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (!started) &#123;</span><br><span class="line">                group.threadStartFailed(<span class="keyword">this</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Throwable ignore) &#123;</span><br><span class="line">            <span class="comment">/* do nothing. If start0 threw a Throwable then</span></span><br><span class="line"><span class="comment">                  it will be passed up the call stack */</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//本地方法</span></span><br><span class="line"><span class="function"><span class="keyword">private</span> <span class="keyword">native</span> <span class="keyword">void</span> <span class="title">start0</span><span class="params">()</span></span>;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>并发,并行</p>
</blockquote>
<p>并发编程:并发、并行</p>
<p>并发(多线程操作同一个资源)</p>
<ul>
<li>CPU一核,模拟出来多条线程,天下武功,唯快不破,快速交替</li>
<li>并发的本质,充分利用电脑上的CPU资源</li>
</ul>
<p>并行(多个人一起行走)</p>
<ul>
<li>CPU多核,多个线程可以同时执行;(线程池)</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//电脑上的处理器核数</span></span><br><span class="line">System.out.println(Runtime.getRuntime().availableProcessors());</span><br></pre></td></tr></table></figure>

<blockquote>
<p>线程的六种状态</p>
</blockquote>
<p>查看线程的源码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">enum</span> <span class="title">State</span> </span>&#123;</span><br><span class="line">    <span class="comment">//新生</span></span><br><span class="line">    <span class="keyword">new</span>,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//运行</span></span><br><span class="line">    runnable,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//阻塞</span></span><br><span class="line">    blocked,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//等待,死等</span></span><br><span class="line">    waiting,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//超时等待,过时不候</span></span><br><span class="line">    timed_waiting,</span><br><span class="line"></span><br><span class="line">    <span class="comment">//终止</span></span><br><span class="line">    terminated;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>wait 和 sleep区别</p>
</blockquote>
<ol>
<li>属于不同的类</li>
</ol>
<p>wait属于Object类</p>
<p>sleep属于Thread类,JUC休眠可以使用<code>TimeUnit.SECONDS.sleep(2);</code>,休息两秒</p>
<ol start="2">
<li>释放锁</li>
</ol>
<p>wait会释放锁,sleep抱着锁睡觉,不会释放</p>
<ol start="3">
<li>使用的地方不同</li>
</ol>
<p>wait必须在同步代码块中使用</p>
<p>sleep任何地方都可以使用</p>
<ol start="4">
<li>是否需要捕获异常</li>
</ol>
<p>两个都需要捕获异常</p>
<h1 id="lock锁"><a href="#lock锁" class="headerlink" title="lock锁"></a>lock锁</h1><h2 id="旧版的卖票问题"><a href="#旧版的卖票问题" class="headerlink" title="旧版的卖票问题"></a>旧版的卖票问题</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Ticket</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">50</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//卖票的方法</span></span><br><span class="line">    <span class="comment">//在上面添加同步</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span>  <span class="keyword">void</span> <span class="title">sell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (number &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            String name = Thread.currentThread().getName();</span><br><span class="line">            System.out.println(name + <span class="string">&quot;拿到了第&quot;</span> + (number--) + <span class="string">&quot;张票,还剩余&quot;</span> + number + <span class="string">&quot;张票&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//资源类</span></span><br><span class="line">        Ticket ticket = <span class="keyword">new</span> Ticket();</span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">60</span>;</span><br><span class="line">        <span class="comment">//并发</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a; i++) &#123;</span><br><span class="line">                ticket.sell();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a; i++) &#123;</span><br><span class="line">                ticket.sell();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a; i++) &#123;</span><br><span class="line">                ticket.sell();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="锁的概念"><a href="#锁的概念" class="headerlink" title="锁的概念"></a>锁的概念</h2><p><a href="https://tool.oschina.net/apidocs/apidoc?api=jdk-zh">在线jdk</a></p>
<p>在jdk文档中,这样解释锁</p>
<blockquote>
<p>Interface Lock</p>
<p>所有已知实现类： </p>
<p>ReentrantLock,ReentrantReadWriteLock.ReadLock,ReentrantReadWriteLock.WriteLock</p>
<p><code>Lock</code> 实现提供了比使用 <code>synchronized</code> 方法和语句可获得的更广泛的锁定操作。此实现允许更灵活的结构，可以具有差别很大的属性，可以支持多个相关的 <code>Condition</code>对象。</p>
</blockquote>
<p><code>ReentrantLock</code>默认是非公平锁,如果需要创建公平锁,传参<code>true</code>即可,eg:<code>Lock lock = new ReentrantLock(true);</code></p>
<p>语法格式是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//创建非公平锁</span></span><br><span class="line">Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line"><span class="comment">//加锁</span></span><br><span class="line">lock.lock();</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">    <span class="comment">//业务代码块</span></span><br><span class="line">&#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">    e.printStackTrace();</span><br><span class="line">&#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">    <span class="comment">//解锁</span></span><br><span class="line">    lock.unlock();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>对卖票问题,解决办法是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">TicketDemo2</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">100</span>;</span><br><span class="line"></span><br><span class="line">    Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//卖票的方法</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sell</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//加锁</span></span><br><span class="line">        lock.lock();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (number &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                String name = Thread.currentThread().getName();</span><br><span class="line">                System.out.println(name + <span class="string">&quot;拿到了第&quot;</span> + (number--) + <span class="string">&quot;张票,还剩余&quot;</span> + number + <span class="string">&quot;张票&quot;</span>);</span><br><span class="line">            &#125;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//解锁</span></span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//资源类</span></span><br><span class="line">        TicketDemo2 ticket = <span class="keyword">new</span> TicketDemo2();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">int</span> a = <span class="number">60</span>;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//并发</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a; i++) &#123;</span><br><span class="line">                ticket.sell();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a; i++) &#123;</span><br><span class="line">                ticket.sell();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; a; i++) &#123;</span><br><span class="line">                ticket.sell();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="和synchronized的区别"><a href="#和synchronized的区别" class="headerlink" title="和synchronized的区别"></a>和synchronized的区别</h2><ol>
<li><p>Synchronized 内置的ava关键字 ，Lock 是一个Java类;</p>
</li>
<li><p>Synchronized 无法判断获取锁的状态, Lock可以判断是否获取到了锁;</p>
</li>
<li><p>Synchronized 会自动释放锁, lock必须要手动释放锁!如果不释放锁,<strong>死锁</strong>;</p>
</li>
<li><p>Synchronized线程1 (获得锁,阻塞)、线程2(等待,傻傻的等) ; Lock锁就不一定会等待下去; </p>
</li>
<li><p>Synchronized 可重入锁 ,不可以中断的,非公平; Lock ,可重入锁，可以判断锁,非公平(可以自己设置) ;</p>
</li>
<li><p>Synchronized适用于少量代码,Lock适用于大量代码.</p>
</li>
</ol>
<h1 id="生产者消费者"><a href="#生产者消费者" class="headerlink" title="生产者消费者"></a>生产者消费者</h1><h2 id="传统版"><a href="#传统版" class="headerlink" title="传统版"></a>传统版</h2><blockquote>
<p>概述</p>
</blockquote>
<p>Java提供了几个方法解决线程之间的通信问题</p>
<p>wait() 表示线程一直等待,直到其他线程通知,与leep不同，会释放锁<br>wait(long timeout) 指定等待的毫秒数<br>notify() 唤醒一个处于等待状态的线程<br>notifyAll() 唤醒同-个对象上所有调用wait()方法的线程，优先级 别高的线程优先调度</p>
<p>注意:<strong>均是0bject类的方法,都只能在同步方法或者同步代码块中使用，否则会抛出异常legalMonitorStateException</strong></p>
<blockquote>
<p>说明</p>
</blockquote>
<p>传统的方式,主要是进行线程通信,用到了<code>synchronized</code>、<code>wait</code>、<code>notify</code>等方法</p>
<blockquote>
<p>代码演示</p>
</blockquote>
<p>注意:</p>
<p><strong>在对资源类进行操作时,要用<code>while</code>进行循环,不要用<code>if</code>判断,因为<code>if</code>只会进行一次判断,容易出现<code>虚假唤醒</code></strong></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Author</span> Wty</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Date</span>: 2021/3/4 10:01</span></span><br><span class="line"><span class="comment"> * <span class="doctag">@Description</span>: //TODO 生产者消费者问题</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProductCustomer</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//操作同一个资源类</span></span><br><span class="line">        Data data = <span class="keyword">new</span> Data();</span><br><span class="line">        <span class="comment">//ABCD四个方法,两个加,两个减</span></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                    data.increment();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                    data.Subtraction();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                    data.increment();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;c&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                    data.Subtraction();</span><br><span class="line">                &#125;</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;d&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//资源类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Data</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//+1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (number != <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//等待</span></span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        number++;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt;&quot;</span> + number);</span><br><span class="line">        <span class="comment">//通知其他线程,我+1完成了</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">Subtraction</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">        <span class="keyword">while</span> (number == <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//等待</span></span><br><span class="line">            <span class="keyword">this</span>.wait();</span><br><span class="line">        &#125;</span><br><span class="line">        number--;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt;&quot;</span> + number);</span><br><span class="line">        <span class="comment">//通知其他线程,我-1完成了</span></span><br><span class="line">        <span class="keyword">this</span>.notifyAll();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>运行结果</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">A==&gt;1</span><br><span class="line">B==&gt;0</span><br><span class="line">A==&gt;1</span><br><span class="line">B==&gt;0</span><br><span class="line">A==&gt;1</span><br><span class="line">B==&gt;0</span><br><span class="line">A==&gt;1</span><br><span class="line">B==&gt;0</span><br><span class="line">A==&gt;1</span><br><span class="line">B==&gt;0</span><br><span class="line">c==&gt;1</span><br><span class="line">B==&gt;0</span><br><span class="line">A==&gt;1</span><br><span class="line">B==&gt;0</span><br><span class="line">c==&gt;1</span><br><span class="line">B==&gt;0</span><br><span class="line">A==&gt;1</span><br><span class="line">B==&gt;0</span><br><span class="line">c==&gt;1</span><br><span class="line">d==&gt;0</span><br><span class="line">A==&gt;1</span><br><span class="line">B==&gt;0</span><br><span class="line">c==&gt;1</span><br><span class="line">d==&gt;0</span><br><span class="line">A==&gt;1</span><br><span class="line">d==&gt;0</span><br><span class="line">c==&gt;1</span><br><span class="line">d==&gt;0</span><br><span class="line">A==&gt;1</span><br><span class="line">d==&gt;0</span><br><span class="line">c==&gt;1</span><br><span class="line">d==&gt;0</span><br><span class="line">c==&gt;1</span><br><span class="line">d==&gt;0</span><br><span class="line">c==&gt;1</span><br><span class="line">d==&gt;0</span><br><span class="line">c==&gt;1</span><br><span class="line">d==&gt;0</span><br><span class="line">c==&gt;1</span><br><span class="line">d==&gt;0</span><br></pre></td></tr></table></figure>

<h2 id="Juc版"><a href="#Juc版" class="headerlink" title="Juc版"></a>Juc版</h2><p><a href="https://www.bilibili.com/video/BV1B7411L7tE?p=8&spm_id_from=pageDriver">狂神说</a></p>
<blockquote>
<p>说明</p>
</blockquote>
<p>传统方式使用<code>synchronized</code>、<code>wait</code>、<code>notify</code>方法</p>
<p>Juc使用<code>Lock</code>、<code>await</code>、<code>signal</code>方法,后面两个方法都是定义在<code>Condition</code>接口中的</p>
<p>关于<code>Condition</code>的解释,jdk文档中原文如下</p>
<blockquote>
<p>Condition因素的 Object监测方法（ wait， notify和 notifyAll）为不同的对象给在每个对象的多个等待集的影响，结合 Lock实现任意使用。<br><strong>在 Lock取代 synchronized方法和语句的使用，一个 Condition取代对象监视器的使用方法。</strong> </p>
</blockquote>
<p>关系如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line"><span class="comment">//创建condition</span></span><br><span class="line">Condition condition = lock.newCondition();</span><br><span class="line"><span class="comment">//等待</span></span><br><span class="line"><span class="comment">//   condition.await();</span></span><br><span class="line"><span class="comment">//唤醒</span></span><br><span class="line"><span class="comment">//    condition.signal();</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>jUC版生产消费</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ProDuctCus</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        <span class="comment">//操作同一个资源类</span></span><br><span class="line">        Data2 data2 = <span class="keyword">new</span> Data2();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                data2.increment();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                data2.Subtraction();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//资源类</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Data2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> number = <span class="number">0</span>;</span><br><span class="line">    Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    Condition condition = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//+1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">increment</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (number != <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//等待</span></span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            number++;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt;&quot;</span> + number);</span><br><span class="line">            <span class="comment">//通知其他线程,我+1完成了</span></span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//-1</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">Subtraction</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (number == <span class="number">0</span>) &#123;</span><br><span class="line">                <span class="comment">//等待</span></span><br><span class="line">                condition.await();</span><br><span class="line">            &#125;</span><br><span class="line">            number--;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt;&quot;</span> + number);</span><br><span class="line">            <span class="comment">//通知其他线程,我-1完成了</span></span><br><span class="line">            condition.signalAll();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="指定唤醒线程"><a href="#指定唤醒线程" class="headerlink" title="指定唤醒线程"></a>指定唤醒线程</h2><p>实现思路是 创建多个监视器<code>condition</code>,规定<code>condition1</code>监视<code>A</code>,在<code>A</code>里面唤醒<code>condition2</code>,然后<code>condition2</code>监视<code>B</code></p>
<p>代码如下</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">PF</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Pfg pfg = <span class="keyword">new</span> Pfg();</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                pfg.a();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                pfg.b();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">10</span>; i++) &#123;</span><br><span class="line">                pfg.c();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;C&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Pfg</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> num = <span class="number">1</span>;</span><br><span class="line">    <span class="comment">//创建三个监视器</span></span><br><span class="line">    Lock lock = <span class="keyword">new</span> ReentrantLock();</span><br><span class="line">    Condition ca = lock.newCondition();</span><br><span class="line">    Condition cb = lock.newCondition();</span><br><span class="line">    Condition cc = lock.newCondition();</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">a</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//如果num=1,就执行代码,不然就等待,唤醒b</span></span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (num != <span class="number">1</span>) &#123;</span><br><span class="line">                <span class="comment">//等待</span></span><br><span class="line">                ca.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;====AAAAA&quot;</span>);</span><br><span class="line">            <span class="comment">//唤醒b</span></span><br><span class="line">            num = <span class="number">2</span>;</span><br><span class="line">            cb.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//如果num=2,就执行代码,不然就等待,唤醒c</span></span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (num != <span class="number">2</span>) &#123;</span><br><span class="line">                <span class="comment">//等待</span></span><br><span class="line">                cb.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;====BBBBB&quot;</span>);</span><br><span class="line">            <span class="comment">//唤醒c</span></span><br><span class="line">            num = <span class="number">3</span>;</span><br><span class="line">            cc.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">c</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//如果num=3,就执行代码,不然就等待,唤醒a</span></span><br><span class="line">        lock.lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">while</span> (num != <span class="number">3</span>) &#123;</span><br><span class="line">                <span class="comment">//等待</span></span><br><span class="line">                cc.await();</span><br><span class="line">            &#125;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;====CCCCC&quot;</span>);</span><br><span class="line">            <span class="comment">//唤醒a</span></span><br><span class="line">            num = <span class="number">1</span>;</span><br><span class="line">            ca.signal();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            lock.unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="八锁现象"><a href="#八锁现象" class="headerlink" title="八锁现象"></a>八锁现象</h1><p><a href="https://www.bilibili.com/video/BV1B7411L7tE?p=10&spm_id_from=pageDriver">狂神说</a></p>
<h2 id="代码"><a href="#代码" class="headerlink" title="代码"></a>代码</h2><p>八锁指的是关于锁的八个问题</p>
<blockquote>
<ol>
<li>标准情况</li>
</ol>
</blockquote>
<p>标准情况下,是先发短信,后打电话,</p>
<p>原因是 两个线程共用一个对象phone,线程A先拿到了对象,并且用了<code>synchronized</code>方法,所以只能同时存在一个线程,优先级A大于B</p>
<p><code>synchorized</code>锁的对象是方法的调用者</p>
<p>代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Phone phone = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            phone.sendSms();</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="comment">//休息一秒</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            phone.call();</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSms</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;发短信&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;打电话&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="2">
<li>线程内部存在休眠</li>
</ol>
</blockquote>
<p>和情况一一样,先执行发短信,</p>
<blockquote>
<ol start="3">
<li>普通方法和线程方法</li>
</ol>
</blockquote>
<p>优先执行普通方法,因为普通方法没有锁,不需要等待</p>
<blockquote>
<ol start="4">
<li>两个对象,两把锁</li>
</ol>
</blockquote>
<p>互不干扰,两个锁可以同时执行,但是发短信刚开始就休眠了4秒,打电话没有休眠,所以打电话先执行</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Phone phone1 = <span class="keyword">new</span> Phone();</span><br><span class="line">        Phone phone2 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            phone1.sendSms();</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line">        <span class="comment">//休息一秒</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            phone2.call();</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSms</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//休息一秒</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;发短信&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;打电话&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span></span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;hello&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="5">
<li>静态同步方法</li>
</ol>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span>  <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSms</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="comment">//休息一秒</span></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">    &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125;</span><br><span class="line">    System.out.println(<span class="string">&quot;发短信&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>因为加了<code>static</code>关键字,所以会在类加载完毕后,就加载static方法,所以哪个方法添加了<code>static</code>哪个就先执行</p>
<p>statis锁的是类的反射class,一个类只有一个反射</p>
<blockquote>
<ol start="6">
<li>两个类,两个静态同步</li>
</ol>
</blockquote>
<p>先执行第一个实例化的类</p>
<p>因为添加了<code>static</code>,所以先加载类的class,第一个实例化类先拿到class,所以先执行</p>
<blockquote>
<ol start="7">
<li>一个对象,一个静态同步,一个普通同步</li>
</ol>
</blockquote>
<p>先执行打电话</p>
<p><code>static</code>锁的是class对象,普通同步锁的是类的调用者,二者没有关系,所以普通同步不用等<code>static</code>先执行完毕</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Phone phone1 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            phone1.sendSms();</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//休息一秒</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            phone1.call();</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSms</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//休息一秒</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;发短信&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;打电话&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<ol start="8">
<li>两个对象,一个静态同步,一个普通同步</li>
</ol>
</blockquote>
<p>先执行打电话</p>
<p>和7的运行原理一样</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Test1</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        Phone phone1 = <span class="keyword">new</span> Phone();</span><br><span class="line">        Phone phone2 = <span class="keyword">new</span> Phone();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            phone1.sendSms();</span><br><span class="line">        &#125;, <span class="string">&quot;A&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//休息一秒</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">1</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            phone2.call();</span><br><span class="line">        &#125;, <span class="string">&quot;B&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Phone</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">sendSms</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="comment">//休息一秒</span></span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">4</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        System.out.println(<span class="string">&quot;发短信&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span>  <span class="keyword">synchronized</span> <span class="keyword">void</span> <span class="title">call</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;打电话&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="小结"><a href="#小结" class="headerlink" title="小结"></a>小结</h2><p><code>new</code>和<code>this</code>指的是一个实例化对象</p>
<p><code>statis</code>指的是类的反射,也就是唯一的一个类模板class</p>
<p>某一个时刻内，只能有一个线程持有锁，无论几个方法。</p>
<h1 id="集合类不安全"><a href="#集合类不安全" class="headerlink" title="集合类不安全"></a>集合类不安全</h1><h2 id="List"><a href="#List" class="headerlink" title="List"></a>List</h2><p>list是单线程安全的,在并发下,容易报错<code>java.util.ConcurrentModificationException</code>,称为并发修改异常</p>
<p>以下代码是错误示例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    List&lt;String&gt; list = <span class="keyword">new</span> ArrayList&lt;&gt;();</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            list.add(UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">5</span>));</span><br><span class="line">            System.out.println(list);</span><br><span class="line">        &#125;, String.valueOf(i)).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决办法有以下几种</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Vector 在jdk1.0时代就出现了,ArrayList在jdk1.2的时候发布</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> Vector&lt;&gt;();</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* Collections作为集合类的工具类,也提供了安全的方法</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;String&gt; list = Collections.synchronizedList(<span class="keyword">new</span> ArrayList&lt;&gt;());</span><br><span class="line"></span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* JUC的方法,写入时复制,底层还是用了Lock锁</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">List&lt;String&gt; list = <span class="keyword">new</span> CopyOnWriteArrayList();</span><br></pre></td></tr></table></figure>

<h2 id="Set"><a href="#Set" class="headerlink" title="Set"></a>Set</h2><p>同样在并发情况下报错<code>java.util.ConcurrentModificationException</code>,称为并发修改异常</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Set&lt;String&gt; set = <span class="keyword">new</span> HashSet();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        set.add(UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">5</span>));</span><br><span class="line">        System.out.println(set);</span><br><span class="line">    &#125;, String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决办法是</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* 集合工具栏</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Set&lt;String&gt; set = Collections.synchronizedSet(<span class="keyword">new</span> HashSet&lt;&gt;());</span><br><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* JUC</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Set&lt;String&gt; set = <span class="keyword">new</span> CopyOnWriteArraySet();</span><br></pre></td></tr></table></figure>

<blockquote>
<p>扩展</p>
</blockquote>
<p><code>HashSet</code>的底层是<code>HashMap</code></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">HashSet</span><span class="params">()</span> </span>&#123;</span><br><span class="line">	map = <span class="keyword">new</span> HashMap&lt;&gt;();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>HashSet</code>的<code>add</code>方法的底层是<code>HashMap</code>的<code>key</code>,无法重复</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">add</span><span class="params">(E e)</span> </span>&#123;</span><br><span class="line">	<span class="keyword">return</span> map.put(e, PRESENT)==<span class="keyword">null</span>;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Map"><a href="#Map" class="headerlink" title="Map"></a>Map</h2><p>代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> HashMap();</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">20</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        map.put(Thread.currentThread().getName(), UUID.randomUUID().toString().substring(<span class="number">0</span>, <span class="number">5</span>));</span><br><span class="line">        System.out.println(map);</span><br><span class="line">    &#125;, String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>解决办法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment">* JUC</span></span><br><span class="line"><span class="comment">*/</span></span><br><span class="line">Map&lt;String, String&gt; map = <span class="keyword">new</span> ConcurrentHashMap&lt;&gt;();</span><br></pre></td></tr></table></figure>

<h1 id="Callable"><a href="#Callable" class="headerlink" title="Callable"></a>Callable</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><blockquote>
<p>public interface Callable<V></p>
<p>返回结果的一个任务，并可能抛出异常。用户定义一个不带参数调用 <code>call</code>的<code>Callable</code>接口类似于<code>Runnable</code>，，是专为其实例的类可能被另一个线程执行。然而，<code>Runnable</code>，不返回结果并不能抛出异常。</p>
</blockquote>
<ol>
<li>可以有返回值</li>
<li>可以抛出异常</li>
<li>方法和线程的不同,是call()</li>
</ol>
<p>代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">CallTest</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> ExecutionException, InterruptedException </span>&#123;</span><br><span class="line">        <span class="comment">/**</span></span><br><span class="line"><span class="comment">         * 不能在Thread中直接启动,所以需要用到一个适配类</span></span><br><span class="line"><span class="comment">         */</span></span><br><span class="line">        MyCall call = <span class="keyword">new</span> MyCall();</span><br><span class="line">        FutureTask task = <span class="keyword">new</span> FutureTask&lt;&gt;(call);</span><br><span class="line">        <span class="keyword">new</span> Thread(task).start();</span><br><span class="line"></span><br><span class="line">        <span class="comment">//获取返回值时,如果碰到了耗时操作,容易造成阻塞,所以一般在代码最后才获取返回值</span></span><br><span class="line">        Integer o = (Integer) task.get();</span><br><span class="line">        System.out.println(o);</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCall</span> <span class="keyword">implements</span> <span class="title">Callable</span>&lt;<span class="title">Integer</span>&gt; </span>&#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Integer <span class="title">call</span><span class="params">()</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;进入了方法&quot;</span>);</span><br><span class="line">        <span class="comment">//耗时操作......</span></span><br><span class="line">        <span class="keyword">return</span> <span class="number">1024</span>;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="三大辅助类"><a href="#三大辅助类" class="headerlink" title="三大辅助类"></a>三大辅助类</h1><p><a href="https://www.bilibili.com/video/BV1B7411L7tE?p=15">狂神说</a></p>
<h2 id="CountDownLatch-加法"><a href="#CountDownLatch-加法" class="headerlink" title="CountDownLatch 加法"></a>CountDownLatch 加法</h2><p>概述</p>
<blockquote>
<p>CountDownLatch能够使一个线程在等待另外一些线程完成各自工作之后，再继续执行。使用一个计数器进行实现。计数器初始值为线程的数量。当每一个线程完成自己任务后，计数器的值就会减一。当计数器的值为0时，表示所有的线程都已经完成一些任务，然后在CountDownLatch上等待的线程就可以恢复执行接下来的任务。</p>
</blockquote>
<p>代码演示</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">    * 模拟6个人都离开放假后才关门</span></span><br><span class="line"><span class="comment">    */</span></span><br><span class="line">    CountDownLatch count = <span class="keyword">new</span> CountDownLatch(<span class="number">6</span>);</span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">6</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;=&gt;go out&quot;</span>);</span><br><span class="line">        <span class="comment">//减操作</span></span><br><span class="line">        count.countDown();</span><br><span class="line">        &#125;, String.valueOf(i)).start();</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">//等待计数器归零</span></span><br><span class="line">    count.await();</span><br><span class="line">    System.out.println(<span class="string">&quot;关门&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>小结:</p>
<p>每次都有线程调用<code>countDown()</code>方法去减1,当值最终为0时,唤醒<code>await</code>继续执行余下的代码</p>
<h2 id="CyclicBarrier-减法"><a href="#CyclicBarrier-减法" class="headerlink" title="CyclicBarrier 减法"></a>CyclicBarrier 减法</h2><p>概述</p>
<blockquote>
<p>CyclicBarrier也叫同步屏障，在JDK1.5被引入，可以让一组线程达到一个屏障时被阻塞，直到最后一个线程达到屏障时，所以被阻塞的线程才能继续执行。<br> CyclicBarrier好比一扇门，默认情况下关闭状态，堵住了线程执行的道路，直到所有线程都就位，门才打开，让所有线程一起通过。</p>
</blockquote>
<p>代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">CyclicBarrier barrier = <span class="keyword">new</span> CyclicBarrier(<span class="number">7</span>, () -&gt; &#123;</span><br><span class="line">	System.out.println(<span class="string">&quot;集齐了七颗龙珠&quot;</span>);</span><br><span class="line">&#125;);</span><br><span class="line"></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">1</span>; i &lt;= <span class="number">7</span>; i++) &#123;</span><br><span class="line">        <span class="keyword">final</span> <span class="keyword">int</span> flag = i;</span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        System.out.println(Thread.currentThread().getName() + <span class="string">&quot;收集了&quot;</span> + flag + <span class="string">&quot;颗龙珠&quot;</span>);</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            barrier.await();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (BrokenBarrierException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125;</span><br><span class="line">        &#125;).start();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="Semaphore-信号量"><a href="#Semaphore-信号量" class="headerlink" title="Semaphore 信号量"></a>Semaphore 信号量</h2><p>概述</p>
<blockquote>
<p>Semaphore也叫<code>信号量</code>，在JDK1.5被引入，可以用来控制同时访问特定资源的线程数量，通过协调各个线程，以保证合理的使用资源。</p>
<p>Semaphore内部维护了一组虚拟的许可，许可的数量可以通过构造函数的参数指定。</p>
<ul>
<li>访问特定资源前，必须使用<code>acquire</code>方法获得许可，如果许可数量为0，该线程则一直阻塞，直到有可用许可。</li>
<li>访问资源后，使用<code>release</code>释放许可。</li>
</ul>
<p>Semaphore和ReentrantLock类似，获取许可有公平策略和非公平许可策略，默认情况下使用非公平策略。</p>
<p>作者：占小狼<br>链接：<a href="https://www.jianshu.com/p/0090341c6b80">https://www.jianshu.com/p/0090341c6b80</a></p>
</blockquote>
<p>代码演示</p>
<p>三个停车位,六辆车,只有等停车位上的车走了以后,才能放置新车</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Semaphore semaphore = <span class="keyword">new</span> Semaphore(<span class="number">3</span>);</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">6</span>; i++) &#123;</span><br><span class="line">    <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//获得</span></span><br><span class="line">            semaphore.acquire();</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;开进来了&quot;</span>);</span><br><span class="line">            <span class="comment">//休息一秒</span></span><br><span class="line">            TimeUnit.SECONDS.sleep(<span class="number">2</span>);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;开出去了&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            <span class="comment">//释放</span></span><br><span class="line">            semaphore.release();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;, String.valueOf(i)).start();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>acquire()</code>获取,如果获取量达到了指定的数量,就等待,一直等待到释放一些线程为止</p>
<p><code>release()</code>释放,会释放线程,然后唤醒等待的线程</p>
<p>作用:多个共享资源互斥的使用!并发限流,控制最大的线程数!</p>
<h1 id="读写锁"><a href="#读写锁" class="headerlink" title="读写锁"></a>读写锁</h1><p><a href="https://www.bilibili.com/video/BV1B7411L7tE?p=18">狂神说</a></p>
<p><a href="https://www.liaoxuefeng.com/wiki/1252599548343744/1306581002092578">廖雪峰</a></p>
<blockquote>
<p>概述</p>
</blockquote>
<p>使用<code>ReadWriteLock</code>可以保证：</p>
<ul>
<li>只允许一个线程写入（其他线程既不能写入也不能读取）；</li>
<li>没有写入时，多个线程允许同时读（提高性能）</li>
</ul>
<p>代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ReadWriteLockDemo</span> </span>&#123;</span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        MyCache2 cache = <span class="keyword">new</span> MyCache2();</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">        <span class="comment">//写入</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> temp = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                cache.put(String.valueOf(temp), temp);</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="comment">//读取</span></span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">5</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">final</span> <span class="keyword">int</span> temp = i;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                cache.get(String.valueOf(temp));</span><br><span class="line">            &#125;, String.valueOf(i)).start();</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//加锁</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">MyCache2</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">volatile</span> Map&lt;String, Object&gt; map = <span class="keyword">new</span> HashMap();</span><br><span class="line">    ReadWriteLock readWriteLock = <span class="keyword">new</span> ReentrantReadWriteLock();</span><br><span class="line"></span><br><span class="line">    <span class="comment">//写入</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">put</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        readWriteLock.writeLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;写入&quot;</span> + key);</span><br><span class="line">            map.put(key, value);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;写入完成&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            readWriteLock.writeLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">//读取</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        readWriteLock.readLock().lock();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;获取&quot;</span> + key);</span><br><span class="line">            Object o = map.get(key);</span><br><span class="line">            System.out.println(Thread.currentThread().getName() + <span class="string">&quot;获取完成&quot;</span>);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            readWriteLock.readLock().unlock();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>输出</p>
<p>保证输入的时候数据的完整性,读取的时候,不保证一致</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">0写入0</span><br><span class="line">0写入完成</span><br><span class="line">1写入1</span><br><span class="line">1写入完成</span><br><span class="line">2写入2</span><br><span class="line">2写入完成</span><br><span class="line">3写入3</span><br><span class="line">3写入完成</span><br><span class="line">4写入4</span><br><span class="line">4写入完成</span><br><span class="line">1获取1</span><br><span class="line">3获取3</span><br><span class="line">3获取完成</span><br><span class="line">1获取完成</span><br><span class="line">0获取0</span><br><span class="line">2获取2</span><br><span class="line">4获取4</span><br><span class="line">4获取完成</span><br><span class="line">2获取完成</span><br><span class="line">0获取完成</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小结</p>
</blockquote>
<p>使用<code>ReadWriteLock</code>可以提高读取效率：</p>
<ul>
<li><code>ReadWriteLock</code>只允许一个线程写入；</li>
<li><code>ReadWriteLock</code>允许多个线程在没有写入时同时读取；</li>
<li><code>ReadWriteLock</code>适合读多写少的场景。</li>
</ul>
<h1 id="阻塞队列-BlockingQueue"><a href="#阻塞队列-BlockingQueue" class="headerlink" title="阻塞队列 BlockingQueue"></a>阻塞队列 BlockingQueue</h1><p><a href="https://www.bilibili.com/video/BV1B7411L7tE?p=19&spm_id_from=pageDriver">狂神说</a></p>
<h2 id="简介-1"><a href="#简介-1" class="headerlink" title="简介"></a>简介</h2><p>双端队列,</p>
<blockquote>
<p>参数类型<br>E -元素举行此集合中的类型<br>All Superinterfaces:<br>    Collection ， Iterable ， Queue<br>All Known Subinterfaces:<br>    BlockingDeque ， TransferQueue<br>所有已知实现类：<br>ArrayBlockingQueue， DelayQueue， LinkedBlockingDeque， LinkedBlockingQueue， LinkedTransferQueue， PriorityBlockingQueue， SynchronousQueue </p>
</blockquote>
<h2 id="图示"><a href="#图示" class="headerlink" title="图示"></a>图示</h2><p><img data-src="/images/java/juc/Collection.svg"></p>
<h2 id="API"><a href="#API" class="headerlink" title="API"></a>API</h2><blockquote>
<p>四组API</p>
</blockquote>
<table>
<thead>
<tr>
<th>方式</th>
<th>抛出异常</th>
<th>有返回值</th>
<th>阻塞 等待</th>
<th>超时等待</th>
</tr>
</thead>
<tbody><tr>
<td>添加</td>
<td><strong>add</strong> (IllegalStateException: Queue full)</td>
<td><strong>offer</strong>(false)</td>
<td><strong>put</strong></td>
<td>offer(“b”, 3, TimeUnit.SECONDS)</td>
</tr>
<tr>
<td>移除</td>
<td><strong>remove</strong>(java.util.NoSuchElementException)</td>
<td><strong>poll</strong>(null)</td>
<td><strong>take</strong></td>
<td>poll(2, TimeUnit.SECONDS)</td>
</tr>
<tr>
<td>获取队首元素</td>
<td><strong>element</strong></td>
<td><strong>peek</strong></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<blockquote>
<p>部分代码演示</p>
</blockquote>
<p>阻塞等待的添加 put</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">//队列的大小为1</span></span><br><span class="line">    ArrayBlockingQueue queue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">    queue.put(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    <span class="comment">//队列没有空余的存储位置,此代码一直等待插入,程序一直运行,不会停止</span></span><br><span class="line">    queue.put(<span class="string">&quot;b&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>阻塞等待的移除 take</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">//队列的大小为1</span></span><br><span class="line">    ArrayBlockingQueue queue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">    queue.put(<span class="string">&quot;a&quot;</span>);</span><br><span class="line"></span><br><span class="line">    System.out.println(queue.take());</span><br><span class="line">    <span class="comment">//第二个值不存在,会一直不停地获取</span></span><br><span class="line">    System.out.println(queue.take());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>超时等待 添加</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">//队列的大小为1</span></span><br><span class="line">    ArrayBlockingQueue queue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">    System.out.println(queue.offer(<span class="string">&quot;a&quot;</span>));</span><br><span class="line">    <span class="comment">//不确定是否可以插入值时,设置一个超时时间,时间到了之后,会返回boolean类型</span></span><br><span class="line">    System.out.println(queue.offer(<span class="string">&quot;b&quot;</span>, <span class="number">3</span>, TimeUnit.SECONDS));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>超时等待 获取</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">b</span><span class="params">()</span> <span class="keyword">throws</span> InterruptedException </span>&#123;</span><br><span class="line">    <span class="comment">//队列的大小为1</span></span><br><span class="line">    ArrayBlockingQueue queue = <span class="keyword">new</span> ArrayBlockingQueue&lt;&gt;(<span class="number">1</span>);</span><br><span class="line">    <span class="comment">//存入</span></span><br><span class="line">    queue.offer(<span class="string">&quot;a&quot;</span>);</span><br><span class="line">    <span class="comment">//获取</span></span><br><span class="line">    System.out.println(queue.poll());</span><br><span class="line">    <span class="comment">//两秒过后还是获取不到值,就放弃,并返回null</span></span><br><span class="line">    System.out.println(queue.poll(<span class="number">2</span>, TimeUnit.SECONDS));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="同步队列-SynchronousQueue"><a href="#同步队列-SynchronousQueue" class="headerlink" title="同步队列  SynchronousQueue"></a>同步队列  SynchronousQueue</h1><h2 id="简介-2"><a href="#简介-2" class="headerlink" title="简介"></a>简介</h2><p><a href="https://www.bilibili.com/video/BV1B7411L7tE?p=21&spm_id_from=pageDriver">狂神说</a></p>
<p>没有容量,存入一个值,必须取出一个值,才可以继续存值</p>
<p>代码演示</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">        SynchronousQueue&lt;String&gt; queue = <span class="keyword">new</span> SynchronousQueue();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;===&gt;&quot;</span> + <span class="string">&quot;put1&quot;</span>);</span><br><span class="line">                queue.put(<span class="string">&quot;1&quot;</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;===&gt;&quot;</span> + <span class="string">&quot;put2&quot;</span>);</span><br><span class="line">                queue.put(<span class="string">&quot;2&quot;</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;===&gt;&quot;</span> + <span class="string">&quot;put3&quot;</span>);</span><br><span class="line">                queue.put(<span class="string">&quot;3&quot;</span>);</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;T1&quot;</span>).start();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt;取出&quot;</span> + queue.take());</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt;取出&quot;</span> + queue.take());</span><br><span class="line">                TimeUnit.SECONDS.sleep(<span class="number">3</span>);</span><br><span class="line">                System.out.println(Thread.currentThread().getName() + <span class="string">&quot;==&gt;取出&quot;</span> + queue.take());</span><br><span class="line">            &#125; <span class="keyword">catch</span> (InterruptedException e) &#123;</span><br><span class="line">                e.printStackTrace();</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;, <span class="string">&quot;T2&quot;</span>).start();</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<p>运行结果如下,说明确实是存一个取一个,发生了同步</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">T1===&gt;put1</span><br><span class="line">T2==&gt;取出1</span><br><span class="line">T1===&gt;put2</span><br><span class="line">T2==&gt;取出2</span><br><span class="line">T1===&gt;put3</span><br><span class="line">T2==&gt;取出3</span><br></pre></td></tr></table></figure>

<h1 id="线程池"><a href="#线程池" class="headerlink" title="线程池"></a>线程池</h1><h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p><a href="https://www.bilibili.com/video/BV1B7411L7tE?p=22&spm_id_from=pageDriver">狂神说</a></p>
<p>阿里巴巴开发手册中关于线程池的规范</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">8. 【强制】线程池不允许使用 Executors 去创建，而是通过 ThreadPoolExecutor 的方式，这样的处理方式让写的同学更加明确线程池的运行规则，规避资源耗尽的风险。</span><br><span class="line">说明：Executors 各个方法的弊端：</span><br><span class="line">1）newFixedThreadPool 和 newSingleThreadExecutor:</span><br><span class="line">主要问题是堆积的请求处理队列可能会耗费非常大的内存，容易,即OOM</span><br><span class="line">2）newCachedThreadPool 和 newScheduledThreadPool:</span><br><span class="line">主要问题是线程数最大数是 Integer.MAX_VALUE(最大值为21亿)，可能会创建数量非常多的线程，造成内存溢出,即OOM。</span><br><span class="line"></span><br><span class="line">9. 【强制】创建线程或线程池时请指定有意义的线程名称，方便出错时回溯。</span><br><span class="line">正例：</span><br><span class="line">public class TimerTaskThread extends Thread &#123;</span><br><span class="line">	public TimerTaskThread()&#123;</span><br><span class="line">	super.setName(&quot;TimerTaskThread&quot;); …</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>线程主要是有 <strong>三大方法</strong>,<strong>七大参数</strong>,<strong>四种拒绝策略</strong></p>
<h2 id="三大方法"><a href="#三大方法" class="headerlink" title="三大方法"></a><strong>三大方法</strong></h2><p>三大方法指的是创建线程池时对池子的默认大小做出了不同的限定,</p>
<p>三大方法的底层,还是使用了<code>ThreadPoolExecutor</code>的代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//只有一个线程在执行</span></span><br><span class="line">    ExecutorService service = Executors.newSingleThreadExecutor();</span><br><span class="line">    <span class="comment">//固定大小的五个线程池</span></span><br><span class="line">    ExecutorService service = Executors.newFixedThreadPool(<span class="number">5</span>);</span><br><span class="line">    <span class="comment">//动态的线程池大小,遇强则强,最多有30个线程池</span></span><br><span class="line">    ExecutorService service = Executors.newCachedThreadPool();</span><br><span class="line"></span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt; <span class="number">100</span>; i++) &#123;</span><br><span class="line">            <span class="keyword">new</span> Thread(() -&gt; &#123;</span><br><span class="line">                service.execute(() -&gt; &#123;</span><br><span class="line">                    System.out.println(Thread.currentThread().getName() + <span class="string">&quot;___OK&quot;</span>);</span><br><span class="line">                &#125;);</span><br><span class="line">            &#125;, <span class="string">&quot;T1&quot;</span>).start();</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//关闭线程池</span></span><br><span class="line">        service.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="七大参数"><a href="#七大参数" class="headerlink" title="七大参数"></a><strong>七大参数</strong></h2><p><a href="https://www.bilibili.com/video/BV1B7411L7tE?p=23">狂神说</a></p>
<blockquote>
<p>引出ThreadPoolExecutor</p>
</blockquote>
<p>最初的创建线程池的办法,内部调用的还是ThreadPoolExecutor,查看以下代码</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> ExecutorService <span class="title">newSingleThreadExecutor</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> FinalizableDelegatedExecutorService</span><br><span class="line">        (<span class="keyword">new</span> ThreadPoolExecutor(<span class="number">1</span>, <span class="number">1</span>,</span><br><span class="line">        			<span class="number">0L</span>, TimeUnit.MILLISECONDS,</span><br><span class="line">        				<span class="keyword">new</span> LinkedBlockingQueue&lt;Runnable&gt;()));</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p><code>new  ThreadPoolExecutor</code>的代码,有七大参数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="title">ThreadPoolExecutor</span><span class="params">(<span class="keyword">int</span> corePoolSize,//核心线程数</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">int</span> maximumPoolSize,//最大线程数</span></span></span><br><span class="line"><span class="function"><span class="params">                          <span class="keyword">long</span> keepAliveTime,//超时,没有人调用就释放</span></span></span><br><span class="line"><span class="function"><span class="params">                          TimeUnit unit,//超时的单位</span></span></span><br><span class="line"><span class="function"><span class="params">                          BlockingQueue&lt;Runnable&gt; workQueue,//阻塞队列</span></span></span><br><span class="line"><span class="function"><span class="params">                          ThreadFactory threadFactory,//线程工厂,创建线程,一般不用动</span></span></span><br><span class="line"><span class="function"><span class="params">                          RejectedExecutionHandler handler//拒绝策略)</span> </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (corePoolSize &lt; <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt;= <span class="number">0</span> ||</span><br><span class="line">        maximumPoolSize &lt; corePoolSize ||</span><br><span class="line">        keepAliveTime &lt; <span class="number">0</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> IllegalArgumentException();</span><br><span class="line">    <span class="keyword">if</span> (workQueue == <span class="keyword">null</span> || threadFactory == <span class="keyword">null</span> || handler == <span class="keyword">null</span>)</span><br><span class="line">        <span class="keyword">throw</span> <span class="keyword">new</span> NullPointerException();</span><br><span class="line">    <span class="keyword">this</span>.acc = System.getSecurityManager() == <span class="keyword">null</span> ?</span><br><span class="line">        <span class="keyword">null</span> :</span><br><span class="line">    AccessController.getContext();</span><br><span class="line">    <span class="keyword">this</span>.corePoolSize = corePoolSize;</span><br><span class="line">    <span class="keyword">this</span>.maximumPoolSize = maximumPoolSize;</span><br><span class="line">    <span class="keyword">this</span>.workQueue = workQueue;</span><br><span class="line">    <span class="keyword">this</span>.keepAliveTime = unit.toNanos(keepAliveTime);</span><br><span class="line">    <span class="keyword">this</span>.threadFactory = threadFactory;</span><br><span class="line">    <span class="keyword">this</span>.handler = handler;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>小例子: 模拟银行存款,只有两个核心窗口,最大可开五个窗口,当窗口人满时,用户可以去三个候客区等待,当候客区满时,就会执行拒绝策略,当用户减少时,超过了一个设定的时间,没有新用户继续前来,五个窗口就关闭三个,只留核心的两个窗口继续展开业务</p>
</blockquote>
<p>代码示例</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> <span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//创建线程池</span></span><br><span class="line">    ExecutorService executor = <span class="keyword">new</span> ThreadPoolExecutor(</span><br><span class="line">        <span class="number">2</span>,<span class="comment">//核心窗口</span></span><br><span class="line">        <span class="number">5</span>,<span class="comment">//最大窗口</span></span><br><span class="line">        <span class="number">3</span>,<span class="comment">//超时等待</span></span><br><span class="line">        TimeUnit.SECONDS,<span class="comment">//时间单位</span></span><br><span class="line">        <span class="keyword">new</span> LinkedBlockingDeque&lt;&gt;(<span class="number">3</span>),<span class="comment">//阻塞队列,即候客区</span></span><br><span class="line">        Executors.defaultThreadFactory(),<span class="comment">//创建工厂</span></span><br><span class="line">        <span class="keyword">new</span> ThreadPoolExecutor.AbortPolicy()<span class="comment">//拒绝策略</span></span><br><span class="line">    );</span><br><span class="line">    <span class="keyword">try</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">int</span> i = <span class="number">0</span>; i &lt;=<span class="number">8</span>; i++) &#123;</span><br><span class="line">            executor.execute(() -&gt; &#123;</span><br><span class="line">                System.out.println(Thread.currentThread().getName());</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">        e.printStackTrace();</span><br><span class="line">    &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">        <span class="comment">//关闭线程池</span></span><br><span class="line">        executor.shutdown();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>for循环中,循环的次数大小,取决于线程池最大数量和阻塞队列相加的和,当超过和,就触发拒绝策略</p>
<h2 id="四种拒绝策略"><a href="#四种拒绝策略" class="headerlink" title="四种拒绝策略"></a><strong>四种拒绝策略</strong></h2><p>创建拒绝策略</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">new</span> ThreadPoolExecutor.DiscardPolicy()</span><br></pre></td></tr></table></figure>

<p>讲解</p>
<p>只有<code>AbortPolicy</code>会抛出异常,其他三个不会</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">AbortPolicy 抛出拒绝执行异常:java.util.concurrent.RejectedExecutionException</span><br><span class="line">CallerRunsPolicy 队列满了,就交给main线程去执行</span><br><span class="line">DiscardOldestPolicy 队列满了,就丢掉任务,不会去执行,也不抛出异常</span><br><span class="line">DiscardPolicy 队列满了,就尝试和最初的核心线程池去竞争,看看最早的有没有执行完,如果执行完了,就插入,如果没有,就不执行</span><br></pre></td></tr></table></figure>

<h2 id="CPU密集和IO密集"><a href="#CPU密集和IO密集" class="headerlink" title="CPU密集和IO密集"></a>CPU密集和IO密集</h2><p>获取CPU的逻辑处理器的个数</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">int</span> processors = Runtime.getRuntime().availableProcessors();</span><br></pre></td></tr></table></figure>

<p>IO密集型:判断出代码中最占用IO的线程,IO常见的是<code>磁盘IO</code>和<code>网络IO</code></p>
<p><a href="https://cloud.tencent.com/developer/article/1633282">腾讯云  Java 线程池讲解——针对 IO 密集型任务</a></p>
<h1 id="四大函数式接口"><a href="#四大函数式接口" class="headerlink" title="四大函数式接口"></a>四大函数式接口</h1><p><a href="https://www.bilibili.com/video/BV1B7411L7tE?p=25&spm_id_from=pageDriver">狂神说</a></p>
<p>常见的lamdba表达式、链式编程、函数式接口、Stream流式计算都属于函数式接口</p>
<blockquote>
<p>function  一个输入参数，一个输出参数</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//正常版</span></span><br><span class="line">Function&lt;String, String&gt; function = <span class="keyword">new</span> Function&lt;String, String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> String <span class="title">apply</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">    	<span class="keyword">return</span> str;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="comment">//lambda版</span></span><br><span class="line">Function&lt;String, String&gt; function1=(str)-&gt;&#123; <span class="keyword">return</span> str;&#125;;</span><br><span class="line"></span><br><span class="line">System.out.println(function.apply(<span class="string">&quot;abc&quot;</span>));</span><br><span class="line">System.out.println(function1.apply(<span class="string">&quot;abc&quot;</span>));</span><br></pre></td></tr></table></figure>

<blockquote>
<p>断定型接口,输入一个Object类型的值,返回只能是一个布尔值</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Predicate predicate = <span class="keyword">new</span> Predicate&lt;String&gt;() &#123;</span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">test</span><span class="params">(String str)</span> </span>&#123;</span><br><span class="line">  	  <span class="keyword">return</span> str.isEmpty();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line">Predicate&lt;String&gt; predicate1 = (str1) -&gt; &#123;</span><br><span class="line">	<span class="keyword">return</span> str1.isEmpty();</span><br><span class="line">&#125;;</span><br><span class="line">System.out.println(predicate.test(<span class="string">&quot;abc&quot;</span>));</span><br><span class="line">System.out.println(predicate1.test(<span class="string">&quot;abc&quot;</span>));</span><br></pre></td></tr></table></figure>

<p><a href="https://www.bilibili.com/video/BV1B7411L7tE?p=26&spm_id_from=pageDriver">消费者和供给型接口</a></p>
]]></content>
      <categories>
        <category>java</category>
      </categories>
      <tags>
        <tag>java基础</tag>
        <tag>线程</tag>
        <tag>并发</tag>
      </tags>
  </entry>
  <entry>
    <title>linux入门</title>
    <url>/2020/06/13/linux/linux/</url>
    <content><![CDATA[<h1 id="目录"><a href="#目录" class="headerlink" title="目录"></a>目录</h1><p><a href="https://www.bilibili.com/video/BV187411y7hF?p=1">视频观看地址</a></p>
<p><a href="http://mp.weixin.qq.com/mp/homepage?__biz=Mzg2NTAzMTExNg==&hid=2&sn=1650b6338f6469ca519b080fdbbbd333&scene=18#wechat_redirect">文档地址</a></p>
<a id="more"></a>

<h2 id="根目录"><a href="#根目录" class="headerlink" title="根目录"></a>根目录</h2><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg2NTAzMTExNg==&mid=2247483879&idx=1&sn=96181b566c35679e48db6bd26fb59a2c&scene=19#wechat_redirect">狂神说微信公众号文档</a></p>
<p><a href="https://www.bilibili.com/video/BV187411y7hF?p=5">视频</a></p>
<blockquote>
<p>/bin：bin是Binary的缩写, 这个目录存放着最经常使用的命令,例如 ls,ping,cp等</p>
<p>/boot： 这里存放的是启动Linux时使用的一些核心文件，包括一些连接文件以及镜像文件。</p>
<p>/dev ： dev是Device(设备)的缩写, 存放的是Linux的外部设备，在Linux中访问设备的方式和访问文件的方式是相同的。</p>
<p><strong>/etc： 这个目录用来存放所有的系统管理所需要的配置文件和子目录,例如Redis tomcat的配置都可以放在这里</strong></p>
<p><strong>/home：用户的主目录，在Linux中，每个用户都有一个自己的目录，一般该目录名是以用户的账号命名的,类似于windows的<code>c:/user/用户名</code>目录</strong></p>
<p>/lib：这个目录里存放着系统最基本的动态连接共享库，其作用类似于Windows里的DLL文件。</p>
<p>/lost+found：这个目录一般情况下是空的，当系统非法关机后，这里就存放了一些文件。</p>
<p>/media：linux系统会自动识别一些设备，例如U盘、光驱等等，当识别后，linux会把识别的设备挂载到这个目录下。</p>
<p>/mnt：系统提供该目录是为了让用户临时挂载别的文件系统的，我们可以将光驱挂载在/mnt/上，然后进入该目录就可以查看光驱里的内容了。</p>
<p><strong>/opt：这是给主机额外安装软件所摆放的目录。比如你安装一个mysql数据库则就可以放到这个目录下。默认是空的。</strong></p>
<p>/proc：这个目录是一个虚拟的目录，它是系统内存的映射，我们可以通过直接访问这个目录来获取系统信息。</p>
<p><strong>/root：该目录为系统管理员，也称作超级权限者的用户主目录,文件内容隐藏,使用 -a命令可以查看</strong></p>
<p>/sbin：s就是Super User的意思，这里存放的是系统管理员使用的系统管理程序。</p>
<p>/srv：该目录存放一些服务启动之后需要提取的数据,即启动项文件。</p>
<p>/sys：这是linux2.6内核的一个很大的变化。该目录下安装了2.6内核中新出现的一个文件系统 sysfs</p>
<p><strong>/tmp：这个目录是用来存放一些临时文件的,比如安装包,用完即删.</strong></p>
<p><strong>/usr：这是一个非常重要的目录，用户的很多应用程序和文件都放在这个目录下，类似于windows下的program files目录。</strong></p>
<p>/usr/bin： 系统用户使用的应用程序。</p>
<p>/usr/sbin： 超级用户使用的比较高级的管理程序和系统守护程序。</p>
<p>/usr/src： 内核源代码默认的放置目录,类似于windows的<code>C:\Windows</code>目录。</p>
<p><strong>/var：这个目录中存放着在不断扩充着的东西，我们习惯将那些经常被修改的目录放在这个目录下。包括各种日志文件。</strong></p>
<p>/run：是一个临时文件系统，存储系统启动以来的信息。当系统重启时，这个目录下的文件应该被删掉或清除。</p>
</blockquote>
<h2 id="ls-列出目录"><a href="#ls-列出目录" class="headerlink" title="ls: 列出目录"></a>ls: 列出目录</h2><ul>
<li>-a：全部的文件，连同隐藏文件( 开头为 . 的文件) 一起列出来(常用)</li>
<li>-l ：长数据串列出，包含文件的属性与权限等等数据；(常用)</li>
<li>-al    将目录下的所有文件列出来(含属性与隐藏档)</li>
</ul>
<h2 id="cd：切换目录"><a href="#cd：切换目录" class="headerlink" title="cd：切换目录"></a>cd：切换目录</h2><blockquote>
<p>绝对路径和相对路径</p>
</blockquote>
<p><strong>绝对路径：</strong></p>
<p>路径的写法，由根目录 / 写起，例如：/usr/share/doc 这个目录。</p>
<p><strong>相对路径：</strong></p>
<p>路径的写法，不是由 / 写起，例如由 /usr/share/doc 要到 /usr/share/man 底下时，可以写成：cd ../man 这就是相对路径的写法啦！</p>
<p><code>cd ..</code> 退回到上一级</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cd [绝对路径或相对路径]</span><br></pre></td></tr></table></figure>

<h2 id="pwd：显示目前的目录"><a href="#pwd：显示目前的目录" class="headerlink" title="pwd：显示目前的目录"></a>pwd：显示目前的目录</h2><ul>
<li><p>pwd   显示路径</p>
</li>
<li><p><strong>-P</strong> ：显示出确实的路径，而非使用连接(link) 路径。</p>
</li>
</ul>
<h2 id="mkdir：创建一个新的目录"><a href="#mkdir：创建一个新的目录" class="headerlink" title="mkdir：创建一个新的目录"></a>mkdir：创建一个新的目录</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">mkdir [-mp] 目录名称</span><br></pre></td></tr></table></figure>

<ul>
<li>-m ：配置文件的权限喔！直接配置，不需要看默认权限 (umask) 的脸色～</li>
<li>-p ：帮助你直接将所需要的目录(包含上一级目录)递归创建起来！</li>
</ul>
<h2 id="rmdir：删除一个空的目录"><a href="#rmdir：删除一个空的目录" class="headerlink" title="rmdir：删除一个空的目录"></a>rmdir：删除一个空的目录</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rmdir [-p] 目录名称</span><br></pre></td></tr></table></figure>

<ul>
<li>-p :   连同上一级『空的』目录也一起删除</li>
</ul>
<h2 id="cp-复制文件或目录"><a href="#cp-复制文件或目录" class="headerlink" title="cp: 复制文件或目录"></a>cp: 复制文件或目录</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">cp [-adfilprsu] 来源档(source) 目标档(destination)</span><br><span class="line">cp [options] source1 source2 source3 .... directory</span><br></pre></td></tr></table></figure>

<ul>
<li><strong>-a：</strong>相当於 -pdr 的意思，至於 pdr 请参考下列说明；(常用)</li>
<li><strong>-p：</strong>连同文件的属性一起复制过去，而非使用默认属性(备份常用)；</li>
<li><strong>-d：</strong>若来源档为连结档的属性(link file)，则复制连结档属性而非文件本身；</li>
<li><strong>-r：</strong>递归持续复制，用於目录的复制行为；(常用)</li>
<li><strong>-f：</strong>为强制(force)的意思，若目标文件已经存在且无法开启，则移除后再尝试一次；</li>
<li><strong>-i：</strong>若目标档(destination)已经存在时，在覆盖时会先询问动作的进行(常用)</li>
<li><strong>-l：</strong>进行硬式连结(hard link)的连结档创建，而非复制文件本身。</li>
<li><strong>-s：</strong>复制成为符号连结档 (symbolic link)，亦即『捷径』文件；</li>
<li><strong>-u：</strong>若 destination 比 source 旧才升级 destination ！</li>
</ul>
<h2 id="rm-移除文件或目录"><a href="#rm-移除文件或目录" class="headerlink" title="rm: 移除文件或目录"></a>rm: 移除文件或目录</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">rm [-fir] 文件或目录</span><br><span class="line"></span><br><span class="line">rm -rf fileName  #删除文件</span><br></pre></td></tr></table></figure>

<ul>
<li>-f ：就是 force 的意思，忽略不存在的文件，不会出现警告信息；</li>
<li>-i ：互动模式，在删除前会询问使用者是否动作</li>
<li>-r ：递归删除啊！最常用在目录的删除了！这是非常危险的选项！！！</li>
</ul>
<h2 id="mv-移动或修改"><a href="#mv-移动或修改" class="headerlink" title="mv: 移动或修改"></a>mv: 移动或修改</h2><figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">[root@www ~]<span class="comment"># mv [-fiu] source destination</span></span><br><span class="line">[root@www ~]<span class="comment"># mv [options] source1 source2 source3 .... directory</span></span><br></pre></td></tr></table></figure>

<ul>
<li>-f ：force 强制的意思，如果目标文件已经存在，不会询问而直接覆盖；</li>
<li>-i ：若目标文件 (destination) 已经存在时，就会询问是否覆盖！</li>
<li>-u ：若目标文件已经存在，且 source 比较新，才会升级 (update)</li>
</ul>
<h1 id="文件属性"><a href="#文件属性" class="headerlink" title="文件属性"></a>文件属性</h1><h2 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h2><p>我们可以使用<code>ll</code>或者<code>ls –l</code>命令来显示一个文件的属性以及文件所属的用户和组，</p>
<p><img data-src="/images/linux/linux-1.png"></p>
<p>实例中，boot文件的第一个属性用”d”表示。”d”在Linux中代表该文件是一个目录文件。</p>
<p>在Linux中第一个字符代表这个文件是目录、文件或链接文件等等：</p>
<ul>
<li>当为[ <strong>d</strong> ]则是目录</li>
<li>当为[ <strong>-</strong> ]则是文件；</li>
<li>若是[ <strong>l</strong> ]则表示为链接文档 ( link file )；</li>
<li>若是[ <strong>b</strong> ]则表示为装置文件里面的可供储存的接口设备 ( 可随机存取装置 )；</li>
<li>若是[ <strong>c</strong> ]则表示为装置文件里面的串行端口设备，例如键盘、鼠标 ( 一次性读取装置 )。</li>
</ul>
<p>接下来的字符中，以三个为一组，且均为『rwx』 的三个参数的组合。</p>
<p>其中，[ r ]代表可读(read)、[ w ]代表可写(write)、[ x ]代表可执行(execute)。</p>
<p>要注意的是，这三个权限的位置不会改变，如果没有权限，就会出现减号[ - ]而已。</p>
<p>每个文件的属性由左边第一部分的10个字符来确定（如下图）：</p>
<p><img data-src="/images/linux/linux-2.png"></p>
<p>从左至右用0-9这些数字来表示。</p>
<p>第0位确定文件类型，第1-3位确定属主（该文件的所有者）拥有该文件的权限。第4-6位确定属组（所有者的同组用户）拥有该文件的权限，第7-9位确定其他用户拥有该文件的权限。</p>
<p>其中：</p>
<p>第1、4、7位表示读权限，如果用”r”字符表示，则有读权限，如果用”-“字符表示，则没有读权限；</p>
<p>第2、5、8位表示写权限，如果用”w”字符表示，则有写权限，如果用”-“字符表示没有写权限；</p>
<p>第3、6、9位表示可执行权限，如果用”x”字符表示，则有执行权限，如果用”-“字符表示，则没有执行权限。</p>
<p>对于文件来说，它都有一个特定的所有者，也就是对该文件具有所有权的用户。</p>
<p>同时，在Linux系统中，用户是按组分类的，一个用户属于一个或多个组。</p>
<p>文件所有者以外的用户又可以分为文件所有者的同组用户和其他用户。</p>
<p>因此，Linux系统按文件所有者、文件所有者同组用户和其他用户来规定了不同的文件访问权限。</p>
<p>在以上实例中，boot 文件是一个目录文件，属主和属组都为 root。</p>
<h2 id="修改文件属性"><a href="#修改文件属性" class="headerlink" title="修改文件属性"></a>修改文件属性</h2><h3 id="chgrp：更改文件属组"><a href="#chgrp：更改文件属组" class="headerlink" title="chgrp：更改文件属组"></a><strong>chgrp：更改文件属组</strong></h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chgrp [-R] 属组名 文件名</span><br></pre></td></tr></table></figure>

<p>-R：递归更改文件属组，就是在更改某个目录文件的属组时，如果加上-R的参数，那么该目录下的所有文件的属组都会更改。</p>
<h3 id="chown：更改文件属主，也可以同时更改文件属组"><a href="#chown：更改文件属主，也可以同时更改文件属组" class="headerlink" title="chown：更改文件属主，也可以同时更改文件属组"></a><strong>chown：更改文件属主，也可以同时更改文件属组</strong></h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chown [–R] 属主名 文件名</span><br><span class="line">chown [-R] 属主名：属组名 文件名</span><br></pre></td></tr></table></figure>

<h3 id="chmod：更改文件9个属性"><a href="#chmod：更改文件9个属性" class="headerlink" title="chmod：更改文件9个属性"></a><strong>chmod：更改文件9个属性</strong></h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod [-R] xyz 文件或目录</span><br></pre></td></tr></table></figure>

<p>Linux文件属性有两种设置方法，一种是数字，一种是符号。</p>
<p>Linux文件的基本权限就有九个，分别是owner/group/others三种身份各有自己的read/write/execute权限。</p>
<p>先复习一下刚刚上面提到的数据：文件的权限字符为：『-rwxrwxrwx』， 这九个权限是三个三个一组的！其中，我们可以使用数字来代表各个权限，各权限的分数对照表如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">r:4     w:2         x:1</span><br></pre></td></tr></table></figure>

<p>每种身份(owner/group/others)各自的三个权限(r/w/x)分数是需要累加的，例如当权限为：[-rwxrwx—] 分数则是：</p>
<ul>
<li>owner = rwx = 4+2+1 = 7</li>
<li>group = rwx = 4+2+1 = 7</li>
<li>others= — = 0+0+0 = 0</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">chmod 770 filename</span><br></pre></td></tr></table></figure>

<h1 id="文件内容查看"><a href="#文件内容查看" class="headerlink" title="文件内容查看"></a>文件内容查看</h1><h2 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h2><p>Linux系统中使用以下命令来查看文件的内容：</p>
<ul>
<li>cat 由第一行开始显示文件内容</li>
<li>tac 从最后一行开始显示，可以看出 tac 是 cat 的倒着写！</li>
<li>nl  显示的时候，顺道输出行号！</li>
<li>more 一页一页的显示文件内容</li>
<li>less 与 more 类似，但是比 more 更好的是，他可以往前翻页！</li>
<li>head 只看头几行</li>
<li>tail 只看尾巴几行</li>
</ul>
<p>你可以使用 *man [命令]*来查看各个命令的使用文档，如 ：man cp。</p>
<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><h3 id="cat-由第一行开始显示文件内容"><a href="#cat-由第一行开始显示文件内容" class="headerlink" title="cat 由第一行开始显示文件内容"></a>cat 由第一行开始显示文件内容</h3><ul>
<li>-A ：相当於 -vET 的整合选项，可列出一些特殊字符而不是空白而已；</li>
<li>-b ：列出行号，仅针对非空白行做行号显示，空白行不标行号！</li>
<li>-E ：将结尾的断行字节 $ 显示出来；</li>
<li>-n ：列印出行号，连同空白行也会有行号，与 -b 的选项不同；</li>
<li>-T ：将 [tab] 按键以 ^I 显示出来；</li>
<li>-v ：列出一些看不出来的特殊字符</li>
</ul>
<h3 id="tac-从最后一行开始显示"><a href="#tac-从最后一行开始显示" class="headerlink" title="tac 从最后一行开始显示"></a>tac 从最后一行开始显示</h3><h3 id="nl-显示的时候，顺道输出行号"><a href="#nl-显示的时候，顺道输出行号" class="headerlink" title="nl  显示的时候，顺道输出行号"></a>nl  显示的时候，顺道输出行号</h3><ul>
<li>-b ：指定行号指定的方式，主要有两种:  <ul>
<li>-b  a ：表示不论是否为空行，也同样列出行号(类似 cat -n)；</li>
<li>-b   t ：如果有空行，空的那一行不要列出行号(默认值)；</li>
</ul>
</li>
<li>-n ：列出行号表示的方法，主要有三种：<ul>
<li>-n ln ：行号在荧幕的最左方显示；</li>
<li>-n rn ：行号在自己栏位的最右方显示，且不加 0 ；</li>
<li>-n rz ：行号在自己栏位的最右方显示，且加 0 ；</li>
</ul>
</li>
</ul>
<ul>
<li>-w ：行号栏位的占用的位数。</li>
</ul>
<h3 id="more-一页一页的显示文件内容"><a href="#more-一页一页的显示文件内容" class="headerlink" title="more 一页一页的显示文件内容"></a>more 一页一页的显示文件内容</h3><ul>
<li>空白键 (space)：代表向下翻一页；</li>
<li>Enter   ：代表向下翻『一行』；</li>
<li>/字串   ：代表在这个显示的内容当中，向下搜寻『字串』这个关键字；</li>
<li>:f    ：立刻显示出档名以及目前显示的行数；</li>
<li>q    ：代表立刻离开 more ，不再显示该文件内容。</li>
<li>b 或 [ctrl]-b ：代表往回翻页，不过这动作只对文件有用，对管线无用。</li>
</ul>
<h3 id="less-与-more-类似，但是可以往前翻页"><a href="#less-与-more-类似，但是可以往前翻页" class="headerlink" title="less 与 more 类似，但是可以往前翻页"></a>less 与 more 类似，但是可以往前翻页</h3><ul>
<li>空白键  ：向下翻动一页；</li>
<li>[pagedown]：向下翻动一页；</li>
<li>[pageup] ：向上翻动一页；</li>
<li>/字串  ：向下搜寻『字串』的功能；</li>
<li>?字串  ：向上搜寻『字串』的功能；</li>
<li>n   ：重复前一个搜寻 (与 / 或 ? 有关！)</li>
<li>N   ：反向的重复前一个搜寻 (与 / 或 ? 有关！)</li>
<li>q   ：离开 less 这个程序；</li>
</ul>
<h3 id="head-只看头几行"><a href="#head-只看头几行" class="headerlink" title="head 只看头几行"></a>head 只看头几行</h3><ul>
<li>-n   后面接数字，代表显示几行的意思！</li>
</ul>
<p>默认的情况中，显示前面 10 行！若要显示前 20 行，就得要这样：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">head -n 20 /etc/csh.login</span><br></pre></td></tr></table></figure>

<h3 id="tail-只看尾巴几行"><a href="#tail-只看尾巴几行" class="headerlink" title="tail 只看尾巴几行"></a>tail 只看尾巴几行</h3><ul>
<li>-n ：后面接数字，代表显示几行的意思</li>
</ul>
<p>默认的情况中，显示最后 10 行！若要显示最后 20 行，就得要这样：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">tail -n 20 /etc/csh.login</span><br></pre></td></tr></table></figure>

<h1 id="软链接和硬链接"><a href="#软链接和硬链接" class="headerlink" title="软链接和硬链接"></a>软链接和硬链接</h1><h2 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h2><h3 id="硬连接-推荐"><a href="#硬连接-推荐" class="headerlink" title="硬连接(推荐)"></a><strong>硬连接(推荐)</strong></h3><p>硬连接指通过索引节点来进行连接。在 Linux 的文件系统中，保存在磁盘分区中的文件不管是什么类型都给它分配一个编号，称为索引节点号(Inode Index)。在 Linux 中，多个文件名指向同一索引节点是存在的。比如：A 是 B 的硬链接（A 和 B 都是文件名），则 A 的目录项中的 inode 节点号与 B 的目录项中的 inode 节点号相同，即一个 inode 节点对应两个不同的文件名，两个文件名指向同一个文件，A 和 B 对文件系统来说是完全平等的。删除其中任何一个都不会影响另外一个的访问。</p>
<p>硬连接的作用是允许一个文件拥有多个有效路径名，这样用户就可以建立硬连接到重要文件，以防止“误删”的功能。其原因如上所述，因为对应该目录的索引节点有一个以上的连接。只删除一个连接并不影响索引节点本身和其它的连接，只有当最后一个连接被删除后，文件的数据块及目录的连接才会被释放。也就是说，文件真正删除的条件是与之相关的所有硬连接文件均被删除。</p>
<h3 id="软连接"><a href="#软连接" class="headerlink" title="软连接"></a><strong>软连接</strong></h3><p>另外一种连接称之为符号连接（Symbolic Link），也叫软连接。软链接文件类似于 Windows 的快捷方式。它实际上是一个特殊的文件。在符号连接中，文件实际上是一个文本文件，其中包含的有另一文件的位置信息。比如：A 是 B 的软链接（A 和 B 都是文件名），A 的目录项中的 inode 节点号与 B 的目录项中的 inode 节点号不相同，A 和 B 指向的是两个不同的 inode，继而指向两块不同的数据块。但是 A 的数据块中存放的只是 B 的路径名（可以根据这个找到 B 的目录项）。A 和 B 之间是“主从”关系，如果 B 被删除了，A 仍然存在（因为两个是不同的文件），但指向的是一个无效的链接。</p>
<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">touch l1    #创建l1文件</span><br><span class="line">ln l1 l2    # 为l1创建硬链接l2</span><br><span class="line">ln -s l1 l3    # 为l1创建软链接l3</span><br><span class="line">echo &quot;love&quot; &gt;&gt; l1  #向l1中添加内容</span><br><span class="line"></span><br><span class="line">rm l1 #删除l1</span><br><span class="line">cat l2 #文件内容存在</span><br><span class="line">cat l3 #没有那个文件或目录</span><br><span class="line">同时删除l1 l2,文件会真正地被删除</span><br></pre></td></tr></table></figure>

<h1 id="Vim"><a href="#Vim" class="headerlink" title="Vim"></a>Vim</h1><p><a href="https://mp.weixin.qq.com/s?__biz=Mzg2NTAzMTExNg==&mid=2247483895&idx=1&sn=b685934ee0d08b9d01cc0c35ed7fed71&scene=19#wechat_redirect">文档地址</a></p>
<h2 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h2><blockquote>
<p>基本上 vi/vim 共分为三种模式，分别是<strong>命令模式（Command mode）</strong>，<strong>输入模式（Insert mode）</strong>和<strong>底线命令模式（Last line mode）</strong></p>
</blockquote>
<h3 id="命令模式（Command-mode）"><a href="#命令模式（Command-mode）" class="headerlink" title="命令模式（Command mode）"></a>命令模式（Command mode）</h3><p>用户刚刚启动 vi/vim，便进入了命令模式。</p>
<p>此状态下敲击键盘动作会被Vim识别为命令，而非输入字符。比如我们此时按下i，并不会输入一个字符，i被当作了一个命令。</p>
<p>以下是常用的几个命令：</p>
<ul>
<li><strong>i</strong> 切换到输入模式，以输入字符。</li>
<li><strong>x</strong> 删除当前光标所在处的字符。</li>
<li><strong>:</strong> 切换到底线命令模式，以在最底一行输入命令。</li>
</ul>
<p>若想要编辑文本：启动Vim，进入了命令模式，按下i，切换到输入模式。</p>
<p>命令模式只有一些最基本的命令，因此仍要依靠底线命令模式输入更多命令。</p>
<h3 id="输入模式（Insert-mode）"><a href="#输入模式（Insert-mode）" class="headerlink" title="输入模式（Insert mode）"></a>输入模式（Insert mode）</h3><p>在命令模式下按下i就进入了输入模式。</p>
<p>在输入模式中，可以使用以下按键：</p>
<ul>
<li><strong>字符按键以及Shift组合</strong>，输入字符</li>
<li><strong>ENTER</strong>，回车键，换行</li>
<li><strong>BACK SPACE</strong>，退格键，删除光标前一个字符</li>
<li><strong>DEL</strong>，删除键，删除光标后一个字符</li>
<li><strong>方向键</strong>，在文本中移动光标</li>
<li><strong>HOME</strong>/<strong>END</strong>，移动光标到行首/行尾</li>
<li><strong>Page Up</strong>/<strong>Page Down</strong>，上/下翻页</li>
<li><strong>Insert</strong>，切换光标为输入/替换模式，光标将变成竖线/下划线</li>
<li><strong>ESC</strong>，退出输入模式，切换到命令模式</li>
</ul>
<h3 id="底线命令模式（Last-line-mode）"><a href="#底线命令模式（Last-line-mode）" class="headerlink" title="底线命令模式（Last line mode）"></a>底线命令模式（Last line mode）</h3><p>在命令模式下按下:（英文冒号）就进入了底线命令模式。</p>
<p>底线命令模式可以输入单个或多个字符的命令，可用的命令非常多。</p>
<p>在底线命令模式中，基本的命令有（已经省略了冒号）：</p>
<ul>
<li>q 退出程序</li>
<li>w 保存文件</li>
</ul>
<p>按ESC键可随时退出底线命令模式。</p>
<h2 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h2><ol>
<li>进入命令模式,新建文件</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">vim wty.txt</span><br></pre></td></tr></table></figure>

<ol start="2">
<li><p>按下<code>i</code>进入编辑模式,然后在文件内输入内容</p>
</li>
<li><p>按下<code>esc</code>退出编辑模式</p>
</li>
<li><p>输入<code>:</code>,切换到底线命令模式，以在最底一行输入命令。wq的顺序不能写反,先保存,后退出</p>
</li>
</ol>
<ul>
<li>q 退出程序</li>
<li>w 保存文件</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">:wq</span><br></pre></td></tr></table></figure>

<h2 id="vim按键"><a href="#vim按键" class="headerlink" title="vim按键"></a>vim按键</h2><h3 id="一：一般模式可用的光标移动、复制粘贴、搜索替换等"><a href="#一：一般模式可用的光标移动、复制粘贴、搜索替换等" class="headerlink" title="一：一般模式可用的光标移动、复制粘贴、搜索替换等**"></a><strong>一：</strong>一般模式可用的光标移动、复制粘贴、搜索替换等**</h3><table>
<thead>
<tr>
<th align="left">移动光标的方法</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="left">h 或 向左箭头键(←)</td>
<td>光标向左移动一个字符</td>
</tr>
<tr>
<td align="left">j 或 向下箭头键(↓)</td>
<td>光标向下移动一个字符</td>
</tr>
<tr>
<td align="left">k 或 向上箭头键(↑)</td>
<td>光标向上移动一个字符</td>
</tr>
<tr>
<td align="left">l 或 向右箭头键(→)</td>
<td>光标向右移动一个字符</td>
</tr>
<tr>
<td align="left">[Ctrl] + [f]</td>
<td>屏幕『向下』移动一页，相当于 [Page Down]按键 (常用)</td>
</tr>
<tr>
<td align="left">[Ctrl] + [b]</td>
<td>屏幕『向上』移动一页，相当于 [Page Up] 按键 (常用)</td>
</tr>
<tr>
<td align="left">[Ctrl] + [d]</td>
<td>屏幕『向下』移动半页</td>
</tr>
<tr>
<td align="left">[Ctrl] + [u]</td>
<td>屏幕『向上』移动半页</td>
</tr>
<tr>
<td align="left">+</td>
<td>光标移动到非空格符的下一行</td>
</tr>
<tr>
<td align="left">-</td>
<td>光标移动到非空格符的上一行</td>
</tr>
<tr>
<td align="left">n&lt; space&gt;</td>
<td>那个 n 表示『数字』，例如 20 。按下数字后再按空格键，光标会向右移动这一行的 n 个字符。</td>
</tr>
<tr>
<td align="left">0 或功能键[Home]</td>
<td>这是数字『 0 』：移动到这一行的最前面字符处 (常用)</td>
</tr>
<tr>
<td align="left">$ 或功能键[End]</td>
<td>移动到这一行的最后面字符处(常用)</td>
</tr>
<tr>
<td align="left">H</td>
<td>光标移动到这个屏幕的最上方那一行的第一个字符</td>
</tr>
<tr>
<td align="left">M</td>
<td>光标移动到这个屏幕的中央那一行的第一个字符</td>
</tr>
<tr>
<td align="left">L</td>
<td>光标移动到这个屏幕的最下方那一行的第一个字符</td>
</tr>
<tr>
<td align="left">G</td>
<td>移动到这个档案的最后一行(常用)</td>
</tr>
<tr>
<td align="left">nG</td>
<td>n 为数字。移动到这个档案的第 n 行。例如 20G 则会移动到这个档案的第 20 行(可配合 :set nu)</td>
</tr>
<tr>
<td align="left">gg</td>
<td>移动到这个档案的第一行，相当于 1G 啊！(常用)</td>
</tr>
<tr>
<td align="left">n&lt; Enter&gt;</td>
<td>n 为数字。光标向下移动 n 行(常用)</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">搜索替换</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="left">/word</td>
<td>向光标之下寻找一个名称为 word 的字符串。例如要在档案内搜寻 vbird 这个字符串，就输入 /vbird 即可！(常用)</td>
</tr>
<tr>
<td align="left">?word</td>
<td>向光标之上寻找一个字符串名称为 word 的字符串。</td>
</tr>
<tr>
<td align="left">n</td>
<td>这个 n 是英文按键。代表重复前一个搜寻的动作。举例来说， 如果刚刚我们执行 /vbird 去向下搜寻 vbird 这个字符串，则按下 n 后，会向下继续搜寻下一个名称为 vbird 的字符串。如果是执行 ?vbird 的话，那么按下 n 则会向上继续搜寻名称为 vbird 的字符串！</td>
</tr>
<tr>
<td align="left">N</td>
<td>这个 N 是英文按键。与 n 刚好相反，为『反向』进行前一个搜寻动作。例如 /vbird 后，按下 N 则表示『向上』搜寻 vbird 。</td>
</tr>
</tbody></table>
<table>
<thead>
<tr>
<th align="left">删除、复制与粘贴</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="left">x, X</td>
<td>在一行字当中，x 为向后删除一个字符 (相当于 [del] 按键)， X 为向前删除一个字符(相当于 [backspace] 亦即是退格键) (常用)</td>
</tr>
<tr>
<td align="left">nx</td>
<td>n 为数字，连续向后删除 n 个字符。举例来说，我要连续删除 10 个字符， 『10x』。</td>
</tr>
<tr>
<td align="left">dd</td>
<td>删除游标所在的那一整行(常用)</td>
</tr>
<tr>
<td align="left">ndd</td>
<td>n 为数字。删除光标所在的向下 n 行，例如 20dd 则是删除 20 行 (常用)</td>
</tr>
<tr>
<td align="left">d1G</td>
<td>删除光标所在到第一行的所有数据</td>
</tr>
<tr>
<td align="left">dG</td>
<td>删除光标所在到最后一行的所有数据</td>
</tr>
<tr>
<td align="left">d$</td>
<td>删除游标所在处，到该行的最后一个字符</td>
</tr>
<tr>
<td align="left">d0</td>
<td>那个是数字的 0 ，删除游标所在处，到该行的最前面一个字符</td>
</tr>
<tr>
<td align="left">yy</td>
<td>复制游标所在的那一行(常用)</td>
</tr>
<tr>
<td align="left">nyy</td>
<td>n 为数字。复制光标所在的向下 n 行，例如 20yy 则是复制 20 行(常用)</td>
</tr>
<tr>
<td align="left">y1G</td>
<td>复制游标所在行到第一行的所有数据</td>
</tr>
<tr>
<td align="left">yG</td>
<td>复制游标所在行到最后一行的所有数据</td>
</tr>
<tr>
<td align="left">y0</td>
<td>复制光标所在的那个字符到该行行首的所有数据</td>
</tr>
<tr>
<td align="left">y$</td>
<td>复制光标所在的那个字符到该行行尾的所有数据</td>
</tr>
<tr>
<td align="left">p, P</td>
<td>p 为将已复制的数据在光标下一行贴上，P 则为贴在游标上一行！举例来说，我目前光标在第 20 行，且已经复制了 10 行数据。则按下 p 后， 那 10 行数据会贴在原本的 20 行之后，亦即由 21 行开始贴。但如果是按下 P 呢？那么原本的第 20 行会被推到变成 30 行。(常用)</td>
</tr>
<tr>
<td align="left">J</td>
<td>将光标所在行与下一行的数据结合成同一行</td>
</tr>
<tr>
<td align="left">c</td>
<td>重复删除多个数据，例如向下删除 10 行，[ 10cj ]</td>
</tr>
<tr>
<td align="left">u</td>
<td>复原前一个动作。(常用)</td>
</tr>
<tr>
<td align="left">[Ctrl]+r</td>
<td>重做上一个动作。(常用)</td>
</tr>
</tbody></table>
<h3 id="二：一般模式切换到编辑模式的可用的按钮说明"><a href="#二：一般模式切换到编辑模式的可用的按钮说明" class="headerlink" title="二：一般模式切换到编辑模式的可用的按钮说明"></a><strong>二：一般模式切换到编辑模式的可用的按钮说明</strong></h3><table>
<thead>
<tr>
<th align="left">进入输入或取代的编辑模式</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="left">i, I</td>
<td>进入输入模式(Insert mode)：i 为『从目前光标所在处输入』， I 为『在目前所在行的第一个非空格符处开始输入』。(常用)</td>
</tr>
<tr>
<td align="left">a, A</td>
<td>进入输入模式(Insert mode)：a 为『从目前光标所在的下一个字符处开始输入』， A 为『从光标所在行的最后一个字符处开始输入』。(常用)</td>
</tr>
<tr>
<td align="left">o, O</td>
<td>进入输入模式(Insert mode)：这是英文字母 o 的大小写。o 为『在目前光标所在的下一行处输入新的一行』；O 为在目前光标所在处的上一行输入新的一行！(常用)</td>
</tr>
<tr>
<td align="left">r, R</td>
<td>进入取代模式(Replace mode)：r 只会取代光标所在的那一个字符一次；R会一直取代光标所在的文字，直到按下 ESC 为止；(常用)</td>
</tr>
<tr>
<td align="left">[Esc]</td>
<td>退出编辑模式，回到一般模式中(常用)</td>
</tr>
</tbody></table>
<h3 id="第三部分：一般模式切换到指令行模式的可用的按钮说明"><a href="#第三部分：一般模式切换到指令行模式的可用的按钮说明" class="headerlink" title="第三部分：一般模式切换到指令行模式的可用的按钮说明"></a><strong>第三部分：一般模式切换到指令行模式的可用的按钮说明</strong></h3><table>
<thead>
<tr>
<th align="left">指令行的储存、离开等指令</th>
<th></th>
</tr>
</thead>
<tbody><tr>
<td align="left">:w</td>
<td>将编辑的数据写入硬盘档案中(常用)</td>
</tr>
<tr>
<td align="left">:w!</td>
<td>若文件属性为『只读』时，强制写入该档案。不过，到底能不能写入， 还是跟你对该档案的档案权限有关啊！</td>
</tr>
<tr>
<td align="left">:q</td>
<td>离开 vi (常用)</td>
</tr>
<tr>
<td align="left">:q!</td>
<td>若曾修改过档案，又不想储存，使用 ! 为强制离开不储存档案。</td>
</tr>
<tr>
<td align="left">注意一下啊，那个惊叹号 (!) 在 vi 当中，常常具有『强制』的意思～</td>
<td></td>
</tr>
<tr>
<td align="left">:wq</td>
<td>储存后离开，若为 :wq! 则为强制储存后离开 (常用)</td>
</tr>
<tr>
<td align="left">ZZ</td>
<td>这是大写的 Z 喔！若档案没有更动，则不储存离开，若档案已经被更动过，则储存后离开！</td>
</tr>
<tr>
<td align="left">:w [filename]</td>
<td>将编辑的数据储存成另一个档案（类似另存新档）</td>
</tr>
<tr>
<td align="left">:r [filename]</td>
<td>在编辑的数据中，读入另一个档案的数据。亦即将 『filename』 这个档案内容加到游标所在行后面</td>
</tr>
<tr>
<td align="left">:n1,n2 w [filename]</td>
<td>将 n1 到 n2 的内容储存成 filename 这个档案。</td>
</tr>
<tr>
<td align="left">:! command</td>
<td>暂时离开 vi 到指令行模式下执行 command 的显示结果！例如 『:! ls /home』即可在 vi 当中看 /home 底下以 ls 输出的档案信息！</td>
</tr>
<tr>
<td align="left">:set nu</td>
<td>显示行号，设定之后，会在每一行的前缀显示该行的行号</td>
</tr>
<tr>
<td align="left">:set nonu</td>
<td>与 set nu 相反，为取消行号！</td>
</tr>
</tbody></table>
<h1 id="账号管理"><a href="#账号管理" class="headerlink" title="账号管理"></a>账号管理</h1><h2 id="概述-4"><a href="#概述-4" class="headerlink" title="概述"></a>概述</h2><p>实现用户账号的管理，要完成的工作主要有如下几个方面：</p>
<ul>
<li>用户账号的添加、删除与修改。</li>
<li>用户口令的管理。</li>
<li>用户组的管理。</li>
</ul>
<h2 id="用户操作"><a href="#用户操作" class="headerlink" title="用户操作"></a>用户操作</h2><h3 id="添加"><a href="#添加" class="headerlink" title="添加"></a>添加</h3><blockquote>
<p>添加账号 useradd</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">useradd 选项 用户名</span><br></pre></td></tr></table></figure>

<p>选项 :</p>
<ul>
<li>-c comment 指定一段注释性描述。</li>
<li>-d 目录 指定用户主目录，如果此目录不存在，则同时使用-m选项，可以创建主目录。</li>
<li>-g 用户组 指定用户所属的用户组。</li>
<li>-G 用户组，用户组 指定用户所属的附加组。</li>
<li>-m　使用者目录如不存在则自动建立。</li>
<li>-s Shell文件 指定用户的登录Shell。</li>
<li>-u 用户号 指定用户的用户号，如果同时有-o选项，则可以重复使用其他用户的标识号。</li>
</ul>
<p>用户名 :</p>
<ul>
<li>指定新账号的登录名。</li>
<li>可以在<code>cat  /etc/passwd</code>文件中查看到用户信息,注意<code>passwd</code>的写法</li>
</ul>
<h3 id="删除"><a href="#删除" class="headerlink" title="删除"></a>删除</h3><blockquote>
<p>删除用户 userdel</p>
</blockquote>
<p>删除一个已有的用户账号使用userdel命令，其格式如下：</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">userdel 选项 用户名</span><br></pre></td></tr></table></figure>

<p>常用的选项是 <strong>-r</strong>，它的作用是把用户的主目录一起删除。</p>
<h3 id="修改"><a href="#修改" class="headerlink" title="修改"></a>修改</h3><blockquote>
<p>修改用户 usermod</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">usermod 选项 用户名</span><br></pre></td></tr></table></figure>

<p>选项 :</p>
<ul>
<li>-c comment 指定一段注释性描述。</li>
</ul>
<ul>
<li>-d 目录 指定用户主目录，如果此目录不存在，则同时使用-m选项，可以创建主目录。</li>
<li>-g 用户组 指定用户所属的用户组。</li>
<li>-G 用户组，用户组 指定用户所属的附加组。</li>
<li>-m　使用者目录如不存在则自动建立。</li>
<li>-s Shell文件 指定用户的登录Shell。</li>
<li>-u 用户号 指定用户的用户号，如果同时有-o选项，则可以重复使用其他用户的标识号。</li>
</ul>
<p>用户名 :</p>
<ul>
<li>指定新账号的登录名。</li>
</ul>
<h3 id="切换用户"><a href="#切换用户" class="headerlink" title="切换用户"></a>切换用户</h3><blockquote>
<p>用户结构</p>
</blockquote>
<p><img data-src="/images/linux/linux-3.png"></p>
<p><img data-src="/images/linux/linux-4.png"></p>
<p>在管理员权限下,切换用户</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">su 用户名 #切换用户</span><br><span class="line">exit  #退回到root账户</span><br></pre></td></tr></table></figure>

<blockquote>
<p>主机名称</p>
</blockquote>
<p>使用<code>hostname</code>查看主机名称</p>
<p>使用<code>hostname  新主机名</code>可以临时更改主机名字,重新连接,即可生效</p>
<h3 id="用户密码设置"><a href="#用户密码设置" class="headerlink" title="用户密码设置"></a>用户密码设置</h3><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">passwd 用户名  # 输入后,按下回车,就可以输入密码了,密码不显示</span><br></pre></td></tr></table></figure>

<blockquote>
<p>超级管理员对用户管理</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">passwd 选项 用户名</span><br></pre></td></tr></table></figure>

<p>可使用的选项：</p>
<ul>
<li>-l 锁定口令，即禁用账号。</li>
<li>-u 口令解锁。</li>
<li>-d 使账号无口令。</li>
<li>-f 强迫用户下次登录时修改口令。</li>
</ul>
<h1 id="用户组"><a href="#用户组" class="headerlink" title="用户组"></a>用户组</h1><h2 id="创建"><a href="#创建" class="headerlink" title="创建"></a>创建</h2><blockquote>
<p>创建 groupadd</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">groupadd 用户组组名   #创建一个组名</span><br><span class="line"></span><br><span class="line">groupadd -g id 用户组组名 #创建一个指定id的组</span><br><span class="line">groupadd -g 100  user  #创建了一个id为100的user用户组</span><br><span class="line"></span><br><span class="line">cat /etc/group  # 可以查看到用户的所属组,</span><br><span class="line">    eg: wty:x:1000:</span><br><span class="line">        admin:x:1001:</span><br><span class="line">        userW:x:1002:</span><br></pre></td></tr></table></figure>

<h2 id="删除-1"><a href="#删除-1" class="headerlink" title="删除"></a>删除</h2><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">groupdel 用户组</span><br></pre></td></tr></table></figure>

<h2 id="修改-1"><a href="#修改-1" class="headerlink" title="修改"></a>修改</h2><blockquote>
<p>groupmod -g 新id -n  新用户组  旧用户组</p>
</blockquote>
<ul>
<li>-g   后面跟一个数字id,表示重命名id</li>
<li>-n    后面跟一个新用户名称</li>
</ul>
<h2 id="切换用户组"><a href="#切换用户组" class="headerlink" title="切换用户组"></a>切换用户组</h2><p>普通用户切换用户组</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">$</span><span class="bash"> newgrp root</span></span><br></pre></td></tr></table></figure>

<h2 id="其他操作"><a href="#其他操作" class="headerlink" title="其他操作"></a>其他操作</h2><p><code>groups</code> 查看当前登录用户的组内成员<br><code>groups gliethttp</code>查看gliethttp用户所在的组,以及组内成员<br><code>whoami </code>查看当前登录用户名</p>
<h1 id="磁盘管理"><a href="#磁盘管理" class="headerlink" title="磁盘管理"></a>磁盘管理</h1><blockquote>
<p>df：列出文件系统的整体磁盘使用量</p>
<p>du：检查磁盘空间使用量</p>
</blockquote>
<h2 id="df"><a href="#df" class="headerlink" title="df"></a>df</h2><p>检查文件系统的磁盘空间占用情况。可以利用该命令来获取硬盘被占用了多少空间，目前还剩下多少空间等信息。</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">df [-ahikHTm] [目录或文件名]</span><br></pre></td></tr></table></figure>

<p><img data-src="/images/linux/linux-5.png"></p>
<p>参数:  </p>
<ul>
<li>-a ：列出所有的文件系统，包括系统特有的 /proc 等文件系统；</li>
<li>-k ：以 KBytes 的容量显示各文件系统；</li>
<li>-m ：以 MBytes 的容量显示各文件系统；</li>
<li>-h ：以人们较易阅读的 GBytes, MBytes, KBytes 等格式自行显示；</li>
<li>-H ：以 M=1000K 取代 M=1024K 的进位方式；</li>
<li>-T ：显示文件系统类型, 连同该 partition 的 filesystem 名称 (例如 ext3) 也列出；</li>
<li>-i ：不用硬盘容量，而以 inode 的数量来显示</li>
</ul>
<h2 id="du"><a href="#du" class="headerlink" title="du"></a>du</h2><p> du命令也是查看使用空间的，但是与df命令不同的是Linux du命令是对文件和目录磁盘使用的空间的查看，还是和df命令有一些区别的</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">du [-ahskm] 文件或目录名称</span><br></pre></td></tr></table></figure>

<p>选项与参数：</p>
<ul>
<li>-a ：列出所有的文件与目录容量，因为默认仅统计目录底下的文件量而已。</li>
<li>-h ：以人们较易读的容量格式 (G/M) 显示；</li>
<li>-s ：列出总量而已，而不列出每个各别的目录占用容量；</li>
<li>-S ：不包括子目录下的总计，与 -s 有点差别。</li>
<li>-k ：以 KBytes 列出容量显示；</li>
<li>-m ：以 MBytes 列出容量显示；</li>
</ul>
<h1 id="进程管理"><a href="#进程管理" class="headerlink" title="进程管理"></a>进程管理</h1><h2 id="查看进程"><a href="#查看进程" class="headerlink" title="查看进程"></a>查看进程</h2><blockquote>
<p>当前用户</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ps [-aux]| grep mysql </span><br></pre></td></tr></table></figure>

<ul>
<li>-a : 显示当前终端运行的进程信息</li>
<li>-u: 以用户的信息显示进程</li>
<li>-x:显示后台运行进程的参数</li>
<li>|:管道符,A|B表示,把A命令查询出的结果输出去操作B命令</li>
<li>grep:过滤,查找符合条件的字符</li>
</ul>
<blockquote>
<p>查看父进程</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">ps -ef|grep  mysql</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">通过进程树的形式查看</span></span><br><span class="line">pstree</span><br><span class="line">	-p 显示父ID</span><br><span class="line">	-u 显示当前用户组</span><br></pre></td></tr></table></figure>

<h2 id="结束进程"><a href="#结束进程" class="headerlink" title="结束进程"></a>结束进程</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">kill -9 进程ID         # kill -9 是固定写法</span><br></pre></td></tr></table></figure>

<p><img data-src="/images/linux/linux-6.png"></p>
<h1 id="软件安装"><a href="#软件安装" class="headerlink" title="软件安装"></a>软件安装</h1><h2 id="rpm安装jdk"><a href="#rpm安装jdk" class="headerlink" title="rpm安装jdk"></a>rpm安装jdk</h2><ol start="0">
<li><p>下载linux下rpm类型的jdk,地址是<a href="https://www.oracle.com/cn/java/technologies/javase/javase-jdk8-downloads.html">oracle中国</a></p>
</li>
<li><p>检测java环境是否安装  <code>java -version </code></p>
</li>
<li><p>如果有,需要卸载</p>
<ul>
<li><code> rpm -qa | grep  jdk</code>  过滤jdk版本</li>
<li><code>rpm -e --nodeps jdk版本号</code>  根据版本号卸载jdk</li>
</ul>
</li>
<li><p>安装jdk  <code>rpm -ivh 安装包名字</code></p>
</li>
<li><p>配置环境变量,路径是<code>/etc</code>下面的<code>profile</code>文件</p>
<ul>
<li>默认安装路径在<code>/usr/java</code>下面</li>
<li>在profile文件最后添加</li>
</ul>
<figure class="highlight cmd"><table><tr><td class="code"><pre><span class="line">export JAVA_HOME=/usr/java/jdk1.<span class="number">8</span>.<span class="number">0</span>_231-amd64</span><br><span class="line">export JRE_HOME=$&#123;JAVA_HOME&#125;/jre  </span><br><span class="line">export CLASSPATH=.:$&#123;JAVA_HOME&#125;/lib:$&#123;JRE_HOME&#125;/lib  </span><br><span class="line">export  <span class="built_in">PATH</span>=$&#123;JAVA_HOME&#125;/bin:$<span class="built_in">PATH</span></span><br></pre></td></tr></table></figure>

<ul>
<li>执行profile文件 <code>source /etc/profile</code></li>
</ul>
</li>
</ol>
<h2 id="解压缩tomcat"><a href="#解压缩tomcat" class="headerlink" title="解压缩tomcat"></a>解压缩tomcat</h2><ol>
<li>下载tomcat <a href="https://tomcat.apache.org/">地址</a></li>
<li>解压 <code>tar -axvf   apache-tomcat-8.5.56.tar.gz</code></li>
<li>在bin目录下,启动tomcat:<code>./startup.sh</code>,关闭:<code>./shutdown.sh</code></li>
<li>启动的时候,确保防火墙的8080端口是开着的</li>
</ol>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 查看firewall服务状态</span></span><br><span class="line">systemctl status firewalld</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开启、重启、关闭、firewalld.service服务</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开启</span></span><br><span class="line">service firewalld start</span><br><span class="line"><span class="meta">#</span><span class="bash"> 重启</span></span><br><span class="line">service firewalld restart</span><br><span class="line"><span class="meta">#</span><span class="bash"> 关闭</span></span><br><span class="line">service firewalld stop</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 查看防火墙规则</span></span><br><span class="line">firewall-cmd --list-all    # 查看全部信息</span><br><span class="line">firewall-cmd --list-ports  # 只看端口信息</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 开启端口</span></span><br><span class="line">开端口命令：firewall-cmd --zone=public --add-port=8080/tcp --permanent</span><br><span class="line"><span class="meta">#</span><span class="bash">移除端口</span></span><br><span class="line">开端口命令：firewall-cmd --zone=public --remove-port=8080/tcp --permanent</span><br><span class="line">重启防火墙：systemctl restart firewalld.service</span><br><span class="line"></span><br><span class="line">命令含义：</span><br><span class="line">--zone #作用域</span><br><span class="line">--add-port=80/tcp  #添加端口，格式为：端口/通讯协议</span><br><span class="line">--permanent   #永久生效，没有此参数重启后失效</span><br></pre></td></tr></table></figure>

<h2 id="yum安装docker"><a href="#yum安装docker" class="headerlink" title="yum安装docker"></a>yum安装docker</h2><p>详细见博客docker文章</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>linux</tag>
      </tags>
  </entry>
  <entry>
    <title>springboot</title>
    <url>/2020/06/09/spring/springboot/</url>
    <content><![CDATA[<h1 id="yaml"><a href="#yaml" class="headerlink" title="yaml"></a>yaml</h1><h2 id="语法"><a href="#语法" class="headerlink" title="语法"></a>语法</h2><figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">k: v：字面直接来写；</span><br><span class="line">字符串默认不用加上单引号或者双引号；</span><br><span class="line">&quot;&quot;：双引号；不会转义字符串里面的特殊字符；特殊字符会作为本身想表示的意思</span><br><span class="line">name: &quot;zhangsan \n lisi&quot;：输出；zhangsan 换行 lisi</span><br><span class="line">&#x27;&#x27;：单引号；会转义特殊字符，特殊字符最终只是一个普通的字符串数据</span><br><span class="line">name: ‘zhangsan \n lisi’：输出；zhangsan \n lisi</span><br></pre></td></tr></table></figure>

<a id="more"></a>

<h2 id="对象"><a href="#对象" class="headerlink" title="对象"></a>对象</h2><ol>
<li>常规写法</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">person:</span> </span><br><span class="line">    <span class="attr">name:</span> <span class="string">张三</span></span><br><span class="line">    <span class="attr">age:</span> <span class="number">49</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>行内写法</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">person:</span> &#123;<span class="attr">name:</span> <span class="string">张三</span>,<span class="attr">age:</span> <span class="number">49</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="list"><a href="#list" class="headerlink" title="list"></a>list</h2><ol>
<li>常规写法</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">person:</span> </span><br><span class="line">    <span class="bullet">-</span> <span class="string">张三</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">lisi</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>行内写法</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">person:</span> [<span class="string">张三</span>,<span class="string">lisi</span>]</span><br></pre></td></tr></table></figure>

<h2 id="map"><a href="#map" class="headerlink" title="map"></a>map</h2><ol>
<li>常规写法</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">map:</span></span><br><span class="line">    <span class="attr">k1:</span> <span class="string">k1</span></span><br><span class="line">    <span class="attr">k2:</span> <span class="string">k2</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>行内写法</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">map:</span> &#123;<span class="attr">k1:</span> <span class="string">k1</span>,<span class="attr">k2:</span> <span class="string">k2</span>&#125;</span><br></pre></td></tr></table></figure>

<h2 id="yaml示例"><a href="#yaml示例" class="headerlink" title="yaml示例"></a>yaml示例</h2><p>maven</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-configuration-processor<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.projectlombok<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>lombok<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="javaBean"><a href="#javaBean" class="headerlink" title="javaBean"></a>javaBean</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="appllication-yaml"><a href="#appllication-yaml" class="headerlink" title="appllication.yaml"></a>appllication.yaml</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">person:</span></span><br><span class="line">  <span class="attr">name:</span> <span class="string">xiaomi</span></span><br><span class="line">  <span class="attr">age:</span> <span class="number">59</span></span><br></pre></td></tr></table></figure>

<h3 id="test"><a href="#test" class="headerlink" title="test"></a>test</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Springboot02ApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> Person person;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(person);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="value"><a href="#value" class="headerlink" title="@value"></a>@value</h2><p>@value适合单个属性的取值和赋值</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Value( &quot;张三&quot;)</span></span><br><span class="line"><span class="meta">@Value(  &quot;$&#123;person.name&#125;&quot;  )</span></span><br><span class="line"><span class="meta">@Value(  &quot;#&#123; 11 * 2&#125;&quot;  )</span></span><br></pre></td></tr></table></figure>

<h2 id="JSR303"><a href="#JSR303" class="headerlink" title="JSR303"></a>JSR303</h2><h3 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.hibernate<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>hibernate-validator<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.0.17.Final<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="javaBean-1"><a href="#javaBean-1" class="headerlink" title="javaBean"></a>javaBean</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="meta">@Data</span></span><br><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;person&quot;)</span></span><br><span class="line"><span class="meta">@Validated</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">Person</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Email</span></span><br><span class="line">    <span class="keyword">private</span> String name;</span><br><span class="line">    <span class="keyword">private</span> Integer age;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="Profile及配置文件"><a href="#Profile及配置文件" class="headerlink" title="Profile及配置文件"></a>Profile及配置文件</h1><h2 id="profile"><a href="#profile" class="headerlink" title="profile"></a>profile</h2><h3 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h3><blockquote>
<p>Profile是为了方便不同环境进行测试的</p>
<p>开发环境,</p>
<p>测试环境,</p>
<p>运维环境</p>
</blockquote>
<h3 id="yaml-1"><a href="#yaml-1" class="headerlink" title="yaml"></a>yaml</h3><p>使用<code>---</code>分割多个环境</p>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8080</span>  <span class="comment">#默认环境</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">pro</span>  <span class="comment">#已激活环境,</span></span><br><span class="line"><span class="string">---</span>  <span class="comment">#多个环境,分割</span></span><br><span class="line"></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8081</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">dev</span>  <span class="comment">#开发环境</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">server:</span></span><br><span class="line">  <span class="attr">port:</span> <span class="number">8082</span></span><br><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span> <span class="string">pro</span> <span class="comment"># 测试环境</span></span><br></pre></td></tr></table></figure>

<h3 id="激活指定环境"><a href="#激活指定环境" class="headerlink" title="激活指定环境"></a>激活指定环境</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">profiles:</span></span><br><span class="line">    <span class="attr">active:</span> <span class="string">pro</span>  <span class="comment">#已激活环境,</span></span><br></pre></td></tr></table></figure>

<h2 id="配置文件加载顺序"><a href="#配置文件加载顺序" class="headerlink" title="配置文件加载顺序"></a>配置文件加载顺序</h2><blockquote>
<p>优先级从高到低</p>
<p>所有位置都加载</p>
<p>高优先级覆盖低优先级</p>
</blockquote>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">-file:./config</span><br><span class="line">-file:./</span><br><span class="line">-classpath:/config/</span><br><span class="line">-classpath:/</span><br></pre></td></tr></table></figure>

<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1）properties文件；</span><br><span class="line">2）YAML文件；</span><br><span class="line">3）系统环境变量；</span><br><span class="line">4）命令行参数；</span><br><span class="line">等等……</span><br></pre></td></tr></table></figure>

<h1 id="配置类"><a href="#配置类" class="headerlink" title="配置类"></a>配置类</h1><h2 id="说明-1"><a href="#说明-1" class="headerlink" title="说明"></a>说明</h2><blockquote>
<p><strong>@Configuration</strong>  指定该类是配置类</p>
<p><strong>@Bean</strong>   将方法的返回值添加到容器中；容器中这个组件默认的id就是方法名</p>
</blockquote>
<h2 id="举例"><a href="#举例" class="headerlink" title="举例"></a>举例</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ConfigService</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Bean</span></span><br><span class="line">    <span class="comment">//将方法的返回值添加到容器中；容器中这个组件默认的id就是方法名</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> User <span class="title">getUser</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;添加了组件&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> User();</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@RunWith(SpringRunner.class)</span></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">DemoApplicationTests</span> </span>&#123;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    ApplicationContext ac;</span><br><span class="line">    </span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        <span class="keyword">boolean</span> a = ac.containsBean(<span class="string">&quot;getUser&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;添加组件生效&quot;</span>);</span><br><span class="line">        System.out.println(<span class="string">&quot;是否存在:&quot;</span> + a);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="自动装配原理"><a href="#自动装配原理" class="headerlink" title="自动装配原理"></a>自动装配原理</h1><p><a href="https://www.bilibili.com/video/BV1PE411i7CV?p=12">视频观看地址</a></p>
<h2 id="推导"><a href="#推导" class="headerlink" title="推导"></a>推导</h2><p>在<code>spring-boot-autoconfigure.jar</code>下面的<code>META-INF</code>下的<code>spring.factories</code>是springboot的核心自动装配文件,以redis配置为例</p>
<ol>
<li><p>在<code>spring.factories</code>中存在的关于<code>redis</code>的配置是<code>org.springframework.boot.autoconfigure.data.redis.RedisAutoConfiguration</code></p>
</li>
<li><p>点击进去,源码是</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//表明这是一个配置类</span></span><br><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="comment">//所有的类,必须在满足一定的情况下才能生效,此注解是spring的底层注解,根据不同的条件,来判断当前配置或者类是否生效</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(RedisOperations.class)</span></span><br><span class="line"><span class="comment">//开启自动配置,自动配置属性  RedisProperties</span></span><br><span class="line"><span class="meta">@EnableConfigurationProperties(RedisProperties.class)</span></span><br><span class="line"><span class="meta">@Import(&#123; LettuceConnectionConfiguration.class, JedisConnectionConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisAutoConfiguration</span> </span>&#123;</span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean(name = &quot;redisTemplate&quot;)</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> RedisTemplate&lt;Object, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">		RedisTemplate&lt;Object, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;&gt;();</span><br><span class="line">		template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">		<span class="keyword">return</span> template;</span><br><span class="line">	&#125;</span><br><span class="line"></span><br><span class="line">	<span class="meta">@Bean</span></span><br><span class="line">	<span class="meta">@ConditionalOnMissingBean</span></span><br><span class="line">	<span class="function"><span class="keyword">public</span> StringRedisTemplate <span class="title">stringRedisTemplate</span><span class="params">(RedisConnectionFactory redisConnectionFactory)</span></span></span><br><span class="line"><span class="function">			<span class="keyword">throws</span> UnknownHostException </span>&#123;</span><br><span class="line">		StringRedisTemplate template = <span class="keyword">new</span> StringRedisTemplate();</span><br><span class="line">		template.setConnectionFactory(redisConnectionFactory);</span><br><span class="line">		<span class="keyword">return</span> template;</span><br><span class="line">	&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>打开自动配置的<code>RedisProperties.class</code>类,源码如下,<ul>
<li>首先,<code>RedisProperties</code>类有一个注解,指定了前缀是<code>spring.redis</code></li>
<li>其次,<code>RedisProperties</code>类有好多属性,例如常见的url,host,port等</li>
</ul>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.redis&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisProperties</span> </span>&#123;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> database = <span class="number">0</span>;</span><br><span class="line">    <span class="keyword">private</span> String url;</span><br><span class="line">    <span class="keyword">private</span> String host = <span class="string">&quot;localhost&quot;</span>;</span><br><span class="line">    <span class="keyword">private</span> String password;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">int</span> port = <span class="number">6379</span>;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">boolean</span> ssl;</span><br><span class="line">    <span class="keyword">private</span> Duration timeout;</span><br><span class="line">    <span class="keyword">private</span> String clientName;</span><br><span class="line">    <span class="keyword">private</span> Sentinel sentinel;</span><br><span class="line">    <span class="keyword">private</span> org.springframework.boot.autoconfigure.data.redis.RedisProperties.Cluster cluster;</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> org.springframework.boot.autoconfigure.data.redis.RedisProperties.Jedis jedis = <span class="keyword">new</span> 	org.springframework.boot.autoconfigure.data.redis.RedisProperties.Jedis();</span><br><span class="line">    <span class="keyword">private</span> <span class="keyword">final</span> Lettuce lettuce = <span class="keyword">new</span> Lettuce();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>然后我们就可以根据<code>RedisProperties</code>类来配置关于redis的项目,例如</li>
</ol>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.redis.database</span>=<span class="string">0</span></span><br><span class="line"><span class="meta">spring.redis.host</span>=<span class="string">192.168.128.128</span></span><br><span class="line"><span class="meta">spring.redis.port</span>=<span class="string">6379</span></span><br></pre></td></tr></table></figure>

<ol start="5">
<li><code>@Conditional</code>扩展注解</li>
</ol>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">1.class条件注解</span><br><span class="line">@ConditionalOnClass：某个class位于类路径上，才会实例化一个Bean。</span><br><span class="line">@ConditionalOnMissingClass：某个class类路径上不存在的时候，才会实例化一个Bean。</span><br><span class="line"></span><br><span class="line">2.Bean条件注解</span><br><span class="line">@ConditionalOnBean：当容器中有指定Bean的条件下进行实例化。</span><br><span class="line">@ConditionalOnMissingBean：当容器里没有指定Bean的条件下进行实例化。</span><br><span class="line"></span><br><span class="line">3.属性条件注解</span><br><span class="line">@ConditionalOnProperty：当指定的属性有指定的值时进行实例化。</span><br><span class="line"></span><br><span class="line">4.Resource条件注解</span><br><span class="line">@ConditionalOnResource：当类路径下有指定的资源时触发实例化。</span><br><span class="line"></span><br><span class="line">5.web条件注解</span><br><span class="line">@ConditionalOnNotWebApplication：不是web应用，才会实例化一个Bean。</span><br><span class="line">@ConditionalOnWebApplication：当项目是一个Web项目时进行实例化。</span><br><span class="line"></span><br><span class="line">6.表达式条件注解</span><br><span class="line">@ConditionalOnExpression：基于SpEL表达式的条件判断，当表达式为true的时候，才会实例化一个Bean。</span><br><span class="line">@ConditionalOnJava：当JVM版本为指定的版本范围时触发实例化。</span><br><span class="line">@ConditionalOnJndi：在JNDI存在的条件下触发实例化。</span><br><span class="line">@ConditionalOnSingleCandidate：当指定的Bean在容器中只有一个，或者有多个但是指定了首选的Bean时触发实例化。</span><br></pre></td></tr></table></figure>

<ol start="6">
<li>有的<code>XXXAutoConfiguration</code>类中,在类注解上没有添加<code>@EnableConfigurationProperties</code>注解,此时就需要去类中的方法上去找,例如<code>webmvc</code>的自动配置类</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line"><span class="meta">@ConditionalOnWebApplication(type = Type.SERVLET)</span></span><br><span class="line"><span class="meta">@ConditionalOnClass(&#123; Servlet.class, DispatcherServlet.class, WebMvcConfigurer.class &#125;)</span></span><br><span class="line"><span class="meta">@ConditionalOnMissingBean(WebMvcConfigurationSupport.class)</span></span><br><span class="line"><span class="meta">@AutoConfigureOrder(Ordered.HIGHEST_PRECEDENCE + 10)</span></span><br><span class="line"><span class="meta">@AutoConfigureAfter(&#123; DispatcherServletAutoConfiguration.class, TaskExecutionAutoConfiguration.class,</span></span><br><span class="line"><span class="meta">		ValidationAutoConfiguration.class &#125;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfiguration</span> </span>&#123;</span><br><span class="line">    <span class="comment">// 省略</span></span><br><span class="line">    <span class="meta">@Configuration(proxyBeanMethods = false)</span></span><br><span class="line">	<span class="meta">@Import(EnableWebMvcConfiguration.class)</span></span><br><span class="line">    <span class="comment">//可以在WebMvcProperties.class中找到可以配置的东西</span></span><br><span class="line">	<span class="meta">@EnableConfigurationProperties(&#123; WebMvcProperties.class, ResourceProperties.class &#125;)</span></span><br><span class="line">	<span class="meta">@Order(0)</span></span><br><span class="line">	<span class="keyword">public</span> <span class="keyword">static</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcAutoConfigurationAdapter</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line">        <span class="comment">//省略</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="7">
<li>　　●注入了什么：就是注入某个对象所需要的外部资源（包括对象、资源、常量数据）。</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.mvc&quot;)</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebMvcProperties</span> </span>&#123;</span><br><span class="line"><span class="comment">//省略</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><ol>
<li>springboot里面存在了大量的<code>XXXAutoConfiguration</code>文件,这些文件自动装配了一个<code>XXXProperties</code>文件</li>
<li>因为<code>XXXProperties</code>文件有默认值,所以也导致了<code>XXXAutoConfiguration</code>是有默认值的</li>
<li>我们需要修改这些默认值,所以就按照``XXXProperties<code>的前缀名那样,更改属性,用来和</code>XXXProperties`绑定</li>
</ol>
<h2 id="查看哪些自动配置生效了"><a href="#查看哪些自动配置生效了" class="headerlink" title="查看哪些自动配置生效了"></a>查看哪些自动配置生效了</h2><p>在application.properties配置文件中做出如下配置<code>debug=true</code>,然后运行主启动类,出现如下信息</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">Positive matches //自动配置类已经启用且生效的</span><br><span class="line">Negative matches //没有生效的</span><br></pre></td></tr></table></figure>

<h1 id="日志框架"><a href="#日志框架" class="headerlink" title="日志框架"></a>日志框架</h1><h2 id="springboot的日志框架选择"><a href="#springboot的日志框架选择" class="headerlink" title="springboot的日志框架选择"></a>springboot的日志框架选择</h2><p>接口: SLF4j + 实现类:logback</p>
<p>开发的时候,直接调用SLF4j抽象类的方法</p>
<p>slf4j官网举例:</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.slf4j.Logger;</span><br><span class="line"><span class="keyword">import</span> org.slf4j.LoggerFactory;</span><br><span class="line"></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">HelloWorld</span> </span>&#123;</span><br><span class="line">  <span class="function"><span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">void</span> <span class="title">main</span><span class="params">(String[] args)</span> </span>&#123;</span><br><span class="line">    Logger logger = LoggerFactory.getLogger(HelloWorld.class);</span><br><span class="line">    logger.info(<span class="string">&quot;Hello World&quot;</span>);</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="各个框架使用统一日志框架"><a href="#各个框架使用统一日志框架" class="headerlink" title="各个框架使用统一日志框架"></a>各个框架使用统一日志框架</h2><ul>
<li><p>举例说明</p>
<p>spring框架底层使用的是commong-logging日志框架,为了能使用slf4j框架,需要加入一个中间包                    </p>
</li>
</ul>
<ul>
<li>使用步骤<ol>
<li>排除正在使用的框架的日志包</li>
<li>加入中间包</li>
<li>使用slf4j日志框架</li>
</ol>
</li>
</ul>
<h2 id="日志级别"><a href="#日志级别" class="headerlink" title="日志级别"></a>日志级别</h2><p>级别由低到高,可以设置级别,默认级别是 info</p>
<blockquote>
<p>tracne &lt; debug &lt; info &lt; warn &lt; error</p>
</blockquote>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Logger logger = LoggerFactory.getLogger(getClass());   <span class="comment">//getClass() 获取本类</span></span><br><span class="line"></span><br><span class="line">logger.trace(<span class="string">&quot;跟踪轨迹日志&quot;</span>);</span><br><span class="line">logger.debug(<span class="string">&quot;debug日志&quot;</span>);</span><br><span class="line">logger.info(<span class="string">&quot;自定义信息&quot;</span>);</span><br><span class="line">logger.warn(<span class="string">&quot;警告信息&quot;</span>);</span><br><span class="line">logger.error(<span class="string">&quot;错误信息&quot;</span>);</span><br></pre></td></tr></table></figure>

<p>eg:</p>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">logging.level.包名</span>=<span class="string">级别</span></span><br><span class="line"><span class="meta">举例</span>:<span class="string"></span></span><br><span class="line"><span class="meta">logging.level.com.example.springbootlogger</span>=<span class="string">trace</span></span><br></pre></td></tr></table></figure>

<h2 id="日志框架的基本设置"><a href="#日志框架的基本设置" class="headerlink" title="日志框架的基本设置"></a>日志框架的基本设置</h2><table>
<thead>
<tr>
<th>logging.file</th>
<th>logging.path</th>
<th>example</th>
<th>Description</th>
</tr>
</thead>
<tbody><tr>
<td>(none)</td>
<td>(none)</td>
<td></td>
<td>只在控制台输出</td>
</tr>
<tr>
<td>指定文件名</td>
<td>(none)</td>
<td>my.log</td>
<td>输出日志到my.log文件中</td>
</tr>
<tr>
<td>(none)</td>
<td>指定目录</td>
<td>/var/log</td>
<td>输出到指定目录的spring.log中</td>
</tr>
</tbody></table>
<blockquote>
<p>1.SpringBoot3.0以后,logging.file更名为logging.file.name</p>
<p>​                    logging.path更名为logging.file.path</p>
<p>2.logging.file 和logging.path同时配置,以logging.file为主</p>
</blockquote>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#设置日志的级别,logging.level+包路径=日志级别</span></span><br><span class="line"><span class="meta">logging.level.com.example.springbootlogger</span>=<span class="string">trace</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#file,需要自定义日志名称</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#不指定文件的路径名,会在项目根路径下创建日志文件</span></span><br><span class="line"><span class="meta">logging.file.name</span>=<span class="string">springboot.log</span></span><br><span class="line"><span class="comment">#指定文件路径,会在路径下创建文件</span></span><br><span class="line"><span class="meta">loggiing.file.name</span>=<span class="string">G://log</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#path,不需要指定日志名称,默认是spring.log</span></span><br><span class="line"><span class="comment">#在linux中,/表示最高路径,会在/下面创建一个log文件夹,log文件夹里有一个spring.log文件</span></span><br><span class="line"><span class="meta">logging.file.path</span>=<span class="string">/log</span></span><br><span class="line"></span><br><span class="line"></span><br></pre></td></tr></table></figure>

<h2 id="自定义日志"><a href="#自定义日志" class="headerlink" title="自定义日志"></a>自定义日志</h2><p>如果使用slf4j日志,可以在classpath路径下放 logback.xml /  logback-spring.xml自定义文件,推荐使用logback-spring.xml ,可以使用高级功能,比如profile功能</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">springpfile</span> <span class="attr">name</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">	在dev中,日志是怎样输出的</span><br><span class="line"><span class="tag">&lt;/<span class="name">springpfile</span>&gt;</span></span><br></pre></td></tr></table></figure>

<p>logback.xml示例</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">scan：当此属性设置为true时，配置文件如果发生改变，将会被重新加载，默认值为true。</span></span><br><span class="line"><span class="comment">scanPeriod：设置监测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认单位是毫秒当scan为true时，此属性生效。默认的时间间隔为1分钟。</span></span><br><span class="line"><span class="comment">debug：当此属性设置为true时，将打印出logback内部日志信息，实时查看logback运行状态。默认值为false。</span></span><br><span class="line"><span class="comment">--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span> <span class="attr">scan</span>=<span class="string">&quot;false&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;60 seconds&quot;</span> <span class="attr">debug</span>=<span class="string">&quot;false&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义日志的根目录 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;LOG_HOME&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/app/log&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 定义日志文件名称 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;appName&quot;</span> <span class="attr">value</span>=<span class="string">&quot;atguigu-springboot&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">property</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- ch.qos.logback.core.ConsoleAppender 表示控制台输出 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;stdout&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        日志输出格式：</span></span><br><span class="line"><span class="comment">			%d表示日期时间，</span></span><br><span class="line"><span class="comment">			%thread表示线程名，</span></span><br><span class="line"><span class="comment">			%-5level：级别从左显示5个字符宽度</span></span><br><span class="line"><span class="comment">			%logger&#123;50&#125; 表示logger名字最长50个字符，否则按照句点分割。 </span></span><br><span class="line"><span class="comment">			%msg：日志消息，</span></span><br><span class="line"><span class="comment">			%n是换行符</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 滚动记录文件，先将日志记录到指定文件，当符合某个条件时，将日志记录到其他文件 --&gt;</span>  </span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;appLogAppender&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 指定日志文件的名称 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;LOG_HOME&#125;/$&#123;appName&#125;.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        当发生滚动时，决定 RollingFileAppender 的行为，涉及文件移动和重命名</span></span><br><span class="line"><span class="comment">        TimeBasedRollingPolicy： 最常用的滚动策略，它根据时间来制定滚动策略，既负责滚动也负责出发滚动。</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            滚动时产生的文件的存放位置及文件名称 %d&#123;yyyy-MM-dd&#125;：按天进行日志滚动 </span></span><br><span class="line"><span class="comment">            %i：当文件大小超过maxFileSize时，按照i进行文件滚动</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;LOG_HOME&#125;/$&#123;appName&#125;-%d&#123;yyyy-MM-dd&#125;-%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">            可选节点，控制保留的归档文件的最大数量，超出数量就删除旧文件。假设设置每天滚动，</span></span><br><span class="line"><span class="comment">            且maxHistory是365，则只保存最近365天的文件，删除之前的旧文件。注意，删除旧文件是，</span></span><br><span class="line"><span class="comment">            那些为了归档而创建的目录也会被删除。</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">MaxHistory</span>&gt;</span>365<span class="tag">&lt;/<span class="name">MaxHistory</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">            当日志文件超过maxFileSize指定的大小是，根据上面提到的%i进行日志文件滚动 注意此处配置SizeBasedTriggeringPolicy是无法实现按文件大小进行滚动的，必须配置timeBasedFileNamingAndTriggeringPolicy</span></span><br><span class="line"><span class="comment">            --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志输出格式： --&gt;</span>     </span><br><span class="line">        <span class="tag">&lt;<span class="name">layout</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.PatternLayout&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [ %thread ] - [ %-5level ] [ %logger&#123;50&#125; : %line ] - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">layout</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">		logger主要用于存放日志对象，也可以定义日志类型、级别</span></span><br><span class="line"><span class="comment">		name：表示匹配的logger类型前缀，也就是包的前半部分</span></span><br><span class="line"><span class="comment">		level：要记录的日志级别，包括 TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR</span></span><br><span class="line"><span class="comment">		additivity：作用在于children-logger是否使用 rootLogger配置的appender进行输出，</span></span><br><span class="line"><span class="comment">		false：表示只用当前logger的appender-ref，true：</span></span><br><span class="line"><span class="comment">		表示当前logger的appender-ref和rootLogger的appender-ref都有效</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- hibernate logger --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;com.atguigu&quot;</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span> /&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- Spring framework logger --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;org.springframework&quot;</span> <span class="attr">level</span>=<span class="string">&quot;debug&quot;</span> <span class="attr">additivity</span>=<span class="string">&quot;false&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">logger</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- </span></span><br><span class="line"><span class="comment">    root与logger是父子关系，没有特别定义则默认为root，任何一个类只会和一个logger对应，</span></span><br><span class="line"><span class="comment">    要么是定义的logger，要么是root，判断的关键在于找到这个logger，然后判断这个logger的appender和level。 </span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;info&quot;</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;stdout&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;appLogAppender&quot;</span> /&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span> </span><br></pre></td></tr></table></figure>

<p>另外一种日志配置</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="meta">&lt;?xml version=&quot;1.0&quot; encoding=&quot;UTF-8&quot;?&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">configuration</span>  <span class="attr">scan</span>=<span class="string">&quot;true&quot;</span> <span class="attr">scanPeriod</span>=<span class="string">&quot;10 seconds&quot;</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 日志级别从低到高分为TRACE &lt; DEBUG &lt; INFO &lt; WARN &lt; ERROR &lt; FATAL，如果设置为WARN，则低于WARN的信息都不会输出 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- scan:当此属性设置为true时，配置文件如果发生改变，将会被重新加载，默认值为true --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- scanPeriod:设置监测配置文件是否有修改的时间间隔，如果没有给出时间单位，默认单位是毫秒。当scan为true时，此属性生效。默认的时间间隔为1分钟。 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- de<span class="doctag">bug:</span>当此属性设置为true时，将打印出logback内部日志信息，实时查看logback运行状态。默认值为false。 --&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="tag">&lt;<span class="name">contextName</span>&gt;</span>logback<span class="tag">&lt;/<span class="name">contextName</span>&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- name的值是变量的名称，value的值时变量定义的值。通过定义的值会被插入到logger上下文中。定义变量后，可以使“$&#123;&#125;”来使用变量。 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;log.path&quot;</span> <span class="attr">value</span>=<span class="string">&quot;/zhiYuLog&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 彩色日志 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- 配置格式变量：CONSOLE_LOG_PATTERN 彩色日志格式 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- magenta:洋红 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- boldMagenta:粗红--&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- cyan:青色 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- white:白色 --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!-- magenta:洋红 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">property</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE_LOG_PATTERN&quot;</span></span></span><br><span class="line"><span class="tag">              <span class="attr">value</span>=<span class="string">&quot;%yellow(%date&#123;yyyy-MM-dd HH:mm:ss&#125;) |%highlight(%-5level) |%blue(%thread) |%blue(%file:%line) |%green(%logger) |%cyan(%msg%n)&quot;</span>/&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--输出到控制台--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;CONSOLE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.ConsoleAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--此日志appender是为开发使用，只配置最底级别，控制台输出的日志级别是大于或等于此级别的日志信息--&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 例如：如果此处配置了INFO级别，则后面其他位置即使配置了DEBUG级别的日志，也不会被输出 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.ThresholdFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">Pattern</span>&gt;</span>$&#123;CONSOLE_LOG_PATTERN&#125;<span class="tag">&lt;/<span class="name">Pattern</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 设置字符集 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--输出到文件--&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 时间滚动输出 level为 INFO 日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;INFO_FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/zhiyu_info.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志文件输出格式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!-- 每天日志归档路径以及格式 --&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/info/log-info-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件保留天数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>30<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 此日志文件只记录info级别的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>INFO<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 时间滚动输出 level为 WARN 日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;WARN_FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/log_warn.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志文件输出格式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span> <span class="comment">&lt;!-- 此处设置字符集 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/warn/log-warn-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件保留天数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 此日志文件只记录warn级别的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>warn<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!-- 时间滚动输出 level为 ERROR 日志 --&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">appender</span> <span class="attr">name</span>=<span class="string">&quot;ERROR_FILE&quot;</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.RollingFileAppender&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 正在记录的日志文件的路径及文件名 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">file</span>&gt;</span>$&#123;log.path&#125;/log_error.log<span class="tag">&lt;/<span class="name">file</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--日志文件输出格式--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">encoder</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">pattern</span>&gt;</span>%d&#123;yyyy-MM-dd HH:mm:ss.SSS&#125; [%thread] %-5level %logger&#123;50&#125; - %msg%n<span class="tag">&lt;/<span class="name">pattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">charset</span>&gt;</span>UTF-8<span class="tag">&lt;/<span class="name">charset</span>&gt;</span> <span class="comment">&lt;!-- 此处设置字符集 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">encoder</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 日志记录器的滚动策略，按日期，按大小记录 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">rollingPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.TimeBasedRollingPolicy&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">fileNamePattern</span>&gt;</span>$&#123;log.path&#125;/error/log-error-%d&#123;yyyy-MM-dd&#125;.%i.log<span class="tag">&lt;/<span class="name">fileNamePattern</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">timeBasedFileNamingAndTriggeringPolicy</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.core.rolling.SizeAndTimeBasedFNATP&quot;</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">maxFileSize</span>&gt;</span>100MB<span class="tag">&lt;/<span class="name">maxFileSize</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">timeBasedFileNamingAndTriggeringPolicy</span>&gt;</span></span><br><span class="line">            <span class="comment">&lt;!--日志文件保留天数--&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">maxHistory</span>&gt;</span>15<span class="tag">&lt;/<span class="name">maxHistory</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">rollingPolicy</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!-- 此日志文件只记录ERROR级别的 --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">filter</span> <span class="attr">class</span>=<span class="string">&quot;ch.qos.logback.classic.filter.LevelFilter&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">level</span>&gt;</span>ERROR<span class="tag">&lt;/<span class="name">level</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMatch</span>&gt;</span>ACCEPT<span class="tag">&lt;/<span class="name">onMatch</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">onMismatch</span>&gt;</span>DENY<span class="tag">&lt;/<span class="name">onMismatch</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">filter</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">appender</span>&gt;</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        &lt;logger&gt;用来设置某一个包或者具体的某一个类的日志打印级别、以及指定&lt;appender&gt;。</span></span><br><span class="line"><span class="comment">        &lt;logger&gt;仅有一个name属性，</span></span><br><span class="line"><span class="comment">        一个可选的level和一个可选的addtivity属性。</span></span><br><span class="line"><span class="comment">        name:用来指定受此logger约束的某一个包或者具体的某一个类。</span></span><br><span class="line"><span class="comment">        level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF，</span></span><br><span class="line"><span class="comment">              如果未设置此属性，那么当前logger将会继承上级的级别。</span></span><br><span class="line"><span class="comment">    --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">        使用mybatis的时候，sql语句是debug下才会打印，而这里我们只配置了info，所以想要查看sql语句的话，有以下两种操作：</span></span><br><span class="line"><span class="comment">        第一种把&lt;root level=&quot;INFO&quot;&gt;改成&lt;root level=&quot;DEBUG&quot;&gt;这样就会打印sql，不过这样日志那边会出现很多其他消息</span></span><br><span class="line"><span class="comment">        第二种就是单独给mapper下目录配置DEBUG模式，代码如下，这样配置sql语句会打印，其他还是正常DEBUG级别：</span></span><br><span class="line"><span class="comment">     --&gt;</span></span><br><span class="line">    <span class="comment">&lt;!--开发环境:打印控制台--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;dev&quot;</span>&gt;</span></span><br><span class="line">        <span class="comment">&lt;!--可以输出项目中的debug日志，包括mybatis的sql日志--&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">logger</span> <span class="attr">name</span>=<span class="string">&quot;zhiyu_dev&quot;</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span> /&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="comment">&lt;!--</span></span><br><span class="line"><span class="comment">            root节点是必选节点，用来指定最基础的日志输出级别，只有一个level属性</span></span><br><span class="line"><span class="comment">            level:用来设置打印级别，大小写无关：TRACE, DEBUG, INFO, WARN, ERROR, ALL 和 OFF，默认是DEBUG</span></span><br><span class="line"><span class="comment">            可以包含零个或多个appender元素。</span></span><br><span class="line"><span class="comment">        --&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;INFO_FILE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;WARN_FILE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ERROR_FILE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">&lt;!--生产环境:输出到文件--&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">springProfile</span> <span class="attr">name</span>=<span class="string">&quot;produce&quot;</span>&gt;</span></span><br><span class="line"></span><br><span class="line">        <span class="tag">&lt;<span class="name">root</span> <span class="attr">level</span>=<span class="string">&quot;INFO&quot;</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;CONSOLE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;INFO_FILE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;ERROR_FILE&quot;</span> /&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">appender-ref</span> <span class="attr">ref</span>=<span class="string">&quot;WARN_FILE&quot;</span> /&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">root</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">springProfile</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;/<span class="name">configuration</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="静态资源"><a href="#静态资源" class="headerlink" title="静态资源"></a>静态资源</h1><h2 id="概述原理"><a href="#概述原理" class="headerlink" title="概述原理"></a>概述原理</h2><p>查看<code>WebMvcAutoConfiguration</code>类下的<code>addResourceHandlers</code>方法</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addResourceHandlers</span><span class="params">(ResourceHandlerRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//如果自定义了,就返回</span></span><br><span class="line">    <span class="keyword">if</span> (!<span class="keyword">this</span>.resourceProperties.isAddMappings()) &#123;</span><br><span class="line">        logger.debug(<span class="string">&quot;Default resource handling disabled&quot;</span>);</span><br><span class="line">        <span class="keyword">return</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    Duration cachePeriod = <span class="keyword">this</span>.resourceProperties.getCache().getPeriod();</span><br><span class="line">    CacheControl cacheControl = <span class="keyword">this</span>.resourceProperties.getCache().getCachecontrol().toHttpCacheControl();</span><br><span class="line">    <span class="comment">//如果有webjars这个目录,就会自动去它下面找</span></span><br><span class="line">    <span class="keyword">if</span> (!registry.hasMappingForPattern(<span class="string">&quot;/webjars/**&quot;</span>)) &#123;</span><br><span class="line">        customizeResourceHandlerRegistration(registry.addResourceHandler(<span class="string">&quot;/webjars/**&quot;</span>)</span><br><span class="line">              <span class="comment">// webjars/** 会自动映射到/META-INF/resources/webjars/目录下</span></span><br><span class="line">             <span class="comment">// 当我们访问的时候,比如jquery: /webjars//META-INF/resources/webjars/jquery/3.5.1/jquery/js</span></span><br><span class="line">            <span class="comment">// 可以直接写成 localhost:8080/webjars/jquery/3.5.1/jquery.js</span></span><br><span class="line">        	 .addResourceLocations(<span class="string">&quot;classpath:/META-INF/resources/webjars/&quot;</span>)</span><br><span class="line">          	.setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">    &#125;</span><br><span class="line">    String staticPathPattern = <span class="keyword">this</span>.mvcProperties.getStaticPathPattern();</span><br><span class="line">    <span class="keyword">if</span> (!registry.hasMappingForPattern(staticPathPattern)) &#123;</span><br><span class="line">        customizeResourceHandlerRegistration(registry.addResourceHandler(staticPathPattern)</span><br><span class="line">                                             .addResourceLocations(getResourceLocations(<span class="keyword">this</span>.resourceProperties.getStaticLocations()))</span><br><span class="line">                                             .setCachePeriod(getSeconds(cachePeriod)).setCacheControl(cacheControl));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="引入静态资源"><a href="#引入静态资源" class="headerlink" title="引入静态资源"></a>引入静态资源</h2><p>使用<a href="https://www.webjars.org/">webjars</a>的方式引入</p>
<p><img data-src="/images/framework/springboot-1.png"></p>
<h2 id="访问路径"><a href="#访问路径" class="headerlink" title="访问路径"></a><strong>访问路径</strong></h2><p>“/**” 访问当前项目的任何资源，如果不存在文件,都去（静态资源文件夹）找映射</p>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">静态资源文件夹如下,从低到高:</span><br><span class="line">&quot;classpath:/META‐INF/resources/&quot;, </span><br><span class="line">&quot;classpath:/resources/&quot;, </span><br><span class="line">&quot;classpath:/static/&quot;, </span><br><span class="line">&quot;classpath:/public/&quot; </span><br><span class="line">&quot;/&quot;：当前项目的根路径</span><br></pre></td></tr></table></figure>

<p>/ 指的是java和resources文件,静态资源文件夹放在下面 </p>
<p>localhost:8080/abc === 去静态资源文件夹里面找abc </p>
<h2 id="欢迎页"><a href="#欢迎页" class="headerlink" title="欢迎页"></a>欢迎页</h2><p>放在classpath:/static/路径下面,必须放固定的文件: index.html,  localhost:8080/index.html,</p>
<h2 id="图标"><a href="#图标" class="headerlink" title="图标"></a>图标</h2><ol>
<li>图标放在<code>static</code>下,一般命名为<code>favicon.ico</code></li>
<li>在<code>index.html</code>中添加</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">link</span> <span class="attr">rel</span>=<span class="string">&quot;icon&quot;</span> <span class="attr">href</span>=<span class="string">&quot;/favicon.ico&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="自定义静态资源的访问路径"><a href="#自定义静态资源的访问路径" class="headerlink" title="自定义静态资源的访问路径"></a>自定义静态资源的访问路径</h2><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.resources.static-locations</span>=<span class="string">classpath:demo1,classpth:demo2</span></span><br></pre></td></tr></table></figure>

<h1 id="Thymeleaf"><a href="#Thymeleaf" class="headerlink" title="Thymeleaf"></a>Thymeleaf</h1><h2 id="maven-1"><a href="#maven-1" class="headerlink" title="maven"></a>maven</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!--模板引擎--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-thymeleaf<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="语法-1"><a href="#语法-1" class="headerlink" title="语法"></a>语法</h2><h3 id="原理"><a href="#原理" class="headerlink" title="原理"></a>原理</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@ConfigurationProperties(prefix = &quot;spring.thymeleaf&quot;)</span></span><br><span class="line"> <span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">ThymeleafProperties</span> </span>&#123;  </span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> Charset DEFAULT_ENCODING = Charset.forName(<span class="string">&quot;UTF‐8&quot;</span>); </span><br><span class="line">      <span class="keyword">private</span> <span class="keyword">static</span> <span class="keyword">final</span> MimeType DEFAULT_CONTENT_TYPE = MimeType.valueOf(<span class="string">&quot;text/html&quot;</span>); </span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_PREFIX = <span class="string">&quot;classpath:/templates/&quot;</span>; <span class="comment">// 前缀       </span></span><br><span class="line">      <span class="keyword">public</span> <span class="keyword">static</span> <span class="keyword">final</span> String DEFAULT_SUFFIX = <span class="string">&quot;.html&quot;</span> <span class="comment">//后缀</span></span><br></pre></td></tr></table></figure>

<h3 id="中文文档"><a href="#中文文档" class="headerlink" title="中文文档"></a>中文文档</h3><p><a href="https://fanlychie.github.io/post/thymeleaf.html">博客地址</a></p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><h3 id="导入"><a href="#导入" class="headerlink" title="导入"></a>导入</h3><figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">&quot;en&quot;</span> <span class="attr">xmlns:th</span>=<span class="string">&quot;http://www.thymeleaf.org&quot;</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="关闭缓存"><a href="#关闭缓存" class="headerlink" title="关闭缓存`"></a>关闭缓存`</h3><figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.thymeleaf.cache</span>=<span class="string">false</span></span><br></pre></td></tr></table></figure>

<h3 id="基本语法"><a href="#基本语法" class="headerlink" title="基本语法"></a>基本语法</h3><p><img data-src="/images/framework/springboot-2.png"></p>
<h3 id="表达式"><a href="#表达式" class="headerlink" title="表达式"></a>表达式</h3><figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">$&#123;&#125;常规获取值</span><br><span class="line">*&#123;&#125;配合$&#123;&#125;使用</span><br><span class="line">#&#123;&#125;获取国际化内容</span><br><span class="line">@&#123;&#125;自定义URL</span><br><span class="line">~&#123;&#125;片段引用</span><br></pre></td></tr></table></figure>

<table>
<thead>
<tr>
<th>语法</th>
<th>名称</th>
<th>描述</th>
<th>作用</th>
</tr>
</thead>
<tbody><tr>
<td>${…}</td>
<td>Variable Expressions</td>
<td>变量表达式</td>
<td>取出上下文变量的值</td>
</tr>
<tr>
<td>*{…}</td>
<td>Selection Variable Expressions</td>
<td>选择变量表达式</td>
<td>取出选择的对象的属性值</td>
</tr>
<tr>
<td>#{…}</td>
<td>Message Expressions</td>
<td>消息表达式</td>
<td>使文字消息国际化，i18n</td>
</tr>
<tr>
<td>@{…}</td>
<td>Link URL Expressions</td>
<td>链接表达式</td>
<td>用于表示各种超链接地址</td>
</tr>
<tr>
<td>~{…}</td>
<td>Fragment Expressions</td>
<td>片段表达式</td>
<td>引用一段公共的代码片段</td>
</tr>
</tbody></table>
<ol>
<li>遍历</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">th:each</span>=<span class="string">&quot;user:$&#123;users&#125;&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;user&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>行内样式</li>
</ol>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">[[ $&#123;&#125; ]]  </span><br></pre></td></tr></table></figure>

<h1 id="springmvc配置"><a href="#springmvc配置" class="headerlink" title="springmvc配置"></a>springmvc配置</h1><h2 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h2><p>关于<code>WebMvcConfigurer</code>接口的方法<a href="https://blog.csdn.net/zhangpower1993/article/details/89016503">说明</a></p>
<p>2.1 addInterceptors：拦截器</p>
<p>2.2 addViewControllers：页面跳转</p>
<p>2.3 addResourceHandlers：静态资源</p>
<p>2.4 configureDefaultServletHandling：默认静态资源处理器</p>
<p>2.5 configureViewResolvers：视图解析器</p>
<p>2.6 configureContentNegotiation：配置内容裁决的一些参数</p>
<p>2.7 addCorsMappings：跨域</p>
<p>2.8 configureMessageConverters：信息转换器</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">//切记,不能添加@EnableWebMvc,加了以后表示全面接管springmvc</span><br><span class="line">@Configuration</span><br><span class="line">public class WebmvcConfig implements WebMvcConfigurer &#123;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="示例-页面跳转"><a href="#示例-页面跳转" class="headerlink" title="示例:页面跳转"></a>示例:页面跳转</h2><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">WebmvcConfig</span> <span class="keyword">implements</span> <span class="title">WebMvcConfigurer</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Override</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">addViewControllers</span><span class="params">(ViewControllerRegistry registry)</span> </span>&#123;</span><br><span class="line">    <span class="comment">//lohost:8080/lo</span></span><br><span class="line">        registry.addViewController(<span class="string">&quot;/lo&quot;</span>).setViewName(<span class="string">&quot;success&quot;</span>);</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="CRUD实战"><a href="#CRUD实战" class="headerlink" title="CRUD实战"></a>CRUD实战</h1><h2 id="静态资源-1"><a href="#静态资源-1" class="headerlink" title="静态资源"></a>静态资源</h2><ol>
<li><p>静态资源放在templates下面</p>
</li>
<li><p>css,js,img等资源文件,统一放在static目录下</p>
</li>
<li><p>html页面中资源文件的引用方式</p>
<ul>
<li>在页面中引入<code>thymeleaf</code>模板引擎 <code>&lt;html lang=&quot;en&quot; xmlns:th=&quot;http://www.thymeleaf.org&quot;&gt;</code></li>
<li>href,src等表示路径的,统一使用thymeleaf,eg:<code>&lt;link th:href=&quot;@&#123;/asserts/css/bootstrap.min.css&#125;&quot; rel=&quot;stylesheet&quot;&gt;</code></li>
</ul>
</li>
<li><p>首页的访问,一般通过扩展springmvc来实现–实现视图解析</p>
</li>
</ol>
<h2 id="国际化"><a href="#国际化" class="headerlink" title="国际化"></a>国际化</h2><h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><ol>
<li><p>在<code>resources</code>下编写i18n文件</p>
</li>
<li><p>在yaml中配置包的基类,例如文件名是login.properties,login_zh_CN.properties,配置:<code>spring.message.basename=i18n.login</code></p>
</li>
<li><p>在页面中配合thymeleaf引擎修改数据,使用<code>#</code>符号,eg:<code>&lt;h1 class=&quot;h3 mb-3 font-weight-normal&quot; th:text=&quot;#&#123;login.tip&#125;&quot;&gt;Please sign in&lt;/h1&gt;</code></p>
</li>
</ol>
<h3 id="后端"><a href="#后端" class="headerlink" title="后端"></a>后端</h3><ol>
<li>原理</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">// WebMvcAutoConfiguration 类下面</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">localeResolver</span><span class="params">()</span> </span>&#123;</span><br><span class="line">      <span class="comment">//如果用户配置了国际化解析,就返回用户的自定义解析</span></span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">this</span>.mvcProperties.getLocaleResolver() == 		org.springframework.boot.autoconfigure.web.servlet.WebMvcProperties.LocaleResolver.FIXED) &#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">new</span> FixedLocaleResolver(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">&#125; <span class="keyword">else</span> &#123;</span><br><span class="line">       <span class="comment">// 否则,就使用默认的国际化解析</span></span><br><span class="line">       <span class="comment">// AcceptHeaderLocaleResolver实现了LocaleResolver接口,所以我们可以实现该接口来自定义</span></span><br><span class="line">       AcceptHeaderLocaleResolver localeResolver = <span class="keyword">new</span> AcceptHeaderLocaleResolver();</span><br><span class="line">       localeResolver.setDefaultLocale(<span class="keyword">this</span>.mvcProperties.getLocale());</span><br><span class="line">       <span class="keyword">return</span> localeResolver;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//AcceptHeaderLocaleResolver解析如下</span></span><br><span class="line"> <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">     <span class="comment">//默认解析</span></span><br><span class="line">       Locale defaultLocale = <span class="keyword">this</span>.getDefaultLocale();</span><br><span class="line">       <span class="keyword">if</span> (defaultLocale != <span class="keyword">null</span> &amp;&amp; request.getHeader(<span class="string">&quot;Accept-Language&quot;</span>) == <span class="keyword">null</span>) &#123;</span><br><span class="line">           <span class="keyword">return</span> defaultLocale;</span><br><span class="line">       &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">           <span class="comment">//获取请求中的区域信息数据</span></span><br><span class="line">           Locale requestLocale = request.getLocale();</span><br><span class="line">           List&lt;Locale&gt; supportedLocales = <span class="keyword">this</span>.getSupportedLocales();</span><br><span class="line">           <span class="keyword">if</span> (!supportedLocales.isEmpty() &amp;&amp; !supportedLocales.contains(requestLocale)) &#123;</span><br><span class="line">               Locale supportedLocale = <span class="keyword">this</span>.findSupportedLocale(request, supportedLocales);</span><br><span class="line">               <span class="keyword">if</span> (supportedLocale != <span class="keyword">null</span>) &#123;</span><br><span class="line">                   <span class="keyword">return</span> supportedLocale;</span><br><span class="line">               &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                   <span class="keyword">return</span> defaultLocale != <span class="keyword">null</span> ? defaultLocale : requestLocale;</span><br><span class="line">               &#125;</span><br><span class="line">           &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">               <span class="keyword">return</span> requestLocale;</span><br><span class="line">           &#125;</span><br><span class="line">       &#125;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>解析</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> Locale <span class="title">resolveLocale</span><span class="params">(HttpServletRequest request)</span> </span>&#123;</span><br><span class="line">       <span class="comment">//需要现在请求中添加一个链接:&lt;a class=&quot;btn btn-sm&quot; th:href=&quot;@&#123;/index.html(l=&#x27;zh_CN&#x27;)&#125;&quot;&gt;中文&lt;/a&gt;</span></span><br><span class="line">       <span class="comment">//获取请求中的语言参数链接</span></span><br><span class="line">       String Language = request.getParameter(<span class="string">&quot;l&quot;</span>);</span><br><span class="line">       <span class="comment">//如果请求参数中没有语言链接,使用默认本地化解析</span></span><br><span class="line">       Locale locale = Locale.getDefault();</span><br><span class="line"></span><br><span class="line">       <span class="keyword">if</span> (!StringUtils.isEmpty(Language)) &#123;</span><br><span class="line">           <span class="comment">//zh_CN</span></span><br><span class="line">           String[] strings = Language.split(<span class="string">&quot;_&quot;</span>);</span><br><span class="line">           locale = <span class="keyword">new</span> Locale(strings[<span class="number">0</span>], strings[<span class="number">1</span>]);</span><br><span class="line">       &#125;</span><br><span class="line">       <span class="keyword">return</span> locale;</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<ol start="3">
<li>自定义的国际化,存放到springboot配置类中</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line">   <span class="function"><span class="keyword">public</span> LocaleResolver <span class="title">myLocale</span><span class="params">()</span></span>&#123;</span><br><span class="line">       <span class="keyword">return</span> <span class="keyword">new</span> MyLocaleResolver();</span><br><span class="line">   &#125;</span><br></pre></td></tr></table></figure>

<h2 id="登录"><a href="#登录" class="headerlink" title="登录"></a>登录</h2><h3 id="前端-1"><a href="#前端-1" class="headerlink" title="前端"></a>前端</h3><p>在前端提示页面中,给出提示信息</p>
<figure class="highlight html"><table><tr><td class="code"><pre><span class="line">//th:text=&quot;$&#123;msg&#125;&quot; 是后台model传出的报错信息</span><br><span class="line">// th:if  判断信息是否为空,为空则不显示</span><br><span class="line">//not 表示取反,取反有两种方式 1. ! 2. not</span><br><span class="line">//#strings是一个工具类,判断字符串是否非空</span><br><span class="line"><span class="tag">&lt;<span class="name">p</span> <span class="attr">style</span>=<span class="string">&quot;color: red&quot;</span> <span class="attr">th:text</span>=<span class="string">&quot;$&#123;msg&#125;&quot;</span> <span class="attr">th:if</span>=<span class="string">&quot;$&#123;not #strings.isEmpty(&#x27;msg&#x27;)&#125;&quot;</span>&gt;</span><span class="tag">&lt;/<span class="name">p</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h1 id="web三大组件"><a href="#web三大组件" class="headerlink" title="web三大组件"></a>web三大组件</h1><h2 id="配置文件示例"><a href="#配置文件示例" class="headerlink" title="配置文件示例"></a>配置文件示例</h2><ol>
<li>配置文件修改示例,具体可以配置哪些,可以点击进入,查看<code>ServerProperties</code>类</li>
</ol>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">server.port</span>=<span class="string">8081</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>实现<code>WebServerFactoryCustomizer</code>接口配置,该接口是泛型</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> WebServerFactoryCustomizer&lt;ConfigurableWebServerFactory&gt; <span class="title">webServerFactoryCustomizer</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> WebServerFactoryCustomizer&lt;ConfigurableWebServerFactory&gt;() &#123;</span><br><span class="line">        <span class="meta">@Override</span></span><br><span class="line">        <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">customize</span><span class="params">(ConfigurableWebServerFactory factory)</span> </span>&#123;</span><br><span class="line">            factory.setPort(<span class="number">8082</span>);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="三大组件"><a href="#三大组件" class="headerlink" title="三大组件"></a>三大组件</h2><h3 id="Servlet"><a href="#Servlet" class="headerlink" title="Servlet"></a>Servlet</h3><p>servlet—–&gt;ServletRegistrationBean </p>
<ol>
<li><p>在配置文件中添加返回类型是ServletRegistrationBean 的方法,记得添加@bean</p>
</li>
<li><p>利用构造方法,加载自定义的servlet eg:new MyServlet</p>
</li>
<li><p>/MyServlet 名字是自定义的,不需要在自定义的servlet添加注解说明名称是MyServlet </p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletRegistrationBean <span class="title">servletRegistrationBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ServletRegistrationBean mys = <span class="keyword">new</span> ServletRegistrationBean(<span class="keyword">new</span> MyServlet(), <span class="string">&quot;/MyServlet&quot;</span>);</span><br><span class="line">    <span class="keyword">return</span> mys;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Filter"><a href="#Filter" class="headerlink" title="Filter"></a>Filter</h3><p>filter—–&gt;FilterRegistrationBean </p>
<ol>
<li><p>返回类型是FilterRegistrationBean </p>
</li>
<li><p>FilterRegistrationBean 构造方法中有泛型,在自定义初始化的时候,可以身省略</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> FilterRegistrationBean <span class="title">registrationBean</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    FilterRegistrationBean filterBean = <span class="keyword">new</span> FilterRegistrationBean();</span><br><span class="line">    filterBean.setFilter(<span class="keyword">new</span> MyFilter());</span><br><span class="line">    filterBean.setUrlPatterns(Arrays.asList(<span class="string">&quot;/hi&quot;</span>, <span class="string">&quot;/MyServlet&quot;</span>));</span><br><span class="line">    <span class="keyword">return</span> filterBean;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="Listener"><a href="#Listener" class="headerlink" title="Listener"></a>Listener</h3><p>listener——&gt; ServletListenerRegistrationBean</p>
<ol>
<li><p>实现ServletContextListener接口</p>
</li>
<li><p>在全局配置文件中做出配置</p>
</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Bean</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> ServletListenerRegistrationBean <span class="title">myListener</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    ServletListenerRegistrationBean&lt;MyListener&gt; yyListener = <span class="keyword">new</span> ServletListenerRegistrationBean(<span class="keyword">new</span> MyListener());</span><br><span class="line">    <span class="keyword">return</span> yyListener;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="整合mybatis"><a href="#整合mybatis" class="headerlink" title="整合mybatis"></a>整合mybatis</h1><h2 id="maven-2"><a href="#maven-2" class="headerlink" title="maven"></a>maven</h2><p>导入mysql jdbc druid mybatis的依赖</p>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>mysql<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mysql-connector-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">scope</span>&gt;</span>runtime<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-jdbc<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.mybatis.spring.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>mybatis-spring-boot-starter<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.1.2<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.alibaba<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>druid<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>1.1.21<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="初始化创建数据库-2-0"><a href="#初始化创建数据库-2-0" class="headerlink" title="初始化创建数据库(2.0)"></a>初始化创建数据库(2.0)</h2><ol>
<li>在类路径下放固定文件<code>schema.sql</code>,内容为建表语句,eg:</li>
</ol>
<blockquote>
<p>springboot2.0 初始化数据,有两步需要注意,</p>
<p>第一,文件名固定,是schema.sql,</p>
<p>第二,在yaml中需要加一句 initialization-mode: always</p>
</blockquote>
<figure class="highlight sql"><table><tr><td class="code"><pre><span class="line"><span class="keyword">DROP</span> <span class="keyword">TABLE</span> <span class="keyword">IF</span> <span class="keyword">EXISTS</span> <span class="string">`books`</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">CREATE</span> <span class="keyword">TABLE</span> <span class="string">`books`</span> (</span><br><span class="line">  <span class="string">`book_id`</span> <span class="built_in">INT</span>(<span class="number">10</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> AUTO_INCREMENT PRIMARY <span class="keyword">KEY</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;书id&#x27;</span>,</span><br><span class="line">  <span class="string">`book_name`</span> <span class="built_in">VARCHAR</span>(<span class="number">100</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;书名&#x27;</span>,</span><br><span class="line">  <span class="string">`book_counts`</span> <span class="built_in">INT</span>(<span class="number">11</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span> <span class="keyword">COMMENT</span> <span class="string">&#x27;数量&#x27;</span>,</span><br><span class="line">  <span class="string">`book_detail`</span> <span class="built_in">VARCHAR</span>(<span class="number">200</span>) <span class="keyword">NOT</span> <span class="literal">NULL</span>  <span class="keyword">COMMENT</span> <span class="string">&#x27;描述&#x27;</span></span><br><span class="line">) <span class="keyword">ENGINE</span>=<span class="keyword">INNODB</span> <span class="keyword">DEFAULT</span> <span class="keyword">CHARSET</span>=utf8;</span><br><span class="line"></span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`books`</span> <span class="keyword">VALUES</span> (<span class="number">1</span>, <span class="string">&#x27;Java&#x27;</span>, <span class="number">1</span>, <span class="string">&#x27;从入门到放弃&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`books`</span> <span class="keyword">VALUES</span> (<span class="number">2</span>, <span class="string">&#x27;MySQL&#x27;</span>, <span class="number">10</span>, <span class="string">&#x27;从删库到跑路&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`books`</span> <span class="keyword">VALUES</span> (<span class="number">3</span>, <span class="string">&#x27;Linux&#x27;</span>, <span class="number">5</span>, <span class="string">&#x27;从进门到进牢&#x27;</span>);</span><br><span class="line"><span class="keyword">INSERT</span> <span class="keyword">INTO</span> <span class="string">`books`</span> <span class="keyword">VALUES</span> (<span class="number">4</span>, <span class="string">&#x27;格林童话&#x27;</span>, <span class="number">11</span>, <span class="string">&#x27;安徒生的童话&#x27;</span>);</span><br></pre></td></tr></table></figure>

<ol start="2">
<li>全局文件配置</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">datasource:</span></span><br><span class="line">    <span class="attr">type:</span> <span class="string">com.alibaba.druid.pool.DruidDataSource</span></span><br><span class="line">    <span class="attr">username:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">password:</span> <span class="string">root</span></span><br><span class="line">    <span class="attr">url:</span> <span class="string">jdbc:mysql:///wty?serverTimezone=UTC</span></span><br><span class="line">    <span class="attr">driver-class-name:</span> <span class="string">com.mysql.cj.jdbc.Driver</span></span><br><span class="line">    <span class="string">//初始化创建表</span></span><br><span class="line">    <span class="attr">schema:</span></span><br><span class="line">      <span class="string">classpath:schema.sql</span></span><br><span class="line">    <span class="comment">#    springboot2.0新增功能</span></span><br><span class="line">    <span class="attr">initialization-mode:</span> <span class="string">always</span></span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><p>在test环境下,测试整合mybatis连接数据库是否正常</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> DataSource dataSource;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> <span class="keyword">throws</span> SQLException </span>&#123;</span><br><span class="line">        System.out.println(dataSource.getConnection());</span><br><span class="line">        System.out.println(dataSource.getClass());</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

<h2 id="代码编写"><a href="#代码编写" class="headerlink" title="代码编写"></a>代码编写</h2><h3 id="注解版"><a href="#注解版" class="headerlink" title="注解版"></a>注解版</h3><ol>
<li>编写mapper接口,并在接口上编写sql语句</li>
<li>在springboot启动类添加注解<code>@MapperScan</code> 或者在mapper接口上添加<code>@Mapper</code></li>
<li>添加语句需要加入主键注解<code>@Options(useGeneratedKeys = true, keyProperty = &quot;id&quot;)</code>,改注解表示是否使用那个自增主键</li>
<li>编写controller代码</li>
</ol>
<h3 id="xml配置版本"><a href="#xml配置版本" class="headerlink" title="xml配置版本"></a>xml配置版本</h3><p><strong>特别注意:resource目录下,不能放mybatis/mapper/<em>.xml文件,建议只放mapper/</em>.xml,不然报错</strong>–<code>Invalid bound statement (not found): </code></p>
<ol>
<li>编写mybatis全局配置文件和mapper映射文件</li>
<li>在springboot中配置</li>
</ol>
<figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">mybatis:</span></span><br><span class="line">  <span class="attr">mapper-locations:</span> <span class="string">classpath:mapper/*.xml</span></span><br><span class="line">  <span class="attr">config-location:</span> <span class="string">classpath:mybatis/mybatis-config.xml</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li><p>在springboot启动类添加注<code>解@MapperScan</code> 或者在mapper接口上添加<code>@Mapper</code></p>
</li>
<li><p>编写controller代码</p>
</li>
</ol>
<h1 id="缓存"><a href="#缓存" class="headerlink" title="缓存"></a>缓存</h1><h2 id="缓存的使用"><a href="#缓存的使用" class="headerlink" title="缓存的使用"></a>缓存的使用</h2><ol>
<li>引入<code>spring-boot-starter-cache</code>模块</li>
<li><code>@EnableCaching</code>开启缓存</li>
<li>使用缓存注解</li>
<li>切换为其他缓存</li>
</ol>
<h2 id="缓存注解"><a href="#缓存注解" class="headerlink" title="缓存注解"></a>缓存注解</h2><h3 id="EnableCaching"><a href="#EnableCaching" class="headerlink" title="@EnableCaching"></a>@EnableCaching</h3><p>在启动类上添加<code>@EnableCaching</code>,表示启用缓存</p>
<h3 id="Cacheable"><a href="#Cacheable" class="headerlink" title="@Cacheable"></a>@Cacheable</h3><p>主要针对方法配置，能够根据方法的请求参数对其进行缓存</p>
<h3 id="CachePut"><a href="#CachePut" class="headerlink" title="@CachePut"></a>@CachePut</h3><p>既调用方法,又更新缓存</p>
<ol>
<li>先调用方法</li>
<li>然后将目标方法的结果缓存起来</li>
</ol>
<ul>
<li><p>查询的时候,传参如果是id,那么在添加了<code>@CachePut</code>注解的方法上,也要声明一下key为id,</p>
</li>
<li><p>声明key有两种方式:</p>
<ul>
<li><code>#employee.id</code></li>
<li><code>#result.id</code></li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">//查询的传参是id  </span></span><br><span class="line"><span class="meta">@Cacheable(cacheNames = &quot;emp&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">getEmp</span><span class="params">(Integer id)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;查询了第==&quot;</span> + id + <span class="string">&quot;==号员工&quot;</span>);</span><br><span class="line">        Employee emp = employeeMapper.getEmpById(id);</span><br><span class="line">        <span class="keyword">return</span> emp;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//声明key是id,</span></span><br><span class="line">    <span class="meta">@CachePut(cacheNames = &quot;emp&quot;,key = &quot;#employee.id&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Employee <span class="title">updateEmp</span><span class="params">(Employee employee)</span> </span>&#123;</span><br><span class="line">        System.out.println(<span class="string">&quot;update==&gt;&quot;</span>+employee);</span><br><span class="line">        employeeMapper.updateEmp(employee);</span><br><span class="line">        <span class="keyword">return</span> employee;</span><br><span class="line">    &#125;</span><br></pre></td></tr></table></figure>

</li>
</ul>
<h3 id="CacheEvict"><a href="#CacheEvict" class="headerlink" title="@CacheEvict"></a>@CacheEvict</h3><ul>
<li>key: 根据指定的id清空缓存</li>
<li>allEntries = true 清空所有缓存,默认false</li>
<li>beforeInvocation = true ,默认是false,true表示执行在方法之前,如果方法发生了异常,也会清除掉缓存</li>
</ul>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@CacheEvict(cacheNames = &quot;emp&quot;,key = &quot;#id&quot;,allEntries=true,beforeInvocation = true)</span></span><br></pre></td></tr></table></figure>

<h3 id="Caching"><a href="#Caching" class="headerlink" title="@Caching"></a>@Caching</h3><p>此注解,抽取缓存的公共配置</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="meta">@interface</span> Caching &#123;</span><br><span class="line">    Cacheable[] cacheable() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    CachePut[] put() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">    CacheEvict[] evict() <span class="keyword">default</span> &#123;&#125;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="任务"><a href="#任务" class="headerlink" title="任务"></a>任务</h1><h2 id="异步任务"><a href="#异步任务" class="headerlink" title="异步任务"></a>异步任务</h2><h3 id="异步任务执行使用场景"><a href="#异步任务执行使用场景" class="headerlink" title="异步任务执行使用场景"></a>异步任务执行使用场景</h3><p>1 发送短信</p>
<p>2 发送邮件</p>
<p>3 App消息推送</p>
<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><ol>
<li>在启动类上添加注解<code>@EnableAsync</code>表示开启异步 </li>
<li>在要执行的业务方法上添加注解 <code>@Async</code>,表示这是一个异步任务</li>
</ol>
<h2 id="定时任务"><a href="#定时任务" class="headerlink" title="定时任务"></a>定时任务</h2><h3 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">org.springframework.scheduling   <span class="class"><span class="keyword">interface</span> <span class="title">TaskScheduler</span>    #任务调度</span></span><br><span class="line"><span class="class"><span class="title">org</span>.<span class="title">springframework</span>.<span class="title">core</span>.<span class="title">task</span>    <span class="title">interface</span> <span class="title">TaskExecutor</span>     # 任务执行</span></span><br><span class="line"><span class="class">    </span></span><br><span class="line"><span class="class">@<span class="title">EnableScheduling</span>    # 开启定时任务</span></span><br><span class="line"><span class="class">@<span class="title">Scheduled</span>       #方法执行定时的注解,此注解内容为<span class="title">corn</span>表达式</span></span><br></pre></td></tr></table></figure>

<h3 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h3><ol>
<li>首先,确保class类已经被被spring管理,例如<code>@Service</code>|<code>@Controller</code></li>
<li>需要在启动类上添加注解<code>@EnableScheduling</code>来开启定时 </li>
<li>在方法上添加 <code>@Scheduled</code></li>
</ol>
<p><a href="https://qqe2.com/cron">corn网站在线生成</a></p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="comment">/**</span></span><br><span class="line"><span class="comment"> *  秒  分  时  日 月 周几</span></span><br><span class="line"><span class="comment"> * second(秒), minute（分）, hour（时）, day of month（日）, month（月）, day of week（周几）.</span></span><br><span class="line"><span class="comment"> * 0 * * * * MON-FRI</span></span><br><span class="line"><span class="comment"> *  【0 0/5 14,18 * * ?】 每天14点整，和18点整，每隔5分钟执行一次</span></span><br><span class="line"><span class="comment"> *  【0 15 10 ? * 1-6】 每个月的周一至周六10:15分执行一次</span></span><br><span class="line"><span class="comment"> *  【0 0 2 ? * 6L】每个月的最后一个周六凌晨2点执行一次</span></span><br><span class="line"><span class="comment"> *  【0 0 2 LW * ?】每个月的最后一个工作日凌晨2点执行一次</span></span><br><span class="line"><span class="comment"> *  【0 0 2-4 ? * 1#1】每个月的第一个周一凌晨2点到4点期间，每个整点都执行一次；</span></span><br><span class="line"><span class="comment"> */</span></span><br><span class="line"><span class="comment">// @Scheduled(cron = &quot;0 * * * * MON-SAT&quot;)</span></span><br><span class="line"><span class="comment">//@Scheduled(cron = &quot;0,1,2,3,4 * * * * MON-SAT&quot;)</span></span><br><span class="line"><span class="comment">// @Scheduled(cron = &quot;0-4 * * * * MON-SAT&quot;)</span></span><br><span class="line"><span class="meta">@Scheduled(cron = &quot;0 43 15 * * *&quot;)</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hello</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    System.out.println(<span class="string">&quot;hello task&quot;</span>);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="邮件任务"><a href="#邮件任务" class="headerlink" title="邮件任务"></a>邮件任务</h2><ol>
<li>导入mail的依赖</li>
</ol>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-mail<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<ol start="2">
<li>编写配置</li>
</ol>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="meta">spring.mail.username</span>=<span class="string">邮箱号码</span></span><br><span class="line"><span class="meta">spring.mail.password</span>=<span class="string">qq邮箱授权码</span></span><br><span class="line"><span class="meta">spring.mail.host</span>=<span class="string">smtp.qq.com</span></span><br><span class="line"><span class="meta">spring.mail.properties.mail.smtp.auth</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.mail.properties.mail.smtp.starttls.enable</span>=<span class="string">true</span></span><br><span class="line"><span class="meta">spring.mail.properties.mail.smtp.starttls.required</span>=<span class="string">true</span></span><br></pre></td></tr></table></figure>

<ol start="3">
<li>测试简单邮件,纯文字版的邮件</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Autowired</span></span><br><span class="line"><span class="keyword">private</span> JavaMailSender mailSender;</span><br><span class="line"></span><br><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSimpleMail</span><span class="params">()</span> </span>&#123;</span><br><span class="line">    SimpleMailMessage message = <span class="keyword">new</span> SimpleMailMessage();</span><br><span class="line">    message.setFrom(<span class="string">&quot;要发送的邮箱地址&quot;</span>);</span><br><span class="line">    message.setTo(<span class="string">&quot;要接收的邮箱地址&quot;</span>); </span><br><span class="line">    message.setSubject(<span class="string">&quot;主题：springboot测试邮件&quot;</span>);</span><br><span class="line">    message.setText(<span class="string">&quot;测试邮件内容&quot;</span>);</span><br><span class="line">    mailSender.send(message);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<ol start="4">
<li>测试复杂版的邮件,附件,图片,html页面等</li>
</ol>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Test</span></span><br><span class="line"><span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">sendSimpleMailFile</span><span class="params">()</span><span class="keyword">throws</span> Exception </span>&#123;</span><br><span class="line">    <span class="comment">//利用JavaMailSender创建复杂邮件</span></span><br><span class="line">    MimeMessage mimeMessage = mailSender.createMimeMessage();</span><br><span class="line">    <span class="comment">//利用MimeMessageHelper进行文件的传输,true表示开启文件传输</span></span><br><span class="line">    MimeMessageHelper mimeMessageHelper = <span class="keyword">new</span> MimeMessageHelper(mimeMessage,<span class="keyword">true</span>);</span><br><span class="line"></span><br><span class="line">    mimeMessageHelper.setFrom(<span class="string">&quot;发送方&quot;</span>);</span><br><span class="line">    mimeMessageHelper.setTo(<span class="string">&quot;接收方&quot;</span>);</span><br><span class="line">    mimeMessageHelper.setSubject(<span class="string">&quot;主题：springboot测试邮件&quot;</span>);</span><br><span class="line">    <span class="comment">//html内容,true表示开启html渲染</span></span><br><span class="line">    mimeMessageHelper.setText(<span class="string">&quot;&lt;b style=&#x27;color:red&#x27;&gt;测试邮件的内容&lt;/b&gt;&quot;</span>,<span class="keyword">true</span>);</span><br><span class="line">    <span class="comment">//文件</span></span><br><span class="line">    mimeMessageHelper.addAttachment(<span class="string">&quot;1.jpg&quot;</span>,<span class="keyword">new</span> File(<span class="string">&quot;D:\\computer\\user\\图片\\phone\\11.jpg&quot;</span>));</span><br><span class="line">    mimeMessageHelper.addAttachment(<span class="string">&quot;2.jpg&quot;</span>,<span class="keyword">new</span> File(<span class="string">&quot;D:\\computer\\user\\图片\\phone\\12.jpg&quot;</span>));</span><br><span class="line">    mailSender.send(mimeMessage);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>]]></content>
      <categories>
        <category>spring框架</category>
      </categories>
      <tags>
        <tag>spring</tag>
      </tags>
  </entry>
  <entry>
    <title>redis</title>
    <url>/2020/05/29/linux/redis/</url>
    <content><![CDATA[<h1 id="概述"><a href="#概述" class="headerlink" title="概述"></a>概述</h1><p><strong>Redis是单线程</strong></p>
<p>Redis 是一个开源（BSD许可）的，内存中的数据结构存储系统，它可以用作<strong>数据库</strong>、<strong>缓存</strong>和<strong>消息中间件</strong>。 它支持多种类型的数据结构，如 <a href="http://www.redis.cn/topics/data-types-intro.html#strings">字符串（strings）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#hashes">散列（hashes）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#lists">列表（lists）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#sets">集合（sets）</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#sorted-sets">有序集合（sorted sets）</a> 与范围查询， <a href="http://www.redis.cn/topics/data-types-intro.html#bitmaps">bitmaps</a>， <a href="http://www.redis.cn/topics/data-types-intro.html#hyperloglogs">hyperloglogs</a> 和 <a href="http://www.redis.cn/commands/geoadd.html">地理空间（geospatial）</a> 索引半径查询。 Redis 内置了 <a href="http://www.redis.cn/topics/replication.html">复制（replication）</a>，<a href="http://www.redis.cn/commands/eval.html">LUA脚本（Lua scripting）</a>， <a href="http://www.redis.cn/topics/lru-cache.html">LRU驱动事件（LRU eviction）</a>，<a href="http://www.redis.cn/topics/transactions.html">事务（transactions）</a> 和不同级别的 <a href="http://www.redis.cn/topics/persistence.html">磁盘持久化（persistence）</a>， 并通过 <a href="http://www.redis.cn/topics/sentinel.html">Redis哨兵（Sentinel）</a>和自动 <a href="http://www.redis.cn/topics/cluster-tutorial.html">分区（Cluster）</a>提供高可用性（high availability）。</p>
<p><strong><a href="http://www.redis.cn/commands.html">命令查询</a></strong></p>
<a id="more"></a>

<h1 id="安装"><a href="#安装" class="headerlink" title="安装"></a>安装</h1><h2 id="安装步骤"><a href="#安装步骤" class="headerlink" title="安装步骤"></a>安装步骤</h2><p><a href="https://www.bilibili.com/video/BV1S54y1R7SB?p=9">狂神说</a></p>
<p>在<a href="https://redis.io/">redis英文官网</a>可以下载最新版的linux安装包</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">将redis安装包,放到/opt目录下并解压,redis.conf在此目录下</span></span><br><span class="line">tar -zxvf redis-6.0.5.tar.gz </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">以下是环境安装</span></span><br><span class="line"><span class="meta">#</span><span class="bash">安装gcc</span></span><br><span class="line">yum install gcc gcc-c++ </span><br><span class="line"><span class="meta">#</span><span class="bash">查看版本</span></span><br><span class="line">gcc -v</span><br><span class="line"><span class="meta">#</span><span class="bash">安装make</span></span><br><span class="line">yum -y install gcc automake autoconf libtool make   </span><br><span class="line"><span class="meta">#</span><span class="bash">必须跳转到redis解压目录,执行此命令,编译安装,会自动安装其他环境</span></span><br><span class="line">make MALLOC=libc </span><br><span class="line">make install</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 安装完成以后,默认安装在/user/<span class="built_in">local</span>/bin下面,在这里可以看到redis的编译文件</span></span><br><span class="line">cd /usr/local/bin  </span><br><span class="line"><span class="meta">#</span><span class="bash">在/usr/<span class="built_in">local</span>/bin文件夹下面创建一个redis的配置文件夹,复制/opt下面的redis配置文件到这里,以后就可以使用这个配置文件启动</span></span><br><span class="line">mkdir redisconf</span><br><span class="line"><span class="meta">#</span><span class="bash">把解压路径下的配置文件复制一份到默认安装位置,在redisconf下执行此命令</span></span><br><span class="line">cp /opt/redis-6.0.5/redis.conf redisconf</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">redis默认不是后台运行的,需要把它修改成后台运行</span></span><br><span class="line">vim redis.conf </span><br><span class="line"><span class="meta">#</span><span class="bash">详细操作</span></span><br><span class="line"><span class="meta">#</span><span class="bash">按下 i 进行编辑,再按 esc退出到底线命令模式,输入<span class="string">&quot;/daemonize&quot;</span>,找到<span class="string">&quot;daemonize no&quot;</span>,将其改为yes,然后按下esc,输入<span class="string">&quot;:wq&quot;</span>,保存退出</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">通过最新修改的配置文件以后台模式启动redis服务</span></span><br><span class="line">redis-server redisconf/redis.conf  </span><br><span class="line"><span class="meta">#</span><span class="bash">运行客户端,后面跟--raw参数,可以解决中文乱码问题</span></span><br><span class="line">redis-cli --raw  </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">查看redis进程是否运行,主要是查看redis-server的6379是否开启</span></span><br><span class="line">ps -ef|grep redis </span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">关机</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 取消连接</span></span><br><span class="line">shutdown</span><br><span class="line"><span class="meta">#</span><span class="bash"> 退出</span></span><br><span class="line">exit</span><br></pre></td></tr></table></figure>

<h1 id="性能测试"><a href="#性能测试" class="headerlink" title="性能测试"></a>性能测试</h1><p><a href="https://www.bilibili.com/video/BV1S54y1R7SB?p=10">狂神说</a></p>
<p><a href="https://www.runoob.com/redis/redis-benchmarks.html">菜鸟教程</a></p>
<table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">选项</th>
<th align="left">描述</th>
<th align="left">默认值</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left"><strong>-h</strong></td>
<td align="left">指定服务器主机名</td>
<td align="left">127.0.0.1</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left"><strong>-p</strong></td>
<td align="left">指定服务器端口</td>
<td align="left">6379</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left"><strong>-s</strong></td>
<td align="left">指定服务器 socket</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">4</td>
<td align="left"><strong>-c</strong></td>
<td align="left">指定并发连接数</td>
<td align="left">50</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left"><strong>-n</strong></td>
<td align="left">指定请求数</td>
<td align="left">10000</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left"><strong>-d</strong></td>
<td align="left">以字节的形式指定 SET/GET 值的数据大小</td>
<td align="left">2</td>
</tr>
<tr>
<td align="left">7</td>
<td align="left"><strong>-k</strong></td>
<td align="left">1=keep alive 0=reconnect</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">8</td>
<td align="left"><strong>-r</strong></td>
<td align="left">SET/GET/INCR 使用随机 key, SADD 使用随机值</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">9</td>
<td align="left"><strong>-P</strong></td>
<td align="left">通过管道传输 <numreq> 请求</td>
<td align="left">1</td>
</tr>
<tr>
<td align="left">10</td>
<td align="left"><strong>-q</strong></td>
<td align="left">强制退出 redis。仅显示 query/sec 值</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">11</td>
<td align="left"><strong>–csv</strong></td>
<td align="left">以 CSV 格式输出</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">12</td>
<td align="left"><strong>-l</strong></td>
<td align="left">生成循环，永久执行测试</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">13</td>
<td align="left"><strong>-t</strong></td>
<td align="left">仅运行以逗号分隔的测试命令列表。</td>
<td align="left"></td>
</tr>
<tr>
<td align="left">14</td>
<td align="left"><strong>-I</strong></td>
<td align="left">Idle 模式。仅打开 N 个 idle 连接并等待。</td>
<td align="left"></td>
</tr>
</tbody></table>
<h2 id="说明"><a href="#说明" class="headerlink" title="说明"></a>说明</h2><figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> 启动性能测试工具</span></span><br><span class="line">redis-benchmark -c 1000 -n 100000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 数据分析</span></span><br><span class="line">100000 requests completed in 2.04 seconds   #对10万个请求进行性能测试</span><br><span class="line">1000 parallel clients   #一千个并发客户端去处理请求</span><br><span class="line">3 bytes payload   #每次只写入三个字节</span><br><span class="line">keep alive: 1</span><br><span class="line">host configuration &quot;save&quot;: 900 1 300 10 60 10000</span><br><span class="line">host configuration &quot;appendonly&quot;: no</span><br><span class="line">multi-thread: no</span><br><span class="line"></span><br><span class="line">99.15% &lt;= 25 milliseconds  #25毫秒的时候,执行了10万请求的百分之99.15</span><br><span class="line">99.99% &lt;= 34 milliseconds   #34毫秒的时候,执行了10万请求的百分之99.99</span><br><span class="line">100.00% &lt;= 34 milliseconds  #34毫秒的时候,执行完了全部的请求</span><br><span class="line">48947.62 requests per second   # 每毫秒执行48947.62次请求</span><br></pre></td></tr></table></figure>

<h1 id="基本命令"><a href="#基本命令" class="headerlink" title="基本命令"></a>基本命令</h1><h2 id="基础命令"><a href="#基础命令" class="headerlink" title="基础命令"></a>基础命令</h2><ul>
<li><p><code>keys *</code> 查看所有的键</p>
</li>
<li><p><code>exists key</code> 是否存在key,返回个数</p>
</li>
<li><p><code>del key</code>移除某一个值</p>
</li>
<li><p><code>expire key time</code> 为key设置一个过期时间,单位是秒</p>
</li>
<li><p><code>ttl key</code> 查看key的过期时间</p>
</li>
<li><p><code>type key</code>查看这个key是什么类型</p>
</li>
<li><p><code>persist key</code>对key进行持久化</p>
</li>
<li><p><code>dbsize</code> 查看数据库的key数量</p>
</li>
<li><p><code>rename key newKey</code>重命名</p>
</li>
<li><p><code>select 数字</code> redis默认16个数据库,数字为数据库的索引</p>
</li>
<li><p><code>move key 数字</code>把当前数据库的key移动到数字的数据库</p>
</li>
<li><p><code>flushdb</code>清除当前数据库</p>
</li>
<li><p><code>flushall</code> 清除所有数据库</p>
</li>
</ul>
<h2 id="String"><a href="#String" class="headerlink" title="String"></a>String</h2><p><a href="https://www.bilibili.com/video/BV1S54y1R7SB?p=13">狂神说</a></p>
<p><strong>基础操作</strong></p>
<blockquote>
<p><code>set key value</code> 设置一个string类型的值</p>
<p><code>rename oldKey newKey</code>对key进行重命名</p>
<p><code>get key</code> 获取值</p>
<p><code>del key</code> 删除</p>
<p><code>append key abc</code>在key的value后面追加内容abc    </p>
<p><code>strlen</code> 获取字符串的长度</p>
</blockquote>
<p><strong>自增自减,可用于阅读量的统计</strong></p>
<blockquote>
<p><code>incr key / decr key</code>自增 / 自减</p>
<p><code>incrby key  num / decrby key  num </code>自增或自减多少num</p>
</blockquote>
<p><strong>替换</strong></p>
<blockquote>
<p><code>getrange name 0 4</code> 截取[0,4],<code>-1表示全部截取</code></p>
<p><code>setrange name 0 x</code>把name的第一位替换成<code>x</code></p>
</blockquote>
<p><strong>过期时间</strong></p>
<blockquote>
<p><code>setex name 30 &quot;zs&quot;</code>设置一个key为name,值为”zs”,只存在30秒</p>
<p><code>ttl name</code>查看剩余时间</p>
<p><code>setnx name &quot;li&quot;</code> 不存在的时候赋值,返回0或者1</p>
</blockquote>
<p><strong>批量操作</strong></p>
<blockquote>
<p><code>mset k1 v1 k2 v2 </code>同时设置多个值</p>
<p><code>mget k1 k2</code> 同时获得多个值</p>
<p><code>msetex</code> 过期时间</p>
<p><code>msetnx</code>不存在时赋值</p>
</blockquote>
<p><strong>对象操作</strong></p>
<p>例如: user:1 {name:zhangsan,age:20},对于这种字符串的操作,可以使用批量操作</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; mset user:1:name &quot;zhangsan&quot; user:1:age 20</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; mget user:1:name user:1:age</span><br><span class="line">1) &quot;zhangsan&quot;</span><br><span class="line">2) &quot;20&quot;</span><br></pre></td></tr></table></figure>

<p><strong>合并命令</strong></p>
<blockquote>
<p><code>getset key value</code>     先获取,后赋值,给key赋值一个新值,返回一个旧值</p>
</blockquote>
<h2 id="Hash哈希"><a href="#Hash哈希" class="headerlink" title="Hash哈希"></a>Hash哈希</h2><p>哈希类型,是一种<code>key:map</code>格式,即 user :name:”zs”,有点类似于json格式,更适合对象的存储</p>
<p>本质上和String没有太大区别</p>
<blockquote>
<p><code>hset user name &quot;zs&quot;</code> 存入一个值</p>
<p><code>hget user name</code> 获取一个值</p>
<p><code>hmset user age &quot;11&quot; address &quot;shanghai&quot;</code>批量存值</p>
<p><code>hmget user age address</code> 批量获取值</p>
<p><code>hgetall user</code>获取所有的值,以key:value形式展示</p>
<p><code>hdel user name</code>删除某一个值</p>
<p><code>hlen user</code>获取hash表的字段数量,即查看有多少个KV键值对</p>
<p><code>hexists user age</code>判断是否存在一个指定的值</p>
<p><code>hkeys user</code>获取所有key,即获取user的name的key</p>
<p><code>hvals user</code>获取所有value,即user的name的value</p>
<p><code>hsetnx user city bj</code>不存在的时候赋值,如果存在,不赋值</p>
</blockquote>
<h2 id="List列表"><a href="#List列表" class="headerlink" title="List列表"></a>List列表</h2><p>双向链表,有序可重复</p>
<p>所有的list命令基本上都是以 L开头的</p>
<blockquote>
<p><code>lpush key one </code>先进后出,后添加的值会在先添加的值的左边,按照顺序获取值,会先获取后放入的值,最后才会获得第一个放入的值<br><code>rpush key one </code>先进先出,<br><code>lrang key 0 -1</code> 查看所有值,0表示从头开始,-1表示所有,查看单个的,可以使用下标<br><code>lpop  key</code>删除左边第一个值,并返回删除的值<br><code>rpop  key</code>删除右边第一个值,并返回删除的值</p>
<p><code>lrem key count value</code>移除一个指定的值,eg:lrm key 2 three,移除key中的2个three</p>
<p><code>lindex key 0</code>获取key的第一个下标的值,0表示第一个,-1表示最后一个</p>
<p><code>llen key</code> 获取长度</p>
<p><code>ltrim mykey 1 2</code>截取1和2两个下标的值,其他数据会不存在</p>
<p><code>rpoplpush list1 list2</code>移动list1列表中的最右边的元素到list2中</p>
<p><code>lset list1 0 &quot;item&quot;</code>把list1中的第一个值修改成item</p>
<p><code>linsert otherlist before &quot;item&quot; &quot;hello&quot;</code>在otherlist的值item的前面添加一个值hello,before(之前)after(之后)</p>
</blockquote>
<h2 id="Set-集合"><a href="#Set-集合" class="headerlink" title="Set 集合"></a>Set 集合</h2><p>无序不可重复</p>
<blockquote>
<p><code>sadd myset hello</code> 新增一个值</p>
<p><code>smembers myset</code>查看所有的myset值</p>
<p><code>sismember myset &quot;hello&quot;</code>判断一个值是否存在myset集合中</p>
<p><code>scard myset</code>获取set集合中的元素个数</p>
<p><code>srem myset hello</code>移除set中的hello元素</p>
<p><code>srandmember myset</code>从set集合中随机产生一个值</p>
<p><code>srandmember myset 2</code>从set集合中随机产生一个指定的值</p>
<p><code>spop myset</code> 从set中随机移除一个元素</p>
<p><code>smove myset1 myset2 &quot;hello&quot;</code>把set1中的hello值移动到set2中</p>
<p><code>sdiff set1 set2</code>差集,以set1为基础,查看set1和set2中不一样的值</p>
<p><code>sinter set1 set2</code> 交集,可以做共同关注功能,即属于A的同时又属于B</p>
<p><code>sunion set1 set2</code> 并集,把两个set的值合并在一起后的值,称之为并集</p>
</blockquote>
<h2 id="ZSet-有序不重复"><a href="#ZSet-有序不重复" class="headerlink" title="ZSet 有序不重复"></a>ZSet 有序不重复</h2><p><a href="https://www.cnblogs.com/knowledgesea/p/4999288.html">参考文档</a></p>
<p>在set的基础上,又增加了一个值  set k1 v1,zset k1 scope v1</p>
<blockquote>
<p><code>zadd user 1 name 2 age</code>批量赋值</p>
<p><code>zrangebyscore salary -inf +inf</code>从小到大排序,<code>-inf</code>最小值,即负无穷</p>
<p><code>zrevrange salary 0 -1</code>从大到小排序</p>
<p><code>zrangebyscore salary -inf +inf withscores</code>以KV键值对的形式查询出来数据</p>
<p><code>zrangebyscore salary -inf 2000 withscores</code> 查询一个2000以内的值,并以KV的形式展示</p>
<p><code>zrem salary &quot;ls&quot;</code>移除</p>
<p><code>zcard salary</code>获取集合中的个数</p>
<p><code>zcount salary -inf +inf</code>返回分数范围内的成员数量</p>
</blockquote>
<h1 id="地理空间（geospatial）"><a href="#地理空间（geospatial）" class="headerlink" title="地理空间（geospatial）"></a>地理空间（geospatial）</h1><p><a href="http://www.redis.cn/commands/geoadd.html">redis官网关于地理空间的文档</a></p>
<p><a href="http://www.ximizi.com/jingweidu.php">城市经纬度查询</a></p>
<blockquote>
<p>geoadd  添加数据</p>
</blockquote>
<ul>
<li>经度必须在纬度之前</li>
</ul>
<ul>
<li>有效的经度从-180度到180度。</li>
<li>有效的纬度从-85.05112878度到85.05112878度。</li>
</ul>
<p>当坐标位置超出上述指定范围时，该命令将会返回一个错误。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">geoadd china:city 116.46 39.92 beijing</span><br><span class="line"></span><br><span class="line">geoadd china:city 111.2 34.12 pinglu</span><br><span class="line"></span><br><span class="line">geoadd china:city 114.48 38.03 shijiazhuang</span><br></pre></td></tr></table></figure>

<blockquote>
<p>geopos 获取数据</p>
</blockquote>
<p>GEOPOS 命令返回一个数组， 数组中的每个项都由两个元素组成： 第一个元素为给定位置元素的经度， 而第二个元素则为给定位置元素的纬度。</p>
<p>当给定的位置元素不存在时， 对应的数组项为空值。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 获取一个城市的经纬度</span><br><span class="line">geopos china:city beijing</span><br><span class="line"></span><br><span class="line"># 批量获取</span><br><span class="line">geopos china:city beijing pinglu shijiazhuang</span><br></pre></td></tr></table></figure>

<blockquote>
<p>geodist  查询两地之间的距离</p>
</blockquote>
<p>返回两个给定位置之间的距离。</p>
<p>如果两个位置之间的其中一个不存在， 那么命令返回空值。</p>
<p>指定单位的参数 unit 必须是以下单位的其中一个：<strong>都是小写字母</strong></p>
<ul>
<li><strong>m</strong> 表示单位为米。</li>
<li><strong>km</strong> 表示单位为千米。</li>
<li><strong>mi</strong> 表示单位为英里。</li>
<li><strong>ft</strong> 表示单位为英尺。</li>
</ul>
<p>如果用户没有显式地指定单位参数， 那么 <code>GEODIST</code> 默认使用米作为单位。</p>
<p><code>GEODIST</code> 命令在计算距离时会假设地球为完美的球形， 在极限情况下， 这一假设最大会造成 0.5% 的误差。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 默认是以m作为单位的</span><br><span class="line">geodist china:city beijing pinglu</span><br><span class="line">&quot;796121.9679&quot;</span><br><span class="line"></span><br><span class="line"># 指定以km作为单位</span><br><span class="line">geodist china:city beijing pinglu km</span><br><span class="line">&quot;796.1220&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>georadius 附近人</p>
</blockquote>
<p>以给定的经纬度为中心， 返回键包含的位置元素当中， 与中心的距离不超过给定最大距离的所有位置元素。</p>
<p>范围可以使用以下其中一个单位：</p>
<ul>
<li><strong>m</strong> 表示单位为米。</li>
<li><strong>km</strong> 表示单位为千米。</li>
<li><strong>mi</strong> 表示单位为英里。</li>
<li><strong>ft</strong> 表示单位为英尺。</li>
</ul>
<p>在给定以下可选项时， 命令会返回额外的信息：</p>
<ul>
<li><code>WITHDIST</code>: 在返回位置元素的同时， 将位置元素与中心之间的距离也一并返回。 距离的单位和用户给定的范围单位保持一致。</li>
<li><code>WITHCOORD</code>: 将位置元素的经度和维度也一并返回。</li>
<li><code>WITHHASH</code>: 以 52 位有符号整数的形式， 返回位置元素经过原始 geohash 编码的有序集合分值。 这个选项主要用于底层应用或者调试， 实际中的作用并不大。</li>
</ul>
<p>命令默认返回未排序的位置元素。 通过以下两个参数， 用户可以指定被返回位置元素的排序方式：</p>
<ul>
<li><code>ASC</code>: 根据中心的位置， 按照从近到远的方式返回位置元素。</li>
<li><code>DESC</code>: 根据中心的位置， 按照从远到近的方式返回位置元素。</li>
</ul>
<p>在默认情况下， GEORADIUS 命令会返回所有匹配的位置元素。 虽然用户可以使用 <strong>COUNT <code>&lt;count&gt;</code></strong> 选项去获取前 N 个匹配元素， 但是因为命令在内部可能会需要对所有被匹配的元素进行处理， 所以在对一个非常大的区域进行搜索时， 即使只使用 <code>COUNT</code> 选项去获取少量元素， 命令的执行速度也可能会非常慢。 但是从另一方面来说， 使用 <code>COUNT</code> 选项去减少需要返回的元素数量， 对于减少带宽来说仍然是非常有用的。</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line"># 以(110,30)为中心,查询方圆一万千米之内的城市</span><br><span class="line">georadius china:city 110 30 10000 km</span><br><span class="line"></span><br><span class="line"># 返回附近的人的地理位置名称以及和我的距离,如果查询的时候指定了以KM为单位,返回时也是kM</span><br><span class="line">georadius china:city 110 30 10000 km WITHDIST</span><br><span class="line"></span><br><span class="line"># 返回附近人的地理位置名称以及经纬度</span><br><span class="line">georadius china:city 110 30 10000 km WITHCOORD</span><br><span class="line"></span><br><span class="line"># 筛选出附近的10个城市</span><br><span class="line">georadius china:city 110 30 10000 km count 10</span><br></pre></td></tr></table></figure>

<blockquote>
<p>georadisbymember</p>
</blockquote>
<p>通过给定的位置元素为中心,找出位于指定范围内的元素</p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 找出指定元素周围的其他元素</span></span><br><span class="line">GEORADIUSBYMEMBER china:city beijing 10000 km</span><br></pre></td></tr></table></figure>

<h1 id="事务"><a href="#事务" class="headerlink" title="事务"></a>事务</h1><p><a href="https://www.bilibili.com/video/BV1S54y1R7SB?p=21">观看地址</a></p>
<blockquote>
<p>redis单条命令式保存原子性,但是事务不保证原子性</p>
<p>redis事务没有隔离级别的概念,即不会有幻读,脏读这类名词</p>
</blockquote>
<h2 id="操作"><a href="#操作" class="headerlink" title="操作"></a>操作</h2><ul>
<li><p>开启事务 <code>multi</code></p>
</li>
<li><p>执行代码 ….</p>
</li>
<li><p>执行事务 <code>exec</code>,事务执行完成后,下次写入数据,需要重新开启事务</p>
</li>
<li><p>放弃事务 <code>discard</code></p>
</li>
</ul>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MULTI  #开启事务</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k1 v1  #代码操作,入队操作</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; set k2 v2</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; EXEC #入队完成后,一次性把数据放到redis中,然后执行事务</span><br><span class="line">1) OK</span><br><span class="line">2) OK</span><br><span class="line">127.0.0.1:6379&gt; get k1</span><br><span class="line">&quot;v1&quot;</span><br></pre></td></tr></table></figure>

<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; MULTI   #开启事务</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; set k4 v4  #入队</span><br><span class="line">QUEUED</span><br><span class="line">127.0.0.1:6379&gt; DISCARD  #放弃事务</span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; get k4  #放弃事务后,数据不会被写入到redis</span><br><span class="line">(nil)</span><br></pre></td></tr></table></figure>

<h2 id="异常"><a href="#异常" class="headerlink" title="异常"></a>异常</h2><h3 id="编译时的异常"><a href="#编译时的异常" class="headerlink" title="编译时的异常"></a>编译时的异常</h3><blockquote>
<p>类似于java的编译异常,开启事务后,进行代码操作,代码出错后,继续提交事务,就导致整组的代命令提交不了</p>
</blockquote>
<p>经常是命令输入错误时,会发生编译错误</p>
<h3 id="运行时异常"><a href="#运行时异常" class="headerlink" title="运行时异常"></a>运行时异常</h3><blockquote>
<p>类似于java的运行时异常,开启事务后,编写3组代码,代码一有错误,但是编译通过, 在提交的时候,代码一报错,其他两组代码顺利执行完毕</p>
</blockquote>
<h1 id="监控"><a href="#监控" class="headerlink" title="监控"></a>监控</h1><h2 id="悲观锁"><a href="#悲观锁" class="headerlink" title="悲观锁"></a>悲观锁</h2><p>认为什么时候都会出问题,每一步操作都加锁</p>
<h2 id="乐观锁"><a href="#乐观锁" class="headerlink" title="乐观锁"></a>乐观锁</h2><p>认为操作不会出现问题,对每一步操作都不加锁,更新数据的时候查看一下,是否有人更改数据.</p>
<h2 id="使用"><a href="#使用" class="headerlink" title="使用"></a>使用</h2><p>需要使用监控,添加关键字<code>watch</code>,用它来监控一个对象 eg: <code>watch name</code>,这个name就是数据,需要监视name</p>
<p>使用<code>unwatch</code>放弃监视</p>
<p>使用步骤: 监控对象,开启事务,操作,提交事务</p>
<p>如果中间出问题,导致失败,放弃监控,直接监控最新版的数据即可</p>
<h1 id="Jedis"><a href="#Jedis" class="headerlink" title="Jedis"></a>Jedis</h1><h2 id="maven"><a href="#maven" class="headerlink" title="maven"></a>maven</h2><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>redis.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jedis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>3.5.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h2 id="Jedis-1"><a href="#Jedis-1" class="headerlink" title="Jedis"></a>Jedis</h2><h3 id="测试连接"><a href="#测试连接" class="headerlink" title="测试连接"></a>测试连接</h3><p>在连接前,需要修改一下redis.conf配置文件</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">注释掉   bind 127.0.0.1</span><br><span class="line">关闭保护模式 ,即修改protected-mode,改为no</span><br><span class="line">关闭防火墙</span><br><span class="line">  	关闭防火墙   systemctl stop firewalld</span><br><span class="line"> 	开启防火墙  systemctl start firewalld</span><br><span class="line">	查看防火墙状态:&#96;systemctl status firewalld</span><br><span class="line">或者对redis端口进行开放</span><br><span class="line">	firewall-cmd --add-port&#x3D;6379&#x2F;tcp --permanent</span><br><span class="line">启动redis  redis-server redisconf&#x2F;redis.conf</span><br><span class="line">中文乱码  在redis-cli启动的时候,添加参数  --raw</span><br><span class="line">查看redis进程  ps -ef|grep redis</span><br></pre></td></tr></table></figure>

<h3 id="jedis的事务"><a href="#jedis的事务" class="headerlink" title="jedis的事务"></a>jedis的事务</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line">Jedis jedis = <span class="keyword">new</span> Jedis(<span class="string">&quot;192.168.254.133&quot;</span>, <span class="number">6379</span>);</span><br><span class="line">		<span class="comment">//生成数据</span></span><br><span class="line">        JSONObject json = <span class="keyword">new</span> JSONObject();</span><br><span class="line">        json.put(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;tom&quot;</span>);</span><br><span class="line">        json.put(<span class="string">&quot;city&quot;</span>, <span class="string">&quot;beiJing&quot;</span>);</span><br><span class="line">        <span class="comment">//开启事务</span></span><br><span class="line">        Transaction multi = jedis.multi();</span><br><span class="line">        String result = json.toJSONString();</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="comment">//事务操作</span></span><br><span class="line">            multi.set(<span class="string">&quot;user1&quot;</span>, result);</span><br><span class="line">            multi.set(<span class="string">&quot;user2&quot;</span>, result);</span><br><span class="line">            <span class="comment">//事务执行</span></span><br><span class="line">            multi.exec();</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            <span class="comment">//出现异常,取消事务</span></span><br><span class="line">            multi.discard();</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">        &#125; <span class="keyword">finally</span> &#123;</span><br><span class="line">            System.out.println(jedis.get(<span class="string">&quot;user1&quot;</span>));</span><br><span class="line">            System.out.println(jedis.get(<span class="string">&quot;user2&quot;</span>));</span><br><span class="line">            multi.close();</span><br><span class="line">        &#125;</span><br></pre></td></tr></table></figure>
<h1 id="Lettuce"><a href="#Lettuce" class="headerlink" title="Lettuce"></a>Lettuce</h1><h2 id="springboot2-0说明"><a href="#springboot2-0说明" class="headerlink" title="springboot2.0说明"></a>springboot2.0说明</h2><p><a href="https://www.bilibili.com/video/BV1S54y1R7SB?p=25">观看地址</a></p>
<p>sprinigboot2.0开始,连接redis的工具换成了lettuce,不使用jedis</p>
<p>jedis:底层采用直接连接数据库的方式,多个线程同时操作,会不安全,可以使用jedis pool来规避</p>
<p>lettuce: 采用netty,实例可以在多线程中共享</p>
<p>简单配置:<code>spring.redis</code></p>
<p>集群配置:<code>spring.redis.lettuce</code></p>
<h2 id="properties配置"><a href="#properties配置" class="headerlink" title="properties配置"></a>properties配置</h2><blockquote>
<ol>
<li>ctrl+shift+n 搜索–&gt; RedisAutoConfiguration</li>
<li>ctrl+shift+n 搜索–&gt; RedisProperties</li>
<li>配置集群的话,使用lettuce</li>
</ol>
</blockquote>
<figure class="highlight properties"><table><tr><td class="code"><pre><span class="line"><span class="comment">#redis服务器的IP </span></span><br><span class="line"><span class="meta">redis.ip</span>=<span class="string"></span></span><br><span class="line"></span><br><span class="line"><span class="comment">#redis服务器的Port </span></span><br><span class="line"><span class="meta">redisl.port</span>=<span class="string">6379</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#最大活动对象数</span></span><br><span class="line"><span class="meta">redis.pool.maxTotal</span>=<span class="string">1000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#最大能够保持ide1状态的对数</span></span><br><span class="line"><span class="meta">redis.pool.maxIdle</span>=<span class="string">100</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#最小能够保持ide1状态的对象数</span></span><br><span class="line"><span class="meta">redis.pool.minIdle</span>=<span class="string">50</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#当池内没有返回对象时，最大等待时间</span></span><br><span class="line"><span class="meta">redis.pool.maxwaitMillis</span>=<span class="string">10000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#当调用borrow object方法时，是否进行有效性检查</span></span><br><span class="line"><span class="meta">redis.pool.testOnBorrow</span>=<span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#当调用return object方法时，是否进行有效性检查</span></span><br><span class="line"><span class="meta">redis.pool.testOnReturn</span>=<span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#&quot;空闲链接&quot;检测线程，检测的周期，毫秒数。如果为负值，表示不运行“检测线程&quot;。默认为-1.</span></span><br><span class="line"><span class="meta">redis.pool.timeBetweenEvictionRunsMillis</span>=<span class="string">30000</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#向调用者输出“链接”对象时，是否检测它的空闲超时；</span></span><br><span class="line"><span class="meta">redis.pool.testWhileIdle</span>=<span class="string">true</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#对于丶空闲链接”检测线程而言，每次检测的链接资源的个数。默认为3.</span></span><br><span class="line"><span class="meta">redis.pool.numTestsPerEvictionRun</span>=<span class="string">50</span></span><br></pre></td></tr></table></figure>

<h2 id="测试"><a href="#测试" class="headerlink" title="测试"></a>测试</h2><h3 id="导入依赖"><a href="#导入依赖" class="headerlink" title="导入依赖"></a>导入依赖</h3><figure class="highlight xml"><table><tr><td class="code"><pre><span class="line"><span class="comment">&lt;!-- 操作lettuce --&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="comment">&lt;!--json转换,用于自定义redisTemplate--&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-annotations<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure>

<h3 id="配置"><a href="#配置" class="headerlink" title="配置"></a>配置</h3><figure class="highlight yaml"><table><tr><td class="code"><pre><span class="line"><span class="attr">spring:</span></span><br><span class="line">  <span class="attr">redis:</span></span><br><span class="line">    <span class="attr">port:</span> <span class="number">6379</span></span><br><span class="line">    <span class="attr">host:</span> <span class="number">192.168</span><span class="number">.254</span><span class="number">.133</span></span><br><span class="line">    <span class="comment"># 可以在jedis和lettuce之间转换</span></span><br><span class="line">    <span class="attr">client-type:</span> <span class="string">LETTUCE</span></span><br></pre></td></tr></table></figure>

<h3 id="测试-1"><a href="#测试-1" class="headerlink" title="测试"></a>测试</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringbootRedisApplicationTests</span> </span>&#123;</span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;mykey&quot;</span>, <span class="string">&quot;kuangshen&quot;</span>);</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;mykey&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="API说明"><a href="#API说明" class="headerlink" title="API说明"></a>API说明</h3><blockquote>
<p>opsForValue 操作字符,类似string</p>
<p>opsForList 操作list,类似List</p>
<p>opsForSet</p>
<p>opsForHash</p>
<p>opsForZSet</p>
</blockquote>
<h2 id="RedisTemplate"><a href="#RedisTemplate" class="headerlink" title="RedisTemplate"></a>RedisTemplate</h2><h3 id="自定义编写"><a href="#自定义编写" class="headerlink" title="自定义编写"></a>自定义编写</h3><p>所有的对象,都需要序列化,序列化用到了<code>jaskson</code>依赖</p>
<figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisConfig</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Bean(name = &quot;redisTemplate&quot;)</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;all&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> RedisTemplate&lt;String, Object&gt; <span class="title">redisTemplate</span><span class="params">(RedisConnectionFactory factory)</span> </span>&#123;</span><br><span class="line">        <span class="comment">// 我们为了自己开发方便，一般直接使用 &lt;String, Object&gt;</span></span><br><span class="line">        RedisTemplate&lt;String, Object&gt; template = <span class="keyword">new</span> RedisTemplate&lt;String, Object&gt;();</span><br><span class="line">        template.setConnectionFactory(factory);</span><br><span class="line"></span><br><span class="line">        <span class="comment">// Json序列化配置</span></span><br><span class="line">        Jackson2JsonRedisSerializer jackson2JsonRedisSerializer = <span class="keyword">new</span> Jackson2JsonRedisSerializer(Object.class);</span><br><span class="line">        ObjectMapper om = <span class="keyword">new</span> ObjectMapper();</span><br><span class="line">        om.setVisibility(PropertyAccessor.ALL, JsonAutoDetect.Visibility.ANY);</span><br><span class="line">        om.enableDefaultTyping(ObjectMapper.DefaultTyping.NON_FINAL);</span><br><span class="line">        jackson2JsonRedisSerializer.setObjectMapper(om);</span><br><span class="line">        <span class="comment">// String 的序列化</span></span><br><span class="line">        StringRedisSerializer stringRedisSerializer = <span class="keyword">new</span> StringRedisSerializer();</span><br><span class="line"></span><br><span class="line">        <span class="comment">// key采用String的序列化方式</span></span><br><span class="line">        template.setKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">// hash的key也采用String的序列化方式</span></span><br><span class="line">        template.setHashKeySerializer(stringRedisSerializer);</span><br><span class="line">        <span class="comment">// value序列化方式采用jackson</span></span><br><span class="line">        template.setValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        <span class="comment">// hash的value序列化方式采用jackson</span></span><br><span class="line">        template.setHashValueSerializer(jackson2JsonRedisSerializer);</span><br><span class="line">        template.afterPropertiesSet();</span><br><span class="line"></span><br><span class="line">        <span class="keyword">return</span> template;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-1"><a href="#使用-1" class="headerlink" title="使用"></a>使用</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="keyword">import</span> org.junit.jupiter.api.Test;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Autowired;</span><br><span class="line"><span class="keyword">import</span> org.springframework.beans.factory.annotation.Qualifier;</span><br><span class="line"><span class="keyword">import</span> org.springframework.boot.test.context.SpringBootTest;</span><br><span class="line"><span class="keyword">import</span> org.springframework.data.redis.core.RedisTemplate;</span><br><span class="line"></span><br><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">RedisApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="meta">@Qualifier(value = &quot;redisTemplate&quot;)</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">void</span> <span class="title">contextLoads</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForValue().set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;深圳&quot;</span>);</span><br><span class="line">        System.out.println(redisTemplate.opsForValue().get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h2 id="工具类-redisUtil"><a href="#工具类-redisUtil" class="headerlink" title="工具类 redisUtil"></a>工具类 redisUtil</h2><h3 id="编写"><a href="#编写" class="headerlink" title="编写"></a>编写</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">final</span> <span class="class"><span class="keyword">class</span> <span class="title">RedisUtil</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 自定义的redisTemplate类</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisTemplate&lt;String, Object&gt; redisTemplate;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// =============================common============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 指定缓存失效时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">expire</span><span class="params">(String key, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.expire(key, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key 获取过期时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 时间(秒) 返回0代表为永久有效</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">getExpire</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.getExpire(key, TimeUnit.SECONDS);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断key是否存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hasKey</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.hasKey(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 可以传一个值 或多个</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="meta">@SuppressWarnings(&quot;unchecked&quot;)</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">del</span><span class="params">(String... key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (key != <span class="keyword">null</span> &amp;&amp; key.length &gt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">if</span> (key.length == <span class="number">1</span>) &#123;</span><br><span class="line">                redisTemplate.delete(key[<span class="number">0</span>]);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                redisTemplate.delete((Collection&lt;String&gt;) CollectionUtils.arrayToList(key));</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============================String=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存获取</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">get</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> key == <span class="keyword">null</span> ? <span class="keyword">null</span> : redisTemplate.opsForValue().get(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForValue().set(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 普通缓存放入并设置时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒) time要大于0 如果time小于等于0 将设置无限期</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false 失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">set</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                redisTemplate.opsForValue().set(key, value, time, TimeUnit.SECONDS);</span><br><span class="line">            &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">                set(key, value);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递增</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta 要增加几(大于0)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">incr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;递增因子必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 递减</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> delta 要减少几(小于0)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">decr</span><span class="params">(String key, <span class="keyword">long</span> delta)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (delta &lt; <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="keyword">throw</span> <span class="keyword">new</span> RuntimeException(<span class="string">&quot;递减因子必须大于0&quot;</span>);</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForValue().increment(key, -delta);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ================================Map=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashGet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">hget</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().get(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取hashKey对应的所有键值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 对应的多个键值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Map&lt;Object, Object&gt; <span class="title">hmget</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().entries(key);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map 对应多个键值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * HashSet 并设置时间</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> map  对应多个键值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time 时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hmset</span><span class="params">(String key, Map&lt;String, Object&gt; map, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().putAll(key, map);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 向一张hash表中放入数据,如果不存在将创建</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item  项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒) 注意:如果已存在的hash表有时间,这里将会替换原有的时间</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 成功 false失败</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hset</span><span class="params">(String key, String item, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForHash().put(key, item, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 删除hash表中的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 可以使多个 不能为null</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">hdel</span><span class="params">(String key, Object... item)</span> </span>&#123;</span><br><span class="line">        redisTemplate.opsForHash().delete(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 判断hash表中是否有该项的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项 不能为null</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">hHasKey</span><span class="params">(String key, String item)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().hasKey(key, item);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递增 如果不存在,就会创建一个 并把新增后的值返回</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   要增加几(大于0)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hincr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * hash递减</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key  键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> item 项</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> by   要减少记(小于0)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">double</span> <span class="title">hdecr</span><span class="params">(String key, String item, <span class="keyword">double</span> by)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> redisTemplate.opsForHash().increment(key, item, -by);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">// ============================set=============================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据key获取Set中的所有值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Set&lt;Object&gt; <span class="title">sGet</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().members(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据value从一个set中查询,是否存在</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> true 存在 false不存在</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">sHasKey</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().isMember(key, value);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将数据放入set缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSet</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().add(key, values);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将set数据放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time   时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 成功个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sSetAndTime</span><span class="params">(String key, <span class="keyword">long</span> time, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().add(key, values);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>)</span><br><span class="line">                expire(key, time);</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取set缓存的长度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">sGetSetSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForSet().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除值为value的</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key    键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> values 值 可以是多个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">setRemove</span><span class="params">(String key, Object... values)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long count = redisTemplate.opsForSet().remove(key, values);</span><br><span class="line">            <span class="keyword">return</span> count;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">// ===============================list=================================</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的内容</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> start 开始</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> end   结束 0 到 -1代表所有值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> List&lt;Object&gt; <span class="title">lGet</span><span class="params">(String key, <span class="keyword">long</span> start, <span class="keyword">long</span> end)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().range(key, start, end);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 获取list缓存的长度</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key 键</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lGetListSize</span><span class="params">(String key)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().size(key);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 通过索引 获取list中的值</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引 index&gt;=0时， 0 表头，1 第二个元素，依次类推；index&lt;0时，-1，表尾，-2倒数第二个元素，依次类推</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> Object <span class="title">lGetIndex</span><span class="params">(String key, <span class="keyword">long</span> index)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            <span class="keyword">return</span> redisTemplate.opsForList().index(key, index);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">null</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒)</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, Object value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPush(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 将list放入缓存</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> time  时间(秒)</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lSet</span><span class="params">(String key, List&lt;Object&gt; value, <span class="keyword">long</span> time)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().rightPushAll(key, value);</span><br><span class="line">            <span class="keyword">if</span> (time &gt; <span class="number">0</span>) &#123;</span><br><span class="line">                expire(key, time);</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 根据索引修改list中的某条数据</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> index 索引</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span></span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">boolean</span> <span class="title">lUpdateIndex</span><span class="params">(String key, <span class="keyword">long</span> index, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            redisTemplate.opsForList().set(key, index, value);</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">true</span>;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">false</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="comment">/**</span></span><br><span class="line"><span class="comment">     * 移除N个值为value</span></span><br><span class="line"><span class="comment">     *</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> key   键</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> count 移除多少个</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@param</span> value 值</span></span><br><span class="line"><span class="comment">     * <span class="doctag">@return</span> 移除的个数</span></span><br><span class="line"><span class="comment">     */</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">long</span> <span class="title">lRemove</span><span class="params">(String key, <span class="keyword">long</span> count, Object value)</span> </span>&#123;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            Long remove = redisTemplate.opsForList().remove(key, count, value);</span><br><span class="line">            <span class="keyword">return</span> remove;</span><br><span class="line">        &#125; <span class="keyword">catch</span> (Exception e) &#123;</span><br><span class="line">            e.printStackTrace();</span><br><span class="line">            <span class="keyword">return</span> <span class="number">0</span>;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h3 id="使用-2"><a href="#使用-2" class="headerlink" title="使用"></a>使用</h3><figure class="highlight java"><table><tr><td class="code"><pre><span class="line"><span class="meta">@SpringBootTest</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">SpringbootRedis02ApplicationTests</span> </span>&#123;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Autowired</span></span><br><span class="line">    <span class="keyword">private</span> RedisUtil redisUtil;</span><br><span class="line"></span><br><span class="line">    <span class="meta">@Test</span></span><br><span class="line">    <span class="function"><span class="keyword">public</span> <span class="keyword">void</span> <span class="title">test1</span><span class="params">()</span> </span>&#123;</span><br><span class="line">        redisUtil.set(<span class="string">&quot;name&quot;</span>, <span class="string">&quot;张三&quot;</span>);</span><br><span class="line">        System.out.println(redisUtil.get(<span class="string">&quot;name&quot;</span>));</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<h1 id="redis-conf"><a href="#redis-conf" class="headerlink" title="redis.conf"></a>redis.conf</h1><blockquote>
<p>存储数据大小(单位)</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># 1k =&gt; 1000 bytes</span></span><br><span class="line"><span class="comment"># 1kb =&gt; 1024 bytes</span></span><br><span class="line"><span class="comment"># 1m =&gt; 1000000 bytes</span></span><br><span class="line"><span class="comment"># 1mb =&gt; 1024*1024 bytes</span></span><br><span class="line"><span class="comment"># 1g =&gt; 1000000000 bytes</span></span><br><span class="line"><span class="comment"># 1gb =&gt; 1024*1024*1024 bytes</span></span><br><span class="line"><span class="comment">#</span></span><br><span class="line"><span class="comment"># units are case insensitive so 1GB 1Gb 1gB are all the same.</span></span><br><span class="line"><span class="comment">#对大小写不敏感</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>NETWORK    网络</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="built_in">bind</span> 127.0.0.1   <span class="comment"># 绑定的ip,*表示都可以访问</span></span><br><span class="line">protected-mode yes <span class="comment"># 保护模式,默认开启</span></span><br><span class="line">port 6379  <span class="comment"># 端口设置</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>INCLUDES    引入外部文件</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line"><span class="comment"># include /path/to/local.conf</span></span><br><span class="line"><span class="comment"># include /path/to/other.conf</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>GENERAL    通用配置</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">daemonize yes  <span class="comment">#以守护进程的方式运行，默认是 no，我们需要自己开启为yes,表示后台运行</span></span><br><span class="line">pidfile /var/run/redis_6379.pid  <span class="comment"># 如果以后台的方式运行，我们就需要指定一个 pid 文件</span></span><br><span class="line"></span><br><span class="line"><span class="comment">#日志级别</span></span><br><span class="line"><span class="comment"># Specify the server verbosity level.</span></span><br><span class="line"><span class="comment"># This can be one of:</span></span><br><span class="line"><span class="comment"># debug (a lot of information, useful for development/testing) 测试阶段</span></span><br><span class="line"><span class="comment"># verbose (many rarely useful info, but not a mess like the debug level)</span></span><br><span class="line"><span class="comment"># notice (moderately verbose, what you want in production probably) 生产环境</span></span><br><span class="line"><span class="comment"># warning (only very important / critical messages are logged) 警告</span></span><br><span class="line">loglevel notice</span><br><span class="line">logfile <span class="string">&quot;&quot;</span>  <span class="comment">#日志的文件位置名</span></span><br><span class="line">databases 16  <span class="comment"># 数据库的数量，默认是 16 个数据库</span></span><br><span class="line">always-show-logo yes  <span class="comment"># 是否总是显示redis开启时的logo</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>SNAPSHOTTING持久化,快照</p>
<p>在规定的时间内,执行多少次操作,就会持久化到文件.rdb或.aof</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">save 900 1   <span class="comment">#900秒内,修改1次数据,就进行保存</span></span><br><span class="line">save 300 10   <span class="comment">#300秒内,修改10次数据,就进行保存</span></span><br><span class="line">save 60 10000   <span class="comment">#60秒内,修改10000次数据,就进行保存</span></span><br><span class="line"></span><br><span class="line">stop-writes-on-bgsave-error yes  <span class="comment"># 持久化如果出错，是否还需要继续工作！</span></span><br><span class="line">rdbcompression yes <span class="comment"># 是否压缩 rdb 文件，需要消耗一些cpu资源</span></span><br><span class="line">rdbchecksum yes <span class="comment"># 保存rdb文件的时候，进行错误的检查校验</span></span><br><span class="line">dir ./  <span class="comment"># rdb 文件保存的目录</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>SECURITY 安全</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config get requirepass  <span class="comment"># 获取redis的密码</span></span><br><span class="line">1) <span class="string">&quot;requirepass&quot;</span></span><br><span class="line">2) <span class="string">&quot;&quot;</span></span><br><span class="line">127.0.0.1:6379&gt; config <span class="built_in">set</span> requirepass <span class="string">&quot;123456&quot;</span>  <span class="comment"># 设置redis的密码</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; config get requirepass  <span class="comment"># 发现所有的命令都没有权限了</span></span><br><span class="line">(error) NOAUTH Authentication required.</span><br><span class="line">127.0.0.1:6379&gt; ping</span><br><span class="line">(error) NOAUTH Authentication required.</span><br><span class="line">127.0.0.1:6379&gt; auth 123456  <span class="comment"># 使用密码进行登录！</span></span><br><span class="line">OK</span><br><span class="line">127.0.0.1:6379&gt; config get requirepass</span><br><span class="line">1) <span class="string">&quot;requirepass&quot;</span></span><br><span class="line">2) <span class="string">&quot;123456&quot;</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>CLIENTS  客户端限制</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">maxclients 10000  <span class="comment"># 设置能连接上redis的最大客户端的数量</span></span><br><span class="line"></span><br><span class="line">maxmemory &lt;bytes&gt;  <span class="comment"># redis 配置最大的内存容量</span></span><br><span class="line"></span><br><span class="line">maxmemory-policy noeviction  <span class="comment"># 内存到达上限之后的处理策略</span></span><br><span class="line"><span class="comment">#  1、volatile-lru：只对设置了过期时间的key进行LRU（默认值）</span></span><br><span class="line"><span class="comment">#  2、allkeys-lru ： 删除lru算法的key </span></span><br><span class="line"><span class="comment">#  3、volatile-random：随机删除即将过期key </span></span><br><span class="line"><span class="comment">#  4、allkeys-random：随机删除 </span></span><br><span class="line"><span class="comment">#  5、volatile-ttl ： 删除即将过期的 </span></span><br><span class="line"><span class="comment">#  6、noeviction ： 永不过期，返回错误</span></span><br></pre></td></tr></table></figure>

<blockquote>
<p>APPEND ONLY 模式 aof配置</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">appendonly no   <span class="comment"># 默认是不开启aof模式的，默认是使用rdb方式持久化的，在大部分所有的情况下，rdb完全够用！</span></span><br><span class="line">appendfilename <span class="string">&quot;appendonly.aof&quot;</span>  <span class="comment"># 持久化的文件的名字</span></span><br><span class="line"></span><br><span class="line"><span class="comment"># appendfsync always  # 每次修改都会 sync。消耗性能</span></span><br><span class="line">appendfsync everysec  <span class="comment"># 每秒执行一次 sync，可能会丢失这1s的数据！</span></span><br><span class="line"><span class="comment"># appendfsync no    # 不执行 sync，这个时候操作系统自己同步数据，速度最快！</span></span><br></pre></td></tr></table></figure>

<h1 id="Redis持久化"><a href="#Redis持久化" class="headerlink" title="Redis持久化"></a>Redis持久化</h1><h2 id="RDB"><a href="#RDB" class="headerlink" title="RDB"></a>RDB</h2><h3 id="概述-1"><a href="#概述-1" class="headerlink" title="概述"></a>概述</h3><p><a href="https://www.bilibili.com/video/BV1S54y1R7SB/?p=28">学习视频</a></p>
<p>rdb是一种临时文件</p>
<p><img data-src="/images/tool/redis-RDB.png"></p>
<blockquote>
<p>Redis会单独创建（fork）一个子进程来进行持久化，会先将数据写入到一个临时文件中，待持久化过程都结束了，再用这个临时文件替换上次持久化好的文件。整个过程中，主进程是不进行任何IO操作的。<br>这就确保了极高的性能。如果需要进行大规模数据的恢复，且对于数据恢复的完整性不是非常敏感，那RDB方式要比AOF方式更加的高效。RDB的缺点是最后一次持久化后的数据可能丢失。我们默认的就是RDB，一般情况下不需要修改这个配置！</p>
</blockquote>
<p>有时候在生产环境我们会将这个文件进行备份！</p>
<blockquote>
<p>rdb保存的文件是dump.rdb都是在配置文件中快照中进行配置的</p>
</blockquote>
<figure class="highlight txt"><table><tr><td class="code"><pre><span class="line">dbfilename dump.rdb</span><br></pre></td></tr></table></figure>

<h3 id="触发机制"><a href="#触发机制" class="headerlink" title="触发机制"></a>触发机制</h3><ol>
<li>save的规则满足的情况下，会自动触发rdb规则</li>
<li>执行 flushall 命令，也会触发我们的rdb规则！</li>
<li>退出redis，也会产生 rdb 文件！</li>
</ol>
<p>备份就自动生成一个 dump.rdb</p>
<h3 id="恢复RDB"><a href="#恢复RDB" class="headerlink" title="恢复RDB"></a>恢复RDB</h3><p>1、只需要将rdb文件放在我们redis启动目录就可以，redis启动的时候会自动检查dump.rdb 恢复其中的数据！<br>2、查看需要存在的位置</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; config get dir</span><br><span class="line">1) &quot;dir&quot;</span><br><span class="line">2) &quot;/usr/local/bin&quot;  # 如果在这个目录下存在 dump.rdb 文件，启动就会自动恢复其中的数据</span><br></pre></td></tr></table></figure>

<h3 id="优缺点"><a href="#优缺点" class="headerlink" title="优缺点"></a>优缺点</h3><blockquote>
<p>优点</p>
</blockquote>
<p>1、适合大规模的数据恢复<br>2、对数据的完整性要不高</p>
<blockquote>
<p>缺点</p>
</blockquote>
<p>1、需要一定的时间间隔进程操作！如果redis意外宕机了，这个最后一次修改数据就没有的了<br>2、fork进程的时候，会占用一定的内容空间</p>
<h2 id="AOF"><a href="#AOF" class="headerlink" title="AOF"></a>AOF</h2><h3 id="概述-2"><a href="#概述-2" class="headerlink" title="概述"></a>概述</h3><p>将我们的所有命令都记录下来，history，恢复的时候就把这个文件全部在执行一遍！</p>
<p>以日志的形式来记录每个写操作，将Redis执行过的所有指令记录下来（读的操作不记录),只许追加文件但不可以改写文件，redis启动之初会读取该文件重新构建数据，换言之，redis重启的话就根据日志文件的内容将写指令从前到后执行一次以完成数据的恢复工作</p>
<p><img data-src="/images/tool/redis-AOF.png"></p>
<h3 id="配置-1"><a href="#配置-1" class="headerlink" title="配置"></a>配置</h3><blockquote>
<p>Aof保存的是 appendonly.aof 文件</p>
</blockquote>
<figure class="highlight xml"><table><tr><td class="code"><pre><span class="line">appendonly no  #默认不开启aof</span><br><span class="line">appendfilename &quot;appendonly.aof&quot; #默认使用此文件</span><br><span class="line"></span><br><span class="line"># appendfsync always  #一直保存</span><br><span class="line">appendfsync everysec  #每一秒保存</span><br><span class="line"># appendfsync no      #不保存</span><br></pre></td></tr></table></figure>

<h3 id="修复"><a href="#修复" class="headerlink" title="修复"></a>修复</h3><p>如果这个 aof 文件有错误，这时候 redis 是启动不起来的吗，我们需要修复这个aof文件<br>redis 给我们提供了一个工具<code> redis-check-aof --fix</code></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">redis-check-aof --fix appendonly.aof</span><br></pre></td></tr></table></figure>

<h3 id="重写"><a href="#重写" class="headerlink" title="重写"></a>重写</h3><p>aof默认文件无限追加</p>
<figure class="highlight plain"><table><tr><td class="code"><pre><span class="line">auto-aof-rewrite-percentage 100</span><br><span class="line">auto-aof-rewrite-min-size 64mb</span><br></pre></td></tr></table></figure>

<p>如果 aof 文件大于 64m，太大了！ fork一个新的进程来将我们的文件进行重写！</p>
<h3 id="优缺点-1"><a href="#优缺点-1" class="headerlink" title="优缺点"></a>优缺点</h3><blockquote>
<p>优点</p>
</blockquote>
<ol>
<li>每一次修改都同步，文件的完整会更加好</li>
<li>每秒同步一次，可能会丢失一秒的数据</li>
<li>从不同步，效率最高的！</li>
</ol>
<blockquote>
<p>缺点</p>
</blockquote>
<ol>
<li><p>相对于数据文件来说，aof远远大于 rdb，修复的速度也比 rdb慢！</p>
</li>
<li><p>Aof 运行效率也要比 rdb 慢，所以我们redis默认的配置就是rdb持久化！</p>
</li>
</ol>
<h2 id="扩展"><a href="#扩展" class="headerlink" title="扩展"></a>扩展</h2><ol>
<li>RDB 持久化方式能够在指定的时间间隔内对你的数据进行快照存储</li>
<li>AOF 持久化方式记录每次对服务器写的操作，当服务器重启的时候会重新执行这些命令来恢复原始的数据，AOF命令以Redis 协议追加保存每次写的操作到文件末尾，Redis还能对AOF文件进行后台重写，使得AOF文件的体积不至于过大。</li>
<li>只做缓存，如果你只希望你的数据在服务器运行的时候存在，你也可以不使用任何持久化</li>
<li>同时开启两种持久化方式</li>
</ol>
<ul>
<li>在这种情况下，当redis重启的时候会优先载入AOF文件来恢复原始的数据，因为在通常情况下AOF文件保存的数据集要比RDB文件保存的数据集要完整。</li>
<li>RDB 的数据不实时，同时使用两者时服务器重启也只会找AOF文件，那要不要只使用AOF呢？作者建议不要，因为RDB更适合用于备份数据库（AOF在不断变化不好备份），快速重启，而且不会有AOF可能潜在的Bug，留着作为一个万一的手段。</li>
</ul>
<ol start="5">
<li>性能建议</li>
</ol>
<ul>
<li><p>因为RDB文件只用作后备用途，建议只在Slave上持久化RDB文件，而且只要15分钟备份一次就够了，只保留 save 900 1 这条规则。</p>
</li>
<li><p>如果Enable AOF ，好处是在最恶劣情况下也只会丢失不超过两秒数据，启动脚本较简单只load自己的AOF文件就可以了，代价一是带来了持续的IO，二是AOF rewrite 的最后将 rewrite 过程中产生的新数据写到新文件造成的阻塞几乎是不可避免的。只要硬盘许可，应该尽量减少AOF rewrite的频率，AOF重写的基础大小默认值64M太小了，可以设到5G以上，默认超过原大小100%大小重写可以改到适当的数值。</p>
</li>
<li><p>如果不Enable AOF ，仅靠 Master-Slave Repllcation 实现高可用性也可以，能省掉一大笔IO，也减少了rewrite时带来的系统波动。代价是如果Master/Slave 同时倒掉，会丢失十几分钟的数据，启动脚本也要比较两个 Master/Slave 中的 RDB文件，载入较新的那个，微博就是这种架构。</p>
</li>
</ul>
<h1 id="发布订阅"><a href="#发布订阅" class="headerlink" title="发布订阅"></a>发布订阅</h1><p><a href="https://www.runoob.com/redis/redis-pub-sub.html">菜鸟教程</a></p>
<h2 id="图示"><a href="#图示" class="headerlink" title="图示"></a>图示</h2><p>频道 channel1 ， 以及订阅这个频道的三个客户端 —— client2 、 client5 和 client1 </p>
<p>当有新消息通过 PUBLISH 命令发送给频道 channel1 时， 这个消息就会被发送给订阅它的三个客户端：</p>
<p><img data-src="/images/tool/redis-1.png"></p>
<h2 id="命令"><a href="#命令" class="headerlink" title="命令"></a>命令</h2><table>
<thead>
<tr>
<th align="left">序号</th>
<th align="left">命令及描述</th>
</tr>
</thead>
<tbody><tr>
<td align="left">1</td>
<td align="left">PSUBSCRIBE pattern [pattern …]订阅一个或多个符合给定模式的频道。</td>
</tr>
<tr>
<td align="left">2</td>
<td align="left">PUBSUB subcommand [argument [argument …]]查看订阅与发布系统状态。</td>
</tr>
<tr>
<td align="left">3</td>
<td align="left">PUBLISH channel message 将信息发送到指定的频道。</td>
</tr>
<tr>
<td align="left">4</td>
<td align="left">PUNSUBSCRIBE [pattern [pattern …]] 退订所有给定模式的频道。</td>
</tr>
<tr>
<td align="left">5</td>
<td align="left">SUBSCRIBE channel [channel …]订阅给定的一个或多个频道的信息。</td>
</tr>
<tr>
<td align="left">6</td>
<td align="left">UNSUBSCRIBE [channel [channel …]] 指退订给定的频道。</td>
</tr>
</tbody></table>
<p>订阅一个频道,名字是<code>wty</code></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SUBSCRIBE wty</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) <span class="string">&quot;subscribe&quot;</span></span><br><span class="line">2) <span class="string">&quot;wty&quot;</span></span><br><span class="line">3) (<span class="built_in">integer</span>) 1</span><br></pre></td></tr></table></figure>

<p>频道发布消息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; PUBLISH  wty &quot;hello,wty&quot;</span><br><span class="line">(integer) 1</span><br></pre></td></tr></table></figure>

<p>订阅者接收到消息</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; SUBSCRIBE wty</span><br><span class="line">Reading messages... (press Ctrl-C to quit)</span><br><span class="line">1) &quot;subscribe&quot;</span><br><span class="line">2) &quot;wty&quot;</span><br><span class="line">3) (integer) 1</span><br><span class="line">1) &quot;message&quot;</span><br><span class="line">2) &quot;wty&quot;</span><br><span class="line">3) &quot;hello,wty&quot;</span><br></pre></td></tr></table></figure>

<blockquote>
<p>使用场景</p>
</blockquote>
<ol>
<li>实时聊天</li>
<li>实时消息系统</li>
<li>订阅,关注等系统</li>
</ol>
<h1 id="主从复制"><a href="#主从复制" class="headerlink" title="主从复制"></a>主从复制</h1><h2 id="概述-3"><a href="#概述-3" class="headerlink" title="概述"></a>概述</h2><p>主从复制，是指将一台Redis服务器的数据，复制到其他的Redis服务器。前者称为主节点(master/leader)，后者称为从节点(slave/follower)；</p>
<p><strong>数据的复制是单向的，只能由主节点到从节点.</strong>  </p>
<p>Master以写为主，Slave 以读为主。</p>
<p>默认情况下，每台Redis服务器都是主节点；<br>且一个主节点可以有多个从节点(或没有从节点)，但一个从节点只能有一个主节点</p>
<p>主从复制的作用主要包括：</p>
<ol>
<li>数据冗余：主从复制实现了数据的热备份，是持久化之外的一种数据冗余方式。</li>
<li>故障恢复：当主节点出现问题时，可以由从节点提供服务，实现快速的故障恢复；实际上是一种服务的冗余。</li>
<li>负载均衡：在主从复制的基础上，配合读写分离，可以由主节点提供写服务，由从节点提供读服务（即写Redis数据时应用连接主节点，读Redis数据时应用连接从节点），分担服务器负载；尤其是在写少读多的场景下，通过多个从节点分担读负载，可以大大提高Redis服务器的并发量。</li>
<li>高可用（集群）基石：除了上述作用以外，主从复制还是哨兵和集群能够实施的基础，因此说主从复制是Redis高可用的基础。一般来说，要将Redis运用于工程项目中，只使用一台Redis是万万不能的（宕机），原因如下：</li>
</ol>
<ul>
<li><p>从结构上，单个Redis服务器会发生单点故障，并且一台服务器需要处理所有的请求负载，压力较大；</p>
</li>
<li><p>从容量上，单个Redis服务器内存容量有限，就算一台Redis服务器内存容量为256G，也不能将所有内存用作Redis存储内存，一般来说，<strong>单台Redis最大使用内存不应该超过20G</strong>。</p>
</li>
</ul>
<h2 id="环境配置"><a href="#环境配置" class="headerlink" title="环境配置"></a>环境配置</h2><p><strong>只配置从库，不用配置主库！</strong></p>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication   <span class="comment">#查看当前库的信息</span></span><br><span class="line"><span class="comment"># Replication</span></span><br><span class="line">role:master  <span class="comment">#角色</span></span><br><span class="line">connected_slaves:0  <span class="comment">#当前连接的从机数量</span></span><br></pre></td></tr></table></figure>

<p>一主二从服务配置</p>
<p>复制3个配置文件，分别是redis79.conf,redis80.conf,redis81conf,然后修改从库对应的信息</p>
<ol>
<li>端口</li>
<li>pidfile 名字</li>
<li>logfile文件名字</li>
<li>dump.rdb 名字</li>
</ol>
<h2 id="一主二从"><a href="#一主二从" class="headerlink" title="一主二从"></a>一主二从</h2><p><strong>默认情况下,每一台服务器都是主节点</strong></p>
<p>修改完成后启动服务器,把79作为主机,80 81作为从机</p>
<blockquote>
<p>临时更改主机</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">slaveof  127.0.01  6379</span><br></pre></td></tr></table></figure>

<p>主机查看自己的从机</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6379&gt; info replication</span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication</span></span><br><span class="line">role:master</span><br><span class="line">connected_slaves:2</span><br><span class="line">slave0:ip=127.0.0.1,port=6380,state=online,offset=546,lag=1</span><br><span class="line">slave1:ip=127.0.0.1,port=6381,state=online,offset=546,lag=0</span><br></pre></td></tr></table></figure>

<p>从机查看自己的主机</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">127.0.0.1:6380&gt; info replication</span><br><span class="line"><span class="meta">#</span><span class="bash"> Replication</span></span><br><span class="line">role:slave</span><br><span class="line">master_host:127.0.0.1</span><br><span class="line">master_port:6379</span><br></pre></td></tr></table></figure>

<blockquote>
<p>永久更改主机</p>
</blockquote>
<p>需要在从机配置文件中找到<code>REPLICATION</code>配置</p>
<p>更改<code># replicaof &lt;masterip&gt; &lt;masterport&gt;</code>为<code>replicaof 127.0.0.1 6379</code>即可</p>
<blockquote>
<p>细节</p>
</blockquote>
<p>主机可以写,从机只能读,主机中的所有信息和数据,都会自动被从机保存!</p>
<blockquote>
<p>复制原理</p>
</blockquote>
<p>Slave启动成功连接到Master后会发送一个sync同步命令<br>Master接到命令,启动后台的存盘进程,同时收集所有接收到的用于修改数据集命令,在后台进程执行完毕之后, master将传送整个数据文件到slave ,并完成一次完全同步。<br><strong>全量复制:</strong> 而slave服务在接收到数据库文件数据后,将其存盘并加载到内存中。<br><strong>增量复制:</strong> Master继续将新的所有收集到的修改命令依次传给slave ,完成同步<br>但是只要是重新连接master , -次完全同步(全量复制)将被自动执行!我们的数据一定可以在从机中看到!</p>
<blockquote>
<p>从机变主机</p>
</blockquote>
<p>如果主机宕机或者其他原因不存在时,从机执行以下命令,可以使自己成为主机</p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line">slaveof no one </span><br></pre></td></tr></table></figure>

<p>其他从机需要<strong>手动</strong>重新配置主从模式</p>
<h1 id="哨兵模式"><a href="#哨兵模式" class="headerlink" title="哨兵模式"></a>哨兵模式</h1><h2 id="简述"><a href="#简述" class="headerlink" title="简述"></a>简述</h2><p><a href="https://www.jianshu.com/p/06ab9daf921d">简书文章</a></p>
<p>哨兵(Sentinel)模式是一种特殊的模式，首先Redis提供了哨兵的命令，哨兵是一个独立的进程，作为进程，它会独立运行。</p>
<p>其原理是<strong>哨兵通过发送命令，等待Redis服务器响应，从而监控运行的多个Redis实例。</strong></p>
<p>这里的哨兵有两个作用</p>
<ul>
<li>通过发送命令，让Redis服务器返回监控其运行状态，包括主服务器和从服务器。</li>
<li>当哨兵监测到master宕机，会自动将slave切换成master，然后通过<strong>发布订阅模式</strong>通知其他的从服务器，修改配置文件，让它们切换主机。</li>
</ul>
<p>然而一个哨兵进程对Redis服务器进行监控，可能会出现问题，为此，我们可以使用多个哨兵进行监控。各个哨兵之间还会进行监控，这样就形成了多哨兵模式。</p>
<p>用文字描述一下<strong>故障切换（failover）</strong>的过程。假设主服务器宕机，哨兵1先检测到这个结果，系统并不会马上进行failover过程，仅仅是哨兵1主观的认为主服务器不可用，这个现象成为<strong>主观下线</strong>。当后面的哨兵也检测到主服务器不可用，并且数量达到一定值时，那么哨兵之间就会进行一次投票，投票的结果由一个哨兵发起，进行failover操作。切换成功后，就会通过发布订阅模式，让各个哨兵把自己监控的从服务器实现切换主机，这个过程称为<strong>客观下线</strong>。这样对于客户端而言，一切都是透明的</p>
<h2 id="小实验"><a href="#小实验" class="headerlink" title="小实验"></a>小实验</h2><blockquote>
<p>前提</p>
</blockquote>
<p>一主二从,6379是主机,6380和6381是从机</p>
<blockquote>
<p>编写一个哨兵配置文件 sentinel.conf</p>
</blockquote>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash"> sentinel monitor 自命名 Ip    端口   1</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 1表示会自动投票选举产生一个新的主机</span></span><br><span class="line">sentinel monitor myredis 127.0.0.1 6379 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 启动</span></span><br><span class="line">redis-sentinel redisconf/sentinel.conf</span><br></pre></td></tr></table></figure>

<blockquote>
<p>以下日志,详细地展示了新的主机诞生过程</p>
</blockquote>
<figure class="highlight bash"><table><tr><td class="code"><pre><span class="line">2032:X 02 Mar 2021 15:22:39.163 <span class="comment"># oO0OoO0OoO0Oo Redis is starting oO0OoO0OoO0Oo</span></span><br><span class="line">2032:X 02 Mar 2021 15:22:39.163 <span class="comment"># Redis version=6.0.10, bits=64, commit=00000000, modified=0, pid=2032, just started</span></span><br><span class="line">2032:X 02 Mar 2021 15:22:39.163 <span class="comment"># Configuration loaded</span></span><br><span class="line">2032:X 02 Mar 2021 15:22:39.164 * Increased maximum number of open files to 10032 (it was originally <span class="built_in">set</span> to 1024).</span><br><span class="line">                _._</span><br><span class="line">           _.-``__ <span class="string">&#x27;&#x27;</span>-._</span><br><span class="line">      _.-``    `.  `_.  <span class="string">&#x27;&#x27;</span>-._           Redis 6.0.10 (00000000/0) 64 bit</span><br><span class="line">  .-`` .-```.  ```\/    _.,_ <span class="string">&#x27;&#x27;</span>-._</span><br><span class="line"> (    <span class="string">&#x27;      ,       .-`  | `,    )     Running in sentinel mode</span></span><br><span class="line"><span class="string"> |`-._`-...-` __...-.``-._|&#x27;</span>` _.-<span class="string">&#x27;|     Port: 26379</span></span><br><span class="line"><span class="string"> |    `-._   `._    /     _.-&#x27;</span>    |     PID: 2032</span><br><span class="line">  `-._    `-._  `-./  _.-<span class="string">&#x27;    _.-&#x27;</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |           http://redis.io</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span></span><br><span class="line"> |`-._`-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span>_.-<span class="string">&#x27;|</span></span><br><span class="line"><span class="string"> |    `-._`-._        _.-&#x27;</span>_.-<span class="string">&#x27;    |</span></span><br><span class="line"><span class="string">  `-._    `-._`-.__.-&#x27;</span>_.-<span class="string">&#x27;    _.-&#x27;</span></span><br><span class="line">      `-._    `-.__.-<span class="string">&#x27;    _.-&#x27;</span></span><br><span class="line">          `-._        _.-<span class="string">&#x27;</span></span><br><span class="line"><span class="string">              `-.__.-&#x27;</span></span><br><span class="line"></span><br><span class="line">2032:X 02 Mar 2021 15:22:39.164 <span class="comment"># WARNING: The TCP backlog setting of 511 cannot be enforced because /proc/sys/net/core/somaxconn is set to the lower value of 128.</span></span><br><span class="line">2032:X 02 Mar 2021 15:22:39.261 <span class="comment"># Sentinel ID is 0cd06673e96d45305e6619acaa03ea9f2000da4b</span></span><br><span class="line">2032:X 02 Mar 2021 15:22:39.261 <span class="comment"># +monitor master myredis 127.0.0.1 6379 quorum 1</span></span><br><span class="line">2032:X 02 Mar 2021 15:22:39.263 * +slave slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.1 6379</span><br><span class="line">2032:X 02 Mar 2021 15:22:39.268 * +slave slave 127.0.0.1:6381 127.0.0.1 6381 @ myredis 127.0.0.1 6379</span><br><span class="line">2032:X 02 Mar 2021 15:24:40.932 <span class="comment"># +sdown master myredis 127.0.0.1 6379</span></span><br><span class="line">2032:X 02 Mar 2021 15:24:40.932 <span class="comment"># +odown master myredis 127.0.0.1 6379 #quorum 1/1</span></span><br><span class="line">2032:X 02 Mar 2021 15:24:40.932 <span class="comment"># +new-epoch 1</span></span><br><span class="line">2032:X 02 Mar 2021 15:24:40.932 <span class="comment"># +try-failover master myredis 127.0.0.1 6379</span></span><br><span class="line">2032:X 02 Mar 2021 15:24:41.015 <span class="comment"># +vote-for-leader 0cd06673e96d45305e6619acaa03ea9f2000da4b 1</span></span><br><span class="line">2032:X 02 Mar 2021 15:24:41.015 <span class="comment"># +elected-leader master myredis 127.0.0.1 6379</span></span><br><span class="line">2032:X 02 Mar 2021 15:24:41.015 <span class="comment"># +failover-state-select-slave master myredis 127.0.0.1 6379</span></span><br><span class="line">2032:X 02 Mar 2021 15:24:41.105 <span class="comment"># +selected-slave slave 127.0.0.1:6381 127.0.0.1 6381 @ myredis 127.0.0.1 6379</span></span><br><span class="line">2032:X 02 Mar 2021 15:24:41.105 * +failover-state-send-slaveof-noone slave 127.0.0.1:6381 127.0.0.1 6381 @ myredis 127.0.0.1 6379</span><br><span class="line">2032:X 02 Mar 2021 15:24:41.196 * +failover-state-wait-promotion slave 127.0.0.1:6381 127.0.0.1 6381 @ myredis127.0.0.1 6379</span><br><span class="line">2032:X 02 Mar 2021 15:24:41.329 <span class="comment"># +promoted-slave slave 127.0.0.1:6381 127.0.0.1 6381 @ myredis 127.0.0.1 6379</span></span><br><span class="line">2032:X 02 Mar 2021 15:24:41.329 <span class="comment"># +failover-state-reconf-slaves master myredis 127.0.0.1 6379</span></span><br><span class="line">2032:X 02 Mar 2021 15:24:41.390 * +slave-reconf-sent slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.1 6379</span><br><span class="line">2032:X 02 Mar 2021 15:24:42.345 * +slave-reconf-inprog slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.16379</span><br><span class="line">2032:X 02 Mar 2021 15:24:42.345 * +slave-reconf-done slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.1 6379</span><br><span class="line">2032:X 02 Mar 2021 15:24:42.396 <span class="comment"># +failover-end master myredis 127.0.0.1 6379</span></span><br><span class="line">2032:X 02 Mar 2021 15:24:42.396 <span class="comment"># +switch-master myredis 127.0.0.1 6379 127.0.0.1 6381</span></span><br><span class="line">2032:X 02 Mar 2021 15:24:42.396 * +slave slave 127.0.0.1:6380 127.0.0.1 6380 @ myredis 127.0.0.1 6381</span><br><span class="line">2032:X 02 Mar 2021 15:24:42.396 * +slave slave 127.0.0.1:6379 127.0.0.1 6379 @ myredis 127.0.0.1 6381</span><br><span class="line">2032:X 02 Mar 2021 15:25:12.403 <span class="comment"># +sdown slave 127.0.0.1:6379 127.0.0.1 6379 @ myredis 127.0.0.1 6381</span></span><br></pre></td></tr></table></figure>

<h2 id="哨兵配置"><a href="#哨兵配置" class="headerlink" title="哨兵配置"></a>哨兵配置</h2><p><a href="http://c.biancheng.net/view/4567.html">教程</a></p>
<p><a href="https://blog.csdn.net/weixin_48692664/article/details/107459294">CSDN博客</a></p>
<figure class="highlight shell"><table><tr><td class="code"><pre><span class="line"><span class="meta">#</span><span class="bash">Example sentinel.conf</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">哨兵sentinel实例运行的端口 默认26379</span></span><br><span class="line">port 26379</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">哨兵sentinel的工作目录</span></span><br><span class="line">dir /tmp</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">哨兵sentinel监控的redis主节点的 ip port</span></span><br><span class="line"><span class="meta">#</span><span class="bash">master-name可以自己命名的主节点名字，只能由字母A-z、数字0-9、这三个字符<span class="string">&quot;.-_&quot;</span>组成。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">quorum 配置多少个sentinel哨兵统一认为master主节点失联 那么这时客观上认为主节点失联了</span></span><br><span class="line"><span class="meta">#</span><span class="bash">sentinel monitor &lt;master-name&gt; &lt;ip&gt; &lt;redis-port&gt; &lt;quorum&gt;</span></span><br><span class="line">sentinel monitor mymaster 127.0.0.1 6379 2</span><br><span class="line"> </span><br><span class="line"><span class="meta">#</span><span class="bash">当在Redis实例中开启了requirepass foobared授权密码，这样所有连接Redis实例的客户端都要提供密码 </span></span><br><span class="line"><span class="meta">#</span><span class="bash">设置哨兵sentinel连接主从的密码，注意必须为主从设置一样的验证密码</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel auth-pass &lt;master-name&gt; &lt;password&gt;</span></span><br><span class="line">sentinel auth-pass mymaster XXX</span><br><span class="line"><span class="meta">#</span><span class="bash">指定多少毫秒之后主节点没有应答哨兵，此时哨兵主观上认为主节点下线，默认30秒</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel down-after-milliseconds &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel down-after-milliseconds mymaster 30000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个配置项指定了在发生failover主备切换（选举）时多可以有多少个slave同时对新的master进行同步，数字越小，完成failover所需的时间就越长，但是如果这个数字越大，就意味着越多的slave因为replication而不可用。可以通过将这个值设为1来保证每次只有一个slave处于不能处理命令请求的状态。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel parallel-syncs &lt;master-name&gt; &lt;numslaves&gt;</span></span><br><span class="line">sentinel parallel-syncs mymaster 1</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">故障转移的超时时间failover-timeout可以用在以下这些方面：</span></span><br><span class="line"><span class="meta">#</span><span class="bash">1. 同一个sentinel对同一个master两次failover之间的间隔时间。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">2. 当一个slave从一个错误的master那里同步数据开始计算时间。直到slave被纠正为向正确的master那里同步数据时。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">3.当想要取消一个正在进行的failover所需要的时间。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">4.当进行failover时，配置所有slaves指向新的master所需的大时间。不过，即使过了这个超时，slaves依然会被正确配置为指向master，但是就不按parallel-syncs所配置的规则来了<span class="comment">#默认三分钟</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel failover-timeout &lt;master-name&gt; &lt;milliseconds&gt;</span></span><br><span class="line">sentinel failover-timeout mymaster 180000</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">SCRIPTS EXECUTION</span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">配置当某一事件发生时所需要执行的脚本，可以通过脚本来通知管理员，例如当系统运行不正常时发邮件通知相关人员。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">对于脚本的运行结果有以下规则：</span></span><br><span class="line"><span class="meta">#</span><span class="bash">若脚本执行后返回1，那么该脚本稍后将会被再次执行，重复次数目前默认为10</span></span><br><span class="line"><span class="meta">#</span><span class="bash">若脚本执行后返回2，或者比2更高的一个返回值，脚本将不会重复执行。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">如果脚本在执行过程中由于收到系统中断信号被终止了，则同返回值为1时的行为相同。<span class="comment">#一个脚本的大执行时间为60s，如果超过这个时间，脚本将会被一个SIGKILL信号终止，之后重新执行。</span></span></span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">通知型脚本:当sentinel有任何警告级别的事件发生时（比如说redis实例的主观失效和客观失效等等），将会去调用这个脚本，这时这个脚本应该通过邮件，SMS等方式去通知系统管理员关于系统不正常运行的信息。调用该脚本时，将传给脚本两个参数，一个是事件的类型，一个是事件的描述。如果sentinel.conf配 置文件中配置了这个脚本路径，那么必须保证这个脚本存在于这个路径，并且是可执行的，否则sentinel无 法正常启动成功。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">通知脚本</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel notification-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line">sentinel notification-script mymaster /var/redis/notify.sh</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span><span class="bash">客户端重新配置主节点参数脚本</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 当一个master由于failover而发生改变时，这个脚本将会被调用，通知相关的客户端关于master地址已经发生改变的信息。</span></span><br><span class="line"><span class="meta">#</span><span class="bash">以下参数将会在调用脚本时传给脚本:</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> &lt;master-name&gt; &lt;role&gt; &lt;state&gt; &lt;from-ip&gt; &lt;from-port&gt; &lt;to-ip&gt; &lt;to-port&gt;</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 目前&lt;state&gt;总是“failover”, <span class="comment"># &lt;role&gt;是“leader”或者“observer”中的一个。</span></span></span><br><span class="line"><span class="meta">#</span><span class="bash">参数 from-ip, from-port, to-ip, to-port是用来和旧的master和新的master(即旧的slave)通信的</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> 这个脚本应该是通用的，能被多次调用，不是针对性的。</span></span><br><span class="line"><span class="meta">#</span><span class="bash"> sentinel client-reconfig-script &lt;master-name&gt; &lt;script-path&gt;</span></span><br><span class="line">sentinel client-reconfig-script mymaster /var/redis/reconfig.sh</span><br></pre></td></tr></table></figure>

<h1 id="缓存穿透和雪崩"><a href="#缓存穿透和雪崩" class="headerlink" title="缓存穿透和雪崩"></a>缓存穿透和雪崩</h1><h2 id="概念"><a href="#概念" class="headerlink" title="概念"></a>概念</h2><p><a href="https://blog.csdn.net/zeb_perfect/article/details/54135506">CSDN博客</a></p>
<blockquote>
<p>缓存穿透</p>
</blockquote>
<p>缓存穿透是指查询一个一定不存在的数据，由于缓存是不命中时被动写的，并且出于容错考虑，如果从存储层查不到数据则不写入缓存，这将导致这个不存在的数据每次请求都要到存储层去查询，失去了缓存的意义。在流量大时，可能DB就挂掉了，要是有人利用不存在的key频繁攻击我们的应用，这就是漏洞。</p>
<p><strong>解决方案</strong></p>
<p>有很多种方法可以有效地解决缓存穿透问题，最常见的则是采用布隆过滤器，将所有可能存在的数据哈希到一个足够大的bitmap中，一个一定不存在的数据会被 这个bitmap拦截掉，从而避免了对底层存储系统的查询压力。另外也有一个更为简单粗暴的方法，如果一个查询返回的数据为空（不管是数据不存在，还是系统故障），我们仍然把这个空结果进行缓存，但它的过期时间会很短，最长不超过五分钟。</p>
<blockquote>
<p>缓存雪崩</p>
</blockquote>
<p>缓存雪崩是指在我们设置缓存时采用了相同的过期时间，导致缓存在某一时刻同时失效，请求全部转发到DB，DB瞬时压力过重雪崩。</p>
<p><strong>解决方案</strong></p>
<p>缓存失效时的雪崩效应对底层系统的冲击非常可怕。大多数系统设计者考虑用加锁或者队列的方式保证缓存的单线程(进程)写，从而避免失效时大量的并发请求落到底层存储系统上。这里分享一个简单方案就是将缓存失效时间分散开，比如我们可以在原有的失效时间基础上增加一个随机值，比如1-5分钟随机，这样每一个缓存的过期时间的重复率就会降低，就很难引发集体失效的事件。</p>
<blockquote>
<p>缓存击穿</p>
</blockquote>
<p>​            对于一些设置了过期时间的key，如果这些key可能会在某些时间点被超高并发地访问，是一种非常“热点”的数据。这个时候，需要考虑一个问题：缓存被“击穿”的问题，这个和缓存雪崩的区别在于这里针对某一key缓存，前者则是很多key。</p>
<p>缓存在某个时间点过期的时候，恰好在这个时间点对这个Key有大量的并发请求过来，这些请求发现缓存过期一般都会从后端DB加载数据并回设到缓存，这个时候大并发的请求可能会瞬间把后端DB压垮。</p>
<p>​            这里需要注意和缓存击穿的区别,缓存击穿,是指一个key非常热点 ,在不停的扛着大并发,大并发集中对这一个点进行访问,当这个key在失效的瞬间,持续的大并发就穿破缓存,直接请求数据库,就像在一个屏障上凿开了一个洞。<br>当某个key在过期的瞬间,有大量的请求并发访问,这类数据一般是热点数据 ,由于缓存过期,会同时访问数据库来查询最新数据，并且回写缓存,会导使数据库瞬间压力过大。</p>
<p><strong>解决方案</strong></p>
<blockquote>
<p>redis高可用</p>
</blockquote>
<p>这个思想的含义是,既然redis有可能挂掉,那我多增设几台redis ,这样-台挂掉之 后其他的还可以继续工作,其实就是搭建的集群。</p>
<blockquote>
<p>限流降级</p>
</blockquote>
<p>这个解决方案的思想是,在缓存失效后,通过加锁或者队列来控制读数据库写缓存的线程数量。比如对某个key只允许-个线程查询数据和写缓存,其他线程等待。</p>
<blockquote>
<p>数据预热</p>
</blockquote>
<p>数据加热的含义就是在正式部署之前,我先把可能的数据先预先访问一遍,这样部分可能大量访问的数据就会加载到缓存中。在即将发生大并发访问前手动触发加载缓存不同的key ,设置不同的过期时间,让缓存失效的时间点尽量均匀。</p>
]]></content>
      <categories>
        <category>linux</category>
      </categories>
      <tags>
        <tag>redis</tag>
      </tags>
  </entry>
</search>
